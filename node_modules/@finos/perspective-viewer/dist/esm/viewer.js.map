{"version":3,"file":"viewer.js","sources":["@finos/perspective-vieux/src/js/vieux.js","../../src/js/polyfill.js","../../src/js/utils.js","../../src/js/viewer/renderers.js","../../src/js/row.js","../../src/js/viewer/dragdrop.js","../../src/js/viewer/cancel_task.js","../../src/js/viewer/state_element.js","../../src/js/viewer/perspective_element.js","../../src/js/viewer/dom_element.js","../../src/js/viewer/action_element.js","../../src/js/viewer.js"],"sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms\n * of the Apache License 2.0.  The full license can be found in the LICENSE\n * file.\n *\n */\n\nimport init, * as internal from \"../../pkg/perspective_vieux.js\";\nimport wasm_internal from \"../../pkg/perspective_vieux_bg.wasm\";\n\nexport const wasm = init(wasm_internal).then(() => {\n    internal.set_panic_hook();\n    return internal;\n});\n\nlet _index = undefined;\nasync function _await_index(f) {\n    await new Promise(setTimeout);\n    if (!_index) {\n        _index = await wasm;\n    }\n    return f();\n}\n\n// function handle_view_errors(e) {\n//     if (e.message !== \"View is not initialized\") {\n//         throw e;\n//     }\n// }\n\nclass PerspectiveVieuxElement extends HTMLElement {\n    constructor() {\n        super();\n        _await_index(() => {\n            this._instance = new _index.PerspectiveVieuxElement(this);\n        });\n    }\n\n    connectedCallback() {\n        _await_index(() => {\n            this._instance.connected_callback();\n        });\n    }\n\n    load(table) {\n        _await_index(() => this._instance.load(table));\n    }\n\n    set_view(view) {\n        _await_index(() => this._instance.set_view(view));\n    }\n\n    delete_view() {\n        return _await_index(() => this._instance.delete_view());\n    }\n\n    toggle_config(force) {\n        return _await_index(() => this._instance.toggle_config(force));\n    }\n\n    _open_expression_editor(target) {\n        return _await_index(() => this._instance._open_expression_editor(target));\n    }\n}\n\nif (document.createElement(\"perspective-vieux\").constructor === HTMLElement) {\n    window.customElements.define(\"perspective-vieux\", PerspectiveVieuxElement);\n}\n\nclass PerspectiveColumnStyleElement extends HTMLElement {\n    constructor() {\n        super();\n    }\n\n    open(target, config, default_config) {\n        _await_index(() => {\n            if (this._instance) {\n                this._instance.reset(config, default_config);\n            } else {\n                this._instance = new _index.PerspectiveColumnStyleElement(this, config, default_config);\n            }\n\n            this._instance.open(target);\n        });\n    }\n}\n\nif (document.createElement(\"perspective-column-style\").constructor === HTMLElement) {\n    window.customElements.define(\"perspective-column-style\", PerspectiveColumnStyleElement);\n}\n","/*\n\nForked from https://github.com/timruffles/mobile-drag-drop/ v2.3.0-rc.2\n\nCopyright (c) 2013 Tim Ruffles\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\nconst CLASS_PREFIX = \"dnd-poly-\";\nconst CLASS_DRAG_IMAGE = CLASS_PREFIX + \"drag-image\";\nconst CLASS_DRAG_IMAGE_SNAPBACK = CLASS_PREFIX + \"snapback\";\nconst CLASS_DRAG_OPERATION_ICON = CLASS_PREFIX + \"icon\";\nconst EVENT_PREFIX = \"dnd-poly-\";\nconst EVENT_DRAG_DRAGSTART_PENDING = EVENT_PREFIX + \"dragstart-pending\";\nconst EVENT_DRAG_DRAGSTART_CANCEL = EVENT_PREFIX + \"dragstart-cancel\";\nconst ALLOWED_EFFECTS = [\"none\", \"copy\", \"copyLink\", \"copyMove\", \"link\", \"linkMove\", \"move\", \"all\"];\nconst DROP_EFFECTS = [\"none\", \"copy\", \"move\", \"link\"];\n\nfunction detectFeatures() {\n    const features = {\n        dragEvents: \"ondragstart\" in document.documentElement,\n        draggable: \"draggable\" in document.documentElement,\n        userAgentSupportingNativeDnD: undefined\n    };\n    const isBlinkEngine = !!window.chrome || /chrome/i.test(navigator.userAgent);\n    features.userAgentSupportingNativeDnD = !(/iPad|iPhone|iPod|Android/.test(navigator.userAgent) || (isBlinkEngine && \"ontouchstart\" in document.documentElement));\n    return features;\n}\nfunction supportsPassiveEventListener() {\n    let supportsPassiveEventListeners = false;\n    try {\n        const opts = Object.defineProperty({}, \"passive\", {\n            get: function() {\n                supportsPassiveEventListeners = true;\n            }\n        });\n        window.addEventListener(\"test\", null, opts);\n    } catch (e) {}\n    return supportsPassiveEventListeners;\n}\n\nconst supportsPassive = supportsPassiveEventListener();\nfunction isDOMElement(object) {\n    return object && object.tagName;\n}\nfunction addDocumentListener(ev, handler, passive) {\n    if (passive === void 0) {\n        passive = true;\n    }\n    document.addEventListener(ev, handler, supportsPassive ? {passive: passive} : false);\n}\nfunction removeDocumentListener(ev, handler) {\n    document.removeEventListener(ev, handler);\n}\nfunction onEvt(el, event, handler, capture) {\n    if (capture === void 0) {\n        capture = false;\n    }\n    const options = supportsPassive ? {passive: true, capture: capture} : capture;\n    el.addEventListener(event, handler, options);\n    return {\n        off: function() {\n            el.removeEventListener(event, handler, options);\n        }\n    };\n}\nfunction prepareNodeCopyAsDragImage(srcNode, dstNode) {\n    if (srcNode.nodeType === 1) {\n        const cs = getComputedStyle(srcNode);\n        for (let i = 0; i < cs.length; i++) {\n            const csName = cs[i];\n            dstNode.style.setProperty(csName, cs.getPropertyValue(csName), cs.getPropertyPriority(csName));\n        }\n        dstNode.style.pointerEvents = \"none\";\n        dstNode.removeAttribute(\"id\");\n        dstNode.removeAttribute(\"class\");\n        dstNode.removeAttribute(\"draggable\");\n        if (dstNode.nodeName === \"CANVAS\") {\n            const canvasSrc = srcNode;\n            const canvasDst = dstNode;\n            const canvasSrcImgData = canvasSrc.getContext(\"2d\").getImageData(0, 0, canvasSrc.width, canvasSrc.height);\n            canvasDst.getContext(\"2d\").putImageData(canvasSrcImgData, 0, 0);\n        }\n    }\n    if (srcNode.hasChildNodes()) {\n        for (let i = 0; i < srcNode.childNodes.length; i++) {\n            prepareNodeCopyAsDragImage(srcNode.childNodes[i], dstNode.childNodes[i]);\n        }\n    }\n}\nfunction createDragImage(sourceNode) {\n    const dragImage = sourceNode.cloneNode(true);\n    prepareNodeCopyAsDragImage(sourceNode, dragImage);\n    return dragImage;\n}\nfunction average(array) {\n    if (array.length === 0) {\n        return 0;\n    }\n    return (\n        array.reduce(function(s, v) {\n            return v + s;\n        }, 0) / array.length\n    );\n}\nfunction isTouchIdentifierContainedInTouchEvent(touchEvent, touchIdentifier) {\n    for (let i = 0; i < touchEvent.changedTouches.length; i++) {\n        const touch = touchEvent.changedTouches[i];\n        if (touch.identifier === touchIdentifier) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction updateCentroidCoordinatesOfTouchesIn(coordinateProp, event, outPoint) {\n    const pageXs = [],\n        pageYs = [];\n    for (let i = 0; i < event.touches.length; i++) {\n        const touch = event.touches[i];\n        pageXs.push(touch[coordinateProp + \"X\"]);\n        pageYs.push(touch[coordinateProp + \"Y\"]);\n    }\n    outPoint.x = average(pageXs);\n    outPoint.y = average(pageYs);\n}\nconst TRANSFORM_CSS_VENDOR_PREFIXES = [\"\", \"-webkit-\"];\nfunction extractTransformStyles(sourceNode) {\n    return TRANSFORM_CSS_VENDOR_PREFIXES.map(function(prefix) {\n        const transform = sourceNode.style[prefix + \"transform\"];\n        if (!transform || transform === \"none\") {\n            return \"\";\n        }\n        return transform.replace(/translate\\(\\D*\\d+[^,]*,\\D*\\d+[^,]*\\)\\s*/g, \"\");\n    });\n}\nfunction translateElementToPoint(element, pnt, originalTransforms, offset, centerOnCoordinates) {\n    if (centerOnCoordinates === void 0) {\n        centerOnCoordinates = true;\n    }\n    let x = pnt.x,\n        y = pnt.y;\n    if (offset) {\n        x += offset.x;\n        y += offset.y;\n    }\n    if (centerOnCoordinates) {\n        x -= parseInt(element.offsetWidth, 10) / 2;\n        y -= parseInt(element.offsetHeight, 10) / 2;\n    }\n    const translate = \"translate3d(\" + x + \"px,\" + y + \"px, 0)\";\n    for (let i = 0; i < TRANSFORM_CSS_VENDOR_PREFIXES.length; i++) {\n        const transformProp = TRANSFORM_CSS_VENDOR_PREFIXES[i] + \"transform\";\n        element.style[transformProp] = translate + \" \" + originalTransforms[i];\n    }\n}\nfunction applyDragImageSnapback(sourceEl, dragImage, dragImageTransforms, transitionEndCb) {\n    const cs = getComputedStyle(sourceEl);\n    if (cs.visibility === \"hidden\" || cs.display === \"none\") {\n        console.log(\"dnd-poly: source node is not visible. skipping snapback transition.\");\n        transitionEndCb();\n        return;\n    }\n    dragImage.classList.add(CLASS_DRAG_IMAGE_SNAPBACK);\n    const csDragImage = getComputedStyle(dragImage);\n    const durationInS = parseFloat(csDragImage.transitionDuration);\n    if (isNaN(durationInS) || durationInS === 0) {\n        console.log(\"dnd-poly: no transition used - skipping snapback\");\n        transitionEndCb();\n        return;\n    }\n    console.log(\"dnd-poly: starting dragimage snap back\");\n    const rect = sourceEl.getBoundingClientRect();\n    const pnt = {\n        x: rect.left,\n        y: rect.top\n    };\n    pnt.x += document.body.scrollLeft || document.documentElement.scrollLeft;\n    pnt.y += document.body.scrollTop || document.documentElement.scrollTop;\n    pnt.x -= parseInt(cs.marginLeft, 10);\n    pnt.y -= parseInt(cs.marginTop, 10);\n    const delayInS = parseFloat(csDragImage.transitionDelay);\n    const durationInMs = Math.round((durationInS + delayInS) * 1000);\n    translateElementToPoint(dragImage, pnt, dragImageTransforms, undefined, false);\n    setTimeout(transitionEndCb, durationInMs);\n}\n\nconst DataTransfer = (function() {\n    function DataTransfer(_dataStore, _setDragImageHandler) {\n        this._dataStore = _dataStore;\n        this._setDragImageHandler = _setDragImageHandler;\n        this._dropEffect = DROP_EFFECTS[0];\n    }\n    Object.defineProperty(DataTransfer.prototype, \"dropEffect\", {\n        get: function() {\n            return this._dropEffect;\n        },\n        set: function(value) {\n            if (this._dataStore.mode !== 0 && ALLOWED_EFFECTS.indexOf(value) > -1) {\n                this._dropEffect = value;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataTransfer.prototype, \"types\", {\n        get: function() {\n            if (this._dataStore.mode !== 0) {\n                return Object.freeze(this._dataStore.types);\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataTransfer.prototype, \"effectAllowed\", {\n        get: function() {\n            return this._dataStore.effectAllowed;\n        },\n        set: function(value) {\n            if (this._dataStore.mode === 2 && ALLOWED_EFFECTS.indexOf(value) > -1) {\n                this._dataStore.effectAllowed = value;\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DataTransfer.prototype.setData = function(type, data) {\n        if (this._dataStore.mode === 2) {\n            if (type.indexOf(\" \") > -1) {\n                throw new Error(\"illegal arg: type contains space\");\n            }\n            this._dataStore.data[type] = data;\n            if (this._dataStore.types.indexOf(type) === -1) {\n                this._dataStore.types.push(type);\n            }\n        }\n    };\n    DataTransfer.prototype.getData = function(type) {\n        if (this._dataStore.mode === 1 || this._dataStore.mode === 2) {\n            return this._dataStore.data[type] || \"\";\n        }\n    };\n    DataTransfer.prototype.clearData = function(format) {\n        if (this._dataStore.mode === 2) {\n            if (format && this._dataStore.data[format]) {\n                delete this._dataStore.data[format];\n                const index = this._dataStore.types.indexOf(format);\n                if (index > -1) {\n                    this._dataStore.types.splice(index, 1);\n                }\n                return;\n            }\n            this._dataStore.data = {};\n            this._dataStore.types = [];\n        }\n    };\n    DataTransfer.prototype.setDragImage = function(image, x, y) {\n        if (this._dataStore.mode === 2) {\n            this._setDragImageHandler(image, x, y);\n        }\n    };\n    return DataTransfer;\n})();\n\nfunction tryFindDraggableTarget(event) {\n    let el = event.target;\n    do {\n        if (el.draggable === false) {\n            continue;\n        }\n        if (el.draggable === true) {\n            return el;\n        }\n        if (el.getAttribute && el.getAttribute(\"draggable\") === \"true\") {\n            return el;\n        }\n    } while ((el = el.parentNode) && el !== document.body);\n}\nfunction determineDropEffect(effectAllowed, sourceNode) {\n    if (!effectAllowed) {\n        if (sourceNode.nodeType === 3 && sourceNode.tagName === \"A\") {\n            return DROP_EFFECTS[3];\n        }\n        return DROP_EFFECTS[1];\n    }\n    if (effectAllowed === ALLOWED_EFFECTS[0]) {\n        return DROP_EFFECTS[0];\n    }\n    if (effectAllowed.indexOf(ALLOWED_EFFECTS[1]) === 0 || effectAllowed === ALLOWED_EFFECTS[7]) {\n        return DROP_EFFECTS[1];\n    }\n    if (effectAllowed.indexOf(ALLOWED_EFFECTS[4]) === 0) {\n        return DROP_EFFECTS[3];\n    }\n    if (effectAllowed === ALLOWED_EFFECTS[6]) {\n        return DROP_EFFECTS[2];\n    }\n    return DROP_EFFECTS[1];\n}\nfunction createDragEventFromTouch(targetElement, e, type, cancelable, window, dataTransfer, relatedTarget) {\n    if (relatedTarget === void 0) {\n        relatedTarget = null;\n    }\n    const touch = e.changedTouches[0];\n    const dndEvent = new Event(type, {\n        bubbles: true,\n        cancelable: cancelable\n    });\n    dndEvent.dataTransfer = dataTransfer;\n    dndEvent.relatedTarget = relatedTarget;\n    dndEvent.screenX = touch.screenX;\n    dndEvent.screenY = touch.screenY;\n    dndEvent.clientX = touch.clientX;\n    dndEvent.clientY = touch.clientY;\n    dndEvent.pageX = touch.pageX;\n    dndEvent.pageY = touch.pageY;\n    const targetRect = targetElement.getBoundingClientRect();\n    dndEvent.offsetX = dndEvent.clientX - targetRect.left;\n    dndEvent.offsetY = dndEvent.clientY - targetRect.top;\n    return dndEvent;\n}\nfunction dispatchDragEvent(dragEvent, targetElement, touchEvent, dataStore, dataTransfer, cancelable, relatedTarget) {\n    if (cancelable === void 0) {\n        cancelable = true;\n    }\n    if (relatedTarget === void 0) {\n        relatedTarget = null;\n    }\n    console.log(\"dnd-poly: dispatching \" + dragEvent);\n    const leaveEvt = createDragEventFromTouch(targetElement, touchEvent, dragEvent, cancelable, document.defaultView, dataTransfer, relatedTarget);\n    const cancelled = !targetElement.dispatchEvent(leaveEvt);\n    dataStore.mode = 0;\n    return cancelled;\n}\nfunction determineDragOperation(effectAllowed, dropEffect) {\n    if (!effectAllowed || effectAllowed === ALLOWED_EFFECTS[7]) {\n        return dropEffect;\n    }\n    if (dropEffect === DROP_EFFECTS[1]) {\n        if (effectAllowed.indexOf(DROP_EFFECTS[1]) === 0) {\n            return DROP_EFFECTS[1];\n        }\n    } else if (dropEffect === DROP_EFFECTS[3]) {\n        if (effectAllowed.indexOf(DROP_EFFECTS[3]) === 0 || effectAllowed.indexOf(\"Link\") > -1) {\n            return DROP_EFFECTS[3];\n        }\n    } else if (dropEffect === DROP_EFFECTS[2]) {\n        if (effectAllowed.indexOf(DROP_EFFECTS[2]) === 0 || effectAllowed.indexOf(\"Move\") > -1) {\n            return DROP_EFFECTS[2];\n        }\n    }\n    return DROP_EFFECTS[0];\n}\n\nconst DragOperationController = (function() {\n    function DragOperationController(_initialEvent, _config, _sourceNode, _dragOperationEndedCb) {\n        this._initialEvent = _initialEvent;\n        this._config = _config;\n        this._sourceNode = _sourceNode;\n        this._dragOperationEndedCb = _dragOperationEndedCb;\n        this._dragOperationState = 0;\n        this._immediateUserSelection = null;\n        this._currentDropTarget = null;\n        console.log(\"dnd-poly: setting up potential drag operation..\");\n        this._lastTouchEvent = _initialEvent;\n        this._initialTouch = _initialEvent.changedTouches[0];\n        this._touchMoveHandler = this._onTouchMove.bind(this);\n        this._touchEndOrCancelHandler = this._onTouchEndOrCancel.bind(this);\n        addDocumentListener(\"touchmove\", this._touchMoveHandler, false);\n        addDocumentListener(\"touchend\", this._touchEndOrCancelHandler, false);\n        addDocumentListener(\"touchcancel\", this._touchEndOrCancelHandler, false);\n    }\n    DragOperationController.prototype._setup = function() {\n        const _this = this;\n        console.log(\"dnd-poly: starting drag and drop operation\");\n        this._dragOperationState = 1;\n        this._currentDragOperation = DROP_EFFECTS[0];\n        this._dragDataStore = {\n            data: {},\n            effectAllowed: undefined,\n            mode: 3,\n            types: []\n        };\n        this._currentHotspotCoordinates = {\n            x: null,\n            y: null\n        };\n        this._dragImagePageCoordinates = {\n            x: null,\n            y: null\n        };\n        let dragImageSrc = this._sourceNode;\n        this._dataTransfer = new DataTransfer(this._dragDataStore, function(element, x, y) {\n            dragImageSrc = element;\n            if (typeof x === \"number\" || typeof y === \"number\") {\n                _this._dragImageOffset = {\n                    x: x || 0,\n                    y: y || 0\n                };\n            }\n        });\n        this._dragDataStore.mode = 2;\n        this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n        if (dispatchDragEvent(\"dragstart\", this._sourceNode, this._lastTouchEvent, this._dragDataStore, this._dataTransfer)) {\n            console.log(\"dnd-poly: dragstart cancelled\");\n            this._dragOperationState = 3;\n            this._cleanup();\n            return false;\n        }\n        updateCentroidCoordinatesOfTouchesIn(\"page\", this._lastTouchEvent, this._dragImagePageCoordinates);\n        const dragImage = this._config.dragImageSetup(dragImageSrc);\n        this._dragImageTransforms = extractTransformStyles(dragImage);\n        dragImage.style.position = \"absolute\";\n        dragImage.style.left = \"0px\";\n        dragImage.style.top = \"0px\";\n        dragImage.style.zIndex = \"999999\";\n        dragImage.classList.add(CLASS_DRAG_IMAGE);\n        dragImage.classList.add(CLASS_DRAG_OPERATION_ICON);\n        this._dragImage = dragImage;\n        if (!this._dragImageOffset) {\n            if (this._config.dragImageOffset) {\n                this._dragImageOffset = {\n                    x: this._config.dragImageOffset.x,\n                    y: this._config.dragImageOffset.y\n                };\n            } else if (this._config.dragImageCenterOnTouch) {\n                const cs = getComputedStyle(dragImageSrc);\n                this._dragImageOffset = {\n                    x: 0 - parseInt(cs.marginLeft, 10),\n                    y: 0 - parseInt(cs.marginTop, 10)\n                };\n            } else {\n                const targetRect = dragImageSrc.getBoundingClientRect();\n                const cs = getComputedStyle(dragImageSrc);\n                this._dragImageOffset = {\n                    x: targetRect.left - this._initialTouch.clientX - parseInt(cs.marginLeft, 10) + targetRect.width / 2,\n                    y: targetRect.top - this._initialTouch.clientY - parseInt(cs.marginTop, 10) + targetRect.height / 2\n                };\n            }\n        }\n        translateElementToPoint(this._dragImage, this._dragImagePageCoordinates, this._dragImageTransforms, this._dragImageOffset, this._config.dragImageCenterOnTouch);\n        document.body.appendChild(this._dragImage);\n        this._iterationIntervalId = window.setInterval(function() {\n            if (_this._iterationLock) {\n                console.log(\"dnd-poly: iteration skipped because previous iteration hast not yet finished.\");\n                return;\n            }\n            _this._iterationLock = true;\n            _this._dragAndDropProcessModelIteration();\n            _this._iterationLock = false;\n        }, this._config.iterationInterval);\n        return true;\n    };\n    DragOperationController.prototype._cleanup = function() {\n        console.log(\"dnd-poly: cleanup\");\n        if (this._iterationIntervalId) {\n            clearInterval(this._iterationIntervalId);\n            this._iterationIntervalId = null;\n        }\n        removeDocumentListener(\"touchmove\", this._touchMoveHandler);\n        removeDocumentListener(\"touchend\", this._touchEndOrCancelHandler);\n        removeDocumentListener(\"touchcancel\", this._touchEndOrCancelHandler);\n        if (this._dragImage) {\n            this._dragImage.parentNode.removeChild(this._dragImage);\n            this._dragImage = null;\n        }\n        this._dragOperationEndedCb(this._config, this._lastTouchEvent, this._dragOperationState);\n    };\n    DragOperationController.prototype._onTouchMove = function(event) {\n        const _this = this;\n        if (isTouchIdentifierContainedInTouchEvent(event, this._initialTouch.identifier) === false) {\n            return;\n        }\n        this._lastTouchEvent = event;\n        if (this._dragOperationState === 0) {\n            let startDrag = void 0;\n            if (this._config.dragStartConditionOverride) {\n                try {\n                    startDrag = this._config.dragStartConditionOverride(event);\n                } catch (e) {\n                    console.error(\"dnd-poly: error in dragStartConditionOverride hook: \" + e);\n                    startDrag = false;\n                }\n            } else {\n                startDrag = event.touches.length === 1;\n            }\n            if (!startDrag) {\n                this._cleanup();\n                return;\n            }\n            if (this._setup() === true) {\n                this._initialEvent.preventDefault();\n                event.preventDefault();\n            }\n            return;\n        }\n        console.log(\"dnd-poly: moving draggable..\");\n        event.preventDefault();\n        updateCentroidCoordinatesOfTouchesIn(\"client\", event, this._currentHotspotCoordinates);\n        updateCentroidCoordinatesOfTouchesIn(\"page\", event, this._dragImagePageCoordinates);\n        if (this._config.dragImageTranslateOverride) {\n            try {\n                let handledDragImageTranslate_1 = false;\n                this._config.dragImageTranslateOverride(\n                    event,\n                    {\n                        x: this._currentHotspotCoordinates.x,\n                        y: this._currentHotspotCoordinates.y\n                    },\n                    this._immediateUserSelection,\n                    function(offsetX, offsetY) {\n                        if (!_this._dragImage) {\n                            return;\n                        }\n                        handledDragImageTranslate_1 = true;\n                        _this._currentHotspotCoordinates.x += offsetX;\n                        _this._currentHotspotCoordinates.y += offsetY;\n                        _this._dragImagePageCoordinates.x += offsetX;\n                        _this._dragImagePageCoordinates.y += offsetY;\n                        translateElementToPoint(_this._dragImage, _this._dragImagePageCoordinates, _this._dragImageTransforms, _this._dragImageOffset, _this._config.dragImageCenterOnTouch);\n                    }\n                );\n                if (handledDragImageTranslate_1) {\n                    return;\n                }\n            } catch (e) {\n                console.log(\"dnd-poly: error in dragImageTranslateOverride hook: \" + e);\n            }\n        }\n        translateElementToPoint(this._dragImage, this._dragImagePageCoordinates, this._dragImageTransforms, this._dragImageOffset, this._config.dragImageCenterOnTouch);\n    };\n    DragOperationController.prototype._onTouchEndOrCancel = function(event) {\n        if (isTouchIdentifierContainedInTouchEvent(event, this._initialTouch.identifier) === false) {\n            return;\n        }\n        if (this._config.dragImageTranslateOverride) {\n            try {\n                this._config.dragImageTranslateOverride(undefined, undefined, undefined, function() {});\n            } catch (e) {\n                console.log(\"dnd-poly: error in dragImageTranslateOverride hook: \" + e);\n            }\n        }\n        if (this._dragOperationState === 0) {\n            this._cleanup();\n            return;\n        }\n        event.preventDefault();\n        this._dragOperationState = event.type === \"touchcancel\" ? 3 : 2;\n    };\n    DragOperationController.prototype._dragAndDropProcessModelIteration = function() {\n        const _this = this;\n        const previousDragOperation = this._currentDragOperation;\n        this._dragDataStore.mode = 3;\n        this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n        const dragCancelled = dispatchDragEvent(\"drag\", this._sourceNode, this._lastTouchEvent, this._dragDataStore, this._dataTransfer);\n        if (dragCancelled) {\n            console.log(\"dnd-poly: drag event cancelled.\");\n            this._currentDragOperation = DROP_EFFECTS[0];\n        }\n        if (dragCancelled || this._dragOperationState === 2 || this._dragOperationState === 3) {\n            const dragFailed = this._dragOperationEnded(this._dragOperationState);\n            if (dragFailed) {\n                applyDragImageSnapback(this._sourceNode, this._dragImage, this._dragImageTransforms, function() {\n                    _this._finishDragOperation();\n                });\n                return;\n            }\n            this._finishDragOperation();\n            return;\n        }\n        const newUserSelection = this._config.elementFromPoint(this._currentHotspotCoordinates.x, this._currentHotspotCoordinates.y);\n        console.log(\"dnd-poly: new immediate user selection is: \" + newUserSelection);\n        const previousTargetElement = this._currentDropTarget;\n        if (newUserSelection !== this._immediateUserSelection && newUserSelection !== this._currentDropTarget) {\n            this._immediateUserSelection = newUserSelection;\n            if (this._currentDropTarget !== null) {\n                this._dragDataStore.mode = 3;\n                this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n                dispatchDragEvent(\"dragexit\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false);\n            }\n            if (this._immediateUserSelection === null) {\n                this._currentDropTarget = this._immediateUserSelection;\n                console.log(\"dnd-poly: current drop target changed to null\");\n            } else {\n                this._dragDataStore.mode = 3;\n                this._dataTransfer.dropEffect = determineDropEffect(this._dragDataStore.effectAllowed, this._sourceNode);\n                if (dispatchDragEvent(\"dragenter\", this._immediateUserSelection, this._lastTouchEvent, this._dragDataStore, this._dataTransfer)) {\n                    console.log(\"dnd-poly: dragenter default prevented\");\n                    this._currentDropTarget = this._immediateUserSelection;\n                    this._currentDragOperation = determineDragOperation(this._dataTransfer.effectAllowed, this._dataTransfer.dropEffect);\n                } else {\n                    if (this._immediateUserSelection !== document.body) {\n                        this._currentDropTarget = document.body;\n                    }\n                }\n            }\n        }\n        if (previousTargetElement !== this._currentDropTarget && isDOMElement(previousTargetElement)) {\n            console.log(\"dnd-poly: current drop target changed.\");\n            this._dragDataStore.mode = 3;\n            this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n            dispatchDragEvent(\"dragleave\", previousTargetElement, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false, this._currentDropTarget);\n        }\n        if (isDOMElement(this._currentDropTarget)) {\n            this._dragDataStore.mode = 3;\n            this._dataTransfer.dropEffect = determineDropEffect(this._dragDataStore.effectAllowed, this._sourceNode);\n            if (dispatchDragEvent(\"dragover\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer) === false) {\n                console.log(\"dnd-poly: dragover not prevented on possible drop-target.\");\n                this._currentDragOperation = DROP_EFFECTS[0];\n            } else {\n                console.log(\"dnd-poly: dragover prevented.\");\n                this._currentDragOperation = determineDragOperation(this._dataTransfer.effectAllowed, this._dataTransfer.dropEffect);\n            }\n        }\n        console.log(\"dnd-poly: d'n'd iteration ended. current drag operation: \" + this._currentDragOperation);\n        if (previousDragOperation !== this._currentDragOperation) {\n            this._dragImage.classList.remove(CLASS_PREFIX + previousDragOperation);\n        }\n        const currentDragOperationClass = CLASS_PREFIX + this._currentDragOperation;\n        this._dragImage.classList.add(currentDragOperationClass);\n    };\n    DragOperationController.prototype._dragOperationEnded = function(state) {\n        console.log(\"dnd-poly: drag operation end detected with \" + this._currentDragOperation);\n        const dragFailed = this._currentDragOperation === DROP_EFFECTS[0] || this._currentDropTarget === null || state === 3;\n        if (dragFailed) {\n            if (isDOMElement(this._currentDropTarget)) {\n                this._dragDataStore.mode = 3;\n                this._dataTransfer.dropEffect = DROP_EFFECTS[0];\n                dispatchDragEvent(\"dragleave\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false);\n            }\n        } else {\n            if (isDOMElement(this._currentDropTarget)) {\n                this._dragDataStore.mode = 1;\n                this._dataTransfer.dropEffect = this._currentDragOperation;\n                if (dispatchDragEvent(\"drop\", this._currentDropTarget, this._lastTouchEvent, this._dragDataStore, this._dataTransfer) === true) {\n                    this._currentDragOperation = this._dataTransfer.dropEffect;\n                } else {\n                    this._currentDragOperation = DROP_EFFECTS[0];\n                }\n            }\n        }\n        return dragFailed;\n    };\n    DragOperationController.prototype._finishDragOperation = function() {\n        console.log(\"dnd-poly: dragimage snap back transition ended\");\n        this._dragDataStore.mode = 3;\n        this._dataTransfer.dropEffect = this._currentDragOperation;\n        dispatchDragEvent(\"dragend\", this._sourceNode, this._lastTouchEvent, this._dragDataStore, this._dataTransfer, false);\n        this._dragOperationState = 2;\n        this._cleanup();\n    };\n    return DragOperationController;\n})();\n\nconst config = {\n    iterationInterval: 150,\n    tryFindDraggableTarget: tryFindDraggableTarget,\n    dragImageSetup: createDragImage,\n    elementFromPoint: function(x, y) {\n        return document.elementFromPoint(x, y);\n    }\n};\nlet activeDragOperation;\nfunction onTouchstart(e, composePath) {\n    console.log(\"dnd-poly: global touchstart\");\n    if (activeDragOperation) {\n        console.log(\"dnd-poly: drag operation already active\");\n        return;\n    }\n    const dragTarget = config.tryFindDraggableTarget(e, composePath);\n    if (!dragTarget) {\n        console.log(\"dnd-poly: no draggable at touchstart coordinates\");\n        return;\n    }\n    try {\n        activeDragOperation = new DragOperationController(e, config, dragTarget, dragOperationEnded);\n    } catch (err) {\n        dragOperationEnded(config, e, 3);\n        throw err;\n    }\n}\nfunction onDelayTouchstart(evt) {\n    console.log(\"dnd-poly: setup delayed dragstart..\");\n    const el = evt.target;\n    const composePath = evt.composedPath();\n    const heldItem = function() {\n        console.log(\"dnd-poly: starting delayed drag..\");\n        end.off();\n        cancel.off();\n        move.off();\n        scroll.off();\n        onTouchstart(evt, composePath);\n    };\n    const onReleasedItem = function(event) {\n        console.log(\"dnd-poly: aborting delayed drag because of \" + event.type);\n        end.off();\n        cancel.off();\n        move.off();\n        scroll.off();\n        if (el) {\n            el.dispatchEvent(new CustomEvent(EVENT_DRAG_DRAGSTART_CANCEL, {bubbles: true, cancelable: true}));\n        }\n        clearTimeout(timer);\n    };\n    if (el) {\n        el.dispatchEvent(new CustomEvent(EVENT_DRAG_DRAGSTART_PENDING, {bubbles: true, cancelable: true}));\n    }\n    const timer = window.setTimeout(heldItem, config.holdToDrag);\n    const end = onEvt(el, \"touchend\", onReleasedItem);\n    const cancel = onEvt(el, \"touchcancel\", onReleasedItem);\n    const move = onEvt(el, \"touchmove\", onReleasedItem);\n    const scroll = onEvt(window, \"scroll\", onReleasedItem, true);\n}\n\nfunction dragOperationEnded(_config, event, state) {\n    if (state === 0) {\n        console.log(\"dnd-poly: Drag never started. Last event was \" + event.type);\n        if (_config.defaultActionOverride) {\n            try {\n                _config.defaultActionOverride(event);\n                if (event.defaultPrevented) {\n                    console.log(\"dnd-poly: defaultActionOverride has taken care of triggering the default action. preventing default on original event\");\n                }\n            } catch (e) {\n                console.log(\"dnd-poly: error in defaultActionOverride: \" + e);\n            }\n        }\n    }\n    activeDragOperation = null;\n}\n\nfunction polyfill(override) {\n    if (override) {\n        Object.keys(override).forEach(function(key) {\n            config[key] = override[key];\n        });\n    }\n    if (!config.forceApply) {\n        const detectedFeatures = detectFeatures();\n        if (detectedFeatures.userAgentSupportingNativeDnD && detectedFeatures.draggable && detectedFeatures.dragEvents) {\n            return false;\n        }\n    }\n    console.log(\"dnd-poly: Applying mobile drag and drop polyfill.\");\n    if (config.holdToDrag) {\n        console.log(\"dnd-poly: holdToDrag set to \" + config.holdToDrag);\n        addDocumentListener(\"touchstart\", onDelayTouchstart, false);\n    } else {\n        addDocumentListener(\"touchstart\", onTouchstart, false);\n    }\n    return true;\n}\n\nfunction tryFindDraggableTarget_override(event, composePath) {\n    const cp = composePath || event.composedPath();\n    for (let o of cp) {\n        let el = o;\n        do {\n            if (el.draggable === false) {\n                continue;\n            }\n            if (el.getAttribute && el.getAttribute(\"draggable\") === \"true\") {\n                return el;\n            }\n        } while ((el = el.parentNode) && el !== document.body);\n    }\n}\n\nfunction elementFromPoint(x, y) {\n    for (let o of this._path) {\n        if (o.elementFromPoint) {\n            let el = o.elementFromPoint(x, y);\n            if (el) {\n                while (el.shadowRoot) {\n                    el = el.shadowRoot.elementFromPoint(x, y);\n                }\n                return el;\n            }\n        }\n    }\n}\n\nfunction dragStartConditionOverride(event) {\n    this._path = event.composedPath();\n    return true;\n}\n\npolyfill({\n    tryFindDraggableTarget: tryFindDraggableTarget_override,\n    elementFromPoint: elementFromPoint,\n    dragStartConditionOverride: dragStartConditionOverride,\n    holdToDrag: 500\n});\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\n/**\n * Instantiate a Template DOM object from an HTML text string.\n *\n * Params\n * ------\n * template : An HTML string representing a template.\n *\n * Returns\n * -------\n * A Template DOM object.\n */\n\nexport function importTemplate(template) {\n    const div = document.createElement(\"div\");\n    div.innerHTML = template;\n    return Array.prototype.slice.call(div.children)[0];\n}\n\nfunction setTemplateContent(template) {\n    // return early in browsers that have template tag support\n    if (template.content) {\n        return;\n    }\n    template.content = document.createDocumentFragment();\n    let child;\n    while ((child = template.firstChild)) {\n        Node.prototype.appendChild.call(template.content, child);\n    }\n}\n\n/**\n * A simple tool for creating Web Components v0.\n *\n * Params\n * ------\n * template : An HTML string representing a template.  Should have an 'id'\n *     attribute which will become the new Web Component's tag name.\n * proto : The new Web Component's prototype object, as per spec.\n */\nexport function registerElement(templateString, styleString, proto) {\n    const template = importTemplate(templateString);\n    setTemplateContent(template);\n    if (styleString) {\n        template.innerHTML = `<style>${styleString.toString()}</style>` + template.innerHTML;\n    }\n    template.innerHTML = `<style id=\"psp_styles\" scope=\"${template.getAttribute(\"id\")}\">test{}</style>` + template.innerHTML;\n\n    const _perspective_element = class extends proto {\n        attributeChangedCallback(name, old, value) {\n            if (value === null) {\n                value = \"null\";\n            }\n            if (name[0] !== \"_\" && old != value && !!Object.getOwnPropertyDescriptor(proto.prototype, name).set) {\n                this[name] = value;\n            }\n        }\n\n        connectedCallback() {\n            if (this._initialized) {\n                return;\n            }\n            this._initializing = true;\n            var node = document.importNode(template.content, true);\n            this.attachShadow({mode: \"open\"});\n            this.shadowRoot.appendChild(node);\n\n            if (super.connectedCallback) {\n                super.connectedCallback();\n            }\n\n            // Call all attributes bound to setters on the proto\n            for (let key of Object.getOwnPropertyNames(proto.prototype)) {\n                if (key !== \"connectedCallback\") {\n                    if (this.hasAttribute(key) && key[0] !== \"_\" && !!Object.getOwnPropertyDescriptor(proto.prototype, key).set) {\n                        this[key] = this.getAttribute(key);\n                    }\n                }\n            }\n            this._initializing = false;\n            this._initialized = true;\n        }\n\n        static get observedAttributes() {\n            return Object.getOwnPropertyNames(proto.prototype);\n        }\n    };\n\n    for (let key of Object.getOwnPropertyNames(proto.prototype)) {\n        let descriptor = Object.getOwnPropertyDescriptor(proto.prototype, key);\n        if (descriptor && descriptor.set) {\n            let old = descriptor.set;\n            descriptor.set = function(val) {\n                if (!this.hasAttribute(key) || this.getAttribute(key) !== val) {\n                    this.setAttribute(key, val);\n                    return;\n                }\n                if (!this._initializing && !this._initialized) {\n                    return;\n                }\n                old.call(this, val);\n            };\n            Object.defineProperty(proto.prototype, key, descriptor);\n        }\n    }\n\n    let name = template.getAttribute(\"id\");\n    console.log(`Registered ${name}`);\n\n    window.customElements.define(name, _perspective_element);\n}\n\nexport function bindTemplate(template, ...styleStrings) {\n    const style = styleStrings.map(x => x.toString()).join(\"\\n\");\n    return function(cls) {\n        return registerElement(template, {toString: () => style}, cls);\n    };\n}\n\n/**\n * A decorator for declaring a setter property of an HTMLElement descendent\n * class as serialized JSON.  Handles converting these types before invoking\n * the underlying function/\n *\n * @param {object} _default the default value to supply the setter when\n * undefined, removed or invalid.\n */\nfunction _attribute(_default) {\n    return function(cls, name, desc) {\n        const old_set = desc.value;\n        desc.set = function(x) {\n            let attr = this.getAttribute(name);\n            try {\n                if (x === null || x === undefined || x === \"\") {\n                    x = _default();\n                }\n                if (typeof x !== \"string\") {\n                    x = JSON.stringify(x);\n                }\n                if (x !== attr) {\n                    attr = x;\n                }\n                attr = JSON.parse(attr);\n            } catch (e) {\n                console.warn(`Invalid value for attribute \"${name}\": ${x}`);\n                attr = _default();\n            }\n            old_set.call(this, attr);\n        };\n        desc.get = function() {\n            if (this.hasAttribute(name)) {\n                return JSON.parse(this.getAttribute(name));\n            } else {\n                return _default();\n            }\n        };\n        delete desc[\"value\"];\n        delete desc[\"writable\"];\n        return desc;\n    };\n}\n\n/**\n * Just like `setTimeout` except it returns a promise which resolves after the\n * callback has (also resolved).\n *\n * @param {func} cb\n * @param {*} timeout\n */\nexport async function setPromise(cb = async () => {}, timeout = 0) {\n    await new Promise(x => setTimeout(x, timeout));\n    return await cb();\n}\n\nexport const invertPromise = () => {\n    let _resolve;\n    const promise = new Promise(resolve => {\n        _resolve = resolve;\n    });\n\n    promise.resolve = _resolve;\n    return promise;\n};\n\nexport function throttlePromise(target, property, descriptor, clear = false) {\n    if (typeof target === \"boolean\") {\n        return function(target, property, descriptor) {\n            return throttlePromise(target, property, descriptor, true);\n        };\n    }\n\n    // Each call to `throttlePromise` has a unique `lock`\n    const lock = Symbol(\"private lock\");\n    const _super = descriptor.value;\n\n    async function throttleOnce(id) {\n        if (id !== this[lock].gen) {\n            // This invocation got de-duped with a later one, but it will\n            // wake up first, so if there is not a lock acquired here, push\n            // it to the back of the event queue.\n            if (!this[lock].lock) {\n                await new Promise(requestAnimationFrame);\n            }\n\n            // Now await the currently-processing invocation (which\n            // occurred after than this one) and return.\n            await this[lock].lock;\n            return true;\n        }\n    }\n\n    // Wrap the underlying function\n    descriptor.value = async function(...args) {\n        // Initialize the lock for this Object instance, if it has never been\n        // initialized.\n        this[lock] = this[lock] || {gen: 0};\n\n        // Assign this invocation a unique ID.\n        let id = ++this[lock].gen;\n\n        if (clear) {\n            await new Promise(requestAnimationFrame);\n        }\n\n        // If the `lock` property is defined, a previous invocation is still\n        // processing.\n        if (this[lock].lock) {\n            // `await` the previous call;  afterwards, the drawn state will be\n            // updated but we need to draw again to incorporate this\n            // invocation's state changes.\n            await this[lock].lock;\n\n            // We only want to execute the _last_ invocation, since each call\n            // precludes the previous ones if they are still queue-ed.\n            if (await throttleOnce.call(this, id)) {\n                return;\n            }\n        } else if (clear) {\n            // Even if the lock is clear, we need to debounce the queue-ed.\n            const debounced = await throttleOnce.call(this, id);\n            if (debounced) {\n                return;\n            }\n        }\n\n        // This invocation has made it to the render process, so \"acquire\" the\n        // lock.\n        this[lock].lock = invertPromise();\n\n        // Call the decorated function itself\n        let result;\n        try {\n            result = await _super.call(this, ...args);\n        } finally {\n            // Errors can leave promises which depend on this behavior\n            // dangling.\n            const l = this[lock].lock;\n            delete this[lock][\"lock\"];\n\n            // If this invocation is still the latest, clear the attribute\n            // state.\n            // TODO this is likely not he behavior we want for this event ..\n            if (id === this[lock].gen && clear) {\n                this.removeAttribute(\"updating\");\n                this.dispatchEvent(new Event(\"perspective-update-complete\"));\n            }\n\n            l.resolve();\n        }\n\n        return result;\n    };\n\n    // A function which clears the lock just like the main wrapper, but then\n    // does nothing.\n    descriptor.value.flush = async function(obj) {\n        if (obj[lock]?.lock) {\n            await obj[lock].lock;\n            await new Promise(requestAnimationFrame);\n            if (obj[lock]?.lock) {\n                await obj[lock].lock;\n            }\n        }\n    };\n\n    return descriptor;\n}\n\n/**\n * Swap 2 HTMLElements in a container.\n * @param {HTMLElement} container\n * @param {HTMLElement} elem1\n * @param {HTMLElement} elem2\n */\nexport function swap(container, ...elems) {\n    if (elems[0] === elems[1]) return;\n    if (elems.every(x => x.classList.contains(\"null-column\"))) return;\n    let [i, j] = elems.map(x => Array.prototype.slice.call(container.children).indexOf(x));\n    if (j < i) {\n        [i, j] = [j, i];\n        elems = elems.reverse();\n    }\n    container.insertBefore(elems[1], elems[0]);\n    if (j + 1 === container.children.length) {\n        container.appendChild(elems[0]);\n    } else {\n        container.insertBefore(elems[0], container.children[j + 1]);\n    }\n}\n\nexport const json_attribute = _attribute(() => ({}));\nexport const array_attribute = _attribute(() => []);\n\nexport const registerPlugin = (name, plugin) => {\n    if (global.registerPlugin) {\n        global.registerPlugin(name, plugin);\n    } else {\n        global.__perspective_plugins__ = global.__perspective_plugins__ || [];\n        global.__perspective_plugins__.push([name, plugin]);\n    }\n};\n\n/**\n * Given an expression, return its alias.\n *\n * @param {*} expression\n * @returns String\n */\nexport function getExpressionAlias(expression) {\n    const matches = expression.match(/\\/\\/(.+?)$/m);\n    let alias;\n\n    // Has an alias - use that to type check.\n    if (matches && matches.length == 2) {\n        alias = matches[1].trim();\n        return alias;\n    } else {\n        return expression;\n    }\n}\n\n/**\n * Adds an alias to the given expression and returns it.\n *\n * @param {*} expression\n * @returns String\n */\n// export function addExpressionAlias(expression) {\n//     let alias;\n//     expression.length > 20\n//         ? (alias =\n//               expression\n//                   .replace(\"\\n\", \" \")\n//                   .substr(0, 20)\n//                   .trim() + \"...\")\n//         : (alias = expression);\n//     return `//${alias}\\n${expression}`;\n// }\n\n/**\n * Given an alias and an array of string expressions, find the alias inside\n * the expressions array. This is important so we can map aliases back to\n * expressions inside _new_row.\n *\n * @param {String} alias\n * @param {Array<String>} expressions\n * @returns String\n */\nexport function findExpressionByAlias(alias, expressions) {\n    for (const expr of expressions) {\n        const expr_alias = getExpressionAlias(expr);\n        if (alias === expr_alias) {\n            return expr;\n        }\n    }\n}\n\n/**\n * Given an expression, strips the alias and returns the expression.\n *\n * @param {String} expression\n * @returns String\n */\nexport function getRawExpression(expression) {\n    return expression.replace(/\\/\\/(.+)\\n/, \"\");\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {html, render} from \"lit-html\";\n\nconst RENDERERS = {};\n\nexport const renderers = new (class {\n    /**\n     * Register a plugin with the <perspective-viewer> component.\n     *\n     * @param {string} name The logical unique name of the plugin.  This will be\n     * used to set the component's `view` attribute.\n     * @param {object} plugin An object with this plugin's prototype.\n     *     Valid keys are:\n     * @param {string} plugin.name The display name for this plugin.\n     * @param {string} plugin.create (required) The creation function - may\n     *     return a `Promise`.\n     * @param {string} plugin.delete The deletion function.\n     * @param {string} plugin.mode The selection mode - may be \"toggle\" or\n     *     \"select\".\n     */\n    registerPlugin(name, plugin) {\n        if (RENDERERS[name]) {\n            throw new Error(`A perspective-viewer plugin \"${name}\" has already been registered`);\n        }\n        for (const id in RENDERERS) {\n            const old_plugin = RENDERERS[id];\n            if (old_plugin && old_plugin.name === plugin.name) {\n                console.warn(`Conflicting plugin name \"${plugin.name}\", qualifying with id`);\n                old_plugin.name = `${old_plugin.name} [${id}]`;\n                plugin.name = `${plugin.name} [${name}]`;\n            }\n        }\n        RENDERERS[name] = plugin;\n    }\n\n    getPlugin(name) {\n        return RENDERERS[name];\n    }\n\n    getInstance() {\n        return RENDERERS;\n    }\n})();\n\nglobal.registerPlugin = renderers.registerPlugin;\n\nglobal.getPlugin = renderers.getPlugin;\n\nif (global.__perspective_plugins__) {\n    global.__perspective_plugins__.forEach(([name, plugin]) => global.registerPlugin(name, plugin));\n}\n\nconst template = csv =>\n    html`\n        <pre style=\"margin:0;overflow:scroll;position:absolute;width:100%;height:100%\">${csv}</pre>\n    `;\n\nexport function register_debug_plugin() {\n    global.registerPlugin(\"debug\", {\n        name: \"Debug\",\n        create: async function(div) {\n            const csv = await this._view.to_csv({config: {delimiter: \"|\"}});\n            const timer = this._render_time();\n            render(template(csv), div);\n            timer();\n        },\n        selectMode: \"toggle\",\n        resize: function() {},\n        delete: function() {}\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport debounce from \"lodash/debounce\";\n\nimport Awesomplete from \"awesomplete\";\nimport awesomplete_style from \"awesomplete/awesomplete.css\";\n\nimport {bindTemplate} from \"./utils.js\";\n\nimport * as perspective from \"@finos/perspective/dist/esm/config/constants.js\";\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\nimport template from \"../html/row.html\";\n\nimport style from \"../less/row.less\";\nimport {html, render, nothing} from \"lit-html\";\n\nconst SPAN = document.createElement(\"span\");\nSPAN.style.visibility = \"hidden\";\nSPAN.style.fontFamily = \"monospace\";\nSPAN.style.fontSize = \"12px\";\nSPAN.style.position = \"absolute\";\n\nfunction get_text_width(text, max = 0) {\n    // FIXME get these values form the stylesheet\n    SPAN.innerHTML = text;\n    document.body.appendChild(SPAN);\n    const width = `${Math.max(max, SPAN.offsetWidth) + 10}px`;\n    document.body.removeChild(SPAN);\n    return width;\n}\n\n// Eslint complains here because we don't do anything, but actually we globally\n// register this class as a CustomElement\n@bindTemplate(template, {toString: () => style + \"\\n\" + awesomplete_style}) // eslint-disable-next-line no-unused-vars\nclass Row extends HTMLElement {\n    set name(n) {\n        const elem = this.shadowRoot.querySelector(\"#name\");\n        elem.innerHTML = this.getAttribute(\"name\");\n    }\n\n    _option_template(agg, name) {\n        return html`\n            <option value=\"${agg}\" data-desc=\"${name}\">${name || agg}</option>\n        `;\n    }\n\n    _select_template(category, type) {\n        const items = perspective[category][type] || [];\n        const weighted_options = html`\n            <optgroup label=\"weighted mean\">\n                ${this._weights.map(x => this._option_template(JSON.stringify([\"weighted mean\", x]), x))}\n            </optgroup>\n        `;\n        const has_weighted_mean = category === \"TYPE_AGGREGATES\" && (type === \"integer\" || type === \"float\");\n        return html`\n            ${items.map(x => this._option_template(x))} ${has_weighted_mean ? weighted_options : nothing}\n        `;\n    }\n\n    set_weights(xs) {\n        this._weights = xs;\n    }\n\n    set type(t) {\n        const elem = this.shadowRoot.querySelector(\"#name\");\n        const type = this.getAttribute(\"type\");\n        if (!type) return;\n        const type_config = get_type_config(type);\n        if (type_config.type) {\n            elem.classList.add(type_config.type);\n        }\n        elem.classList.add(type);\n        const agg_dropdown = this.shadowRoot.querySelector(\"#column_aggregate\");\n        const filter_dropdown = this.shadowRoot.querySelector(\"#filter_operator\");\n\n        render(this._select_template(\"TYPE_AGGREGATES\", type_config.type || type), agg_dropdown);\n        render(this._select_template(\"TYPE_FILTERS\", type_config.type || type), filter_dropdown);\n\n        if (!this.hasAttribute(\"aggregate\")) {\n            this.aggregate = type_config.aggregate;\n        } else {\n            this.aggregate = this.getAttribute(\"aggregate\");\n        }\n        if (this.hasAttribute(\"filter\")) {\n            this.filter = this.getAttribute(\"filter\");\n        }\n\n        const filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\n        this._callback = event => this._update_filter(event);\n        filter_operand.addEventListener(\"keyup\", this._callback.bind(this));\n    }\n\n    choices(choices) {\n        const filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\n        const filter_operator = this.shadowRoot.querySelector(\"#filter_operator\");\n        const selector = new Awesomplete(filter_operand, {\n            label: this.getAttribute(\"name\"),\n            list: choices,\n            minChars: 0,\n            autoFirst: true,\n            filter: function(text, input) {\n                return Awesomplete.FILTER_CONTAINS(text, input.match(/[^,]*$/)[0]);\n            },\n            item: function(text, input) {\n                return Awesomplete.ITEM(text, input.match(/[^,]*$/)[0]);\n            },\n            replace: function(text) {\n                const before = this.input.value.match(/^.+,\\s*|/)[0];\n                if (filter_operator.value === \"in\" || filter_operator.value === \"not in\") {\n                    this.input.value = before + text + \", \";\n                } else {\n                    this.input.value = before + text;\n                }\n            }\n        });\n        if (filter_operand.value === \"\") {\n            selector.evaluate();\n        }\n        filter_operand.focus();\n        this._filter_operand.addEventListener(\"focus\", () => {\n            if (filter_operand.value.trim().length === 0) {\n                selector.evaluate();\n            }\n        });\n        filter_operand.addEventListener(\"awesomplete-selectcomplete\", this._callback);\n    }\n\n    set filter(f) {\n        const filter_dropdown = this.shadowRoot.querySelector(\"#filter_operator\");\n        const filter = JSON.parse(this.getAttribute(\"filter\"));\n        if (filter_dropdown.value !== filter.operator) {\n            filter_dropdown.value = filter.operator || get_type_config(this.getAttribute(\"type\")).filter_operator;\n        }\n        filter_dropdown.style.width = get_text_width(filter_dropdown.value);\n        const filter_input = this.shadowRoot.querySelector(\"#filter_operand\");\n        const operand = filter.operand ? filter.operand.toString() : \"\";\n        if (!this._initialized) {\n            filter_input.value = operand;\n        }\n        if (filter_dropdown.value === perspective.FILTER_OPERATORS.isNull || filter_dropdown.value === perspective.FILTER_OPERATORS.isNotNull) {\n            filter_input.style.display = \"none\";\n        } else {\n            filter_input.style.display = \"inline-block\";\n            filter_input.style.width = get_text_width(operand, 30);\n        }\n    }\n\n    set aggregate(a) {\n        const agg_dropdown = this.shadowRoot.querySelector(\"#column_aggregate\");\n        const aggregate = this.getAttribute(\"aggregate\");\n        if (agg_dropdown.value !== aggregate && this.hasAttribute(\"type\")) {\n            const type = this.getAttribute(\"type\");\n            agg_dropdown.value = aggregate || get_type_config(type).aggregate;\n        }\n        this._blur_agg_dropdown();\n    }\n\n    _update_filter(event) {\n        const filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\n        const filter_operator = this.shadowRoot.querySelector(\"#filter_operator\");\n        let val = filter_operand.value;\n        const type = this.getAttribute(\"type\");\n        switch (type) {\n            case \"float\":\n                val = parseFloat(val);\n                break;\n            case \"integer\":\n                val = parseInt(val);\n                break;\n            case \"boolean\":\n                val = val.toLowerCase().indexOf(\"true\") > -1;\n                break;\n            case \"string\":\n            default:\n        }\n        if (filter_operator.value === perspective.FILTER_OPERATORS.isIn || filter_operator.value === perspective.FILTER_OPERATORS.isNotIn) {\n            val = val.split(\",\").map(x => x.trim());\n        }\n        this.setAttribute(\"filter\", JSON.stringify({operator: filter_operator.value, operand: val}));\n        this.dispatchEvent(new CustomEvent(\"filter-selected\", {detail: event}));\n    }\n\n    _set_data_transfer(event) {\n        let data;\n        if (this.hasAttribute(\"filter\")) {\n            const {operator, operand} = JSON.parse(this.getAttribute(\"filter\"));\n            data = [this.getAttribute(\"name\"), operator, operand, this.getAttribute(\"type\"), this.getAttribute(\"aggregate\")];\n        } else {\n            data = [this.getAttribute(\"name\"), get_type_config(this.getAttribute(\"type\")).filter_operator, undefined, this.getAttribute(\"type\"), this.getAttribute(\"aggregate\")];\n        }\n        if (this.hasAttribute(\"expression\") && this.hasAttribute(\"title\")) {\n            // Add the expression to drag-data so it automatically\n            // resolves inside the expression editor.\n            data.push(this.getAttribute(\"title\"));\n        }\n        event.dataTransfer.setData(\"text/plain\", JSON.stringify(data));\n        this.dispatchEvent(new CustomEvent(\"row-drag\"));\n    }\n\n    _register_ids() {\n        this._li = this.shadowRoot.querySelector(\".row_draggable\");\n        this._visible = this.shadowRoot.querySelector(\".is_visible\");\n        this._row_close = this.shadowRoot.querySelector(\"#row_close\");\n        this._agg_dropdown = this.shadowRoot.querySelector(\"#column_aggregate\");\n        this._sort_order = this.shadowRoot.querySelector(\"#sort_order\");\n        this._filter_operand = this.shadowRoot.querySelector(\"#filter_operand\");\n        this._filter_operator = this.shadowRoot.querySelector(\"#filter_operator\");\n        this._column_aggregate_category = this.shadowRoot.querySelector(\"#column_aggregate_category\");\n    }\n\n    _blur_agg_dropdown() {\n        this._agg_dropdown.blur();\n        if (this._agg_dropdown.value[0] === \"[\") {\n            for (const option of this._agg_dropdown.querySelectorAll(\"optgroup option\")) {\n                const name = option.getAttribute(\"data-desc\");\n                option.innerHTML = `mean by ${name}`;\n            }\n        }\n    }\n\n    _focus_agg_dropdown() {\n        for (const option of this._agg_dropdown.querySelectorAll(\"optgroup option\")) {\n            const name = option.getAttribute(\"data-desc\");\n            option.innerHTML = `by ${name}`;\n        }\n    }\n\n    _register_callbacks() {\n        this._li.addEventListener(\"dragstart\", this._set_data_transfer.bind(this));\n        this._li.addEventListener(\"dragend\", () => {\n            this.dispatchEvent(new CustomEvent(\"row-dragend\"));\n        });\n        this._visible.addEventListener(\"mousedown\", event => this.dispatchEvent(new CustomEvent(\"visibility-clicked\", {detail: event})));\n        this._row_close.addEventListener(\"mousedown\", event => this.dispatchEvent(new CustomEvent(\"close-clicked\", {detail: event})));\n        this._agg_dropdown.addEventListener(\"focus\", this._focus_agg_dropdown.bind(this));\n\n        this._agg_dropdown.addEventListener(\"change\", event => {\n            this._blur_agg_dropdown();\n            const value = this._agg_dropdown.value;\n            this.setAttribute(\"aggregate\", value);\n            this.dispatchEvent(new CustomEvent(\"aggregate-selected\", {detail: event}));\n        });\n        this._sort_order.addEventListener(\"click\", event => {\n            this.dispatchEvent(new CustomEvent(\"sort-order\", {detail: event}));\n        });\n\n        const debounced_filter = debounce(event => this._update_filter(event), 50);\n        this._filter_operator.addEventListener(\"change\", () => {\n            this._filter_operand.focus();\n            this._filter_operator.style.width = get_text_width(this._filter_operator.value);\n            const filter_input = this.shadowRoot.querySelector(\"#filter_operand\");\n            filter_input.style.width = get_text_width(\"\" + this._filter_operand.value, 30);\n            debounced_filter();\n        });\n    }\n\n    connectedCallback() {\n        this._register_ids();\n        this._register_callbacks();\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {swap} from \"../utils.js\";\n\nfunction calc_index(event) {\n    if (this._active_columns.children.length == 0) {\n        return 0;\n    } else {\n        let is_last_null = false;\n        for (let cidx in this._active_columns.children) {\n            let child = this._active_columns.children[cidx];\n            is_last_null = is_last_null || child?.classList?.contains(\"null-column\");\n            if (child.offsetTop + child.offsetHeight > event.offsetY + this._active_columns.scrollTop) {\n                return parseInt(cidx);\n            }\n        }\n        let last_index = this._active_columns.children.length;\n        if (is_last_null) {\n            last_index--;\n        }\n        return last_index;\n    }\n}\n\nexport function dragend(event) {\n    let div = event.target.getRootNode().host;\n    let parent = div;\n    if (parent.tagName === \"PERSPECTIVE-VIEWER\") {\n        parent = event.target.parentElement;\n    } else {\n        parent = div.parentElement;\n    }\n    let idx = Array.prototype.slice.call(parent.children).indexOf(div.tagName === \"PERSPECTIVE-ROW\" ? div : event.target);\n    let attr_name = parent.getAttribute(\"for\");\n    if (this.hasAttribute(attr_name)) {\n        let attr_value = JSON.parse(this.getAttribute(attr_name));\n        attr_value.splice(idx, 1);\n        if (attr_value.length === 0) {\n            this.removeAttribute(attr_name);\n        } else {\n            this.setAttribute(attr_name, JSON.stringify(attr_value));\n        }\n    }\n}\n\nexport function drop(ev) {\n    ev.preventDefault();\n    ev.currentTarget.classList.remove(\"dropping\");\n    DRAG_COUNT_MAP = new WeakMap();\n    if (this._drop_target_hover) {\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n    let data = ev.dataTransfer.getData(\"text\");\n    if (!data) return;\n    data = JSON.parse(data);\n\n    // Update the columns attribute\n    let name = ev.currentTarget.querySelector(\"ul\").getAttribute(\"for\") || ev.currentTarget.getAttribute(\"id\").replace(\"_\", \"-\");\n    let columns = JSON.parse(this.getAttribute(name) || \"[]\");\n    let data_index = columns.indexOf(data[0]);\n    if (data_index !== -1) {\n        columns.splice(data_index, 1);\n    }\n\n    const filtering = name.indexOf(\"filter\") > -1;\n    if (filtering) {\n        this.setAttribute(name, JSON.stringify(columns.concat([data])));\n    } else if (name.indexOf(\"sort\") > -1) {\n        this.setAttribute(name, JSON.stringify(columns.concat([[data[0]]])));\n    } else {\n        this.setAttribute(name, JSON.stringify(columns.concat([data[0]])));\n    }\n\n    // Deselect the dropped column\n    if (this._plugin.deselectMode === \"pivots\" && this._get_visible_column_count() > 1 && name !== \"sort\" && !filtering) {\n        for (let x of this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\")) {\n            if (x.getAttribute(\"name\") === data[0]) {\n                this._active_columns.removeChild(x);\n                break;\n            }\n        }\n        this._update_column_view();\n    }\n\n    this._debounce_update();\n}\n\nexport function column_dragend(event) {\n    let data = event.target.parentElement.parentElement;\n    if (Array.prototype.slice(this._active_columns.children).indexOf(data) > -1 && this._get_visible_column_count() > 1 && event.dataTransfer.dropEffect !== \"move\") {\n        this._active_columns.removeChild(data);\n        this._update_column_view();\n    }\n    this._active_columns.classList.remove(\"dropping\");\n}\n\nexport function column_dragleave(event) {\n    let src = event.relatedTarget;\n    while (src && src !== this._active_columns) {\n        src = src.parentElement;\n    }\n    if (src === null) {\n        this._active_columns.classList.remove(\"dropping\");\n        if (this._drop_target_null) {\n            this._active_columns.replaceChild(this._drop_target_null, this._drop_target_hover);\n            delete this._drop_target_null;\n        }\n        if (this._drop_target_hover.parentElement === this._active_columns) {\n            this._active_columns.removeChild(this._drop_target_hover);\n        }\n        if (this._original_index !== -1) {\n            this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[this._original_index]);\n        }\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n}\n\nfunction _unset_drop_target_null() {\n    if (this._drop_target_null) {\n        if (this._drop_target_null.parentElement === this._active_columns) {\n            swap(this._active_columns, this._drop_target_hover, this._drop_target_null);\n        } else {\n            this._active_columns.replaceChild(this._drop_target_null, this._drop_target_hover);\n        }\n        delete this._drop_target_null;\n    }\n}\n\nfunction column_swap(new_index) {\n    _unset_drop_target_null.call(this);\n    if (this._active_columns.children[new_index]) {\n        if (this._drop_target_hover !== this._active_columns.children[new_index]) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            swap(this._active_columns, this._active_columns.children[new_index], this._drop_target_hover);\n        }\n    }\n}\n\nfunction column_replace(new_index) {\n    _unset_drop_target_null.call(this);\n    if (this._active_columns.children[new_index]) {\n        this._drop_target_null = this._active_columns.children[new_index];\n        this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n    }\n}\n\nexport function column_dragover(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n    if (!this._drop_target_hover.hasAttribute(\"drop-target\")) {\n        this._drop_target_hover.toggleAttribute(\"drop-target\", true);\n    }\n    let new_index = calc_index.call(this, event);\n    const current_index = Array.prototype.slice.call(this._active_columns.children).indexOf(this._drop_target_hover);\n    const over_elem = this._active_columns.children[new_index];\n    const to_replace = new_index < this._plugin.initial?.names?.length - 1;\n    const is_diff = this._drop_target_hover !== this._active_columns.children[new_index];\n    const from_active = this._original_index !== -1;\n    const from_replace = from_active && this._original_index < this._plugin.initial?.names?.length - 1;\n    const from_append = from_active && this._original_index >= this._plugin.initial?.names?.length - 1;\n    const from_required = from_active && this._original_index < this._plugin.initial?.count;\n    const to_required = new_index < this._plugin.initial?.count;\n    const to_null = !to_required && over_elem?.classList.contains(\"null-column\");\n    if (from_required && to_null) {\n        _unset_drop_target_null.call(this);\n    } else if (to_replace && from_append && is_diff) {\n        _unset_drop_target_null.call(this);\n        const from_last =\n            this._original_index === this._plugin.initial?.names?.length - 1 &&\n            this._drop_target_hover === this._active_columns.children[this._original_index] &&\n            this._active_columns.children.length === this._plugin.initial?.names?.length;\n        if (from_last) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            swap(this._active_columns, this._active_columns.children[new_index], this._drop_target_hover);\n        } else if (!this._active_columns.children[new_index]?.classList.contains(\"null-column\")) {\n            this._drop_target_null = this._active_columns.children[new_index];\n            this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n            this._active_columns.insertBefore(this._drop_target_null, this._active_columns.children[this._original_index]);\n        } else {\n            if (this._drop_target_hover !== this._active_columns.children[new_index]) {\n                this._drop_target_null = this._active_columns.children[new_index];\n                this._active_columns.replaceChild(this._drop_target_hover, this._active_columns.children[new_index]);\n            }\n        }\n    } else if (to_replace && from_active && is_diff) {\n        column_swap.call(this, new_index);\n    } else if (to_replace && !from_active && is_diff) {\n        column_replace.call(this, new_index);\n    } else if (!to_replace && from_replace && is_diff) {\n        column_swap.call(this, new_index);\n    } else if (to_null && from_active) {\n        column_swap.call(this, new_index);\n    } else if (to_null && !from_active) {\n        column_replace.call(this, new_index);\n    } else if (current_index < new_index) {\n        if (new_index + 1 < this._active_columns.children.length) {\n            if (!this._active_columns.children[new_index + 1].hasAttribute(\"drop-target\")) {\n                _unset_drop_target_null.call(this);\n                this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[new_index + 1]);\n            }\n        } else {\n            if (!this._active_columns.children[this._active_columns.children.length - 1].hasAttribute(\"drop-target\")) {\n                _unset_drop_target_null.call(this);\n                this._active_columns.appendChild(this._drop_target_hover);\n            }\n        }\n    } else if (new_index < this._active_columns.children.length) {\n        if (!this._active_columns.children[new_index].hasAttribute(\"drop-target\")) {\n            _unset_drop_target_null.call(this);\n            this._active_columns.insertBefore(this._drop_target_hover, this._active_columns.children[new_index]);\n        }\n    } else {\n        if (!this._active_columns.children[this._active_columns.children.length - 1].hasAttribute(\"drop-target\")) {\n            _unset_drop_target_null.call(this);\n            this._active_columns.appendChild(this._drop_target_hover);\n        }\n    }\n}\n\nexport function column_drop(ev) {\n    ev.preventDefault();\n    delete this._drop_target_null;\n    ev.currentTarget.classList.remove(\"dropping\");\n    DRAG_COUNT_MAP = new WeakMap();\n    if (this._drop_target_hover.parentElement === this._active_columns) {\n        this._drop_target_hover.removeAttribute(\"drop-target\");\n    }\n    let data = ev.dataTransfer.getData(\"text\");\n    if (!data) return;\n\n    this._update_column_view();\n}\n\nexport function dragover(ev) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    ev.dataTransfer.dropEffect = \"move\";\n}\n\nlet DRAG_COUNT_MAP = new WeakMap();\n\nfunction dragenterleave(event) {\n    let dragHoverCount = DRAG_COUNT_MAP.get(event.currentTarget) || 0;\n    event.type === \"dragenter\" ? dragHoverCount++ : dragHoverCount--;\n    DRAG_COUNT_MAP.set(event.currentTarget, dragHoverCount);\n    event.currentTarget.classList.toggle(\"dropping\", dragHoverCount > 0);\n    event.preventDefault();\n}\n\nexport const dragenter = dragenterleave;\nexport const dragleave = dragenterleave;\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport class CancelTask {\n    constructor(on_cancel, initial = false) {\n        this._on_cancel = on_cancel;\n        this._cancelled = false;\n        this.initial = initial;\n    }\n\n    cancel() {\n        if (!this._cancelled && this._on_cancel) {\n            this._on_cancel();\n            this._on_cancel = undefined;\n        }\n        this._cancelled = true;\n    }\n\n    get cancelled() {\n        return this._cancelled;\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {renderers} from \"./renderers.js\";\n\nexport class StateElement extends HTMLElement {\n    get _plugin() {\n        let current_renderers = renderers.getInstance();\n        let view = this.getAttribute(\"plugin\");\n        if (!view) {\n            view = Object.keys(current_renderers)[0];\n            this.setAttribute(\"plugin\", view);\n        }\n        return current_renderers[view] || current_renderers[Object.keys(current_renderers)[0]];\n    }\n\n    // deprecate\n    _get_view_dom_columns(selector, callback) {\n        selector = selector || \"#active_columns perspective-row\";\n        let columns = Array.prototype.slice.call(this.shadowRoot.querySelectorAll(selector));\n        if (!callback) {\n            return columns;\n        }\n        return columns.map(callback).filter(x => x);\n    }\n\n    _get_view_active_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\"));\n    }\n\n    _get_view_active_valid_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#active_columns perspective-row\")).filter(x => !x.classList.contains(\"null-column\"));\n    }\n\n    _get_view_inactive_columns() {\n        return Array.prototype.slice.call(this.shadowRoot.querySelectorAll(\"#inactive_columns perspective-row\"));\n    }\n\n    _get_view_all_column_names() {\n        return this._get_view_inactive_columns().map(x => x.getAttribute(\"name\"));\n    }\n\n    _get_view_active_column_names() {\n        return this._get_view_active_columns().map(x => x.getAttribute(\"name\"));\n    }\n\n    _get_view_all_valid_column_names() {\n        return this._get_view_all_column_names().filter(x => x);\n    }\n\n    _get_view_active_valid_column_names() {\n        return this._get_view_active_column_names().filter(x => x);\n    }\n\n    _get_view_active_valid_column_count() {\n        return this._get_view_active_valid_column_names().length;\n    }\n\n    // deprecate\n    _get_view_columns({active = true} = {}) {\n        let selector;\n        if (active) {\n            selector = \"#active_columns perspective-row\";\n        } else {\n            selector = \"#inactive_columns perspective-row\";\n        }\n        return this._get_view_dom_columns(selector, col => {\n            return col.getAttribute(\"name\");\n        });\n    }\n\n    _get_view_aggregates(selector) {\n        selector = selector || \"#active_columns perspective-row\";\n        return this._get_view_dom_columns(selector, s => {\n            let op = s.getAttribute(\"aggregate\");\n            if (op[0] === \"[\") {\n                try {\n                    op = JSON.parse(op);\n                } catch (e) {\n                    console.error(e);\n                }\n            }\n            const column = s.getAttribute(\"name\");\n            return column && {op, column};\n        });\n    }\n\n    _get_view_row_pivots() {\n        return this._get_view_dom_columns(\"#row_pivots perspective-row\", col => {\n            return col.getAttribute(\"name\");\n        });\n    }\n\n    _get_view_column_pivots() {\n        return this._get_view_dom_columns(\"#column_pivots perspective-row\", col => {\n            return col.getAttribute(\"name\");\n        });\n    }\n\n    _get_view_filter_nodes() {\n        return this._get_view_dom_columns(\"#filters perspective-row\");\n    }\n\n    _get_view_filters() {\n        return this._get_view_dom_columns(\"#filters perspective-row\", col => {\n            let {operator, operand} = JSON.parse(col.getAttribute(\"filter\"));\n            return [col.getAttribute(\"name\"), operator, operand];\n        });\n    }\n\n    _get_view_sorts() {\n        return this._get_view_dom_columns(\"#sort perspective-row\", col => {\n            let order = col.getAttribute(\"sort-order\") || \"asc\";\n            return [col.getAttribute(\"name\"), order];\n        });\n    }\n\n    _get_view_expressions() {\n        return JSON.parse(this.getAttribute(\"expressions\")) || [];\n    }\n\n    _get_visible_column_count() {\n        return this._get_view_active_columns().length;\n    }\n\n    get_aggregate_attribute() {\n        const aggs = JSON.parse(this.getAttribute(\"aggregates\")) || {};\n        const found = new Set();\n        const new_aggs = Object.keys(aggs).map(col => {\n            found.add(col);\n            return {column: col, op: aggs[col]};\n        });\n        if (this._aggregate_defaults) {\n            for (const column of Object.keys(this._aggregate_defaults)) {\n                if (!found.has(column)) {\n                    new_aggs.push({\n                        column,\n                        op: this._aggregate_defaults[column]\n                    });\n                }\n            }\n        }\n        return new_aggs;\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport isEqual from \"lodash/isEqual\";\nimport {html, render} from \"lit-html\";\n\nimport {throttlePromise} from \"../utils.js\";\nimport * as perspective from \"@finos/perspective/dist/esm/config/constants.js\";\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\nimport {CancelTask} from \"./cancel_task.js\";\n\nimport {StateElement} from \"./state_element.js\";\nimport {findExpressionByAlias, getExpressionAlias} from \"../utils.js\";\n\n/******************************************************************************\n *\n *  Helpers\n *\n */\n\nfunction numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nlet TYPE_ORDER = {integer: 2, string: 0, float: 3, boolean: 4, datetime: 1, date: 1};\n\nconst column_sorter = schema => (a, b) => {\n    const s1 = TYPE_ORDER[schema[a]];\n    const s2 = TYPE_ORDER[schema[b]];\n    let r = 0;\n    if (s1 == s2) {\n        r = a.toLowerCase() < b.toLowerCase() ? -1 : 1;\n    } else {\n        r = s1 < s2 ? -1 : 1;\n    }\n    return r;\n};\n\nfunction get_aggregate_defaults(columns, schema, expression_schema) {\n    const aggregates = {};\n    for (const col of columns) {\n        let type = schema[col];\n        if (!type) {\n            type = expression_schema[col];\n        }\n        aggregates[col] = get_type_config(type).aggregate;\n    }\n    return aggregates;\n}\n\nfunction get_aggregates_with_defaults(aggregate_attribute, columns, schema, expression_schema) {\n    const found = new Set();\n    const aggregates = [];\n    for (const col of aggregate_attribute) {\n        let type = schema[col.column];\n        if (!type) {\n            type = expression_schema[col.column];\n        }\n        const type_config = get_type_config(type);\n        found.add(col.column);\n        if (type_config.type || type) {\n            if (col.op === \"\" || perspective.TYPE_AGGREGATES[type_config.type || type].indexOf(col.op) === -1) {\n                col.op = type_config.aggregate;\n            }\n            aggregates.push(col);\n        } else {\n            console.warn(`No column \"${col.column}\" found (specified in aggregates attribute).`);\n        }\n    }\n\n    // Add columns detected from dataset.\n    for (const col of columns) {\n        if (!found.has(col)) {\n            let type = schema[col];\n            if (!type) {\n                type = expression_schema[col.column];\n            }\n            aggregates.push({\n                column: col,\n                op: get_type_config(type).aggregate\n            });\n        }\n    }\n\n    return aggregates;\n}\n\nconst _total_template = args => {\n    if (args) {\n        const x = numberWithCommas(args[0]);\n        const y = numberWithCommas(args[1]);\n        const total = Math.floor((args[0] / args[1]) * 100);\n        return html`\n            <span title=\"${x} / ${y}\" class=\"plugin_information--overflow-hint\">&nbsp;<span class=\"plugin_information--overflow-hint-percent\">${total}%</span>&nbsp;</span>\n        `;\n    }\n};\n\nconst _nowrap_template = text => {\n    if (text !== \"\") {\n        return html`\n            <span style=\"white-space:nowrap\">${text}</span>\n        `;\n    }\n};\n\n/**\n * Render warning template tagged literal.\n * @param {*} strings\n * @param  {...[n, m]} args tuples of rationals to be formatted.\n */\nconst _warning = (strings, ...args) => strings.flatMap((str, idx) => [_nowrap_template(str), _total_template(args[idx])]).filter(x => x);\n\n/******************************************************************************\n *\n * PerspectiveElement\n *\n */\n\nexport class PerspectiveElement extends StateElement {\n    /**\n     * Given a {@link module:perspective~table}, load it into the\n     * {@link module:perspective_viewer~PerspectiveViewer} and set the viewer's\n     * state. If the `expressions` attribute is set on the viewer, this\n     * method attempts to validate the expressions with the `Table` and\n     * reconcile state.\n     *\n     * @param {*} table\n     */\n    async _load_table(table, resolve) {\n        this.shadowRoot.querySelector(\"#app\").classList.add(\"hide_message\");\n\n        this._clear_state();\n        this._table = table;\n\n        let [cols, schema] = await Promise.all([table.columns(), table.schema(true)]);\n\n        // Initial col order never contains expressions\n        this._initial_col_order = cols.slice();\n\n        // Grab expressions from the viewer and validate them so that\n        // expressions do not crash the viewer/table.\n        const expressions = this._get_view_expressions();\n        const valid_expressions = [];\n\n        let expression_schema = {};\n\n        if (expressions.length > 0) {\n            const valid_expression_alias = [];\n            const validate_results = await table.validate_expressions(expressions);\n            expression_schema = validate_results.expression_schema;\n\n            for (const expression of expressions) {\n                const alias = getExpressionAlias(expression);\n\n                if (alias === undefined) {\n                    console.warn(`Not applying expression ${expression} as it does not have an alias set.`);\n                    continue;\n                }\n\n                if (expression_schema[alias]) {\n                    valid_expressions.push(expression);\n                    valid_expression_alias.push(alias);\n                } else {\n                    console.error(`Could not validate expression \"${alias}\": ${validate_results.errors[alias]}`);\n                }\n            }\n\n            cols = cols.concat(valid_expression_alias);\n        }\n\n        if (!this.hasAttribute(\"columns\")) {\n            this.setAttribute(\"columns\", JSON.stringify(this._initial_col_order));\n        }\n\n        cols.sort(column_sorter(schema));\n\n        // Update aggregates\n        const aggregate_attribute = this.get_aggregate_attribute();\n        const aggregates = get_aggregates_with_defaults(aggregate_attribute, cols, schema, expression_schema);\n\n        let shown = JSON.parse(this.getAttribute(\"columns\")); //.filter(x => all_cols.indexOf(x) > -1);\n\n        // At this point, cols contains both the table columns and the\n        // validated expressions, so this should only filter on columns\n        // that don't exist in either.\n        const shown_is_invalid = shown.filter(x => cols.indexOf(x) > -1).length === 0;\n\n        if (shown_is_invalid) {\n            shown = this._initial_col_order;\n        }\n\n        this._aggregate_defaults = get_aggregate_defaults(cols, schema, expression_schema);\n\n        // Clear the columns in the DOM before adding new ones\n        this._clear_columns();\n\n        for (const name of cols) {\n            let aggregate = aggregates.find(a => a.column === name).op;\n            let type = schema[name];\n            if (!type) {\n                type = expression_schema[name];\n            }\n            const expression = findExpressionByAlias(name, valid_expressions);\n            const row = this._new_row(name, type, aggregate, null, null, expression);\n            this._inactive_columns.appendChild(row);\n            if (shown.includes(name)) {\n                row.classList.add(\"active\");\n            }\n        }\n\n        while (shown.length < this._plugin.initial?.names?.length) {\n            shown.push(null);\n        }\n\n        for (const x of shown) {\n            let type = schema[x];\n            if (!type) {\n                type = expression_schema[x];\n            }\n            const expression = findExpressionByAlias(x, valid_expressions);\n            const active_row = this._new_row(x, type, undefined, undefined, undefined, expression);\n            this._active_columns.appendChild(active_row);\n        }\n\n        if (cols.length === shown.filter(x => cols.indexOf(x) > -1).length) {\n            this._columns_container.classList.add(\"collapse\");\n        } else {\n            this._columns_container.classList.remove(\"collapse\");\n        }\n\n        this._show_column_container();\n        this._show_side_panel_actions();\n\n        // Filters need type information to populate e.g. the operator dropdown,\n        // so reset them.\n        if (this.hasAttribute(\"filters\")) {\n            this.filters = this.getAttribute(\"filters\");\n        }\n\n        // Get an edit port from the table, and set it on the viewer so that\n        // all grid edits use the specified port.\n        this._edit_port = await table.make_port();\n\n        // Resolve the edit port lock, which allows for `get_edit_port` to be\n        // called in arbitary order without ever returning a null value.\n        this._edit_port_lock.resolve(this._edit_port);\n\n        try {\n            await this._debounce_update({force_update: true});\n        } catch (e) {\n            console.warn(\"Initial view failed, resetting UI state\");\n            await this.reset();\n            throw e;\n        }\n\n        resolve();\n    }\n\n    async get_maxes() {\n        // If the plugin is set to not render a warning, i.e. after the user\n        // selects \"Render all points\", then return null for max_cols/max_rows.\n        if (typeof this._plugin.max_columns !== \"undefined\" && this._plugin.render_warning === false) {\n            return {\n                max_cols: null,\n                max_rows: null\n            };\n        }\n\n        let max_cols, max_rows;\n        const [schema, num_columns] = await Promise.all([this._view.schema(), this._view.num_columns()]);\n        const schema_columns = Object.keys(schema || {}).length || 1;\n\n        if (typeof this._plugin.max_columns !== \"undefined\") {\n            const column_group_diff = this._plugin.max_columns % schema_columns;\n            const column_limit = this._plugin.max_columns + column_group_diff;\n            max_cols = column_limit < num_columns ? column_limit : undefined;\n        }\n\n        if (typeof this._plugin.max_cells !== \"undefined\") {\n            max_rows = Math.ceil(max_cols ? this._plugin.max_cells / max_cols : this._plugin.max_cells / (num_columns || 1));\n        }\n\n        return {max_cols, max_rows};\n    }\n\n    async _warn_render_size_exceeded(max_cols, max_rows) {\n        if (this._show_warnings && (max_cols || max_rows)) {\n            const num_columns = await this._view.num_columns();\n            const num_rows = await this._view.num_rows();\n            const count = num_columns * num_rows;\n            const columns_are_truncated = max_cols && max_cols < num_columns;\n            const rows_are_truncated = max_rows && max_rows < num_rows;\n            if (columns_are_truncated && rows_are_truncated) {\n                this._plugin_information.classList.remove(\"hidden\");\n                const warning = _warning`Rendering ${[max_cols, num_columns]} of columns and ${[num_columns * max_rows, count]} of points.`;\n                render(warning, this._plugin_information_message);\n                return true;\n            } else if (columns_are_truncated) {\n                this._plugin_information.classList.remove(\"hidden\");\n                const warning = _warning`Rendering ${[max_cols, num_columns]} of columns.`;\n                render(warning, this._plugin_information_message);\n                return true;\n            } else if (rows_are_truncated) {\n                this._plugin_information.classList.remove(\"hidden\");\n                const warning = _warning`Rendering ${[num_columns * max_rows, count]} of points.`;\n                render(warning, this._plugin_information_message);\n                return true;\n            } else {\n                this._plugin_information.classList.add(\"hidden\");\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Calculates the optimal timeout in milliseconds for render events,\n     * calculated by 5 frame moving average of this component's render\n     * framerate, or explicit override attribute `\"throttle\"`.\n     *\n     * @private\n     * @returns\n     * @memberof PerspectiveElement\n     */\n    _calculate_throttle_timeout() {\n        let timeout;\n        const throttle = this.getAttribute(\"throttle\");\n        if (throttle === undefined || throttle === \"null\" || !this.hasAttribute(\"throttle\")) {\n            if (!this.__render_times || this.__render_times.length < 5) {\n                return 0;\n            }\n            timeout = this.__render_times.reduce((x, y) => x + y, 0) / this.__render_times.length;\n            timeout = Math.min(5000, timeout);\n        } else {\n            timeout = parseInt(throttle);\n            if (isNaN(timeout) || timeout < 0) {\n                console.warn(`Bad throttle attribute value \"${throttle}\".  Can be (non-negative integer) milliseconds.`);\n                this.removeAttribute(\"throttle\");\n                return 0;\n            }\n        }\n        return Math.max(0, timeout);\n    }\n\n    _view_on_update(limit_points) {\n        if (!this._debounced) {\n            this._debounced = setTimeout(async () => {\n                this._debounced = undefined;\n                const timer = this._render_time();\n                if (this._task && !this._task.initial) {\n                    this._task.cancel();\n                }\n                const task = (this._task = new CancelTask());\n                const updater = this._plugin.update || this._plugin.create;\n                try {\n                    if (limit_points) {\n                        const {max_cols, max_rows} = await this.get_maxes();\n                        if (!task.cancelled) {\n                            await this._warn_render_size_exceeded(max_cols, max_rows);\n                            await updater.call(this, this._datavis, this._view, task, max_cols, max_rows);\n                        }\n                    } else {\n                        await updater.call(this, this._datavis, this._view, task);\n                    }\n                    timer();\n                    task.cancel();\n                } finally {\n                    this.dispatchEvent(new Event(\"perspective-view-update\"));\n                }\n            }, this._calculate_throttle_timeout());\n        }\n    }\n\n    async _validate_filters() {\n        const filters = [];\n        for (const node of this._get_view_filter_nodes()) {\n            const operandNode = node.shadowRoot.getElementById(\"filter_operand\");\n            const exclamation = node.shadowRoot.getElementById(\"row_exclamation\");\n            const {operator, operand} = JSON.parse(node.getAttribute(\"filter\"));\n            const filter = [node.getAttribute(\"name\"), operator, operand];\n            if (await this._table.is_valid_filter(filter)) {\n                filters.push(filter);\n                operandNode.style.borderColor = \"\";\n                exclamation.hidden = true;\n            } else {\n                operandNode.style.borderColor = \"red\";\n                exclamation.hidden = false;\n            }\n        }\n\n        return filters;\n    }\n\n    _is_config_changed(config) {\n        const plugin_name = this.getAttribute(\"plugin\");\n        if (isEqual(config, this._previous_config) && plugin_name === this._previous_plugin_name) {\n            return false;\n        } else {\n            this._previous_config = config;\n            this._previous_plugin_name = plugin_name;\n            return true;\n        }\n    }\n\n    async _new_view({force_update = false, ignore_size_check = false, limit_points = true} = {}) {\n        if (!this._table) return;\n        this._check_responsive_layout();\n        const row_pivots = this._get_view_row_pivots();\n        const column_pivots = this._get_view_column_pivots();\n        const filters = await this._validate_filters();\n        const view_aggregates = this._get_view_aggregates();\n        if (view_aggregates.length === 0) return;\n        const sort = this._get_view_sorts();\n\n        let columns = view_aggregates.map(x => x.column);\n        let aggregates = {};\n        for (const a of view_aggregates) {\n            aggregates[a.column] = a.op;\n        }\n\n        for (const s of sort) {\n            const name = s[0];\n            if (columns.indexOf(name) === -1 && !(column_pivots.indexOf(s) > -1 || row_pivots.indexOf(s) > -1)) {\n                const all = this.get_aggregate_attribute();\n                const {column, op} = all.reduce((obj, y) => (y.column === name ? y : obj));\n                aggregates[column] = op;\n            }\n        }\n\n        const expressions = this._get_view_expressions();\n\n        const config = {\n            filter: filters,\n            row_pivots: row_pivots,\n            column_pivots: column_pivots,\n            aggregates: aggregates,\n            columns: columns,\n            sort: sort,\n            expressions: expressions\n        };\n\n        if (this._task) {\n            this._task.cancel();\n        }\n\n        if (this._view) {\n            this._view.remove_update(this._view_updater);\n            this._vieux.delete_view();\n            this._view.delete();\n        }\n\n        try {\n            this._view = await this._table.view(config);\n            this._view_updater = () => this._view_on_update(limit_points);\n            this._view.on_update(this._view_updater);\n        } catch (e) {\n            // Delete the view handle only if it exists - if this._view is\n            // undefined, calling delete will throw its own \"cannot read\n            // property of undefined\" error and squash the original, more\n            // informative error message on why the view could not be created.\n            if (this._view) this._view.delete();\n            throw e;\n        }\n\n        this._vieux.set_view(this._view);\n\n        const timer = this._render_time();\n        const task = (this._task = new CancelTask(() => {}, true));\n\n        try {\n            const {max_cols, max_rows} = await this.get_maxes();\n            if (task.cancelled) {\n                return;\n            }\n            if (!ignore_size_check) {\n                await this._warn_render_size_exceeded(max_cols, max_rows);\n            }\n            if (limit_points) {\n                await this._plugin.create.call(this, this._datavis, this._view, task, max_cols, max_rows, force_update);\n            } else {\n                await this._plugin.create.call(this, this._datavis, this._view, task, undefined, undefined, force_update);\n            }\n        } catch (err) {\n            console.warn(err);\n        } finally {\n            if (!this.__render_times) {\n                this.__render_times = [];\n                this.dispatchEvent(new Event(\"perspective-view-update\"));\n            }\n\n            timer();\n            task.cancel();\n        }\n    }\n\n    _check_loaded_table() {\n        if (this._table && this._table_resolver) {\n            const table = this._table;\n            const resolve = this._table_resolver;\n            delete this._table;\n            delete this._table_resolver;\n            this._load_table(table, resolve);\n        }\n    }\n\n    _render_time() {\n        const t = performance.now();\n        return () => {\n            this.__render_times.unshift(performance.now() - t);\n            this.__render_times = this.__render_times.slice(0, 5);\n        };\n    }\n\n    _restyle_plugin() {\n        if (this._plugin.styleElement) {\n            const task = (this._task = new CancelTask());\n            this._plugin.styleElement.call(this, this._datavis, this._view, task);\n        }\n    }\n\n    _clear_state() {\n        if (this._task) {\n            this._task.cancel();\n        }\n        const all = [];\n        if (this._view) {\n            const view = this._view;\n            this._view = undefined;\n            all.push(view.delete());\n            view.remove_update(this._view_updater);\n            view.remove_delete();\n        }\n        return Promise.all(all);\n    }\n\n    _set_updating() {\n        this.toggleAttribute(\"updating\", true);\n        let resolve;\n        this._updating_promise = new Promise(_resolve => {\n            resolve = () => {\n                _resolve();\n            };\n        });\n        return resolve;\n    }\n\n    @throttlePromise(true)\n    async _update(ignore_size_check, force_update, limit_points) {\n        await new Promise(setTimeout);\n        await this._new_view({ignore_size_check, force_update, limit_points});\n    }\n\n    async _debounce_update({force_update = false, ignore_size_check = false, limit_points = true} = {}) {\n        if (this._table) {\n            let resolve = this._set_updating();\n            await this._update(ignore_size_check, force_update, limit_points);\n            resolve();\n        }\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\nimport {dragend} from \"./dragdrop.js\";\nimport {renderers} from \"./renderers.js\";\n\nimport {PerspectiveElement} from \"./perspective_element.js\";\nimport {html, render} from \"lit-html\";\nimport {findExpressionByAlias, getExpressionAlias, getRawExpression} from \"../utils.js\";\n\n/**\n * Render `<option>` blocks\n * @param {*} names name objects\n */\nconst options = vals => {\n    const opts = [];\n    for (let name in vals) {\n        opts.push(html`\n            <option value=\"${name}\">${vals[name].name || name}</option>\n        `);\n    }\n    return opts;\n};\n\nexport class DomElement extends PerspectiveElement {\n    _clear_columns() {\n        this._inactive_columns.innerHTML = \"\";\n        this._active_columns.innerHTML = \"\";\n    }\n\n    set_aggregate_attribute(aggs) {\n        let is_set = false;\n        let aggregates = aggs.reduce((obj, agg) => {\n            if (this._aggregate_defaults[agg.column] !== agg.op) {\n                obj[agg.column] = agg.op;\n                is_set = true;\n            }\n            return obj;\n        }, {});\n        if (is_set) {\n            this.setAttribute(\"aggregates\", JSON.stringify(aggregates));\n        } else {\n            this.removeAttribute(\"aggregates\");\n        }\n    }\n\n    _get_type(name) {\n        let all = this._get_view_inactive_columns();\n        if (all.length > 0) {\n            const type = all.find(x => x.getAttribute(\"name\") === name);\n            if (type) {\n                return type.getAttribute(\"type\");\n            } else {\n                return \"integer\";\n            }\n        } else {\n            return \"\";\n        }\n    }\n\n    _set_row_type(row) {\n        const weights = this._get_view_inactive_columns()\n            .filter(x => x.getAttribute(\"type\") === \"integer\" || x.getAttribute(\"type\") === \"float\")\n            .map(x => x.getAttribute(\"name\"));\n        row.set_weights(weights);\n        row.setAttribute(\"type\", this._get_type(row.getAttribute(\"name\")));\n    }\n\n    // Generates a new row in state + DOM\n    _new_row(name, type, aggregate, filter, sort, expression) {\n        let row = document.createElement(\"perspective-row\");\n        type = type || this._get_type(name);\n\n        if (!aggregate) {\n            let aggregates = this.get_aggregate_attribute();\n            if (aggregates) {\n                aggregate = aggregates.find(x => x.column === name);\n                if (aggregate) {\n                    aggregate = aggregate.op;\n                } else {\n                    aggregate = get_type_config(type).aggregate;\n                }\n            } else {\n                aggregate = get_type_config(type).aggregate;\n            }\n        }\n\n        if (filter) {\n            row.setAttribute(\"filter\", filter);\n\n            if (type === \"string\" || type === \"date\" || type === \"datetime\") {\n                // Get all unique values for the column - because all options\n                // must be valid column names, recreate expressions if the\n                // expression is in the filter.\n                const expressions = this._get_view_expressions();\n                // either the expression string or undefined\n                let expression = findExpressionByAlias(name, expressions);\n\n                // If the filter is an expression, we need to recreate the\n                // expression column.\n                this._table\n                    .view({\n                        row_pivots: [name],\n                        columns: [],\n                        expressions: expression ? [expression] : []\n                    })\n                    .then(async view => {\n                        // set as a property so we can delete it after the\n                        // autocomplete choices are set.\n                        this._filter_view = view;\n                        let nrows = await view.num_rows();\n\n                        if (nrows < 100000) {\n                            // Autocomplete\n                            const json = await view.to_json({\n                                end_row: 10\n                            });\n                            row.choices(this._autocomplete_choices(json, type));\n                        } else {\n                            console.warn(`perspective-viewer did not generate autocompletion results - ${nrows} is greater than limit of 100,000 rows.`);\n                        }\n                    })\n                    .finally(() => {\n                        // Clean up the View on the Emscripten heap.\n                        this._filter_view?.delete();\n                        delete this._filter_view;\n                    });\n            }\n        }\n\n        if (sort) {\n            row.setAttribute(\"sort-order\", sort);\n        } else {\n            if (this._get_view_column_pivots().indexOf(name) > -1) {\n                row.setAttribute(\"sort-order\", \"col asc\");\n            } else {\n                row.setAttribute(\"sort-order\", \"asc\");\n            }\n        }\n\n        const weights = this._get_view_inactive_columns()\n            .filter(x => x.getAttribute(\"type\") === \"integer\" || x.getAttribute(\"type\") === \"float\")\n            .map(x => x.getAttribute(\"name\"));\n        row.set_weights(weights);\n\n        if (name === null) {\n            row.classList.add(\"null-column\");\n        } else {\n            row.setAttribute(\"type\", type);\n            row.setAttribute(\"name\", name);\n        }\n\n        row.setAttribute(\"aggregate\", Array.isArray(aggregate) ? JSON.stringify(aggregate) : aggregate);\n\n        row.addEventListener(\"visibility-clicked\", this._column_visibility_clicked.bind(this));\n        row.addEventListener(\"aggregate-selected\", this._column_aggregate_clicked.bind(this));\n        row.addEventListener(\"filter-selected\", this._column_filter_clicked.bind(this));\n        row.addEventListener(\"close-clicked\", event => dragend.call(this, event.detail));\n        row.addEventListener(\"sort-order\", this._sort_order_clicked.bind(this));\n\n        row.addEventListener(\"row-drag\", () => {\n            this.classList.add(\"dragging\");\n            this._original_index = Array.prototype.slice.call(this._active_columns.children).findIndex(x => x.getAttribute(\"name\") === name);\n            if (this._original_index !== -1) {\n                this._drop_target_hover = this._active_columns.children[this._original_index];\n                setTimeout(() => row.setAttribute(\"drop-target\", true));\n            } else {\n                this._drop_target_hover = this._new_row(name, type, aggregate);\n            }\n        });\n        row.addEventListener(\"row-dragend\", () => {\n            this.classList.remove(\"dragging\");\n        });\n\n        if (expression) {\n            row.classList.add(\"expression\");\n\n            // used by the viewer to diff expression columns\n            row.setAttribute(\"expression\", expression);\n\n            // expression without the newline alias - allows us to hover\n            // and see the expression as typed by the user.\n            const raw_expr = getRawExpression(expression);\n            row.setAttribute(\"title\", raw_expr);\n        }\n\n        return row;\n    }\n\n    /**\n     * Add expression columns to the DOM.\n     *\n     * @param {*} expressions\n     * @param {*} expression_schema\n     */\n    _update_expressions_view(expressions, expression_schema) {\n        const columns = this._get_view_all_column_names();\n        const active = this._get_view_active_column_names();\n\n        if (expressions.length === 0) {\n            return;\n        }\n\n        let added_count = 0;\n\n        const attr = JSON.parse(this.getAttribute(\"columns\")) || [];\n        let reset_columns_attr = false;\n\n        for (const expr of expressions) {\n            // All expressions are guaranteed to have alias at this point. If\n            // it does not, then skip the expression.\n            const alias = getExpressionAlias(expr);\n\n            if (alias === undefined) {\n                console.warn(`Not applying expression ${expr} as it does not have an alias set.`);\n                continue;\n            }\n\n            //\n            // Check for whether the expression is in the attribute but\n            // NOT in the DOM - occurs when restore is called and a race\n            // condition between `expressions` and `columns` occurs.\n            const should_reset = !columns.includes(alias) && attr.includes(alias);\n\n            if (should_reset) {\n                reset_columns_attr = true;\n            }\n\n            // If the column already exists or is already in the active DOM,\n            // don't add it to the inactive DOM\n            const should_add = !columns.includes(alias) && !active.includes(alias);\n\n            if (!should_add) {\n                continue;\n            }\n\n            let type = expression_schema[alias];\n\n            const row = this._new_row(alias, type, null, null, null, expr);\n            this._inactive_columns.insertBefore(row, this._inactive_columns.childNodes[0] || null);\n            added_count++;\n        }\n\n        if (reset_columns_attr) {\n            this._update_column_view(attr, true);\n        } else {\n            // Remove collapse so that new inactive columns show up\n            if (added_count > 0 && this._inactive_columns.parentElement.classList.contains(\"collapse\")) {\n                this._inactive_columns.parentElement.classList.remove(\"collapse\");\n            }\n        }\n    }\n\n    /**\n     * Given two arrays of expressions, return an array of expressions that\n     * are in the old set but not the new set, i.e. they should be removed\n     * because they do not need to be included or re-calculated.\n     *\n     * @param {Array<String>} old_expressions\n     * @param {Array<String>} old_expressions\n     */\n    _diff_expressions(old_expressions, new_expressions) {\n        const to_remove = [];\n        for (const expr of old_expressions) {\n            if (!new_expressions.includes(expr)) {\n                to_remove.push(expr);\n            }\n        }\n        return to_remove;\n    }\n\n    /**\n     * When the `expressions` attribute is set to null, undefined, or [] or\n     * is unset, or when required, remove expression columns from the\n     * viewer. If `expressions` is undefined, all expressions are removed,\n     * otherwise the specified expressions will be removed.\n     *\n     * @param {Array<String>} expressions\n     */\n    _reset_expressions_view(expressions) {\n        if (expressions) {\n            // Only remove columns specified in `expressions`\n            const columns = this._get_view_active_column_names().filter(x => !expressions.includes(x));\n            const aggregates = this._get_view_aggregates().filter(x => !expressions.includes(x.column));\n            const rp = this._get_view_row_pivots().filter(x => !expressions.includes(x));\n            const cp = this._get_view_column_pivots().filter(x => !expressions.includes(x));\n            const sort = this._get_view_sorts().filter(x => !expressions.includes(x[0]));\n            const filters = this._get_view_filters().filter(x => !expressions.includes(x[0]));\n\n            // Aggregates as an array is from the attribute API\n            this.set_aggregate_attribute(aggregates);\n\n            this.setAttribute(\"columns\", JSON.stringify(columns));\n            this.setAttribute(\"row-pivots\", JSON.stringify(rp));\n            this.setAttribute(\"column-pivots\", JSON.stringify(cp));\n            this.setAttribute(\"sort\", JSON.stringify(sort));\n            this.setAttribute(\"filters\", JSON.stringify(filters));\n        } else {\n            // `expressions` is empty, so remove all columns that do not\n            // exist on the underlying table.\n            if (this._table) {\n                this._table.columns().then(table_columns => {\n                    const columns = this._get_view_active_column_names().filter(x => table_columns.includes(x));\n                    const aggregates = this._get_view_aggregates().filter(x => table_columns.includes(x.column));\n                    const rp = this._get_view_row_pivots().filter(x => table_columns.includes(x));\n                    const cp = this._get_view_column_pivots().filter(x => table_columns.includes(x));\n                    const sort = this._get_view_sorts().filter(x => table_columns.includes(x[0]));\n                    const filters = this._get_view_filters().filter(x => table_columns.includes(x[0]));\n\n                    // Aggregates as an array is from the attribute API\n                    this.set_aggregate_attribute(aggregates);\n\n                    this.setAttribute(\"columns\", JSON.stringify(columns));\n                    this.setAttribute(\"row-pivots\", JSON.stringify(rp));\n                    this.setAttribute(\"column-pivots\", JSON.stringify(cp));\n                    this.setAttribute(\"sort\", JSON.stringify(sort));\n                    this.setAttribute(\"filters\", JSON.stringify(filters));\n                });\n            } else {\n                // this would happen if you tried to set expressions without\n                // a table, and then restored/removed expressions/tried to apply\n                // an invalid expression. In this case just reset the viewer.\n                this.removeAttribute(\"columns\");\n                this.removeAttribute(\"row-pivots\");\n                this.removeAttribute(\"column-pivots\");\n                this.removeAttribute(\"sort\");\n                this.removeAttribute(\"filters\");\n                this.removeAttribute(\"aggregates\");\n            }\n        }\n\n        // Remove inactive expression columns from the DOM\n        const inactive_expressions = this._get_view_inactive_columns().filter(x => x.classList.contains(\"expression\"));\n\n        for (const expr of inactive_expressions) {\n            this._inactive_columns.removeChild(expr);\n        }\n\n        // Re-check on whether to collapse inactive columns\n        const pop_cols = this._get_view_active_columns().filter(x => typeof x !== \"undefined\" && x !== null);\n        const lis = this._get_view_inactive_columns();\n\n        if (pop_cols.length === lis.length) {\n            this._columns_container.classList.add(\"collapse\");\n        } else {\n            this._columns_container.classList.remove(\"collapse\");\n        }\n    }\n\n    _update_column_view(columns, reset = false) {\n        if (!columns) {\n            columns = this._get_view_active_column_names();\n        }\n\n        if (this._plugin.initial && this._plugin.initial.names) {\n            while (columns.length < this._plugin.initial.names.length) {\n                columns.push(null);\n            }\n        }\n\n        // If columns were not passed in, this is needed to keep the attribute\n        // API in sync with DOM state.\n        this.setAttribute(\"columns\", JSON.stringify(columns));\n\n        const pop_cols = columns.filter(x => typeof x !== \"undefined\" && x !== null);\n        const lis = this._get_view_inactive_columns();\n        if (pop_cols.length === lis.length) {\n            this._columns_container.classList.add(\"collapse\");\n        } else {\n            this._columns_container.classList.remove(\"collapse\");\n        }\n        lis.forEach(x => {\n            const index = pop_cols.indexOf(x.getAttribute(\"name\"));\n            if (index === -1) {\n                x.classList.remove(\"active\");\n            } else {\n                x.classList.add(\"active\");\n            }\n        });\n        if (reset) {\n            this._update_column_list(columns, this._active_columns, (name, expressions) => {\n                if (name === null) {\n                    return this._new_row(null);\n                } else {\n                    const ref = lis.find(x => x.getAttribute(\"name\") === name);\n                    if (ref) {\n                        const name = ref.getAttribute(\"name\");\n                        // either the expression string or undefined\n                        let expression = findExpressionByAlias(name, expressions);\n                        return this._new_row(name, ref.getAttribute(\"type\"), undefined, undefined, undefined, expression);\n                    }\n                }\n            });\n        }\n    }\n\n    _update_column_list(columns, container, callback, accessor) {\n        accessor = accessor || ((x, y) => y.getAttribute(\"name\") === x);\n        const active_columns = Array.prototype.slice.call(container.children);\n\n        // Make sure the `expression` class and attribute is set on expressions\n        const expressions = this._get_view_expressions();\n\n        for (let i = 0, j = 0; i < active_columns.length || j < columns.length; i++, j++) {\n            const name = columns[j];\n            const col = active_columns[i];\n            const next_col = active_columns[i + 1];\n            if (!col) {\n                const node = callback(name, expressions);\n                if (node) {\n                    container.appendChild(node);\n                }\n            } else if (typeof name === \"undefined\") {\n                container.removeChild(col);\n            } else if (accessor(name, col)) {\n                this._set_row_type(col);\n            } else {\n                if (col.classList.contains(\"null-column\")) {\n                    const node = callback(name, expressions);\n                    if (node) {\n                        container.replaceChild(node, col);\n                    }\n                } else if (next_col && accessor(name, next_col)) {\n                    container.removeChild(col);\n                    i++;\n                    //  j--;\n                } else {\n                    const node = callback(name, expressions);\n                    if (node) {\n                        container.insertBefore(node, col);\n                        i--;\n                    }\n                }\n            }\n        }\n    }\n\n    _set_row_styles() {\n        let style = \"\";\n        if (this._plugin.initial && this._plugin.initial.names) {\n            for (const nidx in this._plugin.initial.names) {\n                const name = this._plugin.initial.names[nidx];\n                style += `#active_columns perspective-row:nth-child(${parseInt(nidx) + 1}){margin-top:23px;}`;\n                style += `#active_columns perspective-row:nth-child(${parseInt(nidx) + 1}):before{content:\"${name}\";}`;\n            }\n        }\n        this.shadowRoot.querySelector(\"#psp_styles\").innerHTML = style;\n    }\n\n    _show_column_container() {\n        this.shadowRoot.querySelector(\"#columns_container\").style.visibility = \"visible\";\n    }\n\n    _show_side_panel_actions() {\n        this.shadowRoot.querySelector(\"#side_panel__actions\").style.visibility = \"visible\";\n    }\n\n    _remove_null_columns(since_index = 0) {\n        const elems = this._get_view_active_columns();\n        while (++since_index < elems.length) {\n            const elem = elems[since_index];\n            if (elem.classList.contains(\"null-column\")) {\n                this.shadowRoot.querySelector(\"#active_columns\").removeChild(elem);\n            }\n        }\n    }\n\n    _set_column_defaults() {\n        const cols = this._get_view_inactive_columns();\n        const active_cols = this._get_view_active_valid_columns();\n        const valid_active_cols = this._get_view_active_valid_column_names();\n        if (cols.length > 0) {\n            if (this._plugin.initial) {\n                let pref = [];\n                let count = this._plugin.initial.count || 2;\n                this._fill_numeric(active_cols, pref);\n                this._fill_numeric(cols, pref);\n                this._fill_numeric(cols, pref, true);\n                pref = pref.slice(0, count);\n                const labels = this._plugin.initial.names;\n                while (labels && pref.length < labels.length) {\n                    pref.push(null);\n                }\n                this.setAttribute(\"columns\", JSON.stringify(pref));\n            } else if (this._plugin.selectMode === \"select\") {\n                this.setAttribute(\"columns\", JSON.stringify([cols[0].getAttribute(\"name\")]));\n            } else {\n                this.setAttribute(\"columns\", JSON.stringify(valid_active_cols));\n                this._remove_null_columns();\n            }\n        }\n    }\n\n    _fill_numeric(cols, pref, bypass = false) {\n        for (let col of cols) {\n            let type = col.getAttribute(\"type\");\n            let name = col.getAttribute(\"name\");\n            if (bypass || ([\"float\", \"integer\"].indexOf(type) > -1 && pref.indexOf(name) === -1)) {\n                pref.push(name);\n            }\n        }\n    }\n\n    async _check_responsive_layout() {\n        if (this.shadowRoot) {\n            const app = this.shadowRoot.querySelector(\"#app\");\n            if (this.clientHeight < 500 && this.clientWidth > 600 && this._get_view_columns({active: false}).length > this._get_view_columns().length) {\n                if (!app.classList.contains(\"columns_horizontal\")) {\n                    const old = this._persisted_side_panel_width;\n                    this._persisted_side_panel_width = this._side_panel.style.width;\n                    this._side_panel.style.width = old || \"\";\n                    app.classList.add(\"columns_horizontal\");\n                }\n            } else if (app.classList.contains(\"columns_horizontal\")) {\n                const panel = this.shadowRoot.querySelector(\"#pivot_chart_container\");\n                panel.clientWidth + this._side_panel.clientWidth;\n                const width = this._persisted_side_panel_width || panel.clientWidth + this._side_panel.clientWidth / 2;\n                const height = panel.clientHeight + 50;\n                await this._pre_resize(width, height, () => {\n                    const old = this._persisted_side_panel_width;\n                    this._persisted_side_panel_width = this._side_panel.style.width;\n                    this._side_panel.style.width = old || \"\";\n                    app.classList.remove(\"columns_horizontal\");\n                });\n                return true;\n            }\n\n            // else if (this.clientWidth < 600 && this.clientHeight < 500) {\n            // if (!app.classList.contains(\"responsive_collapse_2\")) {\n            //     app.classList.add(\"responsive_collapse_2\");\n            // }\n            // } else if (app.classList.contains(\"responsive_collapse_2\")) {\n            // app.classList.remove(\"responsive_collapse_2\");\n            // }\n            return false;\n        }\n        return false;\n    }\n\n    // setup functions\n    _register_ids() {\n        this._app = this.shadowRoot.querySelector(\"#app\");\n        this._aggregate_selector = this.shadowRoot.querySelector(\"#aggregate_selector\");\n        this._vis_selector = this.shadowRoot.querySelector(\"#vis_selector\");\n        this._filters = this.shadowRoot.querySelector(\"#filters\");\n        this._row_pivots = this.shadowRoot.querySelector(\"#row_pivots\");\n        this._column_pivots = this.shadowRoot.querySelector(\"#column_pivots\");\n        this._datavis = this.shadowRoot.querySelector(\"#pivot_chart\");\n        this._active_columns = this.shadowRoot.querySelector(\"#active_columns\");\n        this._inactive_columns = this.shadowRoot.querySelector(\"#inactive_columns\");\n        this._side_panel_actions = this.shadowRoot.querySelector(\"#side_panel__actions\");\n        this._add_expression_button = this.shadowRoot.querySelector(\"#add-expression\");\n        this._side_panel = this.shadowRoot.querySelector(\"#side_panel\");\n        this._top_panel = this.shadowRoot.querySelector(\"#top_panel\");\n        this._sort = this.shadowRoot.querySelector(\"#sort\");\n        this._transpose_button = this.shadowRoot.querySelector(\"#transpose_button\");\n        this._plugin_information = this.shadowRoot.querySelector(\".plugin_information\");\n        this._plugin_information_action = this.shadowRoot.querySelector(\".plugin_information__action\");\n        this._plugin_information_message = this.shadowRoot.querySelector(\"#plugin_information_count\");\n        this._columns_container = this.shadowRoot.querySelector(\"#columns_container\");\n        this._vieux = this.shadowRoot.querySelector(\"perspective-vieux\");\n    }\n\n    // sets state, manipulates DOM\n    _register_view_options() {\n        let current_renderers = renderers.getInstance();\n        render(options(current_renderers), this._vis_selector);\n    }\n\n    _autocomplete_choices(json, type) {\n        const choices = [];\n        const type_config = get_type_config(type);\n\n        for (let i = 1; i < json.length; i++) {\n            const row_path = json[i].__ROW_PATH__;\n            if (Array.isArray(row_path) && row_path.length > 0 && row_path[0]) {\n                let choice = row_path[0];\n\n                if (type === \"date\" || type === \"datetime\") {\n                    choice = new Date(choice);\n                    choice = choice.toLocaleString(\"en-US\", type_config.format);\n                }\n\n                choices.push(choice);\n            }\n        }\n        return choices;\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2018, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {dragend, column_dragend, column_dragleave, column_dragover, column_drop, drop, dragenter, dragover, dragleave} from \"./dragdrop.js\";\nimport {DomElement} from \"./dom_element.js\";\nimport {findExpressionByAlias} from \"../utils.js\";\n\nexport class ActionElement extends DomElement {\n    async _toggle_config(event) {\n        if (!event || event.button !== 2) {\n            this._show_config = !this._show_config;\n            const panel = this.shadowRoot.querySelector(\"#pivot_chart_container\");\n            if (!this._show_config) {\n                await this._pre_resize(\n                    panel.clientWidth + this._side_panel.clientWidth,\n                    panel.clientHeight + this._top_panel.clientHeight,\n                    () => {\n                        this._app.classList.remove(\"settings-open\");\n                        this.removeAttribute(\"settings\");\n                    },\n                    () => this.dispatchEvent(new CustomEvent(\"perspective-toggle-settings\", {detail: this._show_config}))\n                );\n            } else {\n                await this._post_resize(\n                    () => {\n                        this.toggleAttribute(\"settings\", true);\n                    },\n                    () => {\n                        this._app.classList.add(\"settings-open\");\n                        this.dispatchEvent(new CustomEvent(\"perspective-toggle-settings\", {detail: this._show_config}));\n                    }\n                );\n            }\n        }\n    }\n\n    /**\n     * Given a targe `width` and `height`, pre-size the plugin before modifying\n     * the HTML to reduce visual tearing.\n     *\n     * @private\n     * @param {*} width\n     * @param {*} height\n     * @param {*} post Function to run once action is complete\n     * @param {*} [pre=undefined] Function to run once visual effects have been\n     * applied.  This may be before `post`, as pre-sizing will be delayed when\n     * the target size is a sub-window of the current view.\n     * @memberof ActionElement\n     */\n    async _pre_resize(width, height, post, pre = undefined) {\n        this._datavis.style.width = `${width}px`;\n        this._datavis.style.height = `${height}px`;\n        try {\n            if (!document.hidden && this.offsetParent) {\n                await this._plugin.resize.call(this);\n            }\n        } finally {\n            pre?.();\n            this._datavis.style.width = \"100%\";\n            this._datavis.style.height = \"100%\";\n            post();\n        }\n    }\n\n    async _post_resize(post, pre) {\n        pre?.();\n        try {\n            if (!document.hidden && this.offsetParent) {\n                await this._plugin.resize.call(this);\n            }\n        } finally {\n            post();\n        }\n    }\n\n    /**\n     * Display the expressions editor.\n     *\n     * @param {*} event\n     */\n    _open_expression_editor(event) {\n        event.stopImmediatePropagation();\n        this._vieux._open_expression_editor(this._add_expression_button);\n        this._add_expression_button.classList.toggle(\"expr_editor_open\", true);\n    }\n\n    _close_expression_editor(event) {\n        event.stopImmediatePropagation();\n        this._add_expression_button.classList.toggle(\"expr_editor_open\", false);\n    }\n\n    _save_expression(expression) {\n        const expressions = this._get_view_expressions();\n        expressions.push(expression);\n        this.setAttribute(\"expressions\", JSON.stringify(expressions));\n    }\n\n    async _type_check_expression(event) {\n        const {expression, alias} = event.detail;\n        const expressions = this._get_view_expressions();\n        const is_duplicate = findExpressionByAlias(alias, expressions);\n\n        if (expressions.includes(expression) || is_duplicate) {\n            console.warn(`Cannot apply duplicate expression: \"${expression}\"`);\n            const result = {\n                expression_schema: {},\n                errors: {}\n            };\n            result.errors[alias] = \"Value Error - Cannot apply duplicate expression.\";\n            this._expression_editor.type_check_expression(result);\n            return;\n        }\n\n        if (!expression || expression.length === 0) {\n            this._expression_editor.type_check_expression({});\n            return;\n        }\n\n        this._expression_editor.type_check_expression(await this._table.validate_expressions([expression]));\n    }\n\n    _column_visibility_clicked(ev) {\n        const parent = ev.currentTarget;\n        const is_active = parent.parentElement.getAttribute(\"id\") === \"active_columns\";\n        if (is_active) {\n            const min_columns = this._plugin.initial?.count || 1;\n            if (this._get_view_active_valid_column_count() === min_columns) {\n                return;\n            }\n            if (ev.detail.shiftKey) {\n                for (let child of Array.prototype.slice.call(this._active_columns.children)) {\n                    if (child !== parent) {\n                        this._active_columns.removeChild(child);\n                    }\n                }\n            } else {\n                const index = Array.prototype.slice.call(this._active_columns.children).indexOf(parent);\n                if (index < this._plugin.initial?.count) {\n                    return;\n                } else if (index < this._plugin.initial?.names?.length - 1) {\n                    this._active_columns.insertBefore(this._new_row(null), parent);\n                }\n                this._active_columns.removeChild(parent);\n            }\n        } else {\n            if ((ev.detail.shiftKey && this._plugin.selectMode === \"toggle\") || (!ev.detail.shiftKey && this._plugin.selectMode === \"select\")) {\n                for (let child of Array.prototype.slice.call(this._active_columns.children)) {\n                    this._active_columns.removeChild(child);\n                }\n            }\n            let row = this._new_row(parent.getAttribute(\"name\"), parent.getAttribute(\"type\"), undefined, undefined, undefined, parent.getAttribute(\"expression\"));\n            const cols = this._get_view_active_columns();\n            let i = cols.length - 1;\n            if (!cols[i] || !cols[i]?.classList.contains(\"null-column\")) {\n                this._active_columns.appendChild(row);\n            } else\n                while (i-- > 0) {\n                    if (!cols[i].classList.contains(\"null-column\")) {\n                        this._active_columns.replaceChild(row, cols[i + 1]);\n                        break;\n                    }\n                }\n        }\n        this._check_responsive_layout();\n        this._update_column_view();\n    }\n\n    _column_aggregate_clicked() {\n        let aggregates = this.get_aggregate_attribute();\n        let new_aggregates = this._get_view_aggregates();\n        for (let aggregate of aggregates) {\n            let updated_agg = new_aggregates.find(x => x.column === aggregate.column);\n            if (updated_agg) {\n                aggregate.op = updated_agg.op;\n            }\n        }\n        this.set_aggregate_attribute(aggregates);\n        this._update_column_view();\n        this._debounce_update();\n    }\n\n    _column_filter_clicked() {\n        let new_filters = this._get_view_filters();\n        this._updating_filter = true;\n        this.setAttribute(\"filters\", JSON.stringify(new_filters));\n        this._updating_filter = false;\n        this._debounce_update();\n    }\n\n    _increment_sort(sort, column_sorting, abs_sorting) {\n        let sort_orders = [\"asc\", \"desc\"];\n        if (column_sorting) {\n            sort_orders.push(\"col asc\", \"col desc\");\n        }\n        if (abs_sorting) {\n            sort_orders = sort_orders.map(x => `${x} abs`);\n        }\n        sort_orders.push(\"none\");\n        return sort_orders[(sort_orders.indexOf(sort) + 1) % sort_orders.length];\n    }\n\n    _sort_order_clicked(event) {\n        const row = event.target;\n        const abs_sorting = event.detail.shiftKey && row.getAttribute(\"type\") !== \"string\";\n        const new_sort_order = this._increment_sort(row.getAttribute(\"sort-order\"), this._get_view_column_pivots().length > 0, abs_sorting);\n        row.setAttribute(\"sort-order\", new_sort_order);\n\n        const sort = this._get_view_sorts();\n        this.setAttribute(\"sort\", JSON.stringify(sort));\n    }\n\n    // edits state\n    _transpose() {\n        const has_row = this.hasAttribute(\"row-pivots\");\n        const has_col = this.hasAttribute(\"column-pivots\");\n        if (has_row && has_col) {\n            let row_pivots = this.getAttribute(\"row-pivots\");\n            this.setAttribute(\"row-pivots\", this.getAttribute(\"column-pivots\"));\n            this.setAttribute(\"column-pivots\", row_pivots);\n        } else if (has_row) {\n            let row_pivots = this.getAttribute(\"row-pivots\");\n            this.removeAttribute(\"row-pivots\");\n            this.setAttribute(\"column-pivots\", row_pivots);\n        } else if (has_col) {\n            let column_pivots = this.getAttribute(\"column-pivots\");\n            this.removeAttribute(\"column-pivots\");\n            this.setAttribute(\"row-pivots\", column_pivots);\n        } else {\n            this.removeAttribute(\"column-pivots\");\n            this.removeAttribute(\"row-pivots\");\n        }\n    }\n\n    _vis_selector_changed() {\n        this._plugin_information.classList.add(\"hidden\");\n        this.setAttribute(\"plugin\", this._vis_selector.value);\n        this._active_columns.classList.remove(\"one_lock\", \"two_lock\");\n        const classname = [\"one_lock\", \"two_lock\"][this._plugin.initial?.count - 1];\n        if (classname) {\n            this._active_columns.classList.add(classname);\n        }\n        this._debounce_update();\n    }\n\n    // most of these are drag and drop handlers - how to clean up?\n    _register_callbacks() {\n        this._sort.addEventListener(\"drop\", drop.bind(this));\n        this._sort.addEventListener(\"dragend\", dragend.bind(this));\n        this._sort.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._sort.addEventListener(\"dragover\", dragover.bind(this));\n        this._sort.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._row_pivots.addEventListener(\"drop\", drop.bind(this));\n        this._row_pivots.addEventListener(\"dragend\", dragend.bind(this));\n        this._row_pivots.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._row_pivots.addEventListener(\"dragover\", dragover.bind(this));\n        this._row_pivots.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._column_pivots.addEventListener(\"drop\", drop.bind(this));\n        this._column_pivots.addEventListener(\"dragend\", dragend.bind(this));\n        this._column_pivots.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._column_pivots.addEventListener(\"dragover\", dragover.bind(this));\n        this._column_pivots.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._filters.addEventListener(\"drop\", drop.bind(this));\n        this._filters.addEventListener(\"dragend\", dragend.bind(this));\n        this._filters.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._filters.addEventListener(\"dragover\", dragover.bind(this));\n        this._filters.addEventListener(\"dragleave\", dragleave.bind(this));\n        this._active_columns.addEventListener(\"drop\", column_drop.bind(this));\n        this._active_columns.addEventListener(\"dragenter\", dragenter.bind(this));\n        this._active_columns.addEventListener(\"dragend\", column_dragend.bind(this));\n        this._active_columns.addEventListener(\"dragover\", column_dragover.bind(this));\n        this._active_columns.addEventListener(\"dragleave\", column_dragleave.bind(this));\n        this._add_expression_button.addEventListener(\"click\", this._open_expression_editor.bind(this));\n        this._add_expression_button.addEventListener(\"-perspective-close-expression\", this._close_expression_editor.bind(this));\n        this._transpose_button.addEventListener(\"click\", this._transpose.bind(this));\n        this._vis_selector.addEventListener(\"change\", this._vis_selector_changed.bind(this));\n        this._vieux.addEventListener(\"perspective-vieux-reset\", () => this.reset());\n        this._vieux.addEventListener(\"perspective-vieux-resize\", () => this._plugin.resize.call(this));\n        this._vieux.addEventListener(\"-perspective-add-expression\", ({detail}) => this._save_expression(detail));\n\n        this._plugin_information_action.addEventListener(\"click\", () => {\n            this._debounce_update({ignore_size_check: true, limit_points: false});\n            this._plugin_information.classList.add(\"hidden\");\n            this._plugin.render_warning = false;\n        });\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {wasm} from \"../../dist/esm/@finos/perspective-vieux\";\nimport \"./polyfill.js\";\n\nimport {bindTemplate, json_attribute, array_attribute, invertPromise, throttlePromise, getExpressionAlias, findExpressionByAlias} from \"./utils.js\";\nimport {renderers, register_debug_plugin} from \"./viewer/renderers.js\";\nimport \"./row.js\";\n\nimport template from \"../html/viewer.html\";\n\nimport view_style from \"../less/viewer.less\";\nimport default_style from \"../less/default.less\";\n\nimport {ActionElement} from \"./viewer/action_element.js\";\n\n/**\n * Module for the `<perspective-viewer>` custom element.\n *\n * This module has no exports, but importing it has a side\n * effect: the {@link module:perspective_viewer~PerspectiveViewer} class is\n * registered as a custom element, after which it can be used as a standard DOM\n * element.\n *\n * The documentation in this module defines the instance structure of a\n * `<perspective-viewer>` DOM object instantiated typically, through HTML or any\n * relevent DOM method e.g. `document.createElement(\"perspective-viewer\")` or\n * `document.getElementsByTagName(\"perspective-viewer\")`.\n *\n * @module perspective-viewer\n */\n\nconst PERSISTENT_ATTRIBUTES = [\"selectable\", \"editable\", \"plugin\", \"expressions\", \"row-pivots\", \"column-pivots\", \"aggregates\", \"filters\", \"sort\", \"columns\"];\n\n// There is no way to provide a default rejection handler within a promise and\n// also not lock the await-er, so this module attaches a global handler to\n// filter out cancelled query messages.\nwindow.addEventListener(\"unhandledrejection\", event => {\n    if (event.reason?.message === \"View method cancelled\") {\n        event.preventDefault();\n    }\n});\n\n/**\n * The HTMLElement class for `<perspective-viewer>` custom element.\n *\n * This class is not exported, so this constructor cannot be invoked in the\n * typical manner; instead, instances of the class are created through the\n * Custom Elements DOM API.\n *\n * Properties of an instance of this class, such as\n * {@link module:perspective_viewer~PerspectiveViewer#columns}, are reflected on\n * the DOM element as Attributes, and should be accessed as such - e.g.\n * `instance.setAttribute(\"columns\", JSON.stringify([\"a\", \"b\"]))`.\n *\n * @class PerspectiveViewer\n * @extends {HTMLElement}\n * @example\n * // Create a new `<perspective-viewer>`\n * const elem = document.createElement(\"perspective-viewer\");\n * elem.setAttribute(\"columns\", JSON.stringify([\"a\", \"b\"]));\n * document.body.appendChild(elem);\n *\n */\n@bindTemplate(template, view_style, default_style) // eslint-disable-next-line no-unused-vars\nclass PerspectiveViewer extends ActionElement {\n    constructor() {\n        super();\n        this._show_config = true;\n        this._show_warnings = true;\n        this.__render_times = [];\n        this._resize_handler = this.notifyResize.bind(this);\n        this._edit_port = null;\n        this._edit_port_lock = invertPromise();\n        window.addEventListener(\"resize\", this._resize_handler);\n    }\n\n    connectedCallback() {\n        if (Object.keys(renderers.getInstance()).length === 0) {\n            register_debug_plugin();\n        }\n\n        this.toggleAttribute(\"settings\", false);\n\n        this._register_ids();\n        this._register_callbacks();\n        this._register_view_options();\n        this._check_loaded_table();\n    }\n\n    /**\n     * Sets this `perspective.table.view`'s `sort` property, an Array of column\n     * names.\n     *\n     * @kind member\n     * @type {Array<String>} Array of arrays tuples of column name and\n     * direction, where the possible values are \"asc\", \"desc\", \"asc abs\", \"desc\n     * abs\" and \"none\".\n     * @fires PerspectiveViewer#perspective-config-update\n     * @example <caption>via Javascript DOM</caption>\n     * let elem = document.getElementById('my_viewer');\n     * elem.setAttribute('sort', JSON.stringify([[\"x\",\"desc\"]));\n     * @example <caption>via HTML</caption>\n     * <perspective-viewer sort='[[\"x\",\"desc\"]]'></perspective-viewer>\n     */\n    @array_attribute\n    sort(sort) {\n        if (sort === null || sort === undefined || sort.length === 0) {\n            if (this.hasAttribute(\"sort\")) {\n                this.removeAttribute(\"sort\");\n            }\n            sort = [];\n        }\n        var inner = this._sort.querySelector(\"ul\");\n        this._update_column_list(\n            sort,\n            inner,\n            (s, expressions) => {\n                let dir = \"asc\";\n                if (Array.isArray(s)) {\n                    dir = s[1];\n                    s = s[0];\n                }\n                // either the whole expression string or undefined\n                let expression = findExpressionByAlias(s, expressions);\n                return this._new_row(s, false, false, false, dir, expression);\n            },\n            (sort, node) => {\n                if (Array.isArray(sort)) {\n                    return node.getAttribute(\"name\") === sort[0] && node.getAttribute(\"sort-order\") === sort[1];\n                }\n                return node.getAttribute(\"name\") === sort;\n            }\n        );\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n        this._debounce_update();\n    }\n\n    /**\n     * The set of visible columns.\n     *\n     * @kind member\n     * @type {Array<String>}\n     * @param {Array} columns An Array of strings, the names of visible columns.\n     * @fires PerspectiveViewer#perspective-config-update\n     * @example <caption>via Javascript DOM</caption>\n     * let elem = document.getElementById('my_viewer');\n     * elem.setAttribute('columns', JSON.stringify([\"x\", \"y'\"]));\n     * @example <caption>via HTML</caption>\n     * <perspective-viewer columns='[\"x\", \"y\"]'></perspective-viewer>\n     */\n    @array_attribute\n    columns(show) {\n        if (show === null || show === undefined || show.length === 0) {\n            if (this.hasAttribute(\"columns\")) {\n                if (this._initial_col_order) {\n                    this.setAttribute(\"columns\", JSON.stringify(this._initial_col_order));\n                } else {\n                    this.removeAttribute(\"columns\");\n                }\n            }\n            show = (this._initial_col_order || []).slice();\n        }\n        this._update_column_view(show, true);\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n        this._debounce_update();\n    }\n\n    /**\n     * DEPRECATED: use the expressions API instead.\n     *\n     * @kind member\n     * @type {Array<Object>}\n     * @param {Array<Object>} computed-columns DEPRECATED - use the\n     * \"expressions\" API instead.\n     * @deprecated\n     */\n    @array_attribute\n    \"computed-columns\"() {\n        console.error(\"[PerspectiveViewer] the `computed-columns` attribute is deprecated - use the `expressions` attribute instead.\");\n    }\n\n    /**\n     * Sets this `perspective.table.view`'s `expressions` property, which will\n     * output new columns from the given expressions.\n     *\n     * @kind member\n     * @type {Array<String>}\n     * @param {Array<String>} expressions An array of string expressions to\n     * be calculated by Perspective.\n     * @fires PerspectiveViewer#perspective-config-update\n     *\n     * @example <caption>via Javascript DOM</caption>\n     * let elem = document.getElementById('my_viewer');\n     * elem.setAttribute('expressions', JSON.stringify(['\"x\" + (\"y\" + 20)']));\n     * @example <caption>via HTML</caption>\n     * <perspective-viewer expressions='[\\'\"x\" + 10\\']'></perspective-viewer>\n     */\n    @array_attribute\n    expressions(expressions) {\n        const resolve = this._set_updating();\n\n        (async () => {\n            if (expressions === null || expressions === undefined || expressions.length === 0) {\n                // Remove expression columns from the DOM, and reset the config\n                // to exclude all expression columns.\n                if (this.hasAttribute(\"expressions\")) {\n                    this.removeAttribute(\"expressions\");\n                    this._reset_expressions_view();\n                    return;\n                }\n\n                resolve();\n            }\n\n            let expression_schema = {};\n\n            if (this.table) {\n                const validation_results = await this.table.validate_expressions(expressions);\n                expression_schema = validation_results.expression_schema;\n                const errors = validation_results.errors;\n                const validated_expressions = {};\n\n                /**\n                 * Clear the expressions attribute if the validation fails at\n                 * any point. This validation gets triggered in two scenarios:\n                 *\n                 * 1. When a user types an expression and clicks save,\n                 *  where the expression has already been checked. In\n                 *  this case, there should be no failure of the\n                 *  validation as the expression has already been\n                 *  checked and validated.\n                 *\n                 * 2. When a user calls setAttribute() or restore()\n                 *  with a config that contains expressions, in which case\n                 *  the existing expressions are cleared already, and so\n                 *  there is no need to preserve the array.\n                 */\n                let clear_expressions = false;\n\n                for (const expression of expressions) {\n                    let alias = getExpressionAlias(expression);\n\n                    // Each expression from the editor should already have\n                    // an alias set. While we can auto-generate aliases, we\n                    // would need to setAttribute again and risk entering an\n                    // infinite recursion, so just let it fall into the error\n                    // state and clear the expressions.\n                    if (expression_schema[alias]) {\n                        validated_expressions[alias] = expression;\n                    } else {\n                        if (alias === undefined) {\n                            console.warn(`Failed to set \"expressions\" attribute: \"${expression}\" does not have an alias, i.e: // Expression Alias \\n \"x\" + \"y\"`);\n                        } else {\n                            // alias is guaranteed to be in the errors map\n                            console.warn(`Error in expression \"${alias}\": ${errors[alias]}\\nFailed to set \"expressions\" attribute: expression \"${expression}\" is invalid.`);\n                        }\n                        clear_expressions = true;\n                    }\n                }\n\n                if (clear_expressions) {\n                    // recurses one level down but will not make any calls\n                    // to Perspective.\n                    this.setAttribute(\"expressions\", null);\n                }\n\n                // Need to remove old expressions from the viewer DOM and\n                // config so they don't mess up state. To do this, we need\n                // to get the expression columns that are currently in the DOM,\n                // as this callback runs after the attribute is already set\n                // with the new value.\n                const active_expressions = this._get_view_active_columns()\n                    .filter(x => x.classList.contains(\"expression\"))\n                    .map(x => x.getAttribute(\"expression\"));\n                const inactive_expressions = this._get_view_inactive_columns()\n                    .filter(x => x.classList.contains(\"expression\"))\n                    .map(x => x.getAttribute(\"expression\"));\n\n                const old_expressions = active_expressions.concat(inactive_expressions);\n                const to_remove = this._diff_expressions(old_expressions, expressions);\n\n                if (to_remove.length > 0) {\n                    this._reset_expressions_view(to_remove);\n                }\n\n                expressions = Object.values(validated_expressions);\n                this.setAttribute(\"expressions\", JSON.stringify(expressions));\n            } else {\n                console.warn(`Applying unvalidated expressions: ${expressions} because the viewer does not have a Table attached!`);\n            }\n\n            this._update_expressions_view(expressions, expression_schema);\n            this.dispatchEvent(new Event(\"perspective-config-update\"));\n            await this._debounce_update();\n            resolve();\n        })();\n    }\n\n    /* eslint-enable max-len */\n\n    /**\n     * The set of column aggregate configurations.\n     *\n     * @kind member\n     * @type {Object}\n     * @param {Object} aggregates A dictionary whose keys are column names, and\n     * values are valid aggregations. The `aggregates` attribute works as an\n     * override; in lieu of a key for a column supplied by the developers, a\n     * default will be selected and reflected to the attribute based on the\n     * column's type.  See {@link perspective/src/js/defaults.js}\n     * @fires PerspectiveViewer#perspective-config-update\n     * @example <caption>via Javascript DOM</caption>\n     * let elem = document.getElementById('my_viewer');\n     * elem.setAttribute('aggregates', JSON.stringify({x: \"distinct count\"}));\n     * @example <caption>via HTML</caption>\n     * <perspective-viewer aggregates='{\"x\": \"distinct count\"}'>\n     * </perspective-viewer>\n     */\n    @json_attribute\n    aggregates(show) {\n        if (show === null || show === undefined || Object.keys(show).length === 0) {\n            if (this.hasAttribute(\"aggregates\")) {\n                this.removeAttribute(\"aggregates\");\n            }\n            show = {};\n        }\n\n        let lis = this._get_view_dom_columns();\n        lis.map(x => {\n            let agg = show[x.getAttribute(\"name\")];\n            if (agg) {\n                x.setAttribute(\"aggregate\", Array.isArray(agg) ? JSON.stringify(agg) : agg);\n            }\n        });\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n        this._debounce_update();\n    }\n\n    /**\n     * The set of column filter configurations.\n     *\n     * @kind member\n     * @type {Array<Array>} filters An Array of filter configs. A filter\n     * config is an Array of three elements: * The column name. * The filter\n     * operation as a String. See\n     * {@link perspective/src/js/config/constants.js} * The filter argument, as\n     * a String, float or Array<String> as the filter operation demands.\n     * @fires PerspectiveViewer#perspective-config-update\n     * @example <caption>via Javascript DOM</caption>\n     * let filters = [\n     *     [\"x\", \"<\", 3],\n     *     [\"y\", \"contains\", \"abc\"]\n     * ];\n     * let elem = document.getElementById('my_viewer');\n     * elem.setAttribute('filters', JSON.stringify(filters));\n     * @example <caption>via HTML</caption>\n     * <perspective-viewer filters='[[\"x\", \"<\", 3], [\"y\", \"contains\", \"abc\"]]'>\n     * </perspective-viewer>\n     */\n    @array_attribute\n    filters(filters) {\n        if (filters === null || filters === undefined || filters.length === 0) {\n            if (this.hasAttribute(\"filters\")) {\n                this.removeAttribute(\"filters\");\n            }\n            filters = [];\n        }\n        if (!this._updating_filter) {\n            var inner = this._filters.querySelector(\"ul\");\n            this._update_column_list(\n                filters,\n                inner,\n                (filter, expressions) => {\n                    const fterms = JSON.stringify({\n                        operator: filter[1],\n                        operand: filter[2]\n                    });\n                    const name = filter[0];\n                    // either the whole expression string or undefined\n                    let expression = findExpressionByAlias(name, expressions);\n                    return this._new_row(name, undefined, undefined, fterms, undefined, expression);\n                },\n                (filter, node) =>\n                    node.getAttribute(\"name\") === filter[0] &&\n                    node.getAttribute(\"filter\") ===\n                        JSON.stringify({\n                            operator: filter[1],\n                            operand: filter[2]\n                        })\n            );\n        }\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n        this._debounce_update();\n    }\n\n    /**\n     * Sets the currently selected plugin, via its `name` field, and removes\n     * any children the previous plugin may have left behind in the light DOM.\n     *\n     * @type {String}\n     * @fires PerspectiveViewer#perspective-config-update\n     */\n    set plugin(v) {\n        if (v === \"null\" || v === null || v === undefined) {\n            this.setAttribute(\"plugin\", this._vis_selector.options[0].value);\n            return;\n        }\n        this.innerHTML = \"\";\n        const plugin_names = Object.keys(renderers.getInstance());\n        if (this.hasAttribute(\"plugin\")) {\n            let plugin = this.getAttribute(\"plugin\");\n            if (plugin_names.indexOf(plugin) === -1) {\n                const guess_plugin = plugin_names.find(x => x.indexOf(plugin) > -1);\n                if (guess_plugin) {\n                    console.warn(`Unknown plugin \"${plugin}\", using \"${guess_plugin}\"`);\n                    this.setAttribute(\"plugin\", guess_plugin);\n                } else {\n                    console.error(`Unknown plugin \"${plugin}\"`);\n                    this.setAttribute(\"plugin\", this._vis_selector.options[0].value);\n                }\n            } else {\n                if (this._vis_selector.value !== plugin) {\n                    this._vis_selector.value = plugin;\n                    this._vis_selector_changed();\n                }\n                this._set_row_styles();\n                this._set_column_defaults();\n                this.dispatchEvent(new Event(\"perspective-config-update\"));\n            }\n        } else {\n            this.setAttribute(\"plugin\", this._vis_selector.options[0].value);\n        }\n    }\n\n    /**\n     * Sets this `perspective.table.view`'s `column_pivots` property.\n     *\n     * @kind member\n     * @type {Array<String>} Array of column names\n     * @fires PerspectiveViewer#perspective-config-update\n     */\n    @array_attribute\n    \"column-pivots\"(pivots) {\n        if (pivots === null || pivots === undefined || pivots.length === 0) {\n            if (this.hasAttribute(\"column-pivots\")) {\n                this.removeAttribute(\"column-pivots\");\n            }\n            pivots = [];\n        }\n\n        const inner = this._column_pivots.querySelector(\"ul\");\n        this._update_column_list(pivots, inner, (pivot, expressions) => {\n            // either the whole expression string or undefined\n            let expression = findExpressionByAlias(pivot, expressions);\n            return this._new_row(pivot, undefined, undefined, undefined, undefined, expression);\n        });\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n        this._debounce_update();\n    }\n\n    /**\n     * Sets this `perspective.table.view`'s `row_pivots` property.\n     *\n     * @kind member\n     * @type {Array<String>} Array of column names\n     * @fires PerspectiveViewer#perspective-config-update\n     */\n    @array_attribute\n    \"row-pivots\"(pivots) {\n        if (pivots === null || pivots === undefined || pivots.length === 0) {\n            if (this.hasAttribute(\"row-pivots\")) {\n                this.removeAttribute(\"row-pivots\");\n            }\n            pivots = [];\n        }\n\n        const inner = this._row_pivots.querySelector(\"ul\");\n        this._update_column_list(pivots, inner, (pivot, expressions) => {\n            // either the whole expression string or undefined\n            let expression = findExpressionByAlias(pivot, expressions);\n            return this._new_row(pivot, undefined, undefined, undefined, undefined, expression);\n        });\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n        this._debounce_update();\n    }\n\n    /**\n     * Determines whether this viewer is editable or not (though it is\n     * ultimately up to the plugin as to whether editing is implemented).\n     *\n     * @kind member\n     * @type {Boolean} Is this viewer editable?\n     * @fires PerspectiveViewer#perspective-config-update\n     */\n    set editable(x) {\n        if (x === \"null\") {\n            if (this.hasAttribute(\"editable\")) {\n                this.removeAttribute(\"editable\");\n            }\n        } else {\n            this.toggleAttribute(\"editable\", true);\n        }\n        this._debounce_update({force_update: true});\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n    }\n\n    /**\n     * Determines the render throttling behavior. Can be an integer, for\n     * millisecond window to throttle render event; or, if `undefined`,\n     * will try to determine the optimal throttle time from this component's\n     * render framerate.\n     *\n     * @kind member\n     * @type {Number|String} The throttle rate - milliseconds (integer), or the\n     * enum \"adaptive\" for a dynamic throttle based on render time.\n     * @example\n     * <!-- Only draws at most 1 frame/sec. -->\n     * <perspective-viewer throttle=\"1000\"></perspective-viewer>\n     */\n    set throttle(x) {\n        if (x === \"null\") {\n            if (this.hasAttribute(\"throttle\")) {\n                this.removeAttribute(\"throttle\");\n            }\n        }\n        // Returns the throttle time, but also perform validaiton - we only want\n        // the latter here.\n        this._calculate_throttle_timeout();\n    }\n\n    /*\n     * Determines whether row selections is enabled on this viewer (though it is\n     * ultimately up to the plugin as to whether selectable is implemented).\n     *\n     * @kind member\n     * @type {Boolean} Is this viewer editable?\n     * @fires PerspectiveViewer#perspective-config-update\n     */\n    set selectable(x) {\n        if (x === \"null\") {\n            if (this.hasAttribute(\"selectable\")) {\n                this.removeAttribute(\"selectable\");\n            }\n        } else {\n            this.toggleAttribute(\"selectable\", true);\n        }\n        this._debounce_update({force_update: true});\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n    }\n\n    /**\n     * This element's `perspective.table` instance.\n     *\n     * @readonly\n     */\n    get table() {\n        return this._table;\n    }\n\n    /**\n     * This element's `perspective.table.view` instance. The instance itself\n     * will change after every `PerspectiveViewer#perspective-config-update`\n     * event.\n     *\n     * @readonly\n     */\n    get view() {\n        return this._view;\n    }\n\n    /**\n     * Load data. If `load` or `update` have already been called on this\n     * element, its internal `perspective.table` will also be deleted.\n     *\n     * @async\n     * @param {any} data The data to load, as a `perspective.Table` or\n     * `Promise<perspective.Table>`.\n     * @returns {Promise<void>} A promise which resolves once the data is loaded\n     * and a `perspective.view` has been created.\n     * @fires module:perspective_viewer~PerspectiveViewer#perspective-click\n     * PerspectiveViewer#perspective-view-update\n     * ]);\n     * @example <caption>Load perspective.table</caption>\n     * const my_viewer = document.getElementById('#my_viewer');\n     * const tbl = await perspective.table(\"x,y\\n1,a\\n2,b\");\n     * my_viewer.load(tbl);\n     * @example <caption>Load Promise<perspective.table></caption>\n     * const my_viewer = document.getElementById('#my_viewer');\n     * const tbl = async () => perspective.table(\"x,y\\n1,a\\n2,b\");\n     * my_viewer.load(tbl);\n     */\n    async load(data) {\n        let table;\n        const resolve = this._set_updating();\n\n        if (data instanceof Promise) {\n            this._vieux.load(data);\n            table = await data;\n        } else {\n            if (data.type === \"table\") {\n                this._vieux.load(Promise.resolve(data));\n                table = data;\n            } else {\n                resolve();\n                throw new Error(`Unrecognized input type ${typeof data}.  Please use a \\`perspective.Table()\\``);\n            }\n        }\n        if (this.isConnected) {\n            await this._load_table(table, resolve);\n        } else {\n            this._table = table;\n            this._table_resolve = resolve;\n        }\n    }\n\n    /**\n     * Determine whether to reflow the viewer and redraw.\n     *\n     */\n    @throttlePromise\n    async notifyResize(immediate) {\n        const resized = await this._check_responsive_layout();\n        if (!resized && !document.hidden && this.offsetParent) {\n            await this._plugin.resize.call(this, immediate);\n        }\n    }\n\n    /**\n     * Duplicate an existing `<perspective-element>`, including data and view\n     * settings.  The underlying `perspective.table` will be shared between both\n     * elements\n     *\n     * @param {any} widget A `<perspective-viewer>` instance to clone.\n     */\n    clone(widget) {\n        const resolve = this._set_updating();\n        this._load_table(widget.table, resolve);\n        this.restore(widget.save());\n    }\n\n    /**\n     * Deletes this element and clears it's internal state (but not its\n     * user state).  This (or the underlying `perspective.view`'s equivalent\n     * method) must be called in order for its memory to be reclaimed, as well\n     * as the reciprocal method on the `perspective.table` which this viewer is\n     * bound to.\n     *\n     * @returns {Promise<Boolean>} Whether or not this call resulted in the\n     * underlying `perspective.table` actually being deleted.\n     */\n    delete() {\n        let x = this._clear_state();\n        if (this._plugin.delete) {\n            this._plugin.delete.call(this);\n        }\n        window.removeEventListener(\"resize\", this._resize_handler);\n        return x;\n    }\n\n    /**\n     * Restyles the elements and to pick up any style changes\n     */\n    restyleElement() {\n        this._restyle_plugin();\n    }\n\n    /**\n     * Serialize this element's attribute/interaction state.\n     *\n     * @returns {object} a serialized element.\n     */\n    save() {\n        let obj = {};\n        const cols = new Set(PERSISTENT_ATTRIBUTES);\n        for (let key = 0; key < this.attributes.length; key++) {\n            let attr = this.attributes[key];\n            if (cols.has(attr.name)) {\n                if (attr.value === \"\") {\n                    obj[attr.name] = true;\n                } else if (attr.name !== \"plugin\" && attr.value !== undefined && attr.value !== null) {\n                    obj[attr.name] = JSON.parse(attr.value);\n                } else {\n                    obj[attr.name] = attr.value;\n                }\n                cols.delete(attr.name);\n            }\n        }\n        for (const col of cols) {\n            obj[col] = null;\n        }\n        if (this._plugin.save) {\n            obj.plugin_config = this._plugin.save.call(this);\n        }\n        return obj;\n    }\n\n    /**\n     * Restore this element to a state as generated by a reciprocal call to\n     * `save` or `serialize`.\n     *\n     * @param {Object|String} config returned by `save` or `serialize`.\n     * @returns {Promise<void>} A promise which resolves when the changes have\n     * been applied.\n     */\n    async restore(config) {\n        if (typeof config === \"string\") {\n            config = JSON.parse(config);\n        }\n        for (const key of PERSISTENT_ATTRIBUTES) {\n            if (config.hasOwnProperty(key)) {\n                let val = config[key];\n                if (val === true) {\n                    this.toggleAttribute(key, true);\n                } else if (val !== undefined && val !== null && val !== false) {\n                    if (typeof val !== \"string\") {\n                        val = JSON.stringify(val);\n                    }\n                    this.setAttribute(key, val);\n                } else {\n                    this.removeAttribute(key);\n                }\n            }\n        }\n\n        if (this._plugin.restore && config.plugin_config) {\n            this._plugin.restore.call(this, config.plugin_config);\n        }\n        await this._debounce_update();\n    }\n\n    /**\n     * Flush any pending attribute modifications to this element.\n     *\n     * @returns {Promise<void>} A promise which resolves when the current\n     * attribute state has been applied.\n     */\n    async flush() {\n        await Promise.all([this._updating_promise || Promise.resolve(), this.notifyResize.flush(this)]);\n    }\n\n    /**\n     * Reset's this element's view state and attributes to default.  Does not\n     * delete this element's `perspective.table` or otherwise modify the data\n     * state.\n     */\n    reset() {\n        this.removeAttribute(\"row-pivots\");\n        this.removeAttribute(\"column-pivots\");\n        this.removeAttribute(\"filters\");\n        this.removeAttribute(\"sort\");\n        this.removeAttribute(\"expressions\");\n        if (this._initial_col_order) {\n            this.setAttribute(\"columns\", JSON.stringify(this._initial_col_order));\n        } else {\n            this.removeAttribute(\"columns\");\n        }\n        this.setAttribute(\"plugin\", Object.keys(renderers.getInstance())[0]);\n        this._plugin.restore?.call(this, {});\n        this.dispatchEvent(new Event(\"perspective-config-update\"));\n    }\n\n    /**\n     * Download this element's data as a CSV file.\n     *\n     * @param {Boolean} [flat=false] Whether to use the element's current view\n     * config, or to use a default \"flat\" view.\n     * @memberof PerspectiveViewer\n     */\n    async download(flat = false) {\n        const {download_flat, download} = await wasm;\n        if (flat) {\n            await download_flat(this._table);\n        } else {\n            await download(this._view);\n        }\n    }\n\n    /**\n     * Copies this element's view data (as a CSV) to the clipboard.  This method\n     * must be called from an event handler, subject to the browser's\n     * restrictions on clipboard access.  See\n     * {@link https://www.w3.org/TR/clipboard-apis/#allow-read-clipboard}.\n     */\n    async copy(flat = false) {\n        const {copy_flat, copy} = await wasm;\n        if (flat) {\n            await copy_flat(this._table);\n        } else {\n            await copy(this._view);\n        }\n    }\n\n    /**\n     * Opens/closes the element's config menu.\n     *\n     * @async\n     */\n    async toggleConfig(force) {\n        await this._vieux.toggle_config(force);\n    }\n\n    /**\n     * Returns a promise that resolves to the element's edit port ID, used\n     * internally when edits are made using DataGrid.\n     *\n     * @async\n     */\n    async getEditPort() {\n        return this._edit_port_lock;\n    }\n}\n\n/**\n * `perspective-click` is fired whenever underlying `view`'s grid or chart are\n * clicked providing a detail that includes a `config`, `column_names` and\n * `row`.\n *\n * @event module:perspective_viewer~PerspectiveViewer#perspective-click\n * @type {object}\n * @property {Array} column_names - Includes a list of column names.\n * @property {object} config - Contains a property `filters` that can be applied\n * to a `<perspective-viewer>` through the use of `restore()` updating it to\n * show the filtered subset of data..\n * @property {Array} row - Includes the data row.\n */\n\n/**\n * `perspective-config-update` is fired whenever an configuration attribute has\n * been modified, by the user or otherwise.\n *\n * @event module:perspective_viewer~PerspectiveViewer#perspective-config-update\n * @type {String}\n */\n\n/**\n * `perspective-view-update` is fired whenever underlying `view`'s data has\n * updated, including every invocation of `load` and `update`.\n *\n * @event module:perspective_viewer~PerspectiveViewer#perspective-view-update\n * @type {String}\n */\n"],"names":["undefined","_index","constructor","_await_index","connected_callback","window","document","CLASS_PREFIX","CLASS_DRAG_IMAGE","CLASS_DRAG_IMAGE_SNAPBACK","CLASS_DRAG_OPERATION_ICON","EVENT_PREFIX","EVENT_DRAG_DRAGSTART_PENDING","EVENT_DRAG_DRAGSTART_CANCEL","ALLOWED_EFFECTS","DROP_EFFECTS","detectFeatures","features","dragEvents","documentElement","draggable","userAgentSupportingNativeDnD","isBlinkEngine","chrome","test","navigator","userAgent","supportsPassiveEventListener","supportsPassiveEventListeners","opts","Object","defineProperty","get","addEventListener","e","supportsPassive","isDOMElement","object","tagName","addDocumentListener","ev","handler","passive","removeDocumentListener","removeEventListener","onEvt","el","event","capture","options","off","prepareNodeCopyAsDragImage","srcNode","dstNode","nodeType","cs","getComputedStyle","i","length","csName","style","setProperty","getPropertyValue","getPropertyPriority","pointerEvents","removeAttribute","nodeName","canvasSrc","canvasDst","canvasSrcImgData","getContext","getImageData","width","height","putImageData","hasChildNodes","childNodes","createDragImage","sourceNode","dragImage","cloneNode","average","array","reduce","s","v","isTouchIdentifierContainedInTouchEvent","touchEvent","touchIdentifier","changedTouches","touch","identifier","updateCentroidCoordinatesOfTouchesIn","coordinateProp","outPoint","pageXs","pageYs","touches","push","x","y","TRANSFORM_CSS_VENDOR_PREFIXES","extractTransformStyles","map","prefix","transform","replace","translateElementToPoint","element","pnt","originalTransforms","offset","centerOnCoordinates","parseInt","offsetWidth","offsetHeight","translate","transformProp","applyDragImageSnapback","sourceEl","dragImageTransforms","transitionEndCb","visibility","display","console","log","classList","add","csDragImage","durationInS","parseFloat","transitionDuration","isNaN","rect","getBoundingClientRect","left","top","body","scrollLeft","scrollTop","marginLeft","marginTop","delayInS","transitionDelay","durationInMs","Math","round","setTimeout","DataTransfer","_dataStore","_setDragImageHandler","_dropEffect","prototype","set","value","mode","indexOf","enumerable","configurable","freeze","types","effectAllowed","setData","type","data","Error","getData","clearData","format","index","splice","setDragImage","image","tryFindDraggableTarget","target","getAttribute","parentNode","determineDropEffect","createDragEventFromTouch","targetElement","cancelable","dataTransfer","relatedTarget","dndEvent","Event","bubbles","screenX","screenY","clientX","clientY","pageX","pageY","targetRect","offsetX","offsetY","dispatchDragEvent","dragEvent","dataStore","leaveEvt","defaultView","cancelled","dispatchEvent","determineDragOperation","dropEffect","DragOperationController","_initialEvent","_config","_sourceNode","_dragOperationEndedCb","_dragOperationState","_immediateUserSelection","_currentDropTarget","_lastTouchEvent","_initialTouch","_touchMoveHandler","_onTouchMove","bind","_touchEndOrCancelHandler","_onTouchEndOrCancel","_setup","_this","_currentDragOperation","_dragDataStore","_currentHotspotCoordinates","_dragImagePageCoordinates","dragImageSrc","_dataTransfer","_dragImageOffset","_cleanup","dragImageSetup","_dragImageTransforms","position","zIndex","_dragImage","dragImageOffset","dragImageCenterOnTouch","appendChild","_iterationIntervalId","setInterval","_iterationLock","_dragAndDropProcessModelIteration","iterationInterval","clearInterval","removeChild","startDrag","dragStartConditionOverride","error","preventDefault","dragImageTranslateOverride","handledDragImageTranslate_1","previousDragOperation","dragCancelled","dragFailed","_dragOperationEnded","_finishDragOperation","newUserSelection","elementFromPoint","previousTargetElement","remove","currentDragOperationClass","state","config","activeDragOperation","onTouchstart","composePath","dragTarget","dragOperationEnded","err","onDelayTouchstart","evt","composedPath","heldItem","end","cancel","move","scroll","onReleasedItem","CustomEvent","clearTimeout","timer","holdToDrag","defaultActionOverride","defaultPrevented","polyfill","override","keys","forEach","key","forceApply","detectedFeatures","tryFindDraggableTarget_override","cp","o","_path","shadowRoot","importTemplate","template","div","createElement","innerHTML","Array","slice","call","children","setTemplateContent","content","createDocumentFragment","child","firstChild","Node","registerElement","templateString","styleString","proto","toString","_perspective_element","attributeChangedCallback","name","old","getOwnPropertyDescriptor","connectedCallback","_initialized","_initializing","node","importNode","attachShadow","getOwnPropertyNames","hasAttribute","observedAttributes","descriptor","val","setAttribute","customElements","define","bindTemplate","styleStrings","join","cls","_attribute","_default","desc","old_set","attr","JSON","stringify","parse","warn","invertPromise","_resolve","promise","Promise","resolve","throttlePromise","property","clear","lock","Symbol","_super","throttleOnce","id","gen","requestAnimationFrame","args","debounced","result","l","flush","obj","swap","container","elems","every","contains","j","reverse","insertBefore","json_attribute","array_attribute","getExpressionAlias","expression","matches","match","alias","trim","findExpressionByAlias","expressions","expr","expr_alias","getRawExpression","RENDERERS","renderers","registerPlugin","plugin","old_plugin","getPlugin","getInstance","global","__perspective_plugins__","csv","html","register_debug_plugin","create","_view","to_csv","delimiter","_render_time","render","selectMode","resize","delete","SPAN","fontFamily","fontSize","get_text_width","text","max","awesomplete_style","Row","n","elem","querySelector","_option_template","agg","_select_template","category","items","perspective","weighted_options","_weights","has_weighted_mean","nothing","set_weights","xs","t","type_config","get_type_config","agg_dropdown","filter_dropdown","aggregate","filter","filter_operand","_callback","_update_filter","choices","filter_operator","selector","Awesomplete","label","list","minChars","autoFirst","input","FILTER_CONTAINS","item","ITEM","before","evaluate","focus","_filter_operand","f","operator","filter_input","operand","isNull","isNotNull","a","_blur_agg_dropdown","toLowerCase","isIn","isNotIn","split","detail","_set_data_transfer","_register_ids","_li","_visible","_row_close","_agg_dropdown","_sort_order","_filter_operator","_column_aggregate_category","blur","option","querySelectorAll","_focus_agg_dropdown","_register_callbacks","debounced_filter","debounce","calc_index","_active_columns","is_last_null","cidx","offsetTop","last_index","dragend","getRootNode","host","parent","parentElement","idx","attr_name","attr_value","drop","currentTarget","DRAG_COUNT_MAP","WeakMap","_drop_target_hover","columns","data_index","filtering","concat","_plugin","deselectMode","_get_visible_column_count","_update_column_view","_debounce_update","column_dragend","column_dragleave","src","_drop_target_null","replaceChild","_original_index","_unset_drop_target_null","column_swap","new_index","column_replace","column_dragover","toggleAttribute","current_index","over_elem","to_replace","initial","names","is_diff","from_active","from_replace","from_append","from_required","count","to_required","to_null","from_last","column_drop","dragover","stopPropagation","dragenterleave","dragHoverCount","toggle","dragenter","dragleave","CancelTask","on_cancel","_on_cancel","_cancelled","StateElement","current_renderers","view","_get_view_dom_columns","callback","_get_view_active_columns","_get_view_active_valid_columns","_get_view_inactive_columns","_get_view_all_column_names","_get_view_active_column_names","_get_view_all_valid_column_names","_get_view_active_valid_column_names","_get_view_active_valid_column_count","_get_view_columns","active","col","_get_view_aggregates","op","column","_get_view_row_pivots","_get_view_column_pivots","_get_view_filter_nodes","_get_view_filters","_get_view_sorts","order","_get_view_expressions","get_aggregate_attribute","aggs","found","Set","new_aggs","_aggregate_defaults","has","numberWithCommas","TYPE_ORDER","integer","string","float","boolean","datetime","date","column_sorter","schema","b","s1","s2","r","get_aggregate_defaults","expression_schema","aggregates","get_aggregates_with_defaults","aggregate_attribute","_total_template","total","floor","_nowrap_template","_warning","strings","flatMap","str","PerspectiveElement","_load_table","table","_clear_state","_table","cols","all","_initial_col_order","valid_expressions","valid_expression_alias","validate_results","validate_expressions","errors","sort","shown","shown_is_invalid","_clear_columns","find","row","_new_row","_inactive_columns","includes","active_row","_columns_container","_show_column_container","_show_side_panel_actions","filters","_edit_port","make_port","_edit_port_lock","force_update","reset","get_maxes","max_columns","render_warning","max_cols","max_rows","num_columns","schema_columns","column_group_diff","column_limit","max_cells","ceil","_warn_render_size_exceeded","_show_warnings","num_rows","columns_are_truncated","rows_are_truncated","_plugin_information","warning","_plugin_information_message","_calculate_throttle_timeout","timeout","throttle","__render_times","min","_view_on_update","limit_points","_debounced","_task","task","updater","update","_datavis","_validate_filters","operandNode","getElementById","exclamation","is_valid_filter","borderColor","hidden","_is_config_changed","plugin_name","isEqual","_previous_config","_previous_plugin_name","_new_view","ignore_size_check","_check_responsive_layout","row_pivots","column_pivots","view_aggregates","remove_update","_view_updater","_vieux","delete_view","on_update","set_view","_check_loaded_table","_table_resolver","performance","now","unshift","_restyle_plugin","styleElement","remove_delete","_set_updating","_updating_promise","_update","vals","DomElement","set_aggregate_attribute","is_set","_get_type","_set_row_type","weights","then","_filter_view","nrows","json","to_json","end_row","_autocomplete_choices","finally","isArray","_column_visibility_clicked","_column_aggregate_clicked","_column_filter_clicked","_sort_order_clicked","findIndex","raw_expr","_update_expressions_view","added_count","reset_columns_attr","should_reset","should_add","_diff_expressions","old_expressions","new_expressions","to_remove","_reset_expressions_view","rp","table_columns","inactive_expressions","pop_cols","lis","_update_column_list","ref","accessor","active_columns","next_col","_set_row_styles","nidx","_remove_null_columns","since_index","_set_column_defaults","active_cols","valid_active_cols","pref","_fill_numeric","labels","bypass","app","clientHeight","clientWidth","_persisted_side_panel_width","_side_panel","panel","_pre_resize","_app","_aggregate_selector","_vis_selector","_filters","_row_pivots","_column_pivots","_side_panel_actions","_add_expression_button","_top_panel","_sort","_transpose_button","_plugin_information_action","_register_view_options","row_path","__ROW_PATH__","choice","Date","toLocaleString","ActionElement","_toggle_config","button","_show_config","_post_resize","post","pre","offsetParent","_open_expression_editor","stopImmediatePropagation","_close_expression_editor","_save_expression","_type_check_expression","is_duplicate","_expression_editor","type_check_expression","is_active","min_columns","shiftKey","new_aggregates","updated_agg","new_filters","_updating_filter","_increment_sort","column_sorting","abs_sorting","sort_orders","new_sort_order","_transpose","has_row","has_col","_vis_selector_changed","classname","PERSISTENT_ATTRIBUTES","reason","message","view_style","default_style","PerspectiveViewer","_resize_handler","notifyResize","inner","dir","show","validation_results","validated_expressions","clear_expressions","active_expressions","values","fterms","plugin_names","guess_plugin","pivots","pivot","editable","selectable","load","isConnected","_table_resolve","immediate","resized","clone","widget","restore","save","restyleElement","attributes","plugin_config","hasOwnProperty","download","flat","download_flat","wasm","copy","copy_flat","toggleConfig","force","toggle_config","getEditPort"],"mappings":"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"}