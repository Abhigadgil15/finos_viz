{"version":3,"sources":["../../../src/js/charts/treemap.js"],"names":["d3","treeColor","treeData","treemapSeries","tooltip","gridLayoutMultiChart","colorRangeLegend","colorLegend","treemap","container","settings","crossValues","length","console","warn","treemaps","data","color","map","d","_container","classList","add","treemapGrid","elementsPrefix","datum","call","color_column","realValues","mainValues","find","x","name","type","legend","scale","treemapEnter","chartEnter","treemapDiv","chartDiv","treemapTitle","chartTitle","each","i","nodes","select","text","split","merge","treemapSvg","parentNode","node","centered","selectAll","plugin","max_cells","max_columns","render_warning","initial","count","names"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {treeColor} from \"../series/treemap/treemapColor\";\nimport {treeData} from \"../data/treeData\";\nimport {treemapSeries} from \"../series/treemap/treemapSeries\";\nimport {tooltip} from \"../tooltip/tooltip\";\nimport {gridLayoutMultiChart} from \"../layout/gridLayoutMultiChart\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport {colorLegend} from \"../legend/legend\";\n\nfunction treemap(container, settings) {\n    if (settings.crossValues.length === 0) {\n        console.warn(\"Unable to render a chart in the absence of any groups.\");\n        return;\n    }\n    if (!settings.treemaps) settings.treemaps = {};\n\n    const data = treeData(settings);\n    const color = treeColor(\n        settings,\n        data.map(d => d.data)\n    );\n\n    if (color) {\n        this._container.classList.add(\"has-legend\");\n    }\n\n    const treemapGrid = gridLayoutMultiChart().elementsPrefix(\"treemap\");\n    container.datum(data).call(treemapGrid);\n    if (color) {\n        const color_column = settings.realValues[1];\n        if (settings.mainValues.find(x => x.name === color_column)?.type === \"string\") {\n            const legend = colorLegend()\n                .settings(settings)\n                .scale(color);\n            container.call(legend);\n        } else {\n            const legend = colorRangeLegend().scale(color);\n            container.call(legend);\n        }\n    }\n\n    const treemapEnter = treemapGrid.chartEnter();\n    const treemapDiv = treemapGrid.chartDiv();\n    const treemapTitle = treemapGrid.chartTitle();\n\n    treemapTitle.each((d, i, nodes) => d3.select(nodes[i]).text(d.split));\n    treemapEnter\n        .merge(treemapDiv)\n        .select(\"svg\")\n        .select(\"g.treemap\")\n        .each(function({split, data}) {\n            const treemapSvg = d3.select(this);\n\n            if (!settings.treemaps[split]) settings.treemaps[split] = {};\n\n            treemapSeries()\n                .settings(settings.treemaps[split])\n                .data(data)\n                .container(d3.select(d3.select(this.parentNode).node().parentNode))\n                .color(color)(treemapSvg);\n\n            tooltip()\n                .settings(settings)\n                .centered(true)(treemapSvg.selectAll(\"g\"));\n        });\n}\n\ntreemap.plugin = {\n    type: \"d3_treemap\",\n    name: \"Treemap\",\n    max_cells: 5000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"]\n    }\n};\nexport default treemap;\n"],"file":"treemap.js"}