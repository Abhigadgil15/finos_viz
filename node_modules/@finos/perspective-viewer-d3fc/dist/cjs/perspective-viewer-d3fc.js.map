{"version":3,"sources":["webpack:///packages/perspective-viewer-d3fc/webpack/universalModuleDefinition","webpack:///packages/perspective-viewer-d3fc/dist/less/chart.less","webpack:///packages/node_modules/css-loader/lib/css-base.js","webpack:///packages/perspective-viewer-d3fc/dist/html/d3fc-chart.html","webpack:///packages/perspective-viewer-d3fc/dist/html/legend-controls.html","webpack:///packages/perspective-viewer-d3fc/dist/html/parent-controls.html","webpack:///packages/perspective-viewer-d3fc/dist/html/tooltip.html","webpack:///packages/perspective-viewer-d3fc/dist/html/zoom-controls.html","webpack:///packages/src/js/axis/axisType.js","webpack:///packages/src/js/axis/flatten.js","webpack:///packages/src/js/axis/minBandwidth.js","webpack:///packages/src/js/axis/noAxis.js","webpack:///packages/src/js/axis/withoutTicks.js","webpack:///packages/src/js/d3fc/padding/default.js","webpack:///packages/src/js/d3fc/extent/extentLinear.js","webpack:///packages/src/js/axis/valueFormatter.js","webpack:///packages/src/js/axis/linearAxis.js","webpack:///packages/src/js/axis/timeAxis.js","webpack:///packages/src/js/d3fc/axis/multi-axis.js","webpack:///packages/src/js/d3fc/axis/store.js","webpack:///packages/src/js/plugin/root.js","webpack:///packages/src/js/axis/ordinalAxis.js","webpack:///packages/src/js/axis/axisFactory.js","webpack:///packages/src/js/axis/chartFactory.js","webpack:///packages/src/js/utils/utils.js","webpack:///packages/src/js/tooltip/selectionData.js","webpack:///packages/src/js/tooltip/generateHTML.js","webpack:///packages/src/js/tooltip/selectionEvent.js","webpack:///packages/src/js/tooltip/tooltip.js","webpack:///packages/src/js/series/barSeries.js","webpack:///packages/src/js/series/seriesKey.js","webpack:///packages/src/js/series/seriesColors.js","webpack:///packages/src/js/axis/axisLabel.js","webpack:///packages/src/js/data/splitIntoMultiSeries.js","webpack:///packages/src/js/data/groupData.js","webpack:///packages/src/js/legend/styling/enforceContainerBoundaries.js","webpack:///packages/src/js/legend/styling/draggableComponent.js","webpack:///packages/src/js/legend/styling/resizableComponent.js","webpack:///packages/src/js/legend/scrollableLegend.js","webpack:///packages/src/js/legend/styling/cropCellContents.js","webpack:///packages/src/js/legend/legend.js","webpack:///packages/src/js/legend/filter.js","webpack:///packages/src/js/gridlines/gridlines.js","webpack:///packages/src/js/d3fc/padding/hardLimitZero.js","webpack:///packages/src/js/zoom/zoomableChart.js","webpack:///packages/src/js/charts/bar.js","webpack:///packages/src/js/axis/domainMatchOrigins.js","webpack:///packages/src/js/axis/axisSplitter.js","webpack:///packages/src/js/axis/splitterLabels.js","webpack:///packages/src/js/charts/column.js","webpack:///packages/src/js/series/lineSeries.js","webpack:///packages/src/js/data/transposeData.js","webpack:///packages/src/js/data/findBest.js","webpack:///packages/src/js/tooltip/nearbyTip.js","webpack:///packages/src/js/charts/line.js","webpack:///packages/src/js/data/splitData.js","webpack:///packages/src/js/series/seriesSymbols.js","webpack:///packages/src/js/series/pointSeriesCanvas.js","webpack:///packages/src/js/charts/xy-line.js","webpack:///packages/src/js/data/xySplitData.js","webpack:///packages/src/js/charts/area.js","webpack:///packages/src/js/data/splitAndBaseData.js","webpack:///packages/src/js/series/areaSeries.js","webpack:///packages/src/js/charts/y-scatter.js","webpack:///packages/src/js/series/categoryPointSeries.js","webpack:///packages/src/js/data/pointData.js","webpack:///packages/src/js/series/seriesRange.js","webpack:///packages/src/js/legend/colorRangeLegend.js","webpack:///packages/src/js/charts/xy-scatter.js","webpack:///packages/src/js/charts/heatmap.js","webpack:///packages/src/js/data/heatmapData.js","webpack:///packages/src/js/series/heatmapSeries.js","webpack:///packages/src/js/data/ohlcData.js","webpack:///packages/src/js/charts/ohlcCandle.js","webpack:///packages/src/js/series/ohlcCandleSeries.js","webpack:///packages/src/js/charts/ohlc.js","webpack:///packages/src/js/charts/candlestick.js","webpack:///packages/src/js/series/sunburst/sunburstColor.js","webpack:///packages/src/js/data/treeData.js","webpack:///packages/src/js/series/sunburst/sunburstArc.js","webpack:///packages/src/js/series/sunburst/sunburstLabel.js","webpack:///packages/src/js/series/sunburst/sunburstClick.js","webpack:///packages/src/js/series/sunburst/sunburstSeries.js","webpack:///packages/src/js/layout/gridLayoutMultiChart.js","webpack:///packages/src/js/charts/sunburst.js","webpack:///packages/src/js/series/treemap/treemapColor.js","webpack:///packages/src/js/series/treemap/treemapLabel.js","webpack:///packages/src/js/series/treemap/treemapLayout.js","webpack:///packages/src/js/series/treemap/treemapLevelCalculation.js","webpack:///packages/src/js/series/treemap/treemapTransitions.js","webpack:///packages/src/js/series/treemap/treemapSeries.js","webpack:///packages/src/js/series/treemap/treemapControls.js","webpack:///packages/src/js/charts/treemap.js","webpack:///packages/src/js/charts/charts.js","webpack:///packages/src/js/series/colorStyles.js","webpack:///packages/src/js/plugin/template.js","webpack:///packages/src/js/plugin/plugin.js","webpack:///packages/src/js/index.js","webpack:///packages/src/js/plugin/polyfills/closest.js","webpack:///packages/src/js/plugin/polyfills/matches.js","webpack:///packages/perspective-viewer-d3fc/external \"@finos/perspective-viewer/src/js/utils\"","webpack:///packages/perspective-viewer-d3fc/external \"@finos/perspective-viewer/src/js/utils.js\"","webpack:///packages/perspective-viewer-d3fc/external \"@finos/perspective/dist/esm/config\"","webpack:///packages/perspective-viewer-d3fc/external \"core-js/modules/es.array.reduce.js\"","webpack:///packages/perspective-viewer-d3fc/external \"core-js/modules/es.string.replace.js\"","webpack:///packages/perspective-viewer-d3fc/external \"core-js/modules/web.dom-collections.iterator.js\"","webpack:///packages/perspective-viewer-d3fc/external \"d3\"","webpack:///packages/perspective-viewer-d3fc/external \"d3-array\"","webpack:///packages/perspective-viewer-d3fc/external \"d3-svg-legend\"","webpack:///packages/perspective-viewer-d3fc/external \"d3fc\"","webpack:///packages/perspective-viewer-d3fc/external \"gradient-parser\"","webpack:///packages/perspective-viewer-d3fc/webpack/bootstrap","webpack:///packages/perspective-viewer-d3fc/webpack/startup","webpack:///packages/perspective-viewer-d3fc/webpack/runtime/compat get default export","webpack:///packages/perspective-viewer-d3fc/webpack/runtime/define property getters","webpack:///packages/perspective-viewer-d3fc/webpack/runtime/hasOwnProperty shorthand","webpack:///packages/perspective-viewer-d3fc/webpack/runtime/make namespace object"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__988__","__WEBPACK_EXTERNAL_MODULE__536__","__WEBPACK_EXTERNAL_MODULE__100__","__WEBPACK_EXTERNAL_MODULE__902__","__WEBPACK_EXTERNAL_MODULE__680__","__WEBPACK_EXTERNAL_MODULE__237__","__WEBPACK_EXTERNAL_MODULE__974__","__WEBPACK_EXTERNAL_MODULE__215__","__WEBPACK_EXTERNAL_MODULE__575__","__WEBPACK_EXTERNAL_MODULE__924__","__WEBPACK_EXTERNAL_MODULE__944__","push","id","useSourceMap","list","toString","this","map","item","content","cssMapping","btoa","sourceMapping","sourceMap","unescape","encodeURIComponent","JSON","stringify","sourceURLs","sources","source","sourceRoot","concat","join","cssWithMappingToString","i","modules","mediaQuery","alreadyImportedModules","length","AXIS_TYPES","axisType","settings","settingName","settingValue","excludeType","getType","checkTypes","types","filter","s","name","some","includes","type","args","flattenArray","array","Array","isArray","adaptee","minBandwidth","arg","rebindAll","bandwidth","Math","max","scale","withoutTicks","ticks","d3","domain","valueNames","orient","_domain","data","flattenedData","transformDomain","Set","d","reverse","valueName","labelFunction","defaultPadding","pad","padUnit","padding","extent","delta","Error","arguments","undefined","toConsumableArray","arr","arr2","from","abs","Number","isInteger","base","accessors","symmetricalAbout","include","paddingStrategy","instance","_iteratorError","values","_iteratorNormalCompletion","_didIteratorError","_iterator","Symbol","iterator","_step","next","done","accessor","value","apply","err","return","extent$$1","d3Array","halfRange","customExtent","v","parseFloat","getDataExtent","fc","dataWidth","gaps","sort","a","b","reduce","acc","src","min","getMinimumGap","tickFormatFunction","valueformatter","Date","getTime","multiAxis","baseAxis","tickSizeOuter","tickSizeInner","axisStore","names","store","target","key","Object","keys","decorate","groups","groupDataJoin","dataJoin","domainPathDataJoin","translate","x","y","isVertical","selection","transition","each","index","group","element","container","select","sign","range","domainPathData","attr","line","g","getAxisSize","getAxisOffset","sum","n","nodes","groupElement","groupScale","scaleFromGroup","tickOffset","step","useAxis","exit","customScale","tickFormat","text","copy","exclude","tickSize","multiAxisTop","axisOrdinalTop","multiAxisBottom","axisOrdinalBottom","multiAxisLeft","axisOrdinalLeft","multiAxisRight","axisOrdinalRight","getChartElement","getRootNode","host","getChartContainer","closest","component","getComponent","multiLevel","levelGroups","axisGroups","groupTickLayout","getGroupTickLayout","l","size","createAxis","axis","tickPadding","axisSet","getAxisSet","bottom","left","right","top","rotation","applyLabelRotation","hideOverlappingLabels","forEach","tick","split","width","maxLength","rotated","isOverlap","r1","r2","height","boundsRect","getXAxisBoundsRect","previousRectangles","transformCoords","transform","splitOn","indexOf","coords","substring","c","parseInt","getTransformCoords","tickRect","node","getBBox","rect","hidden","r","chart","querySelector","chartRect","getBoundingClientRect","axisRect","getLabelTransform","anchor","style","axisTypes","none","ordinal","time","linear","axisFactory","optionalParams","optional","_factory","useType","domainFunction","p","createComponent","defaultComponent","label","chartSvgFactory","xAxis","yAxis","chartFactory","chartCanvasFactory","cartesian","canvas","axisSplitter","altAxis","xScale","yScale","xDomain","xLabel","xAxisHeight","xDecorate","xTickFormat","yDomain","yLabel","yAxisWidth","yDecorate","yOrient","yTickFormat","xPaddingInner","xPaddingOuter","yPaddingInner","yPaddingOuter","oldDecorate","plotArea","setAttribute","clientWidth","clientHeight","haveSplit","altData","y2AxisDataJoin","ySeriesDataJoin","enter","append","y2Scale","yAxisComponent","on","call","drawMultiCanvasSeries","canvasPlotArea","context","getContext","yScales","drawMultiSvgSeries","svgPlotArea","datum","getOrCreateElement","selector","createCallback","isElementOverflowing","containerRect","innerElementRect","direction","isElementOverlapping","immovableRect","elementRect","fuzz","dimension","immovableInnerPoint","immovableOuterPoint","elementInnerPoint","elementOuterPoint","toValue","toLocaleString","get_type_config","format","getGroupValues","crossValues","crossValue","cross","getSplitValues","splitValues","mainValue","getDataValues","mainValues","baseValue","main","colorValue","generateHtml","tooltipDiv","selectAll","formatNumber","addDataValues","minimumFractionDigits","precision","maximumFractionDigits","mapToFilter","raiseEvent","column_names","groupFilters","splitFilters","filters","dispatchEvent","CustomEvent","bubbles","composed","detail","config","row","tooltip","alwaysShow","centered","_tooltip","isConnected","hideTooltip","html","tooltipTemplate","getTooltipDiv","showTip","containerNode","scrollTop","tooltipDivRect","leftAdjust","newLeft","topAdjust","newTop","centerTip","shiftIfOverflowingChartArea","showTooltip","hideTip","_event","selectionEvent","barSeries","color","series","groupFromKey","slice","seriesColors","col","k","colorScale","seriesColorsFromDistinct","seriesColorsFromGroups","defaultColors","mapFunction","withOpacity","colorStyles","opacity","colors","styles","defaults","scheme","withoutOpacity","setOpacity","decoded","labelFunctions","noLabel","ordinalLabel","timeLabel","linearLabel","splitIntoMultiSeries","stack","excludeEmpty","useData","multiSeries","baseValues","labels","baseKey","splitName","__ROW_PATH__","__KEY__","splitByValuesIntoMultiSeries","groupAndStackData","groupPointDataByMainValue","seriesFn","labelfn","seriesDataFn","margin","enforceContainerBoundaries","innerNode","offsetX","offsetY","chartNodeRect","getContainer","innerNodeRect","draggedInnerNodeRect","adjustedOffsets","edge","bound","adjustment","resizeForDraggingEvent","draggableComponent","pinned","draggable","cursor","legend","drag","offsets","offsetLeft","offsetTop","position","nodeRect","isNodeInTopRight","window","pinNodeToTopRight","unpinNodeFromTopRight","horizontalHandleClass","verticalHandleClass","handlesContainerId","resizeEvent","extendPerpendicularHandles","handles","offset","orientationClass","_","handleNode","handlesContainerExists","pinHandleToHandleBoxEdge","handle","extendHandlesBox","fromLegend","d3Legend","pageSize","resizable","pageCount","pageIndex","scrollableLegend","handleWidthPx","zIndex","minDimensionsPx","maxDimensionsPx","callbacks","executeCallbacks","event","callback","execute","dragHelper","horizontal","dragLeft","vertical","dragTop","dragRight","dragBottom","topleft","topright","bottomright","bottomleft","handlesGroup","xCoordHelper","yCoordHelper","leftHandle","topHandle","rightHandle","bottomHandle","concatCornerEdges","corner","cornerCursorHelper","topLeftHandle","topRightHandle","bottomRightHandle","bottomLeftHandle","enforceDistToParallelBarConstraints","offsetWidth","updateSettings","resizeAndRelocateHandles","dx","pointerFallenBehindAbsoluteCoordinates","offsetHeight","dy","dimensions","pinCorners","enforceMaxDimensions","relativeHandle","becauseCrossedMinSize","becauseExitedCoordinateSpace","dragHandleContainer","operatorFunction","anticipatedDimension","input","minWidth","minHeight","handleWidth","maxWidth","maxHeight","resizableComponent","render","calculatePageSize","renderControls","renderLegend","legendDiv","legendCells","legendDivRect","svg","cell","cutoffCharIndex","cellRect","cutoffCoord","createSVGPoint","fuzzyFactor","getCharNumAtPosition","getCutoffCharacterIndex","cropCellContents","controls","getLegendControls","setPage","cellFilter","remove","legendElement","getLegendElement","cellContainerSize","legendContainerRect","proposedPageSize","floor","calculatePageCount","ceil","legendControlsTemplate","scrollColorLegend","shape","shapeRadius","scrollSymbolLegend","shapePadding","labelOffset","colorLegend","legendComponent","symbolLegend","symbolScale","fromScale","scrollLegendComponent","scaleModifier","scrollLegend","hideKeys","draw","options","parts","legendSelection","isHidden","cells","classed","filterData","clone","filterDataByGroup","crossGridSvg","seriesMulti","annotationGridline","mainGrid","grid","gridLineColor","mainGridSvg","crossGrid","_withGridLines","strokeStyle","lineWidth","mainGridCanvas","crossGridCanvas","multi","xStyle","yStyle","gridlines","hardLimitZeroPadding","_defaultPadding","paddedLowerExtent","paddedUpperExtent","xCopy","yCopy","onChange","zoomableChart","chartPlotArea","dateAxis","zoom","applyTransform","noZoom","zoomControls","getZoomControls","oneYear","sixMonths","oneMonth","dateClick","endCalculation","start","end","xRange","yMiddle","setYear","getFullYear","setMonth","getMonth","sel","initialTransform","zoomableScale","changeArgs","rescaleX","yZoomDomain","rescaleY","template","nice","barChart","bars","mapping","withGridLines","align","xNice","zoomChart","plugin","max_cells","max_columns","render_warning","isMatchable","isNaN","originRatio","adjustLowerBound","ratio","sourceData","splitFn","dataSplitFunction","splitMainValues","altValue","m","splitter","labelsInfo","mainLabels","altLabels","labeller","alt","_render","labelDataJoin","disabled","coloured","redrawChart","chartElement","splitterLabels","isIncludedFn","dataBlankFunction","assign","groupedBlankFunction","columnChart","yAxisFactory","blankFunction","yAxis1","plotSeries","yNice","yAxis2","domain1","domain2","ratio1","ratio2","domainMatchOrigins","lineSeries","transposeData","columns","findBestFromData","valueFn","compareFn","findBestFromArray","best","thisValue","findBestFromItem","bestItem","xValueName","yValueName","altDataWithScale","nearbyTip","tooltipData","pointer","getClosestDataPoint","useYScale","renderTip","tipData","tips","merge","sqrt","pos","distFn","pow","dist1","best1","dist2","best2","lineChart","splitData","toolTip","transposed_data","symbols","fromDomain","symbolTypeFromGroups","xyLine","n_cols","cols","xySplitData","xAxisFactory","initial","count","selectMode","areaChart","splitAndBaseData","areaSeries","yScatter","groupedSeries","groupData","symbolType","seriesKey","categoryPointSeries","pointData","mappedSeries","realValues","seriesToPoints","seriesColorRange","getExtent","gradient","full","positive","negative","maxVal","interpolator","multiInterpolator","gradientPairs","interpolators","findIndex","value1","value2","colorRangeLegend","paddedDomain","expandedDomain","svgBar","middle","round","tickValues","axisLabel","legendSvg","legendBar","barWidth","xyScatter","useGroupColors","seriesLinearRange","seriesCanvasPoint","fillStyle","pointSeriesCanvas","axisDefault","heatmapChart","mainType","heatmapData","pop","getMainValues","xValue","yValue","colorInterpolate","widthFraction","heatmapSeries","xAlign","yAlign","ohlcData","getNextOpen","openValue","closeValue","highValue","lowValue","seriesToOHLC","seriesCanvas","srcData","bollinger","seriesData","bollingerData","upColor","downColor","avgColor","isUp","bollingerAverageSeries","average","bollingerAreaSeries","upper","lower","ohlcCandleSeries","zoomedData","ohlc","ohlcCandle","seriesCanvasOhlc","candlestick","seriesCanvasCandlestick","treeColor","color_column","find","getColors","withUndefined","fn","flattenExtent","extents","children","child","treeData","sets","real_aggs","j","splits","splitValue","getSplitNames","currentLevel","e","is_leaf","getDataValue","agg_paths","entries","set","tree","chartData","PI","current","ancestors","depth","getExtents","aggregate","drawArc","radius","arc","startAngle","x0","endAngle","x1","padAngle","padRadius","innerRadius","y0","outerRadius","y1","arcVisible","labelVisible","labelTransform","cropLabel","targetWidth","actualWidth","labelText","textSelection","replace","clickHandler","parent","parentTitle","path","skipTransition","sunburstLevel","t","duration","tween","interpolate","getAttribute","attrTween","sunburstSeries","_sunburstSeries","sunburstElement","segment","descendants","segmentEnter","segmentMerge","onClick","gridLayoutMultiChart","elementsPrefix","chartContainer","chartEnter","chartDiv","chartTitle","containerSize","_gridLayoutMultiChart","innerContainer","innerRect","containerHeight","containerWidth","rows","sunburst","console","warn","sunburstGrid","sunburstContainer","sunburstEnter","sunburstDiv","sunburstTitle","svgNode","parentNode","labelMapExists","textAttributes","toggleLabels","treemapLevel","textLevelHelper","visibleNodes","selectVisibleNodes","centerLabels","preventTextCollisions","topNodes","textVisability","high","low","lowerNode","topNode","textOpacity","mid","zero","adjustLabelsThatOverflow","shrinkOrHideText","centerText","nodeSelect","childNodes","textRect","rectRect","needsToShrinkOrHide","fontSize","every","treemapLayout","paddingInner","tile","calculateSubTreeMap","nodesMerge","rootNode","treemapDiv","oldDimensions","newDimensions","dimensionMultiplier","calcWidth","calcHeight","visible","val","includesAllCrossValues","mapLevel","levelRoot","approximateAttributesForAllNodes","subTreeRoot","treeRootWidth","treeRootHeight","treemapBlueprinter","dummiedDescendants","hierarchy","recalculateVisibleSubTreeCoordinates","calculateTextOpacities","saveLabelMap","class","textVis","textLockedAt","changeLevel","rects","treemapSvg","parentCtrls","treemapRoute","executeTransition","recordLabelMap","ease","preventUserInteraction","styleTween","catch","enableUserInteraction","then","visibleLabelNodes","async","interpolation","lockedOpacity","targetOpacity","ex","error","unlockTextOpacity","fadeTextTransition","lockTextOpacity","hide","deactivate","nodeLevel","treemapSeries","_treemapSeries","deactivated","button","parentControls","maxDepth","treemap","nodesEnter","isLeafNode","nodeLevelHelper","calculateRootLevelMap","cv","returnToLevel","treemaps","_container","classList","add","treemapGrid","treemapEnter","heatmap","getOpacityFromColor","stepAsColor","computedStyle","ShadyCSS","getComputedStyleValue","containerStyles","getComputedStyle","getPropertyValue","parseGradient","parsed","gparser","colorStops","styleWithD3FC","headerStyles","document","querySelectorAll","d3fcStyles","innerText","getD3FCStyles","EXCLUDED_SETTINGS","bindTemplate","constructor","super","_chart","_settings","connectedCallback","shadowRoot","handler","obj","prop","Event","Proxy","_configureSettings","computed","initialiseStyles","navigator","userAgent","setTimeout","containerDiv","chartClass","resize","innerHTML","delete","getSettings","setSettings","oldSettings","newSettings","oldValues","newValues","arr1","PRIVATE","DEFAULT_PLUGIN_SETTINGS","drawChart","el","view","task","end_col","end_row","jsonp","metadata","parse","leaves_only","to_json","Promise","all","_table","schema","expression_schema","get_config","cancelled","table_schema","view_schema","json","get_pivot_column_type","column","row_pivots","column_pivots","filtered","aggs","len","mapped","createOrUpdateChart","getOrCreatePluginElement","perspective_d3fc_element","createElement","div","contains","appendChild","resizeChart","deleteChart","save","restore","Element","prototype","matches","msMatchesSelector","plugins","charts","has","registerPlugin","create","register","webkitMatchesSelector","parentElement","nodeType","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","getter","__esModule","definition","o","defineProperty","enumerable","get","hasOwnProperty","toStringTag"],"mappings":"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","file":"perspective-viewer-d3fc.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"core-js/modules/es.array.reduce.js\"), require(\"core-js/modules/web.dom-collections.iterator.js\"), require(\"@finos/perspective-viewer/src/js/utils.js\"), require(\"d3fc\"), require(\"d3\"), require(\"d3-array\"), require(\"@finos/perspective/dist/esm/config\"), require(\"d3-svg-legend\"), require(\"core-js/modules/es.string.replace.js\"), require(\"gradient-parser\"), require(\"@finos/perspective-viewer/src/js/utils\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"core-js/modules/es.array.reduce.js\", \"core-js/modules/web.dom-collections.iterator.js\", \"@finos/perspective-viewer/src/js/utils.js\", \"d3fc\", \"d3\", \"d3-array\", \"@finos/perspective/dist/esm/config\", \"d3-svg-legend\", \"core-js/modules/es.string.replace.js\", \"gradient-parser\", \"@finos/perspective-viewer/src/js/utils\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"perspective-view-d3fc\"] = factory(require(\"core-js/modules/es.array.reduce.js\"), require(\"core-js/modules/web.dom-collections.iterator.js\"), require(\"@finos/perspective-viewer/src/js/utils.js\"), require(\"d3fc\"), require(\"d3\"), require(\"d3-array\"), require(\"@finos/perspective/dist/esm/config\"), require(\"d3-svg-legend\"), require(\"core-js/modules/es.string.replace.js\"), require(\"gradient-parser\"), require(\"@finos/perspective-viewer/src/js/utils\"));\n\telse\n\t\troot[\"perspective-view-d3fc\"] = factory(root[\"core-js/modules/es.array.reduce.js\"], root[\"core-js/modules/web.dom-collections.iterator.js\"], root[\"@finos/perspective-viewer/src/js/utils.js\"], root[\"d3fc\"], root[\"d3\"], root[\"d3-array\"], root[\"@finos/perspective/dist/esm/config\"], root[\"d3-svg-legend\"], root[\"core-js/modules/es.string.replace.js\"], root[\"gradient-parser\"], root[\"@finos/perspective-viewer/src/js/utils\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__988__, __WEBPACK_EXTERNAL_MODULE__536__, __WEBPACK_EXTERNAL_MODULE__100__, __WEBPACK_EXTERNAL_MODULE__902__, __WEBPACK_EXTERNAL_MODULE__680__, __WEBPACK_EXTERNAL_MODULE__237__, __WEBPACK_EXTERNAL_MODULE__974__, __WEBPACK_EXTERNAL_MODULE__215__, __WEBPACK_EXTERNAL_MODULE__575__, __WEBPACK_EXTERNAL_MODULE__924__, __WEBPACK_EXTERNAL_MODULE__944__) {\nreturn ","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:15px;overflow:hidden}:host .chart.d3_heatmap d3fc-group.cartesian-chart,\\n:host .chart.d3_treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content)}:host .chart .chart-label{display:none}:host .chart.d3_heatmap{padding-right:120px}:host .chart.d3_sunburst{padding:0;font-size:14px}:host .chart.d3_sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.d3_sunburst .inner-container div{overflow:hidden}:host .chart.d3_sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px)}:host .chart.d3_sunburst .inner-container svg{width:100%;height:100%}:host .chart.d3_sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart.d3_sunburst .inner-container text.segment,\\n:host .chart.d3_sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,#333333)}:host .chart.d3_sunburst .inner-container div.title-container{margin-top:5px}:host .chart.has-legend{padding-right:120px}:host .chart.d3_treemap .treemap-container{position:relative}:host .chart.d3_treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.d3_treemap .inner-container div{overflow:hidden}:host .chart.d3_treemap .inner-container svg{width:100%;height:100%}:host .chart.d3_treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart.d3_treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1}:host .chart.d3_treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0}:host .chart.d3_treemap .inner-container .branchnode{opacity:0}:host .chart.d3_treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black)}:host .chart.d3_treemap .inner-container .leafnode{fill-opacity:0.8}:host .chart.d3_treemap .inner-container .leafnode:hover{fill-opacity:0.5}:host .chart.d3_treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0}:host .chart.d3_treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none}:host .chart.d3_treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4}:host .chart.d3_treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4}:host .chart.d3_treemap .inner-container text{fill:var(--d3fc-treedata--labels,#333333)}:host .chart.d3_treemap .inner-container text.title{dominant-baseline:hanging}:host .chart.d3_treemap .inner-container .parent-controls{position:absolute;top:15px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s}:host .chart.d3_treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px #000;transition:box-shadow 0.2s}:host .chart .x-label{height:1.2em!important;line-height:1em!important}:host .chart .x-label,\\n:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px}:host .chart d3fc-canvas.plot-area{display:none}:host .chart.d3_xy_scatter d3fc-canvas.plot-area,\\n:host .chart.d3_xy_line d3fc-canvas.plot-area,\\n:host .chart.d3_ohlc d3fc-canvas.plot-area,\\n:host .chart.d3_candlestick d3fc-canvas.plot-area{display:block}:host .chart .y-axis text,\\n:host .chart .x-axis text{fill:var(--d3fc-axis--ticks,#505050);font-size:11px}:host .chart .y-axis path,\\n:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,#b4d2e1)}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,#b4d2e1)}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis--ticks,#505050)}:host .chart .splitter-label.disabled{cursor:default}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3)}:host .chart .y-label-container .splitter-label::after{font-family:var(--d3fc-y1-label--font-family,inherit);content:var(--d3fc-y1-label--content,\\\"\\\\1F847\\\")}:host .chart .y2-label-container .splitter-label::after{font-family:var(--d3fc-y2-label--font-family,inherit);content:var(--d3fc-y2-label--content,\\\"\\\\1F845\\\")}:host .chart.d3_y_bar .y-axis path,\\n:host .chart.d3_y_line .y-axis path,\\n:host .chart.d3_xy_line .y-axis path,\\n:host .chart.d3_xy_line .x-axis path,\\n:host .chart.d3_y_area .y-axis path,\\n:host .chart.d3_y_scatter .y-axis path,\\n:host .chart.d3_xy_scatter .y-axis path,\\n:host .chart.d3_xy_scatter .x-axis path,\\n:host .chart.d3_x_bar .x-axis path{visibility:hidden}:host .chart .y-label{white-space:nowrap}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart .series{fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart .series-1{fill:var(--d3fc-series-1,#0366d6)}:host .chart .series-2{fill:var(--d3fc-series-2,#ff7f0e)}:host .chart .series-3{fill:var(--d3fc-series-3,#2ca02c)}:host .chart .series-4{fill:var(--d3fc-series-4,#d62728)}:host .chart .series-5{fill:var(--d3fc-series-5,#9467bd)}:host .chart .series-6{fill:var(--d3fc-series-6,#8c564b)}:host .chart .series-7{fill:var(--d3fc-series-7,#e377c2)}:host .chart .series-8{fill:var(--d3fc-series-8,#7f7f7f)}:host .chart .series-9{fill:var(--d3fc-series-9,#bcbd22)}:host .chart .series-10{fill:var(--d3fc-series-10,#17becf)}:host .disabled{filter:grayscale(100%)}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none}:host #dragHandles rect{pointer-events:all}:host .label rect{fill:none}:host .legend-container{position:absolute;top:15px;right:15px;left:auto;width:150px;height:280px}:host .legend-container.legend-color{width:90px;height:150px}:host .legend-container[borderbox-on-hover=\\\"true\\\"]{transition:box-shadow 1s}:host .legend-container[borderbox-on-hover=\\\"true\\\"]:hover{background-color:var(--d3fc-legend--background,#ffffff);box-shadow:0 2px 4px 0 rgba(0,0,0,0.1);transition:box-shadow 0.2s,background-color 0.2s}:host .legend-container .legend{font-size:8pt;width:100%}:host .legend-container .legend .cell{cursor:pointer}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,#1f77b4)}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:#cccccc}:host .legend-container .legend .cell.hidden circle{fill:#cccccc!important}:host .legend-container text{fill:var(--d3fc-legend--text,#333333)}:host .legend-container .label:hover{fill:#22a0ce}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,#333333)}:host .legend-container .legend-controls{margin-left:12px}:host .legend-container .legend-controls #up-arrow,\\n:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:#1f77b4}:host .legend-container .legend-controls #up-arrow.disabled,\\n:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:#333333}:host .d3_heatmap .legend-container.legend-color{height:200px}:host .d3_treemap .legend-container.legend-color{height:200px}:host .d3_treemap .legend-container:not(.legend-color){width:100px}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center}:host .zoom-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #cccccc;padding:10px;opacity:0.5;cursor:pointer}:host .zoom-controls button:hover{background:#e6e6e6}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right}:host .parent-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #cccccc;padding:10px;opacity:0.5;cursor:pointer}:host .parent-controls button:hover{background:#e6e6e6}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none}:host div.tooltip ul{margin:0;padding:0;list-style-type:none}\", \"\"]);\n\n// exports\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","module.exports = \"<template id=\\\"perspective-d3fc-chart\\\">\\r\\n    <div id=\\\"container\\\" class=\\\"chart\\\">\\r\\n    </div>\\r\\n</template>\";","module.exports = \"<span id=\\\"up-arrow\\\">&#9650;</span>\\n<span id=\\\"page-text\\\"></span>\\n<span id=\\\"down-arrow\\\">&#9660;</span>\";","module.exports = \"<button id=\\\"goto-parent\\\">Goto parent</button>\";","module.exports = \"<ul id=\\\"tooltip-values\\\"></ul>\";","module.exports = \"<button id=\\\"zoom-reset\\\">Reset zoom</button>\\n<button id=\\\"one-year\\\">1 Year</button>\\n<button id=\\\"six-months\\\">6 Months</button>\\n<button id=\\\"one-month\\\">1 Month</button>\";","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const AXIS_TYPES = {\n    none: \"none\",\n    ordinal: \"ordinal\",\n    time: \"time\",\n    linear: \"linear\"\n};\n\nexport const axisType = settings => {\n    let settingName = \"crossValues\";\n    let settingValue = null;\n    let excludeType = null;\n\n    const getType = () => {\n        const checkTypes = types => {\n            const list = settingValue ? settings[settingName].filter(s => settingValue == s.name) : settings[settingName];\n\n            if (settingName == \"crossValues\" && list.length > 1) {\n                // can't do multiple values on non-ordinal cross-axis\n                return false;\n            }\n\n            return list.some(s => types.includes(s.type));\n        };\n\n        if (settings[settingName].length === 0) {\n            return AXIS_TYPES.none;\n        } else if (excludeType != AXIS_TYPES.time && checkTypes([\"datetime\", \"date\"])) {\n            return AXIS_TYPES.time;\n        } else if (excludeType != AXIS_TYPES.linear && checkTypes([\"integer\", \"float\"])) {\n            return AXIS_TYPES.linear;\n        }\n\n        if (excludeType == AXIS_TYPES.ordinal) {\n            return AXIS_TYPES.linear;\n        }\n        return AXIS_TYPES.ordinal;\n    };\n\n    getType.settingName = (...args) => {\n        if (!args.length) {\n            return settingName;\n        }\n        settingName = args[0];\n        return getType;\n    };\n\n    getType.settingValue = (...args) => {\n        if (!args.length) {\n            return settingValue;\n        }\n        settingValue = args[0];\n        return getType;\n    };\n\n    getType.excludeType = (...args) => {\n        if (!args.length) {\n            return excludeType;\n        }\n        excludeType = args[0];\n        return getType;\n    };\n\n    return getType;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const flattenExtent = array => {\n    const withUndefined = fn => (a, b) => {\n        if (a === undefined) return b;\n        if (b === undefined) return a;\n        return fn(a, b);\n    };\n    return array.reduce((r, v) => [withUndefined(Math.min)(r[0], v[0]), withUndefined(Math.max)(r[1], v[1])], [undefined, undefined]);\n};\n\nexport const flattenArray = array => {\n    if (Array.isArray(array)) {\n        return [].concat(...array.map(flattenArray));\n    } else {\n        return [array];\n    }\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {rebindAll} from \"d3fc\";\n\nconst MIN_BANDWIDTH = 1;\n\nexport default adaptee => {\n    const minBandwidth = arg => {\n        return adaptee(arg);\n    };\n\n    rebindAll(minBandwidth, adaptee);\n\n    minBandwidth.bandwidth = (...args) => {\n        if (!args.length) {\n            return Math.max(adaptee.bandwidth(), MIN_BANDWIDTH);\n        }\n        adaptee.bandwidth(...args);\n        return minBandwidth;\n    };\n\n    return minBandwidth;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport {flattenArray} from \"./flatten\";\nimport minBandwidth from \"./minBandwidth\";\nimport withoutTicks from \"./withoutTicks\";\n\nexport const scale = () => withoutTicks(minBandwidth(d3.scaleBand()));\n\nexport const domain = () => {\n    let valueNames = [\"crossValue\"];\n    let orient = \"horizontal\";\n\n    const _domain = data => {\n        const flattenedData = flattenArray(data);\n        return transformDomain([...new Set(flattenedData.map(d => d[valueNames[0]]))]);\n    };\n\n    const transformDomain = d => (orient == \"vertical\" ? d.reverse() : d);\n\n    _domain.valueName = (...args) => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n    _domain.valueNames = (...args) => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    _domain.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _domain;\n    };\n\n    return _domain;\n};\n\nexport const labelFunction = valueName => d => d[valueName].join(\"|\");\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {rebindAll} from \"d3fc\";\n\nexport default adaptee => {\n    const withoutTicks = arg => {\n        return adaptee(arg);\n    };\n\n    rebindAll(withoutTicks, adaptee);\n\n    withoutTicks.ticks = function() {\n        return [];\n    };\n\n    return withoutTicks;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const defaultPadding = () => {\n    let pad = [0, 0];\n    let padUnit = \"percent\";\n\n    const padding = extent => {\n        switch (padUnit) {\n            case \"domain\": {\n                extent[0] -= pad[0];\n                extent[1] += pad[1];\n                break;\n            }\n            case \"percent\": {\n                let delta = extent[1] - extent[0];\n                extent[0] -= pad[0] * delta;\n                extent[1] += pad[1] * delta;\n                break;\n            }\n            default:\n                throw new Error(\"Unknown padUnit: \" + padUnit);\n        }\n        return extent;\n    };\n\n    padding.pad = function() {\n        if (!arguments.length) {\n            return pad;\n        }\n        pad = arguments.length <= 0 ? undefined : arguments[0];\n        return padding;\n    };\n\n    padding.padUnit = function() {\n        if (!arguments.length) {\n            return padUnit;\n        }\n        padUnit = arguments.length <= 0 ? undefined : arguments[0];\n        return padding;\n    };\n\n    return padding;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3Array from \"d3-array\";\nimport {defaultPadding} from \"../padding/default\";\n\nexport const extentLinear = function() {\n    let accessors = [\n        function(d) {\n            return d;\n        }\n    ];\n    let symmetricalAbout = null;\n    let include = [];\n    let paddingStrategy = defaultPadding();\n\n    const instance = function instance(data) {\n        let values = new Array(data.length);\n        let _iteratorNormalCompletion = true;\n        let _didIteratorError = false;\n        let _iteratorError = undefined;\n\n        let _iterator = accessors[Symbol.iterator]();\n        try {\n            for (let _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                let accessor = _step.value;\n\n                for (let i = 0; i < data.length; i++) {\n                    let value = accessor(data[i], i);\n                    if (Array.isArray(value)) {\n                        values.push.apply(values, toConsumableArray(value));\n                    } else {\n                        values.push(value);\n                    }\n                }\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n\n        let extent$$1 = [d3Array.min(values), d3Array.max(values)];\n\n        extent$$1[0] = extent$$1[0] == null ? d3Array.min(include) : d3Array.min([extent$$1[0]].concat(toConsumableArray(include)));\n        extent$$1[1] = extent$$1[1] == null ? d3Array.max(include) : d3Array.max([extent$$1[1]].concat(toConsumableArray(include)));\n\n        if (symmetricalAbout != null) {\n            let halfRange = Math.max(Math.abs(extent$$1[1] - symmetricalAbout), Math.abs(extent$$1[0] - symmetricalAbout));\n            extent$$1[0] = symmetricalAbout - halfRange;\n            extent$$1[1] = symmetricalAbout + halfRange;\n        }\n\n        return paddingStrategy(extent$$1);\n    };\n\n    instance.accessors = function() {\n        if (!arguments.length) {\n            return accessors;\n        }\n        accessors = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    //This function points directly at the paddingStrategy child object's\n    //properties for backwards-compatibility. DEPRECATED.\n    instance.pad = function() {\n        if (!arguments.length) {\n            return paddingStrategy.pad;\n        }\n        paddingStrategy.pad(arguments.length <= 0 ? undefined : arguments[0]);\n        return instance;\n    };\n\n    //This function points directly at the paddingStrategy child object's\n    //properties for backwards-compatibility. DEPRECATED.\n    instance.padUnit = function() {\n        if (!arguments.length) {\n            return paddingStrategy.padUnit;\n        }\n        paddingStrategy.padUnit(arguments.length <= 0 ? undefined : arguments[0]);\n        return instance;\n    };\n\n    instance.include = function() {\n        if (!arguments.length) {\n            return include;\n        }\n        include = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    instance.symmetricalAbout = function() {\n        if (!arguments.length) {\n            return symmetricalAbout;\n        }\n        symmetricalAbout = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    instance.paddingStrategy = function() {\n        if (!arguments.length) {\n            return paddingStrategy;\n        }\n        paddingStrategy = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    return instance;\n};\n\nlet toConsumableArray = function(arr) {\n    if (Array.isArray(arr)) {\n        let arr2 = Array(arr.length);\n        for (let i = 0; i < arr.length; i++) {\n            arr2[i] = arr[i];\n        }\n        return arr2;\n    } else {\n        return Array.from(arr);\n    }\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\n\nconst SI_MIN = 10000000;\n\nexport default d => (Math.abs(d) >= SI_MIN ? d3.format(\".3s\")(d) : Number.isInteger(d) ? d3.format(\",.0f\")(d) : d3.format(\",.2f\")(d));\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport {flattenArray} from \"./flatten\";\nimport {extentLinear as customExtent} from \"../d3fc/extent/extentLinear\";\nimport valueformatter from \"./valueFormatter\";\n\nexport const scale = () => d3.scaleLinear();\n\nexport const domain = () => {\n    const base = customExtent()\n        .pad([0, 0.1])\n        .padUnit(\"percent\");\n\n    let valueNames = [\"crossValue\"];\n\n    const _domain = data => {\n        base.accessors(valueNames.map(v => d => parseFloat(d[v])));\n\n        return getDataExtent(flattenArray(data));\n    };\n\n    fc.rebindAll(_domain, base);\n\n    const getMinimumGap = data => {\n        const gaps = valueNames.map(valueName =>\n            data\n                .map(d => d[valueName])\n                .sort((a, b) => a - b)\n                .filter((d, i, a) => i === 0 || d !== a[i - 1])\n                .reduce((acc, d, i, src) => (i === 0 || acc <= d - src[i - 1] ? acc : Math.abs(d - src[i - 1])))\n        );\n\n        return Math.min(...gaps);\n    };\n\n    const getDataExtent = data => {\n        if (base.padUnit() == \"domain\") {\n            const dataWidth = getMinimumGap(data);\n            return base.pad([dataWidth / 2, dataWidth / 2])(data);\n        } else {\n            return base(data);\n        }\n    };\n\n    _domain.valueName = (...args) => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n    _domain.valueNames = (...args) => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    return _domain;\n};\n\nexport const labelFunction = valueName => d => d[valueName][0];\n\nexport const tickFormatFunction = valueformatter;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport {flattenArray} from \"./flatten\";\n\nexport const scale = () => d3.scaleTime();\n\nexport const domain = () => {\n    const base = fc.extentTime();\n\n    let valueNames = [\"crossValue\"];\n\n    const _domain = data => {\n        base.accessors(valueNames.map(v => d => new Date(d[v])));\n\n        return getDataExtent(flattenArray(data));\n    };\n\n    fc.rebindAll(_domain, base, fc.exclude(\"include\", \"paddingStrategy\"));\n\n    const getMinimumGap = data => {\n        const gaps = valueNames.map(valueName =>\n            data\n                .map(d => new Date(d[valueName]).getTime())\n                .sort((a, b) => a - b)\n                .filter((d, i, a) => i === 0 || d !== a[i - 1])\n                .reduce((acc, d, i, src) => (i === 0 || acc <= d - src[i - 1] ? acc : Math.abs(d - src[i - 1])))\n        );\n\n        return Math.min(...gaps);\n    };\n\n    const getDataExtent = data => {\n        const dataWidth = getMinimumGap(data);\n        return base.padUnit(\"domain\").pad([dataWidth / 2, dataWidth / 2])(data);\n    };\n\n    _domain.valueName = (...args) => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n    _domain.valueNames = (...args) => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    return _domain;\n};\n\nexport const labelFunction = valueName => d => new Date(d[valueName][0]);\n","import {select, line} from \"d3\";\nimport {axisOrdinalTop, axisOrdinalBottom, axisOrdinalLeft, axisOrdinalRight, dataJoin, rebindAll, exclude} from \"d3fc\";\nimport store from \"./store\";\n\nconst multiAxis = (orient, baseAxis, scale) => {\n    let tickSizeOuter = 6;\n    let tickSizeInner = 6;\n    let axisStore = store(\"tickFormat\", \"ticks\", \"tickArguments\", \"tickValues\", \"tickPadding\");\n    let decorate = () => {};\n\n    let groups = null;\n\n    const groupDataJoin = dataJoin(\"g\", \"group\");\n    const domainPathDataJoin = dataJoin(\"path\", \"domain\");\n\n    const translate = (x, y) => (isVertical() ? `translate(${y}, ${x})` : `translate(${x}, ${y})`);\n\n    const pathTranspose = arr => (isVertical() ? arr.map(d => [d[1], d[0]]) : arr);\n\n    const isVertical = () => orient === \"left\" || orient === \"right\";\n\n    const multiAxis = selection => {\n        if (!groups) {\n            axisStore(baseAxis(scale).decorate(decorate))(selection);\n            return;\n        }\n\n        if (selection.selection) {\n            groupDataJoin.transition(selection);\n            domainPathDataJoin.transition(selection);\n        }\n\n        selection.each((data, index, group) => {\n            const element = group[index];\n\n            const container = select(element);\n\n            const sign = orient === \"bottom\" || orient === \"right\" ? 1 : -1;\n\n            // add the domain line\n            const range = scale.range();\n            const domainPathData = pathTranspose([\n                [range[0], sign * tickSizeOuter],\n                [range[0], 0],\n                [range[1], 0],\n                [range[1], sign * tickSizeOuter]\n            ]);\n\n            const domainLine = domainPathDataJoin(container, [data]);\n            domainLine\n                .attr(\"d\", line()(domainPathData))\n                .attr(\"stroke\", \"#000\")\n                .attr(\"fill\", \"none\");\n\n            const g = groupDataJoin(container, groups);\n\n            const getAxisSize = i => (Array.isArray(tickSizeInner) ? tickSizeInner[i] : tickSizeInner);\n            const getAxisOffset = i => {\n                let sum = 0;\n                for (let n = 0; n < i; n++) {\n                    sum += getAxisSize(n);\n                }\n                return sum;\n            };\n\n            g.attr(\"transform\", (d, i) => translate(0, sign * getAxisOffset(i))).each((group, i, nodes) => {\n                const groupElement = select(nodes[i]);\n                const groupScale = scaleFromGroup(scale, group);\n                const useAxis = axisStore(baseAxis(groupScale))\n                    .decorate((s, data) => decorate(s, data, i))\n                    .tickSizeInner(getAxisSize(i))\n                    .tickOffset(d => groupScale.step(d) / 2);\n                useAxis(groupElement);\n\n                groupElement.select(\"path.domain\").attr(\"visibility\", \"hidden\");\n            });\n\n            // exit\n            g.exit().attr(\"transform\", (d, i) => translate(0, sign * getAxisOffset(i)));\n        });\n    };\n\n    const scaleFromGroup = (scale, group) => {\n        function customScale(value) {\n            const values = value.domain;\n            return values.reduce((sum, d) => sum + scale(d), 0) / values.length;\n        }\n\n        customScale.ticks = () => {\n            return group;\n        };\n        customScale.tickFormat = () => d => {\n            return d.text;\n        };\n        customScale.copy = () => scaleFromGroup(scale, group);\n\n        customScale.step = value => value.domain.length * scale.step();\n\n        rebindAll(customScale, scale, exclude(\"ticks\", \"step\", \"copy\"));\n        return customScale;\n    };\n\n    multiAxis.tickSize = (...args) => {\n        if (!args.length) {\n            return tickSizeInner;\n        }\n        tickSizeInner = tickSizeOuter = Number(args[0]);\n        return multiAxis;\n    };\n\n    multiAxis.tickSizeInner = (...args) => {\n        if (!args.length) {\n            return tickSizeInner;\n        }\n        tickSizeInner = Array.isArray(args[0]) ? args[0] : Number(args[0]);\n        return multiAxis;\n    };\n\n    multiAxis.tickSizeOuter = (...args) => {\n        if (!args.length) {\n            return tickSizeOuter;\n        }\n        tickSizeOuter = Number(args[0]);\n        return multiAxis;\n    };\n\n    multiAxis.decorate = (...args) => {\n        if (!args.length) {\n            return decorate;\n        }\n        decorate = args[0];\n        return multiAxis;\n    };\n\n    multiAxis.groups = (...args) => {\n        if (!args.length) {\n            return groups;\n        }\n        groups = args[0];\n        return multiAxis;\n    };\n\n    rebindAll(multiAxis, axisStore);\n\n    return multiAxis;\n};\n\nexport const multiAxisTop = scale => multiAxis(\"top\", axisOrdinalTop, scale);\n\nexport const multiAxisBottom = scale => multiAxis(\"bottom\", axisOrdinalBottom, scale);\n\nexport const multiAxisLeft = scale => multiAxis(\"left\", axisOrdinalLeft, scale);\n\nexport const multiAxisRight = scale => multiAxis(\"right\", axisOrdinalRight, scale);\n","export default (...names) => {\n    const data = {};\n\n    const store = target => {\n        for (const key of Object.keys(data)) {\n            target[key](data[key]);\n        }\n        return target;\n    };\n\n    for (const name of names) {\n        store[name] = (...args) => {\n            if (!args.length) {\n                return data[name];\n            }\n            data[name] = args[0];\n            return store;\n        };\n    }\n\n    return store;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport function getChartElement(element) {\n    return element.getRootNode().host;\n}\n\nexport function getChartContainer(element) {\n    return element.closest(\"#container.chart\");\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport minBandwidth from \"./minBandwidth\";\nimport {flattenArray} from \"./flatten\";\nimport {multiAxisBottom, multiAxisLeft, multiAxisTop, multiAxisRight} from \"../d3fc/axis/multi-axis\";\nimport {getChartContainer} from \"../plugin/root\";\n\nexport const scale = () => minBandwidth(d3.scaleBand()).padding(0.5);\n\nexport const domain = () => {\n    let valueNames = [\"crossValue\"];\n    let orient = \"horizontal\";\n\n    const _domain = data => {\n        const flattenedData = flattenArray(data);\n        return transformDomain([...new Set(flattenedData.map(d => d[valueNames[0]]))]);\n    };\n\n    const transformDomain = d => (orient == \"vertical\" ? d.reverse() : d);\n\n    _domain.valueName = (...args) => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n    _domain.valueNames = (...args) => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    _domain.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _domain;\n    };\n\n    return _domain;\n};\n\nexport const labelFunction = valueName => d => d[valueName].join(\"|\");\n\nexport const component = settings => {\n    let orient = \"horizontal\";\n    let settingName = \"crossValues\";\n    let domain = null;\n\n    const getComponent = () => {\n        const multiLevel = settings[settingName].length > 1;\n\n        // Calculate the label groups and corresponding group sizes\n        const levelGroups = axisGroups(domain);\n        const groupTickLayout = levelGroups.map(getGroupTickLayout);\n\n        const tickSizeInner = multiLevel ? groupTickLayout.map(l => l.size) : groupTickLayout[0].size;\n        const tickSizeOuter = groupTickLayout.reduce((s, v) => s + v.size, 0);\n\n        const createAxis = base => scale => {\n            const axis = base(scale);\n\n            if (multiLevel) {\n                axis.groups(levelGroups)\n                    .tickSizeInner(tickSizeInner)\n                    .tickSizeOuter(tickSizeOuter);\n            }\n            if (orient !== \"horizontal\") axis.tickPadding(10);\n            return axis;\n        };\n\n        const decorate = (s, data, index) => {\n            const rotation = groupTickLayout[index].rotation;\n            if (orient === \"horizontal\") applyLabelRotation(s, rotation);\n            hideOverlappingLabels(s, rotation);\n        };\n\n        const axisSet = getAxisSet(multiLevel);\n        return {\n            bottom: createAxis(axisSet.bottom),\n            left: createAxis(axisSet.left),\n            right: createAxis(axisSet.right),\n            top: createAxis(axisSet.top),\n            size: `${tickSizeOuter + 10}px`,\n            decorate\n        };\n    };\n\n    // const pickAxis = multiLevel => {\n    //     if (multiLevel) {\n    //         return orient === \"horizontal\" ?\n    //                multiAxisBottom : multiAxisLeft;\n    //     }\n    //     return orient === \"horizontal\" ?\n    //                 fc.axisOrdinalBottom : fc.axisOrdinalLeft;\n    // };\n\n    const getAxisSet = multiLevel => {\n        if (multiLevel) {\n            return {\n                bottom: multiAxisBottom,\n                left: multiAxisLeft,\n                top: multiAxisTop,\n                right: multiAxisRight\n            };\n        } else {\n            return {\n                bottom: fc.axisOrdinalBottom,\n                left: fc.axisOrdinalLeft,\n                top: fc.axisOrdinalTop,\n                right: fc.axisOrdinalRight\n            };\n        }\n    };\n\n    const axisGroups = domain => {\n        const groups = [];\n        domain.forEach(tick => {\n            const split = tick && tick.split ? tick.split(\"|\") : [tick];\n            split.forEach((s, i) => {\n                while (groups.length <= i) groups.push([]);\n\n                const group = groups[i];\n                if (group.length > 0 && group[group.length - 1].text === s) {\n                    group[group.length - 1].domain.push(tick);\n                } else {\n                    group.push({text: s, domain: [tick]});\n                }\n            });\n        });\n        return groups.reverse();\n    };\n\n    const getGroupTickLayout = group => {\n        const width = settings.size.width;\n        const maxLength = Math.max(...group.map(g => (g.text ? g.text.length : 0)));\n\n        if (orient === \"horizontal\") {\n            // x-axis may rotate labels and expand the available height\n            if (group && group.length * 16 > width - 100) {\n                return {\n                    size: maxLength * 5 + 10,\n                    rotation: 90\n                };\n            } else if (group && group.length * (maxLength * 6 + 10) > width - 100) {\n                return {\n                    size: maxLength * 3 + 20,\n                    rotation: 45\n                };\n            }\n            return {\n                size: 25,\n                rotation: 0\n            };\n        } else {\n            // y-axis size always based on label size\n            return {\n                size: maxLength * 5 + 10,\n                rotation: 0\n            };\n        }\n    };\n\n    const hideOverlappingLabels = (s, rotated) => {\n        const getTransformCoords = transform => {\n            const splitOn = transform.indexOf(\",\") !== -1 ? \",\" : \" \";\n            const coords = transform\n                .substring(transform.indexOf(\"(\") + 1, transform.indexOf(\")\"))\n                .split(splitOn)\n                .map(c => parseInt(c));\n            while (coords.length < 2) coords.push(0);\n            return coords;\n        };\n\n        const rectanglesOverlap = (r1, r2) => r1.x <= r2.x + r2.width && r2.x <= r1.x + r1.width && r1.y <= r2.y + r2.height && r2.y <= r1.y + r1.height;\n        const rotatedLabelsOverlap = (r1, r2) => r1.x + r1.width + 14 > r2.x + r2.width;\n        const isOverlap = rotated ? rotatedLabelsOverlap : rectanglesOverlap;\n\n        const rectangleContained = (r1, r2) => r1.x >= r2.x && r1.x + r1.width <= r2.x + r2.width && r1.y >= r2.y && r1.y + r1.height <= r2.y + r2.height;\n        // The bounds rect is the available screen space a label can fit into\n        const boundsRect = orient == \"horizontal\" ? getXAxisBoundsRect(s) : null;\n\n        const previousRectangles = [];\n        s.each((d, i, nodes) => {\n            const tick = d3.select(nodes[i]);\n\n            // How the \"tick\" element is transformed (x/y)\n            const transformCoords = getTransformCoords(tick.attr(\"transform\"));\n\n            // Work out the actual rectanble the label occupies\n            const tickRect = tick.node().getBBox();\n            const rect = {x: tickRect.x + transformCoords[0], y: tickRect.y + transformCoords[1], width: tickRect.width, height: tickRect.height};\n\n            const overlap = previousRectangles.some(r => isOverlap(r, rect));\n\n            // Test that it also fits into the screen space\n            const hidden = overlap || (boundsRect && !rectangleContained(rect, boundsRect));\n\n            tick.attr(\"visibility\", hidden ? \"hidden\" : \"\");\n            if (!hidden) {\n                previousRectangles.push(rect);\n            }\n        });\n    };\n\n    const getXAxisBoundsRect = s => {\n        const container = getChartContainer(s.node());\n        if (container === null) {\n            return;\n        }\n        const chart = container.querySelector(\".cartesian-chart\");\n        const axis = chart.querySelector(\".x-axis\");\n\n        const chartRect = chart.getBoundingClientRect();\n        const axisRect = axis.getBoundingClientRect();\n        return {\n            x: chartRect.left - axisRect.left,\n            width: chartRect.width,\n            y: chartRect.top - axisRect.top,\n            height: chartRect.height\n        };\n    };\n\n    const getLabelTransform = rotation => {\n        if (!rotation) {\n            return \"translate(0, 8)\";\n        }\n        if (rotation < 60) {\n            return `rotate(-${rotation} 5 5)`;\n        }\n        return `rotate(-${rotation} 3 7)`;\n    };\n\n    const applyLabelRotation = (s, rotation) => {\n        const transform = getLabelTransform(rotation);\n        const anchor = rotation ? \"end\" : \"\";\n        s.each((d, i, nodes) => {\n            const tick = d3.select(nodes[i]);\n            const text = tick.select(\"text\");\n\n            text.attr(\"transform\", transform).style(\"text-anchor\", anchor);\n        });\n    };\n\n    getComponent.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return getComponent;\n    };\n\n    getComponent.settingName = (...args) => {\n        if (!args.length) {\n            return settingName;\n        }\n        settingName = args[0];\n        return getComponent;\n    };\n\n    getComponent.domain = (...args) => {\n        if (!args.length) {\n            return domain;\n        }\n        domain = args[0];\n        return getComponent;\n    };\n\n    return getComponent;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisType} from \"./axisType\";\nimport * as none from \"./noAxis\";\nimport * as linear from \"./linearAxis\";\nimport * as time from \"./timeAxis\";\nimport * as ordinal from \"./ordinalAxis\";\n\nconst axisTypes = {\n    none,\n    ordinal,\n    time,\n    linear\n};\n\nexport const axisFactory = settings => {\n    let excludeType = null;\n    let orient = \"horizontal\";\n    let settingName = \"crossValues\";\n    let settingValue = null;\n    let valueNames = [\"crossValue\"];\n\n    const optionalParams = [\"include\", \"paddingStrategy\", \"pad\"];\n    const optional = {};\n\n    const _factory = data => {\n        const useType = axisType(settings)\n            .excludeType(excludeType)\n            .settingName(settingName)\n            .settingValue(settingValue)();\n\n        const axis = axisTypes[useType];\n        const domainFunction = axis.domain().valueNames(valueNames);\n\n        optionalParams.forEach(p => {\n            if (optional[p] && domainFunction[p]) domainFunction[p](optional[p]);\n        });\n        if (domainFunction.orient) domainFunction.orient(orient);\n\n        const domain = domainFunction(data);\n        const component = axis.component ? createComponent(axis, domain, data) : defaultComponent();\n\n        return {\n            scale: axis.scale(),\n            domain,\n            domainFunction,\n            labelFunction: axis.labelFunction,\n            component: {\n                bottom: component.bottom,\n                left: component.left,\n                top: component.top,\n                right: component.right\n            },\n            size: component.size,\n            decorate: component.decorate,\n            label: settings[settingName].map(v => v.name).join(\", \"),\n            tickFormatFunction: axis.tickFormatFunction\n        };\n    };\n\n    const createComponent = (axis, domain, data) =>\n        axis\n            .component(settings)\n            .orient(orient)\n            .settingName(settingName)\n            .domain(domain)(data);\n\n    const defaultComponent = () => ({\n        bottom: fc.axisBottom,\n        left: fc.axisLeft,\n        top: fc.axisTop,\n        right: fc.axisRight,\n        decorate: () => {}\n    });\n\n    _factory.excludeType = (...args) => {\n        if (!args.length) {\n            return excludeType;\n        }\n        excludeType = args[0];\n        return _factory;\n    };\n\n    _factory.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _factory;\n    };\n\n    _factory.settingName = (...args) => {\n        if (!args.length) {\n            return settingName;\n        }\n        settingName = args[0];\n        return _factory;\n    };\n\n    _factory.settingValue = (...args) => {\n        if (!args.length) {\n            return settingValue;\n        }\n        settingValue = args[0];\n        return _factory;\n    };\n\n    _factory.valueName = (...args) => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _factory;\n    };\n\n    _factory.valueNames = (...args) => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _factory;\n    };\n\n    optionalParams.forEach(p => {\n        _factory[p] = (...args) => {\n            if (!args.length) {\n                return optional[p];\n            }\n            optional[p] = args[0];\n            return _factory;\n        };\n    });\n\n    return _factory;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\n\nexport const chartSvgFactory = (xAxis, yAxis) => chartFactory(xAxis, yAxis, fc.chartSvgCartesian, false);\nexport const chartCanvasFactory = (xAxis, yAxis) => chartFactory(xAxis, yAxis, fc.chartCanvasCartesian, true);\n\nconst chartFactory = (xAxis, yAxis, cartesian, canvas) => {\n    let axisSplitter = null;\n    let altAxis = null;\n\n    const chart = cartesian({\n        xScale: xAxis.scale,\n        yScale: yAxis.scale,\n        xAxis: xAxis.component,\n        yAxis: yAxis.component\n    })\n        .xDomain(xAxis.domain)\n        .xLabel(xAxis.label)\n        .xAxisHeight(xAxis.size)\n        .xDecorate(xAxis.decorate)\n        .xTickFormat(xAxis.tickFormatFunction)\n        .yDomain(yAxis.domain)\n        .yLabel(yAxis.label)\n        .yAxisWidth(yAxis.size)\n        .yDecorate(yAxis.decorate)\n        .yOrient(\"left\")\n        .yTickFormat(yAxis.tickFormatFunction);\n\n    if (xAxis.decorate) chart.xDecorate(xAxis.decorate);\n    if (yAxis.decorate) chart.yDecorate(yAxis.decorate);\n\n    // Padding defaults can be overridden\n    chart.xPaddingInner && chart.xPaddingInner(1);\n    chart.xPaddingOuter && chart.xPaddingOuter(0.5);\n    chart.yPaddingInner && chart.yPaddingInner(1);\n    chart.yPaddingOuter && chart.yPaddingOuter(0.5);\n\n    chart.axisSplitter = (...args) => {\n        if (!args.length) {\n            return axisSplitter;\n        }\n        axisSplitter = args[0];\n        return chart;\n    };\n\n    chart.altAxis = (...args) => {\n        if (!args.length) {\n            return altAxis;\n        }\n        altAxis = args[0];\n        return chart;\n    };\n\n    const oldDecorate = chart.decorate();\n    chart.decorate((container, data) => {\n        const plotArea = container.select(\"d3fc-svg.plot-area\");\n\n        plotArea\n            .select(\"svg\")\n            .node()\n            .setAttribute(\"viewBox\", `0 0 ${plotArea.node().clientWidth} ${plotArea.node().clientHeight}`);\n\n        oldDecorate(container, data);\n        if (!axisSplitter) return;\n\n        if (axisSplitter.haveSplit()) {\n            // Render a second axis on the right of the chart\n            const altData = axisSplitter.altData();\n\n            const y2AxisDataJoin = fc.dataJoin(\"d3fc-svg\", \"y2-axis\").key(d => d);\n            const ySeriesDataJoin = fc.dataJoin(\"g\", \"y-series\").key(d => d);\n\n            // Column 5 of the grid\n            container\n                .enter()\n                .append(\"div\")\n                .attr(\"class\", \"y2-label-container\")\n                .style(\"grid-column\", 5)\n                .style(\"-ms-grid-column\", 5)\n                .style(\"grid-row\", 3)\n                .style(\"-ms-grid-row\", 3)\n                .style(\"width\", altAxis.size || \"1em\")\n                .style(\"display\", \"flex\")\n                .style(\"align-items\", \"center\")\n                .style(\"justify-content\", \"center\")\n                .append(\"div\")\n                .attr(\"class\", \"y-label\")\n                .style(\"transform\", \"rotate(-90deg)\");\n\n            const y2Scale = altAxis.scale.domain(altAxis.domain);\n            const yAxisComponent = altAxis.component.right(y2Scale);\n            yAxisComponent.tickFormat(altAxis.tickFormatFunction);\n            if (altAxis.decorate) yAxisComponent.decorate(altAxis.decorate);\n\n            // Render the axis\n            y2AxisDataJoin(container, [\"right\"])\n                .attr(\"class\", d => `y-axis ${d}-axis`)\n                .on(\"measure\", (d, i, nodes) => {\n                    const {width, height} = d3.event.detail;\n                    if (d === \"left\") {\n                        d3.select(nodes[i])\n                            .select(\"svg\")\n                            .attr(\"viewBox\", `${-width} 0 ${width} ${height}`);\n                    }\n                    y2Scale.range([height, 0]);\n                })\n                .on(\"draw\", (d, i, nodes) => {\n                    d3.select(nodes[i])\n                        .select(\"svg\")\n                        .call(yAxisComponent);\n                });\n\n            // Render all the series using either the primary or alternate\n            // y-scales\n            if (canvas) {\n                const drawMultiCanvasSeries = selection => {\n                    const canvasPlotArea = chart.plotArea();\n                    canvasPlotArea.context(selection.node().getContext(\"2d\")).xScale(xAxis.scale);\n\n                    const yScales = [yAxis.scale, y2Scale];\n                    [data, altData].forEach((d, i) => {\n                        canvasPlotArea.yScale(yScales[i]);\n                        canvasPlotArea(d);\n                    });\n                };\n\n                container.select(\"d3fc-canvas.plot-area\").on(\"draw\", (d, i, nodes) => {\n                    drawMultiCanvasSeries(d3.select(nodes[i]).select(\"canvas\"));\n                });\n            } else {\n                const drawMultiSvgSeries = selection => {\n                    const svgPlotArea = chart.plotArea();\n                    svgPlotArea.xScale(xAxis.scale);\n\n                    const yScales = [yAxis.scale, y2Scale];\n                    ySeriesDataJoin(selection, [data, altData]).each((d, i, nodes) => {\n                        svgPlotArea.yScale(yScales[i]);\n                        d3.select(nodes[i])\n                            .datum(d)\n                            .call(svgPlotArea);\n                    });\n                };\n\n                container.select(\"d3fc-svg.plot-area\").on(\"draw\", (d, i, nodes) => {\n                    drawMultiSvgSeries(d3.select(nodes[i]).select(\"svg\"));\n                });\n            }\n        }\n\n        // Render any UI elements the splitter component requires\n        axisSplitter(container);\n    });\n\n    return chart;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport function areArraysEqualSimple(arr1, arr2) {\n    return JSON.stringify(arr1) === JSON.stringify(arr2);\n}\n\nexport function getOrCreateElement(container, selector, createCallback) {\n    let element = container.select(selector);\n    return element.size() > 0 ? element : createCallback();\n}\n\nexport function isElementOverflowing(containerRect, innerElementRect, direction = \"right\") {\n    if (direction === \"right\" || direction === \"bottom\") {\n        return containerRect[direction] < innerElementRect[direction] ? true : false;\n    }\n\n    if (direction === \"left\" || direction === \"top\") {\n        return containerRect[direction] > innerElementRect[direction] ? true : false;\n    }\n\n    throw `Direction being checked for overflow is invalid: ${direction}`;\n}\n\nexport function isElementOverlapping(axis, immovableRect, elementRect, fuzz = 0) {\n    const dimension = axis === \"x\" ? \"width\" : \"height\";\n\n    const immovableInnerPoint = immovableRect[axis];\n    const immovableOuterPoint = immovableRect[axis] + immovableRect[dimension];\n\n    const elementInnerPoint = elementRect[axis];\n    const elementOuterPoint = elementRect[axis] + elementRect[dimension];\n\n    const innerPointInside = elementInnerPoint + fuzz > immovableInnerPoint && elementInnerPoint - fuzz < immovableOuterPoint;\n    const outerPointInside = elementOuterPoint + fuzz > immovableInnerPoint && elementOuterPoint - fuzz < immovableOuterPoint;\n    const pointsEitherSide = elementInnerPoint + fuzz < immovableInnerPoint && elementOuterPoint - fuzz > immovableOuterPoint;\n\n    return innerPointInside || outerPointInside || pointsEitherSide;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\n\nexport function toValue(type, value) {\n    switch (type) {\n        case \"date\":\n        case \"datetime\":\n            return value instanceof Date ? value : new Date(parseInt(value)).toLocaleString(\"en-us\", get_type_config(type).format);\n        case \"integer\":\n            return parseInt(value, 10);\n        case \"float\":\n            return parseFloat(value);\n    }\n    return value;\n}\n\nexport function getGroupValues(data, settings) {\n    if (settings.crossValues.length === 0) return [];\n    const groupValues = (data.crossValue.split ? data.crossValue.split(\"|\") : [data.crossValue]) || [data.key];\n    return groupValues.map((cross, i) => ({\n        name: settings.crossValues[i].name,\n        value: toValue(settings.crossValues[i].type, cross)\n    }));\n}\n\nexport function getSplitValues(data, settings) {\n    if (settings.splitValues.length === 0) return [];\n    const splitValues = data.key ? data.key.split(\"|\") : data.mainValue.split ? data.mainValue.split(\"|\") : [data.mainValue];\n    return settings.splitValues.map((split, i) => ({\n        name: split.name,\n        value: toValue(split.type, splitValues[i])\n    }));\n}\n\nexport function getDataValues(data, settings) {\n    if (settings.mainValues.length > 1) {\n        if (data.mainValue) {\n            return [\n                {\n                    name: data.key,\n                    value: data.mainValue - (data.baseValue || 0)\n                }\n            ];\n        }\n        return settings.mainValues.map((main, i) => ({\n            name: main.name,\n            value: toValue(main.type, data.mainValues[i])\n        }));\n    }\n    return [\n        {\n            name: settings.mainValues[0].name,\n            value: toValue(settings.mainValues[0].type, data.colorValue || data.mainValue - data.baseValue || data.mainValue || data.mainValues)\n        }\n    ];\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {select} from \"d3\";\nimport {getGroupValues, getSplitValues, getDataValues} from \"./selectionData\";\nimport {get_type_config} from \"@finos/perspective/dist/esm/config\";\n\nexport function generateHtml(tooltipDiv, data, settings) {\n    const tooltipValues = getGroupValues(data, settings)\n        .concat(getSplitValues(data, settings))\n        .concat(getDataValues(data, settings));\n    addDataValues(tooltipDiv, tooltipValues);\n}\n\nfunction addDataValues(tooltipDiv, values) {\n    tooltipDiv\n        .select(\"#tooltip-values\")\n        .selectAll(\"li\")\n        .data(values)\n        .join(\"li\")\n        .each(function(d) {\n            select(this)\n                .text(`${d.name}: `)\n                .append(\"b\")\n                .text(formatNumber(d.value));\n        });\n}\n\nconst formatNumber = value =>\n    value.toLocaleString(undefined, {\n        style: \"decimal\",\n        minimumFractionDigits: get_type_config(\"float\").precision,\n        maximumFractionDigits: get_type_config(\"float\").precision\n    });\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {getGroupValues, getSplitValues, getDataValues} from \"./selectionData\";\n\nconst mapToFilter = d => [d.name, \"==\", d.value];\n\nexport const raiseEvent = (node, data, settings) => {\n    const column_names = getDataValues(data, settings).map(d => d.name);\n    const groupFilters = getGroupValues(data, settings).map(mapToFilter);\n    const splitFilters = getSplitValues(data, settings).map(mapToFilter);\n\n    const filters = settings.filter.concat(groupFilters).concat(splitFilters);\n\n    node.dispatchEvent(\n        new CustomEvent(\"perspective-click\", {\n            bubbles: true,\n            composed: true,\n            detail: {\n                column_names,\n                config: {filters},\n                row: data.row\n            }\n        })\n    );\n};\n\nexport const selectionEvent = () => {\n    let settings = null;\n\n    const _event = selection => {\n        const node = selection.node();\n        selection.on(\"click\", data => raiseEvent(node, data, settings));\n    };\n\n    _event.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _event;\n    };\n\n    return _event;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {getChartContainer} from \"../plugin/root\";\nimport {getOrCreateElement, isElementOverflowing} from \"../utils/utils\";\nimport tooltipTemplate from \"../../html/tooltip.html\";\nimport {generateHtml} from \"./generateHTML\";\nimport {selectionEvent} from \"./selectionEvent\";\n\nexport const tooltip = () => {\n    let alwaysShow = false;\n    let tooltipDiv = null;\n    let settings = null;\n    let centered = false;\n\n    const _tooltip = selection => {\n        const node = selection.node();\n\n        if (!node || !node.isConnected) {\n            hideTooltip(tooltipDiv);\n            return;\n        }\n\n        const container = select(getChartContainer(node));\n        tooltipDiv = getTooltipDiv(container);\n\n        const showTip = (data, i, nodes) => {\n            generateHtml(tooltipDiv, data, settings);\n            showTooltip(container.node(), nodes[i], tooltipDiv, centered);\n            select(nodes[i]).style(\"opacity\", \"0.7\");\n        };\n        const hideTip = (data, i, nodes) => {\n            hideTooltip(tooltipDiv);\n            if (nodes) select(nodes[i]).style(\"opacity\", \"1\");\n        };\n\n        if (alwaysShow) {\n            selection.each(showTip);\n        } else {\n            selection.on(\"mouseover\", showTip).on(\"mouseout\", hideTip);\n            selectionEvent().settings(settings)(selection);\n        }\n    };\n\n    _tooltip.alwaysShow = (...args) => {\n        if (!args.length) {\n            return alwaysShow;\n        }\n        alwaysShow = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.centered = (...args) => {\n        if (!args.length) {\n            return centered;\n        }\n        centered = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _tooltip;\n    };\n\n    return _tooltip;\n};\n\nfunction getTooltipDiv(container) {\n    return getOrCreateElement(container, \"div.tooltip\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"tooltip\")\n            .style(\"z-index\", 3)\n            .style(\"opacity\", 0)\n            .html(tooltipTemplate)\n    );\n}\n\nfunction showTooltip(containerNode, node, tooltipDiv, centered) {\n    const containerRect = containerNode.getBoundingClientRect();\n    const rect = node.getBoundingClientRect();\n\n    let left = rect.left + rect.width / 2 - containerRect.left;\n    let top = rect.top - containerRect.top + containerNode.scrollTop;\n\n    if (centered) top = rect.top + rect.height / 2 - containerRect.top + containerNode.scrollTop;\n\n    tooltipDiv\n        .style(\"left\", `${left}px`)\n        .style(\"top\", `${top}px`)\n        // .transition()\n        // .duration(200)\n        .style(\"opacity\", 0.9);\n\n    if (centered) [left, top] = centerTip(tooltipDiv, containerRect);\n\n    shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered);\n}\n\nfunction centerTip(tooltipDiv, containerRect) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    const leftAdjust = tooltipDivRect.width / 2;\n    const newLeft = tooltipDivRect.left - leftAdjust - containerRect.left;\n    tooltipDiv.style(\"left\", `${newLeft}px`);\n\n    const topAdjust = tooltipDivRect.height / 2;\n    const newTop = tooltipDivRect.top - topAdjust - containerRect.top;\n    tooltipDiv.style(\"top\", `${newTop}px`);\n    return [newLeft, newTop];\n}\n\nfunction shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered = false) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    if (isElementOverflowing(containerRect, tooltipDivRect)) {\n        const leftAdjust = tooltipDivRect.right - containerRect.right;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"bottom\")) {\n        const topAdjust = tooltipDivRect.bottom - containerRect.bottom;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n\n    if (!centered) return;\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"left\")) {\n        const leftAdjust = tooltipDivRect.left - containerRect.left;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"top\")) {\n        const topAdjust = tooltipDivRect.top - containerRect.top;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n}\n\nfunction hideTooltip(tooltipDiv) {\n    if (tooltipDiv) {\n        tooltipDiv\n            // .transition()\n            // .duration(500)\n            .style(\"opacity\", 0);\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {tooltip} from \"../tooltip/tooltip\";\n\nexport function barSeries(settings, color) {\n    let series = settings.mainValues.length > 1 ? fc.seriesSvgGrouped(fc.seriesSvgBar()) : fc.seriesSvgBar();\n\n    series = series.decorate(selection => {\n        tooltip().settings(settings)(selection);\n        selection.style(\"fill\", d => color(d.key));\n    });\n\n    return fc\n        .autoBandwidth(minBandwidth(series))\n        .crossValue(d => d.crossValue)\n        .mainValue(d => d.mainValue)\n        .baseValue(d => d.baseValue);\n}\n\nconst minBandwidth = adaptee => {\n    const min = arg => {\n        return adaptee(arg);\n    };\n\n    fc.rebindAll(min, adaptee);\n\n    min.bandwidth = (...args) => {\n        if (!args.length) {\n            return adaptee.bandwidth();\n        }\n        adaptee.bandwidth(Math.max(args[0], 1));\n        return min;\n    };\n\n    return min;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport function groupFromKey(key) {\n    return key\n        .split(\"|\")\n        .slice(0, -1)\n        .join(\"|\");\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport {groupFromKey} from \"./seriesKey\";\n\nexport function seriesColors(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = Object.keys(col).filter(k => k !== \"__ROW_PATH__\");\n    return colorScale()\n        .settings(settings)\n        .domain(domain)();\n}\n\nexport function seriesColorsFromDistinct(settings, data) {\n    let domain = Array.from(new Set(data));\n    return colorScale()\n        .settings(settings)\n        .domain(domain)();\n}\n\nexport function seriesColorsFromGroups(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = [];\n    Object.keys(col).forEach(key => {\n        if (key !== \"__ROW_PATH__\") {\n            const group = groupFromKey(key);\n            if (!domain.includes(group)) {\n                domain.push(group);\n            }\n        }\n    });\n    return colorScale()\n        .settings(settings)\n        .domain(domain)();\n}\n\nexport function colorScale() {\n    let domain = null;\n    let defaultColors = null;\n    let settings = {};\n    let mapFunction = d => withOpacity(d, settings.colorStyles && settings.colorStyles.opacity);\n\n    const colors = () => {\n        const styles = settings.colorStyles;\n        const defaults = defaultColors || [styles.series];\n        if (defaults || domain.length > 1) {\n            const range = domain.length > 1 ? styles.scheme : defaults;\n            return d3.scaleOrdinal(range.map(mapFunction)).domain(domain);\n        }\n        return null;\n    };\n\n    colors.domain = (...args) => {\n        if (!args.length) {\n            return domain;\n        }\n        domain = args[0];\n        return colors;\n    };\n\n    colors.defaultColors = (...args) => {\n        if (!args.length) {\n            return defaultColors;\n        }\n        defaultColors = args[0];\n        return colors;\n    };\n\n    colors.mapFunction = (...args) => {\n        if (!args.length) {\n            return mapFunction;\n        }\n        mapFunction = args[0];\n        return colors;\n    };\n\n    colors.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return colors;\n    };\n\n    return colors;\n}\n\nexport function withoutOpacity(color) {\n    return setOpacity(1)(color);\n}\n\nexport function withOpacity(color, opacity = 0.5) {\n    return setOpacity(opacity)(color);\n}\n\nexport function setOpacity(opacity) {\n    return color => {\n        const decoded = d3.color(color);\n        decoded.opacity = opacity;\n        return decoded + \"\";\n    };\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {rebindAll} from \"d3fc\";\nimport {axisType} from \"./axisType\";\nimport {labelFunction as noLabel} from \"./noAxis\";\nimport {labelFunction as timeLabel} from \"./timeAxis\";\nimport {labelFunction as linearLabel} from \"./linearAxis\";\nimport {labelFunction as ordinalLabel} from \"./ordinalAxis\";\n\nconst labelFunctions = {\n    none: noLabel,\n    ordinal: ordinalLabel,\n    time: timeLabel,\n    linear: linearLabel\n};\n\nexport const labelFunction = settings => {\n    const base = axisType(settings);\n    let valueName = \"__ROW_PATH__\";\n\n    const label = (d, i) => {\n        return labelFunctions[base()](valueName)(d, i);\n    };\n\n    rebindAll(label, base);\n\n    label.valueName = (...args) => {\n        if (!args.length) {\n            return valueName;\n        }\n        valueName = args[0];\n        return label;\n    };\n\n    return label;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport function splitIntoMultiSeries(settings, data, {stack = false, excludeEmpty = false} = {}) {\n    const useData = data || settings.data;\n\n    if (settings.splitValues.length > 0) {\n        return splitByValuesIntoMultiSeries(settings, useData, {stack, excludeEmpty});\n    }\n    return [useData];\n}\n\nfunction splitByValuesIntoMultiSeries(settings, data, {stack = false, excludeEmpty = false}) {\n    // Create a series for each \"split\" value, each one containing all the\n    // \"aggregate\" values, and \"base\" values to offset it from the previous\n    // series\n    const multiSeries = {};\n\n    data.forEach(col => {\n        // Split this column by \"split\", including multiple aggregates for each\n        const baseValues = {};\n        const split = {};\n\n        // Keys are of the form \"split1|split2|aggregate\"\n        Object.keys(col)\n            .filter(key => key !== \"__ROW_PATH__\")\n            .filter(key => !excludeEmpty || (col[key] != null && col[key] != undefined))\n            .forEach(key => {\n                const labels = key.split(\"|\");\n                // label=\"aggregate\"\n                const label = labels[labels.length - 1];\n                const value = col[key] || 0;\n                const baseKey = `${label}${value >= 0 ? \"+ve\" : \"-ve\"}`;\n                // splitName=\"split1|split2\"\n                const splitName = labels.slice(0, labels.length - 1).join(\"|\");\n\n                // Combine aggregate values for the same split in a single\n                // object\n                const splitValues = (split[splitName] = split[splitName] || {__ROW_PATH__: col.__ROW_PATH__});\n                const baseValue = baseValues[baseKey] || 0;\n\n                splitValues.__KEY__ = splitName;\n\n                // Assign the values for this split/aggregate\n                if (stack) {\n                    splitValues[label] = baseValue + value;\n                    splitValues[`__BASE_VALUE__${label}`] = baseValue;\n                    baseValues[baseKey] = splitValues[label];\n                } else {\n                    splitValues[label] = value;\n                }\n                splitValues.row = col;\n            });\n\n        // Push each object onto the correct series\n        Object.keys(split).forEach(splitName => {\n            const series = (multiSeries[splitName] = multiSeries[splitName] || []);\n            series.push(split[splitName]);\n        });\n    });\n\n    return Object.keys(multiSeries).map(k => {\n        const series = multiSeries[k];\n        series.key = k;\n        return series;\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\n\nexport function groupData(settings, data) {\n    const stack = {stack: false};\n    const groupedSeries = splitIntoMultiSeries(settings, data, stack).map(data => groupPointDataByMainValue(settings, data, stack));\n\n    if (settings.mainValues.length > 1) {\n        const flattenedSeries = groupedSeries.reduce((a, b) => a.concat(b));\n        return flattenedSeries;\n    }\n\n    return groupedSeries;\n}\n\nexport function groupAndStackData(settings, data) {\n    const stack = {stack: true};\n    return splitIntoMultiSeries(settings, data, stack).map(data => groupPointDataByMainValue(settings, data, stack));\n}\n\nfunction seriesDataFn(settings, data, {stack = false}) {\n    const labelfn = labelFunction(settings);\n\n    return mainValue => {\n        const baseValue = col => (stack ? col[`__BASE_VALUE__${mainValue.name}`] || 0 : 0);\n        const series = data.map((col, i) => ({\n            crossValue: labelfn(col, i),\n            mainValue: !!col[mainValue.name] ? col[mainValue.name] : null,\n            baseValue: baseValue(col),\n            key: col.__KEY__ ? `${col.__KEY__}|${mainValue.name}` : mainValue.name,\n            row: col.row || col\n        }));\n        series.key = series[0].key;\n        return series;\n    };\n}\n\nfunction groupPointDataByMainValue(settings, data, {stack = false}) {\n    // Split data into a group for each aggregate (mainValue)\n    const seriesFn = seriesDataFn(settings, data, {stack});\n\n    if (settings.mainValues.length > 1) {\n        return settings.mainValues.map(seriesFn);\n    } else {\n        return seriesFn(settings.mainValues[0]);\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {isElementOverflowing} from \"../../utils/utils\";\nimport {getChartElement} from \"../../plugin/root\";\n\nexport const margin = 10;\n\nexport function enforceContainerBoundaries(innerNode, offsetX, offsetY) {\n    const chartNodeRect = d3\n        .select(getChartElement(innerNode).getContainer())\n        .node()\n        .getBoundingClientRect();\n\n    const innerNodeRect = innerNode.getBoundingClientRect();\n\n    const draggedInnerNodeRect = {\n        top: innerNodeRect.top + offsetY - margin,\n        right: innerNodeRect.right + offsetX + margin,\n        bottom: innerNodeRect.bottom + offsetY + margin,\n        left: innerNodeRect.left + offsetX - margin\n    };\n\n    const adjustedOffsets = {x: offsetX, y: offsetY};\n    const boundaries = [\n        {edge: \"right\", dimension: \"x\"},\n        {edge: \"left\", dimension: \"x\"},\n        {edge: \"top\", dimension: \"y\"},\n        {edge: \"bottom\", dimension: \"y\"}\n    ];\n\n    boundaries.forEach(bound => {\n        if (isElementOverflowing(chartNodeRect, draggedInnerNodeRect, bound.edge)) {\n            const adjustment = draggedInnerNodeRect[bound.edge] - chartNodeRect[bound.edge];\n            adjustedOffsets[bound.dimension] = adjustedOffsets[bound.dimension] - adjustment;\n        }\n    });\n\n    return adjustedOffsets;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {getChartContainer} from \"../../plugin/root\";\nimport {enforceContainerBoundaries, margin} from \"./enforceContainerBoundaries\";\n\nconst resizeForDraggingEvent = \"resize.for-dragging\";\n\nexport function draggableComponent() {\n    let pinned = true;\n    let settings = null;\n\n    const draggable = element => {\n        const node = element.node();\n        node.style.cursor = \"move\";\n        if (settings.legend) {\n            node.style.left = settings.legend.left;\n            node.style.top = settings.legend.top;\n        }\n\n        const drag = d3.drag().on(\"drag\", function() {\n            const offsets = enforceContainerBoundaries(this, d3.event.dx, d3.event.dy);\n            this.style.left = `${this.offsetLeft + offsets.x}px`;\n            this.style.top = `${this.offsetTop + offsets.y}px`;\n            const position = {\n                left: this.style.left,\n                top: this.style.top\n            };\n            settings.legend = {...settings.legend, ...position};\n\n            if (isNodeInTopRight(node)) {\n                pinned = pinNodeToTopRight(node);\n                return;\n            }\n\n            pinned = unpinNodeFromTopRight(node, pinned);\n        });\n\n        element.call(drag);\n    };\n\n    draggable.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return draggable;\n    };\n\n    return draggable;\n}\n\nfunction unpinNodeFromTopRight(node, pinned) {\n    if (pinned !== false) {\n        // Default behaviour for the legend is to remain pinned to the top right\n        // hand corner with a specific margin. Once the legend has moved we\n        // cannot continue to use that css based approach.\n        d3.select(window).on(resizeForDraggingEvent, function() {\n            const offsets = enforceContainerBoundaries(node, 0, 0);\n            node.style.left = `${node.offsetLeft + offsets.x}px`;\n            node.style.top = `${node.offsetTop + offsets.y}px`;\n        });\n    }\n    return false;\n}\n\nfunction pinNodeToTopRight(node) {\n    d3.select(window).on(resizeForDraggingEvent, null);\n    node.style.left = \"auto\";\n    return true;\n}\n\nfunction isNodeInTopRight(node) {\n    const nodeRect = node.getBoundingClientRect();\n    const containerRect = d3\n        .select(getChartContainer(node))\n        .node()\n        .getBoundingClientRect();\n\n    const fuzz = 5;\n\n    return nodeRect.right + margin + fuzz >= containerRect.right && nodeRect.top - margin - fuzz <= containerRect.top;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {enforceContainerBoundaries} from \"./enforceContainerBoundaries\";\n\nconst horizontalHandleClass = \"horizontal-drag-handle\";\nconst verticalHandleClass = \"vertical-drag-handle\";\nconst cornerHandleClass = \"corner-drag-handle\";\n\nconst handlesContainerId = \"dragHandles\";\n\nconst fillOpacity = 0.0;\nconst resizeEvent = \"resize\";\n\nexport function resizableComponent() {\n    let handleWidthPx = 9;\n    let zIndex = 3;\n    let settings = null;\n    const minDimensionsPx = {height: 100, width: 100};\n    const maxDimensionsPx = {height: null, width: null};\n\n    const callbacks = [];\n    const executeCallbacks = (event, direction) => callbacks.filter(callback => callback.event === event).forEach(callback => callback.execute(direction));\n\n    const resizable = container => {\n        if (handlesContainerExists(container)) {\n            return;\n        }\n\n        const dragHelper = {\n            left: () => executeCallbacks(resizeEvent, {horizontal: dragLeft(d3.event), vertical: false}),\n            top: () => executeCallbacks(resizeEvent, {horizontal: false, vertical: dragTop(d3.event)}),\n            right: () => executeCallbacks(resizeEvent, {horizontal: dragRight(d3.event), vertical: false}),\n            bottom: () => executeCallbacks(resizeEvent, {horizontal: false, vertical: dragBottom(d3.event)}),\n            topleft: () => executeCallbacks(resizeEvent, {horizontal: dragLeft(d3.event), vertical: dragTop(d3.event)}),\n            topright: () => executeCallbacks(resizeEvent, {horizontal: dragRight(d3.event), vertical: dragTop(d3.event)}),\n            bottomright: () => executeCallbacks(resizeEvent, {horizontal: dragRight(d3.event), vertical: dragBottom(d3.event)}),\n            bottomleft: () => executeCallbacks(resizeEvent, {horizontal: dragLeft(d3.event), vertical: dragBottom(d3.event)})\n        };\n\n        const containerNode = container.node();\n        if (settings.legend) {\n            containerNode.style.height = settings.legend.height;\n            containerNode.style.width = settings.legend.width;\n        }\n\n        const containerRect = containerNode.getBoundingClientRect();\n        const handles = container\n            .append(\"svg\")\n            .attr(\"id\", handlesContainerId)\n            .attr(\"width\", containerRect.width)\n            .attr(\"height\", containerRect.height);\n        const handlesGroup = handles.append(\"g\");\n\n        const isVertical = d => d === \"left\" || d === \"right\";\n        const xCoordHelper = {left: 0, top: handleWidthPx, right: containerRect.width - handleWidthPx, bottom: handleWidthPx};\n        const yCoordHelper = {left: handleWidthPx, top: 0, right: handleWidthPx, bottom: containerRect.height - handleWidthPx};\n        const edgeHandles = [\"left\", \"top\", \"right\", \"bottom\"];\n        const [leftHandle, topHandle, rightHandle, bottomHandle] = edgeHandles.map(edge =>\n            handlesGroup\n                .append(\"rect\")\n                .attr(\"id\", `drag${edge}`)\n                .attr(\"class\", isVertical(edge) ? verticalHandleClass : horizontalHandleClass)\n                .attr(\"y\", yCoordHelper[edge])\n                .attr(\"x\", xCoordHelper[edge])\n                .attr(\"height\", isVertical(edge) ? containerRect.height - handleWidthPx * 2 : handleWidthPx)\n                .attr(\"width\", isVertical(edge) ? handleWidthPx : containerRect.width - handleWidthPx * 2)\n                .attr(\"fill\", isVertical(edge) ? \"lightgreen\" : \"lightblue\")\n                .attr(\"fill-opacity\", fillOpacity)\n                .style(\"z-index\", zIndex)\n                .attr(\"cursor\", isVertical(edge) ? \"ew-resize\" : \"ns-resize\")\n                .call(d3.drag().on(\"drag\", dragHelper[edge]))\n        );\n\n        const concatCornerEdges = corner => `${corner[0]}${corner[1]}`;\n        const cornerCursorHelper = {topleft: \"nwse\", topright: \"nesw\", bottomright: \"nwse\", bottomleft: \"nesw\"};\n        const cornerHandles = [\n            [\"top\", \"left\"],\n            [\"top\", \"right\"],\n            [\"bottom\", \"right\"],\n            [\"bottom\", \"left\"]\n        ];\n        const [topLeftHandle, topRightHandle, bottomRightHandle, bottomLeftHandle] = cornerHandles.map(corner =>\n            handlesGroup\n                .append(\"rect\")\n                .attr(\"id\", `drag${concatCornerEdges(corner)}`)\n                .attr(\"class\", `${cornerHandleClass} ${corner[0]} ${corner[1]}`)\n                .attr(\"height\", handleWidthPx)\n                .attr(\"width\", handleWidthPx)\n                .attr(\"fill\", \"red\")\n                .attr(\"fill-opacity\", fillOpacity)\n                .style(\"z-index\", zIndex)\n                .attr(\"cursor\", `${cornerCursorHelper[concatCornerEdges(corner)]}-resize`)\n                .call(d3.drag().on(\"drag\", dragHelper[concatCornerEdges(corner)]))\n        );\n\n        enforceMaxDimensions(\"height\", \"y\", bottomHandle);\n        enforceMaxDimensions(\"width\", \"x\", rightHandle);\n        pinCorners(handles);\n\n        function dragLeft(event) {\n            const offset = enforceDistToParallelBarConstraints(enforceContainerBoundaries(leftHandle.node(), event.x, 0).x, handles, \"width\", (x, y) => x - y);\n            containerNode.style.left = `${containerNode.offsetLeft + offset}px`;\n            containerNode.style.width = `${containerNode.offsetWidth - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(rightHandle, offset, \"width\", \"x\");\n        }\n\n        function dragRight(event) {\n            const offset = -enforceDistToParallelBarConstraints(enforceContainerBoundaries(rightHandle.node(), event.dx, 0).x, handles, \"width\", (x, y) => x + y);\n            if (pointerFallenBehindAbsoluteCoordinates(offset, \"x\", rightHandle, event)) return false;\n            containerNode.style.width = `${containerNode.offsetWidth - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(rightHandle, offset, \"width\", \"x\");\n        }\n\n        function dragTop(event) {\n            const offset = enforceDistToParallelBarConstraints(enforceContainerBoundaries(topHandle.node(), 0, event.y).y, handles, \"height\", (x, y) => x - y);\n            containerNode.style.top = `${containerNode.offsetTop + offset}px`;\n            containerNode.style.height = `${containerNode.offsetHeight - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(bottomHandle, offset, \"height\", \"y\");\n        }\n\n        function dragBottom(event) {\n            const offset = -enforceDistToParallelBarConstraints(enforceContainerBoundaries(bottomHandle.node(), 0, event.dy).y, handles, \"height\", (x, y) => x + y);\n            if (pointerFallenBehindAbsoluteCoordinates(offset, \"y\", bottomHandle, event)) return false;\n            containerNode.style.height = `${containerNode.offsetHeight - offset}px`;\n            updateSettings();\n            return resizeAndRelocateHandles(bottomHandle, offset, \"height\", \"y\");\n        }\n\n        function updateSettings() {\n            const dimensions = {\n                top: containerNode.style.top,\n                left: containerNode.style.left,\n                height: containerNode.style.height,\n                width: containerNode.style.width\n            };\n            settings.legend = {...settings.legend, ...dimensions};\n        }\n\n        function resizeAndRelocateHandles(handle, offset, dimension, axis) {\n            extendHandlesBox(handles, dimension, offset);\n            pinHandleToHandleBoxEdge(handle, axis, offset);\n            extendPerpendicularHandles(handles, offset, dimension, dimension === \"height\" ? verticalHandleClass : horizontalHandleClass);\n            pinCorners(handles);\n            return offset != 0;\n        }\n\n        function pinCorners(handles) {\n            topLeftHandle.attr(\"y\", 0, \"x\", 0);\n            topRightHandle.attr(\"y\", 0).attr(\"x\", handles.attr(\"width\") - handleWidthPx);\n            bottomRightHandle.attr(\"y\", handles.attr(\"height\") - handleWidthPx).attr(\"x\", handles.attr(\"width\") - handleWidthPx);\n            bottomLeftHandle.attr(\"y\", handles.attr(\"height\") - handleWidthPx).attr(\"x\", 0);\n        }\n\n        function enforceMaxDimensions(dimension, axis, relativeHandle) {\n            if (!!maxDimensionsPx[dimension] && maxDimensionsPx[dimension] < containerRect[dimension]) {\n                containerNode.style[dimension] = `${maxDimensionsPx[dimension]}px`;\n                resizeAndRelocateHandles(relativeHandle, containerRect[dimension] - maxDimensionsPx[dimension], dimension, axis);\n            }\n        }\n    };\n\n    resizable.on = (event, callback) => {\n        callbacks.push({event: event, execute: callback});\n        return resizable;\n    };\n\n    resizable.zIndex = input => {\n        zIndex = input;\n        return resizable;\n    };\n\n    resizable.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return resizable;\n    };\n\n    resizable.minWidth = input => {\n        minDimensionsPx.width = input;\n        if (!!maxDimensionsPx.width) maxDimensionsPx.width = Math.max(minDimensionsPx.width, maxDimensionsPx.width);\n        return resizable;\n    };\n\n    resizable.minHeight = input => {\n        minDimensionsPx.height = input;\n        if (!!maxDimensionsPx.height) maxDimensionsPx.height = Math.max(minDimensionsPx.height, maxDimensionsPx.height);\n        return resizable;\n    };\n\n    resizable.handleWidth = input => {\n        handleWidthPx = input;\n        return resizable;\n    };\n\n    resizable.maxWidth = input => {\n        maxDimensionsPx.width = input;\n        minDimensionsPx.width = Math.min(minDimensionsPx.width, maxDimensionsPx.width);\n        return resizable;\n    };\n\n    resizable.maxHeight = input => {\n        maxDimensionsPx.height = input;\n        minDimensionsPx.height = Math.min(minDimensionsPx.height, maxDimensionsPx.height);\n        return resizable;\n    };\n\n    function pointerFallenBehindAbsoluteCoordinates(offset, axis, handle, event) {\n        const becauseCrossedMinSize = (offset, axis, handle, event) => offset < 0 && event[axis] < Number(handle.attr(axis));\n        const becauseExitedCoordinateSpace = (offset, axis, handle, event) => offset > 0 && event[axis] > Number(handle.attr(axis));\n        return becauseCrossedMinSize(offset, axis, handle, event) || becauseExitedCoordinateSpace(offset, axis, handle, event);\n    }\n\n    function enforceDistToParallelBarConstraints(offset, dragHandleContainer, dimension, operatorFunction) {\n        const anticipatedDimension = operatorFunction(Number(dragHandleContainer.attr(dimension)), offset);\n        if (anticipatedDimension < minDimensionsPx[dimension]) {\n            const difference = minDimensionsPx[dimension] - anticipatedDimension;\n            return operatorFunction(offset, difference);\n        }\n        if (!!maxDimensionsPx[dimension] && anticipatedDimension > maxDimensionsPx[dimension]) {\n            const difference = maxDimensionsPx[dimension] - anticipatedDimension;\n            return operatorFunction(offset, difference);\n        }\n        return offset;\n    }\n\n    return resizable;\n}\n\n// \"dimension\" referring to width or height\nconst extendPerpendicularHandles = (handles, offset, dimension, orientationClass) => {\n    const perpendicularHandles = handles.selectAll(`.${orientationClass}`);\n    perpendicularHandles.each((_, i, nodes) => {\n        const handleNode = nodes[i];\n        const handleElement = d3.select(handleNode);\n        handleElement.attr(dimension, handleNode.getBoundingClientRect()[dimension] - offset);\n    });\n};\n\nconst handlesContainerExists = container => container.select(`#${handlesContainerId}`).size() > 0;\n\nconst pinHandleToHandleBoxEdge = (handle, axis, offset) => handle.attr(axis, Number(handle.attr(axis)) - offset);\n\nconst extendHandlesBox = (handles, dimension, offset) => handles.attr(dimension, handles.node().getBoundingClientRect()[dimension] - offset);\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3Legend from \"d3-svg-legend\";\nimport {rebindAll} from \"d3fc\";\nimport {getOrCreateElement} from \"../utils/utils\";\nimport legendControlsTemplate from \"../../html/legend-controls.html\";\nimport {cropCellContents} from \"./styling/cropCellContents\";\nimport {draggableComponent} from \"./styling/draggableComponent\";\nimport {resizableComponent} from \"./styling/resizableComponent\";\n\nconst averageCellHeightPx = 16;\nconst controlsHeightPx = 20;\n\nexport default (fromLegend, settings) => {\n    const legend = fromLegend || d3Legend.legendColor();\n\n    let domain = [];\n    let pageCount = 1;\n    let pageSize;\n    let pageIndex = settings.legend && settings.legend.pageIndex ? settings.legend.pageIndex : 0;\n    let decorate = () => {};\n    let draggable = draggableComponent().settings(settings);\n    let resizable;\n\n    const scrollableLegend = selection => {\n        domain = legend.scale().domain();\n\n        resizable = resizableComponent()\n            .settings(settings)\n            .maxHeight(domain.length * averageCellHeightPx + controlsHeightPx)\n            .on(\"resize\", () => render(selection));\n\n        resizable(selection);\n        draggable(selection);\n        render(selection);\n    };\n\n    const render = selection => {\n        calculatePageSize(selection);\n        renderControls(selection);\n        renderLegend(selection);\n        cropCellContents(selection);\n    };\n\n    const renderControls = selection => {\n        const controls = getLegendControls(selection);\n        controls.style(\"display\", pageCount <= 1 ? \"none\" : \"block\");\n\n        controls.select(\"#page-text\").text(`${pageIndex + 1}/${pageCount}`);\n\n        controls\n            .select(\"#up-arrow\")\n            .attr(\"class\", pageIndex === 0 ? \"disabled\" : \"\")\n            .on(\"click\", () => {\n                if (pageIndex > 0) {\n                    setPage(pageIndex - 1);\n                    render(selection);\n                }\n            });\n\n        controls\n            .select(\"#down-arrow\")\n            .attr(\"class\", pageIndex >= pageCount - 1 ? \"disabled\" : \"\")\n            .on(\"click\", () => {\n                if (pageIndex < pageCount - 1) {\n                    setPage(pageIndex + 1);\n                    render(selection);\n                }\n            });\n    };\n\n    const renderLegend = selection => {\n        if (pageCount > 1) legend.cellFilter(cellFilter());\n        selection.select(\"g.legendCells\").remove();\n\n        const legendElement = getLegendElement(selection);\n        legendElement.call(legend);\n\n        const cellContainerSize = selection\n            .select(\"g.legendCells\")\n            .node()\n            .getBBox();\n        legendElement.attr(\"height\", cellContainerSize.height + controlsHeightPx);\n\n        decorate(selection);\n    };\n\n    const setPage = index => {\n        pageIndex = index;\n        settings.legend = {...settings.legend, pageIndex};\n    };\n\n    const cellFilter = () => (_, i) => i >= pageSize * pageIndex && i < pageSize * pageIndex + pageSize;\n\n    const calculatePageSize = selection => {\n        const legendContainerRect = selection.node().getBoundingClientRect();\n        let proposedPageSize = Math.floor(legendContainerRect.height / averageCellHeightPx) - 1;\n\n        // if page size is less than all legend items, leave space for the\n        // legend controls\n        pageSize = proposedPageSize < domain.length ? proposedPageSize - 1 : proposedPageSize;\n        pageCount = calculatePageCount(proposedPageSize);\n        pageIndex = Math.min(pageIndex, pageCount - 1);\n    };\n\n    const calculatePageCount = pageSize => Math.ceil(domain.length / pageSize);\n\n    const getLegendControls = container =>\n        getOrCreateElement(container, \".legend-controls\", () =>\n            container\n                .append(\"g\")\n                .attr(\"class\", \"legend-controls\")\n                .html(legendControlsTemplate)\n        );\n\n    const getLegendElement = container => getOrCreateElement(container, \".legend\", () => container.append(\"svg\").attr(\"class\", \"legend\"));\n\n    scrollableLegend.decorate = (...args) => {\n        if (!args.length) {\n            return decorate;\n        }\n        decorate = args[0];\n        return scrollableLegend;\n    };\n\n    rebindAll(scrollableLegend, legend);\n\n    return scrollableLegend;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {isElementOverflowing} from \"../../utils/utils\";\n\nexport function cropCellContents(legendDiv) {\n    const legendCells = legendDiv.select(\"g.legendCells\");\n    const legendDivRect = legendDiv.node().getBoundingClientRect();\n\n    if (!isElementOverflowing(legendDivRect, legendCells.node().getBoundingClientRect())) {\n        return;\n    }\n\n    const svg = legendDiv.select(\".legend\");\n\n    legendCells.selectAll(\".label\").text((d, i, nodes) => {\n        const cell = nodes[i];\n        if (isElementOverflowing(legendDivRect, cell.getBoundingClientRect())) {\n            const cutoffCharIndex = getCutoffCharacterIndex(cell, svg, legendDivRect);\n            return `${d.substring(0, cutoffCharIndex - 3)}...`;\n        } else {\n            return d;\n        }\n    });\n}\n\nfunction getCutoffCharacterIndex(cell, svg, legendDivRect) {\n    const cellRect = cell.getBoundingClientRect();\n    const cutoffCoord = svg.node().createSVGPoint();\n    // Sometimes the svg point can _just_ miss a character, so we fuzz it.\n    const fuzzyFactor = 3;\n    cutoffCoord.x = legendDivRect.right - cellRect.left - fuzzyFactor;\n    cutoffCoord.y = 0;\n    return cell.getCharNumAtPosition(cutoffCoord);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport * as d3Legend from \"d3-svg-legend\";\nimport scrollableLegend from \"./scrollableLegend\";\nimport {withoutOpacity} from \"../series/seriesColors\";\nimport {getChartElement} from \"../plugin/root\";\nimport {getOrCreateElement} from \"../utils/utils\";\n\nconst scrollColorLegend = settings =>\n    scrollableLegend(\n        d3Legend\n            .legendColor()\n            .shape(\"circle\")\n            .shapeRadius(6),\n        settings\n    );\n\nconst scrollSymbolLegend = settings =>\n    scrollableLegend(\n        d3Legend\n            .legendSymbol()\n            .shapePadding(1)\n            .labelOffset(3),\n        settings\n    );\n\nexport const colorLegend = () => legendComponent(scrollColorLegend);\nexport const symbolLegend = () => legendComponent(scrollSymbolLegend, symbolScale);\nexport const colorGroupLegend = () => legendComponent(scrollColorLegend, symbolScale);\n\nfunction symbolScale(fromScale) {\n    if (!fromScale) return null;\n\n    const domain = fromScale.domain();\n    const range = fromScale.range().map(r => d3.symbol().type(r)());\n\n    return d3\n        .scaleOrdinal()\n        .domain(domain)\n        .range(range);\n}\n\nfunction legendComponent(scrollLegendComponent, scaleModifier) {\n    let settings = {};\n    let scale = null;\n    let color = null;\n\n    function legend(container) {\n        if (scale && scale.range().length > 1) {\n            const scrollLegend = scrollLegendComponent(settings);\n            scrollLegend\n                .scale(scale)\n                .orient(\"vertical\")\n                .on(\"cellclick\", function(d) {\n                    settings.hideKeys = settings.hideKeys || [];\n                    if (settings.hideKeys.includes(d)) {\n                        settings.hideKeys = settings.hideKeys.filter(k => k !== d);\n                    } else {\n                        settings.hideKeys.push(d);\n                    }\n\n                    getChartElement(this).draw();\n                });\n\n            scrollLegend.labels(options => {\n                const parts = options.domain[options.i].split(\"|\");\n                return settings.mainValues.length <= 1 && parts.length > 1 ? parts.slice(0, parts.length - 1).join(\"|\") : options.domain[options.i];\n            });\n\n            const legendSelection = getOrCreateElement(container, \"div.legend-container\", () => container.append(\"div\"));\n\n            scrollLegend.decorate(selection => {\n                const isHidden = data => settings.hideKeys && settings.hideKeys.includes(data);\n\n                const cells = selection\n                    .select(\"g.legendCells\")\n                    .attr(\"transform\", \"translate(20,20)\")\n                    .selectAll(\"g.cell\");\n\n                cells.classed(\"hidden\", isHidden);\n                cells.append(\"title\").html(d => d);\n\n                if (color) {\n                    cells\n                        .select(\"circle, path\")\n                        .style(\"fill\", d => (isHidden(d) ? null : color(d)))\n                        .style(\"stroke\", d => (isHidden(d) ? null : withoutOpacity(color(d))));\n                }\n            });\n\n            // render the legend\n            legendSelection\n                .attr(\"class\", \"legend-container\")\n                .attr(\"borderbox-on-hover\", true)\n                .style(\"z-index\", \"2\")\n                .call(scrollLegend);\n        }\n    }\n\n    legend.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return legend;\n    };\n\n    legend.scale = (...args) => {\n        if (!args.length) {\n            return scale;\n        }\n        scale = scaleModifier ? scaleModifier(args[0]) : args[0];\n        return legend;\n    };\n\n    legend.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return legend;\n    };\n\n    return legend;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {groupFromKey} from \"../series/seriesKey\";\n\nexport function filterData(settings, data) {\n    const useData = data || settings.data;\n    if (settings.hideKeys && settings.hideKeys.length > 0) {\n        return useData.map(col => {\n            const clone = {...col};\n            settings.hideKeys.forEach(k => {\n                delete clone[k];\n            });\n            return clone;\n        });\n    }\n    return useData;\n}\n\nexport function filterDataByGroup(settings, data) {\n    const useData = data || settings.data;\n    if (settings.hideKeys && settings.hideKeys.length > 0) {\n        return useData.map(col => {\n            const clone = {};\n            Object.keys(col).map(key => {\n                if (!settings.hideKeys.includes(groupFromKey(key))) {\n                    clone[key] = col[key];\n                }\n            });\n            return clone;\n        });\n    }\n    return useData;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\n\nconst mainGridSvg = settings => x => x.style(\"stroke-width\", \"1.0\").style(\"stroke\", settings ? settings.colorStyles.grid.gridLineColor : \"#bbb\");\n\nconst mainGridCanvas = settings => c => {\n    c.strokeStyle = settings ? settings.colorStyles.grid.gridLineColor : \"#bbb\";\n    c.lineWidth = 1;\n};\n\nconst crossGridSvg = x => x.style(\"display\", \"none\");\nconst crossGridCanvas = settings => c => {\n    c.lineWidth = 1;\n    c.strokeStyle = settings ? settings.colorStyles.grid.gridLineColor : \"#bbb\";\n};\n\nexport default (series, settings) => {\n    let orient = \"both\";\n    let canvas = false;\n    let xScale = null;\n    let yScale = null;\n    let context = null;\n\n    let seriesMulti = fc.seriesSvgMulti();\n    let annotationGridline = fc.annotationSvgGridline();\n    let mainGrid = mainGridSvg(settings);\n    let crossGrid = crossGridSvg;\n\n    const _withGridLines = function(...args) {\n        if (canvas) {\n            seriesMulti = fc.seriesCanvasMulti().context(context);\n            annotationGridline = fc.annotationCanvasGridline();\n            mainGrid = mainGridCanvas(settings);\n            crossGrid = crossGridCanvas(settings);\n        }\n\n        const multi = seriesMulti.xScale(xScale).yScale(yScale);\n\n        const xStyle = orient === \"vertical\" ? crossGrid : mainGrid;\n        const yStyle = orient === \"horizontal\" ? crossGrid : mainGrid;\n\n        const gridlines = annotationGridline.xDecorate(xStyle).yDecorate(yStyle);\n\n        return multi.series([gridlines, series])(...args);\n    };\n\n    _withGridLines.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.canvas = (...args) => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.xScale = (...args) => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.yScale = (...args) => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.context = (...args) => {\n        if (!args.length) {\n            return context;\n        }\n        context = args[0];\n        return _withGridLines;\n    };\n\n    return _withGridLines;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {defaultPadding} from \"./default\";\nimport * as fc from \"d3fc\";\n\nexport const hardLimitZeroPadding = () => {\n    const _defaultPadding = defaultPadding();\n\n    const padding = extent => {\n        let pad = _defaultPadding.pad();\n        let padUnit = _defaultPadding.padUnit();\n\n        let delta = 1;\n        switch (padUnit) {\n            case \"domain\": {\n                break;\n            }\n            case \"percent\": {\n                delta = extent[1] - extent[0];\n                break;\n            }\n            default:\n                throw new Error(\"Unknown padUnit: \" + padUnit);\n        }\n\n        let paddedLowerExtent = extent[0] - pad[0] * delta;\n        let paddedUpperExtent = extent[1] + pad[1] * delta;\n\n        // If datapoints are exclusively negative or exclusively positive hard\n        // limit extent to 0.\n        extent[0] = extent[0] >= 0 && paddedLowerExtent < 0 ? 0 : paddedLowerExtent;\n        extent[1] = extent[1] <= 0 && paddedUpperExtent > 0 ? 0 : paddedUpperExtent;\n        return extent;\n    };\n\n    fc.rebindAll(padding, _defaultPadding);\n\n    return padding;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {getOrCreateElement} from \"../utils/utils\";\nimport template from \"../../html/zoom-controls.html\";\n\nexport default () => {\n    let chart = null;\n    let settings = null;\n    let xScale = null;\n    let xCopy = null;\n    let yScale = null;\n    let yCopy = null;\n    let bound = false;\n    let canvas = false;\n    let onChange = () => {};\n\n    function zoomableChart(selection) {\n        const chartPlotArea = `d3fc-${canvas ? \"canvas\" : \"svg\"}.plot-area`;\n        if (xScale || yScale) {\n            const dateAxis = xCopy && xCopy.domain()[0] instanceof Date;\n            const zoom = d3.zoom().on(\"zoom\", () => {\n                const {transform} = d3.event;\n                settings.zoom = {\n                    k: transform.k,\n                    x: transform.x,\n                    y: transform.y\n                };\n\n                applyTransform(transform);\n\n                selection.call(chart);\n\n                const noZoom = transform.k === 1 && transform.x === 0 && transform.y === 0;\n\n                const zoomControls = getZoomControls(selection).style(\"display\", noZoom ? \"none\" : \"\");\n                zoomControls.select(\"#zoom-reset\").on(\"click\", () => selection.select(chartPlotArea).call(zoom.transform, d3.zoomIdentity));\n\n                const oneYear = zoomControls.select(\"#one-year\").style(\"display\", dateAxis ? \"\" : \"none\");\n                const sixMonths = zoomControls.select(\"#six-months\").style(\"display\", dateAxis ? \"\" : \"none\");\n                const oneMonth = zoomControls.select(\"#one-month\").style(\"display\", dateAxis ? \"\" : \"none\");\n                if (dateAxis) {\n                    const dateClick = endCalculation => () => {\n                        const start = new Date(xScale.domain()[0]);\n                        const end = new Date(start);\n                        endCalculation(start, end);\n\n                        const xRange = xCopy.range();\n                        const k = (xRange[1] - xRange[0]) / (xCopy(end) - xCopy(start));\n                        const x = -xCopy(start) * k;\n                        let y = 0;\n                        if (yScale) {\n                            const yMiddle = yScale.domain().reduce((a, b) => a + b) / 2;\n                            y = -yCopy(yMiddle) * k + yScale(yMiddle);\n                        }\n                        selection.select(chartPlotArea).call(zoom.transform, d3.zoomIdentity.translate(x, y).scale(k));\n                    };\n\n                    oneYear.on(\n                        \"click\",\n                        dateClick((start, end) => end.setYear(start.getFullYear() + 1))\n                    );\n                    sixMonths.on(\n                        \"click\",\n                        dateClick((start, end) => end.setMonth(start.getMonth() + 6))\n                    );\n                    oneMonth.on(\n                        \"click\",\n                        dateClick((start, end) => end.setMonth(start.getMonth() + 1))\n                    );\n                }\n            });\n\n            const oldDecorate = chart.decorate();\n            chart.decorate((sel, data) => {\n                oldDecorate(sel, data);\n                if (!bound) {\n                    bound = true;\n                    // add the zoom interaction on the enter selection\n                    const plotArea = sel.select(chartPlotArea);\n\n                    plotArea\n                        .on(\"measure.zoom-range\", () => {\n                            if (xCopy) xCopy.range([0, d3.event.detail.width]);\n                            if (yCopy) yCopy.range([0, d3.event.detail.height]);\n\n                            if (settings.zoom) {\n                                const initialTransform = d3.zoomIdentity.translate(settings.zoom.x, settings.zoom.y).scale(settings.zoom.k);\n                                plotArea.call(zoom.transform, initialTransform);\n                            }\n                        })\n                        .call(zoom);\n                }\n            });\n        }\n\n        selection.call(chart);\n    }\n\n    zoomableChart.chart = (...args) => {\n        if (!args.length) {\n            return chart;\n        }\n        chart = args[0];\n        return zoomableChart;\n    };\n\n    zoomableChart.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return zoomableChart;\n    };\n\n    zoomableChart.xScale = (...args) => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = zoomableScale(args[0]);\n        xCopy = xScale ? xScale.copy() : null;\n        return zoomableChart;\n    };\n\n    zoomableChart.yScale = (...args) => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = zoomableScale(args[0]);\n        yCopy = yScale ? yScale.copy() : null;\n        if (yCopy) {\n            const yDomain = yCopy.domain();\n            yCopy.domain([yDomain[1], yDomain[0]]);\n        }\n        return zoomableChart;\n    };\n\n    zoomableChart.canvas = (...args) => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return zoomableChart;\n    };\n\n    zoomableChart.onChange = (...args) => {\n        if (!args.length) {\n            return onChange;\n        }\n        onChange = args[0];\n        return zoomableChart;\n    };\n\n    const applyTransform = transform => {\n        const changeArgs = {...transform};\n        if (xScale) {\n            xScale.domain(transform.rescaleX(xCopy).domain());\n            changeArgs.xDomain = xScale.domain();\n        }\n\n        if (yScale) {\n            const yZoomDomain = transform.rescaleY(yCopy).domain();\n            yScale.domain([yZoomDomain[1], yZoomDomain[0]]);\n            changeArgs.yDomain = yScale.domain();\n        }\n\n        onChange(changeArgs);\n    };\n\n    const getZoomControls = container =>\n        getOrCreateElement(container, \".zoom-controls\", () =>\n            container\n                .append(\"div\")\n                .attr(\"class\", \"zoom-controls\")\n                .style(\"display\", \"none\")\n                .html(template)\n        );\n\n    const zoomableScale = scale => {\n        if (scale && scale.nice) {\n            return scale;\n        }\n        return null;\n    };\n\n    return zoomableChart;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {barSeries} from \"../series/barSeries\";\nimport {seriesColors} from \"../series/seriesColors\";\nimport {groupAndStackData} from \"../data/groupData\";\nimport {colorLegend} from \"../legend/legend\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\n\nfunction barChart(container, settings) {\n    const data = groupAndStackData(settings, filterData(settings));\n    const color = seriesColors(settings);\n\n    const legend = colorLegend()\n        .settings(settings)\n        .scale(color);\n\n    const bars = barSeries(settings, color).orient(\"horizontal\");\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(() => bars));\n\n    const xAxis = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .excludeType(AXIS_TYPES.ordinal)\n        .include([0])\n        .paddingStrategy(hardLimitZeroPadding())(data);\n    const yAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")\n        .orient(\"vertical\")(data);\n\n    const chart = chartSvgFactory(xAxis, yAxis).plotArea(withGridLines(series, settings).orient(\"horizontal\"));\n\n    if (chart.yPaddingInner) {\n        chart.yPaddingInner(0.5);\n        chart.yPaddingOuter(0.25);\n        bars.align(\"left\");\n    }\n    chart.xNice && chart.xNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .yScale(yAxis.scale);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(legend);\n}\nbarChart.plugin = {\n    type: \"d3_x_bar\",\n    name: \"X Bar Chart\",\n    max_cells: 1000,\n    max_columns: 50,\n    render_warning: true\n};\n\nexport default barChart;\n","export default (domain1, domain2) => {\n    if (!isMatchable(domain1) || !isMatchable(domain2)) return;\n\n    const ratio1 = originRatio(domain1);\n    const ratio2 = originRatio(domain2);\n\n    if (ratio1 > ratio2) {\n        domain2[0] = adjustLowerBound(domain2, ratio1);\n    } else {\n        domain1[0] = adjustLowerBound(domain1, ratio2);\n    }\n};\n\nconst isMatchable = domain => domain.length === 2 && !isNaN(domain[0]) && !isNaN(domain[1]) && domain[0] !== domain[1];\nconst originRatio = domain => (0 - domain[0]) / (domain[1] - domain[0]);\nconst adjustLowerBound = (domain, ratio) => (ratio * domain[1]) / (ratio - 1);\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {splitterLabels} from \"./splitterLabels\";\n\nexport const axisSplitter = (settings, sourceData, splitFn = dataSplitFunction) => {\n    let color;\n    let data;\n    let altData;\n\n    // splitMainValues is an array of main-value names to put into the alt-axis\n    const splitMainValues = settings.splitMainValues || [];\n    const altValue = name => {\n        const split = name.split(\"|\");\n        return splitMainValues.includes(split[split.length - 1]);\n    };\n\n    const haveSplit = settings[\"mainValues\"].some(m => altValue(m.name));\n\n    // Split the data into main and alt displays\n    data = haveSplit ? splitFn(sourceData, key => !altValue(key)) : sourceData;\n    altData = haveSplit ? splitFn(sourceData, altValue) : null;\n\n    // Renderer to show the special controls for moving between axes\n    const splitter = selection => {\n        if (settings[\"mainValues\"].length === 1) return;\n\n        const labelsInfo = settings[\"mainValues\"].map((v, i) => ({\n            index: i,\n            name: v.name\n        }));\n        const mainLabels = labelsInfo.filter(v => !altValue(v.name));\n        const altLabels = labelsInfo.filter(v => altValue(v.name));\n\n        const labeller = () => splitterLabels(settings).color(color);\n\n        selection.select(\".y-label-container>.y-label\").call(labeller().labels(mainLabels));\n        selection.select(\".y2-label-container>.y-label\").call(\n            labeller()\n                .labels(altLabels)\n                .alt(true)\n        );\n    };\n\n    splitter.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return splitter;\n    };\n\n    splitter.haveSplit = () => haveSplit;\n\n    splitter.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return splitter;\n    };\n    splitter.altData = (...args) => {\n        if (!args.length) {\n            return altData;\n        }\n        altData = args[0];\n        return splitter;\n    };\n\n    return splitter;\n};\n\nexport const dataSplitFunction = (sourceData, isIncludedFn) => {\n    return sourceData.map(d => d.filter(v => isIncludedFn(v.key)));\n};\n\nexport const dataBlankFunction = (sourceData, isIncludedFn) => {\n    return sourceData.map(series => {\n        if (!isIncludedFn(series.key)) {\n            // Blank this data\n            return series.map(v => Object.assign({}, v, {mainValue: null}));\n        }\n        return series;\n    });\n};\n\nexport const groupedBlankFunction = (sourceData, isIncludedFn) => {\n    return sourceData.map(group => dataBlankFunction(group, isIncludedFn));\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {getChartElement} from \"../plugin/root\";\nimport {withoutOpacity} from \"../series/seriesColors.js\";\n\n// Render a set of labels with the little left/right arrows for moving\n// between axes\nexport const splitterLabels = settings => {\n    let labels = [];\n    let alt = false;\n    let color;\n\n    const _render = selection => {\n        selection.text(\"\");\n\n        const labelDataJoin = fc.dataJoin(\"span\", \"splitter-label\").key(d => d);\n\n        const disabled = !alt && labels.length === 1;\n        const coloured = color && settings.splitValues.length === 0;\n        labelDataJoin(selection, labels)\n            .classed(\"disabled\", disabled)\n            .text(d => d.name)\n            .style(\"color\", d => (coloured ? withoutOpacity(color(d.name)) : undefined))\n            .on(\"click\", d => {\n                if (disabled) return;\n\n                if (alt) {\n                    settings.splitMainValues = settings.splitMainValues.filter(v => v != d.name);\n                } else {\n                    settings.splitMainValues = [d.name].concat(settings.splitMainValues || []);\n                }\n\n                redrawChart(selection);\n            });\n    };\n\n    const redrawChart = selection => {\n        const chartElement = getChartElement(selection.node());\n        chartElement.remove();\n        chartElement.draw();\n    };\n\n    _render.labels = (...args) => {\n        if (!args.length) {\n            return labels;\n        }\n        labels = args[0];\n        return _render;\n    };\n    _render.alt = (...args) => {\n        if (!args.length) {\n            return alt;\n        }\n        alt = args[0];\n        return _render;\n    };\n\n    _render.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _render;\n    };\n    return _render;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport domainMatchOrigins from \"../axis/domainMatchOrigins\";\nimport {axisSplitter, dataBlankFunction, groupedBlankFunction} from \"../axis/axisSplitter\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {barSeries} from \"../series/barSeries\";\nimport {seriesColors} from \"../series/seriesColors\";\nimport {groupAndStackData} from \"../data/groupData\";\nimport {colorLegend} from \"../legend/legend\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\n\nfunction columnChart(container, settings) {\n    const data = groupAndStackData(settings, filterData(settings));\n    const color = seriesColors(settings);\n\n    const legend = colorLegend()\n        .settings(settings)\n        .scale(color);\n\n    const bars = barSeries(settings, color).orient(\"vertical\");\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(() => bars));\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .excludeType(AXIS_TYPES.ordinal)\n        .orient(\"vertical\")\n        .include([0])\n        .paddingStrategy(hardLimitZeroPadding());\n\n    // Check whether we've split some values into a second y-axis\n    const blankFunction = settings.mainValues.length > 1 ? groupedBlankFunction : dataBlankFunction;\n    const splitter = axisSplitter(settings, data, blankFunction).color(color);\n\n    const yAxis1 = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    if (chart.xPaddingInner) {\n        chart.xPaddingInner(0.5);\n        chart.xPaddingOuter(0.25);\n        bars.align(\"left\");\n    }\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n\n        domainMatchOrigins(yAxis1.domain, yAxis2.domain);\n        chart.yDomain(yAxis1.domain).altAxis(yAxis2);\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(legend);\n}\ncolumnChart.plugin = {\n    type: \"d3_y_bar\",\n    name: \"Y Bar Chart\",\n    max_cells: 1000,\n    max_columns: 50,\n    render_warning: true\n};\n\nexport default columnChart;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {withoutOpacity} from \"./seriesColors.js\";\n\nexport function lineSeries(settings, color) {\n    let series = fc.seriesSvgLine();\n\n    series = series.decorate(selection => {\n        selection.style(\"stroke\", d => withoutOpacity(color(d[0] && d[0].key)));\n    });\n\n    return series.crossValue(d => d.crossValue).mainValue(d => d.mainValue);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const transposeData = function(x) {\n    const columns = [];\n    for (const row of x) {\n        for (let col = 0; col < row.length; col++) {\n            if (row[col].mainValue !== null) {\n                columns[col] = columns[col] || [];\n                columns[col].push(row[col]);\n            }\n        }\n    }\n    return columns;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nexport const findBestFromData = (array, valueFn, compareFn = Math.min) => {\n    const findBestFromArray = array => {\n        return array.reduce((best, v) => {\n            const thisValue = findBestFromItem(v, valueFn);\n            return thisValue && (!best || compareFn(best.value, thisValue.value) === thisValue.value) ? thisValue : best;\n        }, null);\n    };\n    const findBestFromItem = item => {\n        if (Array.isArray(item)) {\n            return findBestFromArray(item, valueFn);\n        }\n        const value = valueFn(item);\n        return value !== null\n            ? {\n                  item,\n                  value\n              }\n            : null;\n    };\n\n    const bestItem = findBestFromArray(array, valueFn);\n    return bestItem ? bestItem.item : null;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as fc from \"d3fc\";\nimport {tooltip} from \"./tooltip\";\nimport {withOpacity} from \"../series/seriesColors.js\";\nimport {findBestFromData} from \"../data/findBest\";\nimport {raiseEvent} from \"./selectionEvent\";\n\nexport default () => {\n    const base = tooltip().alwaysShow(true);\n\n    let xScale = null;\n    let yScale = null;\n    let color = null;\n    let size = null;\n    let canvas = false;\n    let data = null;\n    let xValueName = \"crossValue\";\n    let yValueName = \"mainValue\";\n    let altDataWithScale = null;\n\n    function nearbyTip(selection) {\n        const chartPlotArea = `d3fc-${canvas ? \"canvas\" : \"svg\"}.plot-area`;\n        if (xScale || yScale) {\n            let tooltipData = null;\n            const pointer = fc.pointer().on(\"point\", event => {\n                const closest = event.length ? getClosestDataPoint(event[0]) : null;\n                tooltipData = closest ? [closest.data] : [];\n                const useYScale = closest ? closest.scale : yScale;\n\n                renderTip(selection, tooltipData, useYScale);\n            });\n\n            selection\n                .select(chartPlotArea)\n                .on(\"measure.nearbyTip\", () => renderTip(selection, []))\n                .on(\"click\", () => {\n                    if (tooltipData.length) {\n                        raiseEvent(selection.node(), tooltipData[0], base.settings());\n                    }\n                })\n                .call(pointer);\n        }\n    }\n\n    const renderTip = (selection, tipData, useYScale = yScale) => {\n        const tips = selection\n            .select(\"d3fc-svg.plot-area svg\")\n            .selectAll(\"circle.nearbyTip\")\n            .data(tipData);\n        tips.exit().remove();\n\n        tips.enter()\n            .append(\"circle\")\n            .attr(\"class\", \"nearbyTip\")\n            .merge(tips)\n            .attr(\"r\", d => (size ? Math.sqrt(size(d.size)) : 10))\n            .attr(\"transform\", d => `translate(${xScale(d[xValueName])},${useYScale(d[yValueName])})`)\n            .style(\"stroke\", \"none\")\n            .style(\"fill\", d => color && withOpacity(color(d.key)));\n\n        base(tips);\n    };\n\n    const getClosestDataPoint = pos => {\n        const distFn = scale => {\n            return v => {\n                if (v[yValueName] === undefined || v[yValueName] === null || v[xValueName] === undefined || v[xValueName] === null) return null;\n\n                return Math.sqrt(Math.pow(xScale(v[xValueName]) - pos.x, 2) + Math.pow(scale(v[yValueName]) - pos.y, 2));\n            };\n        };\n\n        // Check the main data\n        const dist1 = distFn(yScale);\n        const best1 = findBestFromData(data, dist1, Math.min);\n\n        if (altDataWithScale) {\n            // Check the alt data with its scale, to see if any are closer\n            const dist2 = distFn(altDataWithScale.yScale);\n            const best2 = findBestFromData(altDataWithScale.data, dist2, Math.min);\n            return dist1(best1) <= dist2(best2) ? {data: best1, scale: yScale} : {data: best2, scale: altDataWithScale.yScale};\n        }\n        return {data: best1, scale: yScale};\n    };\n\n    nearbyTip.xScale = (...args) => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.yScale = (...args) => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.size = (...args) => {\n        if (!args.length) {\n            return size;\n        }\n        size = args[0] ? args[0].copy().range([40, 4000]) : null;\n        return nearbyTip;\n    };\n\n    nearbyTip.canvas = (...args) => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.xValueName = (...args) => {\n        if (!args.length) {\n            return xValueName;\n        }\n        xValueName = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.yValueName = (...args) => {\n        if (!args.length) {\n            return yValueName;\n        }\n        yValueName = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.altDataWithScale = (...args) => {\n        if (!args.length) {\n            return altDataWithScale;\n        }\n        altDataWithScale = args[0];\n        return nearbyTip;\n    };\n\n    fc.rebindAll(nearbyTip, base);\n    return nearbyTip;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {axisSplitter} from \"../axis/axisSplitter\";\nimport {seriesColors} from \"../series/seriesColors\";\nimport {lineSeries} from \"../series/lineSeries\";\nimport {splitData} from \"../data/splitData\";\nimport {colorLegend} from \"../legend/legend\";\nimport {filterData} from \"../legend/filter\";\nimport {transposeData} from \"../data/transposeData\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction lineChart(container, settings) {\n    const data = splitData(settings, filterData(settings));\n    const color = seriesColors(settings);\n\n    const legend = colorLegend()\n        .settings(settings)\n        .scale(color);\n\n    const series = fc\n        .seriesSvgRepeat()\n        .series(lineSeries(settings, color))\n        .orient(\"horizontal\");\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.1, 0.1])\n        .padUnit(\"percent\");\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, transposeData(data)).color(color);\n\n    const yAxis1 = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({yScale: yAxis2.scale, data: splitter.altData()});\n    }\n\n    const transposed_data = splitter.data();\n\n    // render\n    container.datum(transposed_data).call(zoomChart);\n    container.call(toolTip);\n    container.call(legend);\n}\n\nlineChart.plugin = {\n    type: \"d3_y_line\",\n    name: \"Y Line Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true\n};\n\nexport default lineChart;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\n\nexport function splitData(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    return data.map((col, i) => {\n        return Object.keys(col)\n            .filter(key => key !== \"__ROW_PATH__\")\n            .map(key => ({\n                key,\n                crossValue: labelfn(col, i),\n                mainValue: col[key],\n                row: col\n            }));\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\n\nconst symbols = [d3.symbolCircle, d3.symbolCross, d3.symbolDiamond, d3.symbolSquare, d3.symbolStar, d3.symbolTriangle, d3.symbolWye];\n\nexport function fromDomain(domain) {\n    return domain.length > 1\n        ? d3\n              .scaleOrdinal()\n              .domain(domain)\n              .range(symbols)\n        : null;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {seriesCanvasPoint} from \"d3fc\";\nimport {withOpacity, withoutOpacity} from \"./seriesColors\";\nimport {groupFromKey} from \"./seriesKey\";\nimport {fromDomain} from \"./seriesSymbols\";\n\nexport function pointSeriesCanvas(settings, seriesKey, size, color, symbols) {\n    let series = seriesCanvasPoint()\n        .crossValue(d => d.x)\n        .mainValue(d => d.y);\n\n    if (size) {\n        series.size(d => size(d.size));\n    }\n    if (symbols) {\n        series.type(symbols(seriesKey));\n    }\n\n    series.decorate((context, d) => {\n        const colorValue = color(d.colorValue !== undefined ? d.colorValue : seriesKey);\n        const opacity = settings.colorStyles && settings.colorStyles.opacity;\n\n        context.strokeStyle = withoutOpacity(colorValue);\n        context.fillStyle = withOpacity(colorValue, opacity);\n    });\n\n    return series;\n}\n\nexport function symbolTypeFromGroups(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = [];\n    Object.keys(col).forEach(key => {\n        if (key !== \"__ROW_PATH__\") {\n            const group = groupFromKey(key);\n            if (!domain.includes(group)) {\n                domain.push(group);\n            }\n        }\n    });\n    return fromDomain(domain);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as fc from \"d3fc\";\nimport {transposeData} from \"../data/transposeData\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {symbolTypeFromGroups} from \"../series/pointSeriesCanvas\";\nimport {lineSeries} from \"../series/lineSeries\";\nimport {xySplitData} from \"../data/xySplitData\";\nimport {seriesColorsFromGroups} from \"../series/seriesColors\";\nimport {colorGroupLegend} from \"../legend/legend\";\nimport {filterDataByGroup} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction xyLine(container, settings) {\n    const data = transposeData(xySplitData(settings, filterDataByGroup(settings)));\n\n    const color = seriesColorsFromGroups(settings);\n    const symbols = symbolTypeFromGroups(settings);\n\n    let legend = null;\n    if (color.domain().length > 2) {\n        legend = colorGroupLegend()\n            .settings(settings)\n            .scale(symbols)\n            .color(color);\n    }\n\n    const series = fc\n        .seriesSvgRepeat()\n        .series(lineSeries(settings, color))\n        .orient(\"horizontal\");\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.1, 0.1])\n        .padUnit(\"percent\");\n\n    const xAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .settingValue(settings.mainValues[0].name)\n        .valueName(\"crossValue\")\n        .paddingStrategy(paddingStrategy);\n\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .settingValue(settings.mainValues[1].name)\n        .valueName(\"mainValue\")\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    const yAxis = yAxisFactory(data);\n    const xAxis = xAxisFactory(data);\n\n    const plotSeries = withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis)\n        .xLabel(settings.mainValues[0].name)\n        .yLabel(settings.mainValues[1].name)\n        .plotArea(plotSeries);\n\n    chart.xNice && chart.xNice();\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale)\n        .color(color)\n        .data(data);\n\n    container.datum(data).call(zoomChart);\n    container.call(toolTip);\n    if (legend) {\n        container.call(legend);\n    }\n}\n\nxyLine.plugin = {\n    type: \"d3_xy_line\",\n    name: \"X/Y Line Chart\",\n    max_cells: 50000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 2,\n        names: [\"X Axis\", \"Y Axis\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default xyLine;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {groupFromKey} from \"../series/seriesKey\";\n\nexport function xySplitData(settings, data) {\n    const n_cols = settings.mainValues.length;\n\n    return data.map(col => {\n        const cols = Object.keys(col).filter(key => key !== \"__ROW_PATH__\");\n        const row = new Array(cols.length / n_cols);\n        for (let i = 0; i < cols.length / n_cols; i++) {\n            row[i] = {\n                key: groupFromKey(cols[i * n_cols]),\n                crossValue: col[cols[i * n_cols]],\n                mainValue: col[cols[i * n_cols + 1]],\n                row: col\n            };\n        }\n        return row;\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {axisSplitter} from \"../axis/axisSplitter\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {areaSeries} from \"../series/areaSeries\";\nimport {seriesColors} from \"../series/seriesColors\";\nimport {splitAndBaseData} from \"../data/splitAndBaseData\";\nimport {colorLegend} from \"../legend/legend\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction areaChart(container, settings) {\n    const data = splitAndBaseData(settings, filterData(settings));\n\n    const color = seriesColors(settings);\n    const legend = colorLegend()\n        .settings(settings)\n        .scale(color);\n\n    const series = fc.seriesSvgRepeat().series(areaSeries(settings, color).orient(\"vertical\"));\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .excludeType(AXIS_TYPES.ordinal)\n        .orient(\"vertical\")\n        .include([0])\n        .paddingStrategy(hardLimitZeroPadding());\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, data).color(color);\n\n    const yAxis1 = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({yScale: yAxis2.scale, data: splitter.altData()});\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(toolTip);\n    container.call(legend);\n}\nareaChart.plugin = {\n    type: \"d3_y_area\",\n    name: \"Y Area Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true\n};\n\nexport default areaChart;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\n\nexport function splitAndBaseData(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    return data.map((col, i) => {\n        const baseValues = {};\n\n        return Object.keys(col)\n            .filter(key => key !== \"__ROW_PATH__\")\n            .map(key => {\n                // Keys are of the form \"split1|split2|aggregate\"\n                const labels = key.split(\"|\");\n                // label=\"aggregate\"\n                const label = labels[labels.length - 1];\n                const baseValue = baseValues[label] || 0;\n                const value = baseValue + col[key];\n                baseValues[label] = value;\n\n                return {\n                    key,\n                    crossValue: labelfn(col, i),\n                    mainValue: value,\n                    baseValue: baseValue,\n                    row: col\n                };\n            });\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\n\nexport function areaSeries(settings, color) {\n    let series = fc.seriesSvgArea();\n\n    series = series.decorate(selection => {\n        selection.style(\"fill\", d => color(d[0].key));\n    });\n\n    return series\n        .crossValue(d => d.crossValue)\n        .mainValue(d => d.mainValue)\n        .baseValue(d => d.baseValue);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {axisSplitter} from \"../axis/axisSplitter\";\nimport {seriesColors} from \"../series/seriesColors\";\nimport {categoryPointSeries, symbolType} from \"../series/categoryPointSeries\";\nimport {groupData} from \"../data/groupData\";\nimport {symbolLegend} from \"../legend/legend\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction yScatter(container, settings) {\n    const data = groupData(settings, filterData(settings));\n    const symbols = symbolType(settings);\n    const color = seriesColors(settings);\n\n    const legend = symbolLegend()\n        .settings(settings)\n        .scale(symbols)\n        .color(color);\n\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(series => categoryPointSeries(settings, series.key, color, symbols)));\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.05, 0.05])\n        .padUnit(\"percent\");\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, data).color(color);\n\n    const yAxis1 = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit() ? series : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({yScale: yAxis2.scale, data: splitter.altData()});\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(toolTip);\n    if (legend) {\n        container.call(legend);\n    }\n}\nyScatter.plugin = {\n    type: \"d3_y_scatter\",\n    name: \"Y Scatter Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true\n};\n\nexport default yScatter;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {withOpacity, withoutOpacity} from \"./seriesColors\";\nimport {fromDomain} from \"./seriesSymbols\";\n\nexport function categoryPointSeries(settings, seriesKey, color, symbols) {\n    let series = fc.seriesSvgPoint().size(100);\n    const opacity = settings.colorStyles && settings.colorStyles.opacity;\n\n    if (symbols) {\n        series.type(symbols(seriesKey));\n    }\n\n    series.decorate(selection => {\n        selection.style(\"stroke\", d => withoutOpacity(color(d.colorValue || seriesKey))).style(\"fill\", d => withOpacity(color(d.colorValue || seriesKey), opacity));\n    });\n\n    return series.crossValue(d => d.crossValue).mainValue(d => d.mainValue);\n}\n\nexport function symbolType(settings) {\n    const col = settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = Object.keys(col).filter(k => k !== \"__ROW_PATH__\");\n    return fromDomain(domain);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\n\nexport function pointData(settings, data) {\n    return splitIntoMultiSeries(settings, data, {excludeEmpty: true}).map(data => seriesToPoints(settings, data));\n}\n\nfunction seriesToPoints(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    const mappedSeries = data.map((col, i) => ({\n        crossValue: labelfn(col, i),\n        mainValues: settings.mainValues.map(v => col[v.name]),\n        x: col[settings.mainValues[0].name],\n        y: col[settings.mainValues[1].name],\n        colorValue: settings.realValues[2] ? col[settings.realValues[2]] : undefined,\n        size: settings.realValues[3] ? col[settings.realValues[3]] : undefined,\n        key: data.key,\n        row: col\n    }));\n\n    mappedSeries.key = data.key;\n    return mappedSeries;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport {domain} from \"../axis/linearAxis\";\n\nexport function seriesLinearRange(settings, data, valueName, customExtent) {\n    return d3.scaleLinear().domain(getExtent(data, valueName, customExtent));\n}\n\nexport function seriesColorRange(settings, data, valueName, customExtent) {\n    let extent = getExtent(data, valueName, customExtent);\n    let gradient = settings.colorStyles.gradient.full;\n\n    if (extent[0] >= 0) {\n        gradient = settings.colorStyles.gradient.positive;\n    } else if (extent[1] <= 0) {\n        gradient = settings.colorStyles.gradient.negative;\n    } else {\n        const maxVal = Math.max(-extent[0], extent[1]);\n        extent = [-maxVal, maxVal];\n    }\n\n    const interpolator = multiInterpolator(gradient);\n    return d3.scaleSequential(interpolator).domain(extent);\n}\n\nconst getExtent = (data, valueName, customExtent) => {\n    return (\n        customExtent ||\n        domain()\n            .valueName(valueName)\n            .pad([0, 0])(data)\n    );\n};\n\nconst multiInterpolator = gradientPairs => {\n    // A new interpolator that calls through to a set of\n    // interpolators between each value/color pair\n    const interpolators = gradientPairs.slice(1).map((p, i) => d3.interpolate(gradientPairs[i][1], p[1]));\n    return value => {\n        const index = gradientPairs.findIndex((p, i) => i < gradientPairs.length - 1 && value <= gradientPairs[i + 1][0] && value > p[0]);\n        if (index === -1) {\n            if (value <= gradientPairs[0][0]) {\n                return gradientPairs[0][1];\n            }\n            return gradientPairs[gradientPairs.length - 1][1];\n        }\n\n        const interpolator = interpolators[index];\n        const [value1] = gradientPairs[index];\n        const [value2] = gradientPairs[index + 1];\n\n        return interpolator((value - value1) / (value2 - value1));\n    };\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport {getOrCreateElement} from \"../utils/utils\";\nimport valueformatter from \"../axis/valueFormatter\";\n\nexport function colorRangeLegend() {\n    let scale = null;\n\n    function legend(container) {\n        const legendSelection = getOrCreateElement(container, \"div.legend-container\", () =>\n            container\n                .append(\"div\")\n                .attr(\"class\", \"legend-container legend-color\")\n                .style(\"z-index\", \"2\")\n        );\n        const {width, height} = legendSelection.node().getBoundingClientRect();\n\n        const xScale = d3\n            .scaleBand()\n            .domain([0, 1])\n            .range([0, width]);\n\n        const domain = scale\n            .copy()\n            .nice()\n            .domain();\n        const paddedDomain = fc\n            .extentLinear()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\")(domain);\n        const [min, max] = paddedDomain;\n        const expandedDomain = d3.range(min, max, (max - min) / height);\n\n        const yScale = d3\n            .scaleLinear()\n            .domain(paddedDomain)\n            .range([height, 0]);\n\n        const svgBar = fc\n            .autoBandwidth(fc.seriesSvgBar())\n            .xScale(xScale)\n            .yScale(yScale)\n            .crossValue(0)\n            .baseValue((_, i) => expandedDomain[Math.max(0, i - 1)])\n            .mainValue(d => d)\n            .decorate(selection => {\n                selection.selectAll(\"path\").style(\"fill\", d => scale(d));\n            });\n\n        const middle = domain[0] < 0 && domain[1] > 0 ? 0 : Math.round((domain[1] + domain[0]) / 2);\n        const tickValues = [...domain, middle];\n\n        const axisLabel = fc\n            .axisRight(yScale)\n            .tickValues(tickValues)\n            .tickSizeOuter(0)\n            .tickFormat(d => valueformatter(d));\n\n        const legendSvg = getOrCreateElement(legendSelection, \"svg\", () => legendSelection.append(\"svg\"))\n            .style(\"width\", width)\n            .style(\"height\", height);\n        const legendBar = getOrCreateElement(legendSvg, \"g\", () => legendSvg.append(\"g\"))\n            .datum(expandedDomain)\n            .call(svgBar);\n\n        const barWidth = Math.abs(legendBar.node().getBBox().x);\n        getOrCreateElement(legendSvg, \"#legend-axis\", () => legendSvg.append(\"g\").attr(\"id\", \"legend-axis\"))\n            .attr(\"transform\", `translate(${barWidth})`)\n            .datum(expandedDomain)\n            .call(axisLabel)\n            .select(\".domain\")\n            .attr(\"visibility\", \"hidden\");\n    }\n\n    legend.scale = (...args) => {\n        if (!args.length) {\n            return scale;\n        }\n        scale = args[0];\n        return legend;\n    };\n\n    return legend;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartCanvasFactory} from \"../axis/chartFactory\";\nimport {pointSeriesCanvas, symbolTypeFromGroups} from \"../series/pointSeriesCanvas\";\nimport {pointData} from \"../data/pointData\";\nimport {seriesColorsFromGroups} from \"../series/seriesColors\";\nimport {seriesLinearRange, seriesColorRange} from \"../series/seriesRange\";\nimport {symbolLegend} from \"../legend/legend\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport {filterDataByGroup} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\n\nfunction xyScatter(container, settings) {\n    const data = pointData(settings, filterDataByGroup(settings));\n    const symbols = symbolTypeFromGroups(settings);\n    const useGroupColors = settings.realValues.length <= 2 || settings.realValues[2] === null;\n    let color = null;\n    let legend = null;\n\n    if (useGroupColors) {\n        color = seriesColorsFromGroups(settings);\n\n        legend = symbolLegend()\n            .settings(settings)\n            .scale(symbols)\n            .color(useGroupColors ? color : null);\n    } else {\n        color = seriesColorRange(settings, data, \"colorValue\");\n        legend = colorRangeLegend().scale(color);\n    }\n\n    const size = settings.realValues[3] ? seriesLinearRange(settings, data, \"size\").range([10, 10000]) : null;\n\n    const series = fc\n        .seriesCanvasMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(series => pointSeriesCanvas(settings, series.key, size, color, symbols)));\n\n    const axisDefault = () =>\n        axisFactory(settings)\n            .settingName(\"mainValues\")\n            .paddingStrategy(hardLimitZeroPadding())\n            .pad([0.1, 0.1]);\n\n    const xAxis = axisDefault()\n        .settingValue(settings.mainValues[0].name)\n        .valueName(\"x\")(data);\n    const yAxis = axisDefault()\n        .orient(\"vertical\")\n        .settingValue(settings.mainValues[1].name)\n        .valueName(\"y\")(data);\n\n    const chart = chartCanvasFactory(xAxis, yAxis)\n        .xLabel(settings.mainValues[0].name)\n        .yLabel(settings.mainValues[1].name)\n        .plotArea(withGridLines(series, settings).canvas(true));\n\n    chart.xNice && chart.xNice();\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale)\n        .canvas(true);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .canvas(true)\n        .xScale(xAxis.scale)\n        .xValueName(\"x\")\n        .yValueName(\"y\")\n        .yScale(yAxis.scale)\n        .color(useGroupColors && color)\n        .size(size)\n        .data(data);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(toolTip);\n    if (legend) container.call(legend);\n}\n\nxyScatter.plugin = {\n    type: \"d3_xy_scatter\",\n    name: \"X/Y Scatter Chart\",\n    max_cells: 50000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 2,\n        names: [\"X Axis\", \"Y Axis\", \"Color\", \"Size\", \"Tooltip\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default xyScatter;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {chartSvgFactory} from \"../axis/chartFactory\";\nimport {heatmapSeries} from \"../series/heatmapSeries\";\nimport {seriesColorRange} from \"../series/seriesRange\";\nimport {heatmapData} from \"../data/heatmapData\";\nimport {filterData} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport zoomableChart from \"../zoom/zoomableChart\";\n\nfunction heatmapChart(container, settings) {\n    const data = heatmapData(settings, filterData(settings));\n\n    const color = seriesColorRange(settings, data, \"colorValue\");\n    const series = heatmapSeries(settings, color);\n\n    const legend = colorRangeLegend().scale(color);\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"splitValues\")\n        .valueName(\"mainValue\")\n        .orient(\"vertical\")(data);\n\n    const chart = chartSvgFactory(xAxis, yAxis).plotArea(withGridLines(series, settings));\n\n    if (chart.xPaddingInner) {\n        chart.xPaddingInner(0);\n        chart.xPaddingOuter(0);\n        series.xAlign(\"right\");\n    }\n    if (chart.yPaddingInner) {\n        chart.yPaddingInner(0);\n        chart.yPaddingOuter(0);\n        series.yAlign(\"top\");\n    }\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(legend);\n}\nheatmapChart.plugin = {\n    type: \"d3_heatmap\",\n    name: \"Heatmap\",\n    max_cells: 1000,\n    max_columns: 50,\n    render_warning: true\n};\n\nexport default heatmapChart;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {axisType} from \"../axis/axisType\";\nimport {AXIS_TYPES} from \"../axis/axisType\";\nimport {labelFunction} from \"../axis/axisLabel\";\n\nexport function heatmapData(settings, data) {\n    const labelfn = labelFunction(settings);\n    const mainType = axisType(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"splitValues\")();\n\n    const heatmapData = [];\n\n    data.forEach((col, i) => {\n        const crossValue = labelfn(col, i);\n        Object.keys(col)\n            .filter(key => key !== \"__ROW_PATH__\")\n            .forEach(key => {\n                const mainValue = getMainValues(key);\n                heatmapData.push({\n                    crossValue: crossValue,\n                    mainValue: mainType === AXIS_TYPES.time ? new Date(mainValue) : mainValue,\n                    colorValue: col[key],\n                    row: col\n                });\n            });\n    });\n\n    return heatmapData;\n}\n\nfunction getMainValues(key) {\n    // Key format is based on \"Split By\" values plus the value label at the end\n    // val1|val2|....|label\n    const labels = key.split(\"|\");\n    labels.pop();\n    return labels.join(\"|\");\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {tooltip} from \"../tooltip/tooltip\";\n\nexport function heatmapSeries(settings, color) {\n    let series = fc.seriesSvgHeatmap();\n\n    series.decorate(selection => {\n        tooltip().settings(settings)(selection);\n        selection.select(\"path\").attr(\"fill\", d => color(d.colorValue));\n    });\n\n    return fc\n        .autoBandwidth(series)\n        .xValue(d => d.crossValue)\n        .yValue(d => d.mainValue)\n        .colorValue(d => d.colorValue)\n        .colorInterpolate(color.interpolator())\n        .widthFraction(1.0);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {labelFunction} from \"../axis/axisLabel\";\nimport {splitIntoMultiSeries} from \"./splitIntoMultiSeries\";\n\nexport function ohlcData(settings, data) {\n    return splitIntoMultiSeries(settings, data, {excludeEmpty: true}).map(data => seriesToOHLC(settings, data));\n}\n\nfunction seriesToOHLC(settings, data) {\n    const labelfn = labelFunction(settings);\n\n    const getNextOpen = i => data[i < data.length - 1 ? i + 1 : i][settings.mainValues[0].name];\n    const mappedSeries = data.map((col, i) => {\n        const openValue = settings.mainValues.length >= 1 ? col[settings.mainValues[0].name] : undefined;\n        const closeValue = settings.mainValues.length >= 2 ? col[settings.mainValues[1].name] : getNextOpen(i);\n        return {\n            crossValue: labelfn(col, i),\n            mainValues: settings.mainValues.map(v => col[v.name]),\n            openValue: openValue,\n            closeValue: closeValue,\n            highValue: settings.mainValues.length >= 3 ? col[settings.mainValues[2].name] : Math.max(openValue, closeValue),\n            lowValue: settings.mainValues.length >= 4 ? col[settings.mainValues[3].name] : Math.min(openValue, closeValue),\n            key: data.key,\n            row: col\n        };\n    });\n\n    mappedSeries.key = data.key;\n    return mappedSeries;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {axisFactory} from \"../axis/axisFactory\";\nimport {chartCanvasFactory} from \"../axis/chartFactory\";\nimport {ohlcData} from \"../data/ohlcData\";\nimport {filterDataByGroup} from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport {hardLimitZeroPadding} from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport {ohlcCandleSeries} from \"../series/ohlcCandleSeries\";\nimport {colorScale, setOpacity} from \"../series/seriesColors\";\nimport {colorLegend} from \"../legend/legend\";\n\nfunction ohlcCandle(seriesCanvas) {\n    return function(container, settings) {\n        const srcData = ohlcData(settings, filterDataByGroup(settings));\n\n        const bollinger = fc.indicatorBollingerBands().value(d => d.openValue);\n        const data = srcData.map(seriesData => {\n            const bollingerData = bollinger(seriesData);\n            return seriesData.map((d, i) => Object.assign({bollinger: bollingerData[i]}, d));\n        });\n\n        const keys = srcData\n            .map(k => k.key)\n            .concat(settings.hideKeys ? settings.hideKeys : [])\n            .sort();\n\n        const upColor = colorScale()\n            .domain(keys)\n            .settings(settings)\n            .mapFunction(setOpacity(1))();\n\n        const legend = colorLegend()\n            .settings(settings)\n            .scale(keys.length > 1 ? upColor : null);\n\n        const series = ohlcCandleSeries(settings, seriesCanvas, upColor);\n\n        const multi = fc\n            .seriesCanvasMulti()\n            .mapping((data, index) => data[index])\n            .series(data.map(() => series));\n\n        const paddingStrategy = hardLimitZeroPadding()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\");\n\n        const xAxis = axisFactory(settings)\n            .settingName(\"crossValues\")\n            .valueName(\"crossValue\")(data);\n        const yAxis = axisFactory(settings)\n            .settingName(\"mainValues\")\n            .valueNames([\"lowValue\", \"highValue\"])\n            .orient(\"vertical\")\n            .paddingStrategy(paddingStrategy)(data);\n\n        const chart = chartCanvasFactory(xAxis, yAxis).plotArea(\n            withGridLines(multi, settings)\n                .orient(\"vertical\")\n                .canvas(true)\n        );\n\n        chart.yNice && chart.yNice();\n\n        const zoomChart = zoomableChart()\n            .chart(chart)\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .onChange(zoom => {\n                const zoomedData = data.map(series => series.filter(d => d.crossValue >= zoom.xDomain[0] && d.crossValue <= zoom.xDomain[1]));\n                chart.yDomain(yAxis.domainFunction(zoomedData));\n            })\n            .canvas(true);\n\n        const toolTip = nearbyTip()\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .yScale(yAxis.scale)\n            .yValueName(\"closeValue\")\n            .color(upColor)\n            .data(data)\n            .canvas(true);\n\n        // render\n        container.datum(data).call(zoomChart);\n        container.call(toolTip);\n        container.call(legend);\n    };\n}\n\nexport default ohlcCandle;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as fc from \"d3fc\";\nimport {colorScale, setOpacity} from \"../series/seriesColors\";\n\nconst isUp = d => d.closeValue >= d.openValue;\n\nexport function ohlcCandleSeries(settings, seriesCanvas, upColor) {\n    const domain = upColor.domain();\n    const downColor = colorScale()\n        .domain(domain)\n        .settings(settings)\n        .defaultColors([settings.colorStyles[\"series-2\"]])\n        .mapFunction(setOpacity(0.5))();\n    const avgColor = colorScale()\n        .settings(settings)\n        .domain(domain)();\n\n    const series = seriesCanvas()\n        .crossValue(d => d.crossValue)\n        .openValue(d => d.openValue)\n        .highValue(d => d.highValue)\n        .lowValue(d => d.lowValue)\n        .closeValue(d => d.closeValue)\n        .decorate((context, d) => {\n            const color = isUp(d) ? upColor(d.key) : downColor(d.key);\n            context.fillStyle = color;\n            context.strokeStyle = color;\n        });\n\n    const bollingerAverageSeries = fc\n        .seriesCanvasLine()\n        .mainValue(d => d.bollinger.average)\n        .crossValue(d => d.crossValue)\n        .decorate((context, d) => {\n            context.strokeStyle = avgColor(d[0].key);\n        });\n\n    const bollingerAreaSeries = fc\n        .seriesCanvasArea()\n        .mainValue(d => d.bollinger.upper)\n        .baseValue(d => d.bollinger.lower)\n        .crossValue(d => d.crossValue)\n        .decorate((context, d) => {\n            context.fillStyle = setOpacity(0.25)(avgColor(d[0].key));\n        });\n\n    return fc.seriesCanvasMulti().series([bollingerAreaSeries, series, bollingerAverageSeries]);\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {seriesCanvasOhlc} from \"d3fc\";\nimport ohlcCandle from \"./ohlcCandle\";\n\nconst ohlc = ohlcCandle(seriesCanvasOhlc);\nohlc.plugin = {\n    type: \"d3_ohlc\",\n    name: \"OHLC Chart\",\n    max_cells: 3500,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 4,\n        names: [\"Open\", \"Close\", \"High\", \"Low\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default ohlc;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport {seriesCanvasCandlestick} from \"d3fc\";\nimport ohlcCandle from \"./ohlcCandle\";\n\nconst candlestick = ohlcCandle(seriesCanvasCandlestick);\ncandlestick.plugin = {\n    type: \"d3_candlestick\",\n    name: \"Candlestick Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 4,\n        names: [\"Open\", \"Close\", \"High\", \"Low\"]\n    },\n    selectMode: \"toggle\"\n};\n\nexport default candlestick;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {flattenExtent} from \"../../axis/flatten\";\nimport {seriesColorRange} from \"../seriesRange\";\nimport {seriesColorsFromDistinct} from \"../seriesColors\";\n\nexport function treeColor(settings, data) {\n    if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n        const color_column = settings.realValues[1];\n        if (settings.mainValues.find(x => x.name === color_column)?.type === \"string\") {\n            const colors = data\n                .map(d => d.data)\n                .filter(x => x.height > 0)\n                .map(x => getColors(x))\n                .reduce((a, b) => a.concat(b));\n            return seriesColorsFromDistinct(settings, colors);\n        } else {\n            return seriesColorRange(settings, null, null, flattenExtent(data.map(d => d.extents)));\n        }\n    }\n}\n\n// only get the colors from the bottom level (e.g. nodes with no children)\nfunction getColors(nodes, colors = []) {\n    nodes.children && nodes.children.length > 0 ? nodes.children.forEach(child => colors.concat(getColors(child, colors))) : nodes.data.color && colors.push(nodes.data.color);\n    return colors;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {toValue} from \"../tooltip/selectionData\";\n\nexport function treeData(settings) {\n    const sets = {};\n    const real_aggs = settings.realValues.map(x => (x === null ? null : settings.mainValues.find(y => y.name === x)));\n    settings.data.forEach((d, j) => {\n        const groups = d.__ROW_PATH__;\n        const splits = getSplitNames(d);\n        splits.forEach(split => {\n            let currentLevel;\n            if (!sets[split]) {\n                sets[split] = [];\n            }\n            currentLevel = sets[split];\n            groups.forEach((group, i) => {\n                let element = currentLevel.find(e => e.name === group);\n                if (!element) {\n                    element = {name: group, children: []};\n                    currentLevel.push(element);\n                }\n                if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n                    const is_leaf = i === groups.length - 1;\n                    const colorValue = is_leaf ? getDataValue(d, settings.mainValues[1], split) : getDataValue(settings.agg_paths[j][i + 1] || d, settings.mainValues[1], split);\n                    if (colorValue !== undefined) {\n                        element.color = colorValue;\n                    }\n                }\n                if (settings.realValues.length > 2 && settings.realValues[2] !== null) {\n                    element.tooltip = [];\n                    for (let i = 2; i < settings.realValues.length; ++i) {\n                        element.tooltip.push(getDataValue(d, real_aggs[i], split));\n                    }\n                }\n                if (i === groups.length - 1) {\n                    element.name = groups.slice(-1)[0];\n                    if (groups.length === settings.crossValues.length) {\n                        const size = getDataValue(d, settings.mainValues[0], split);\n                        element.size = size > 0 ? size : 0;\n                    }\n                }\n                currentLevel = element.children;\n            });\n        });\n    });\n\n    const data = Object.entries(sets).map(set => {\n        const tree = {name: \"root\", children: set[1]};\n        const root = d3.hierarchy(tree).sum(d => d.size);\n        const chartData = d3.partition().size([2 * Math.PI, root.height + 1])(root);\n        chartData.each(d => {\n            d.current = d;\n            d.mainValues =\n                settings.realValues.length === 1 || (settings.realValues[1] === null && settings.realValues[2] === null)\n                    ? d.value\n                    : [d.value, d.data.color].concat(d.data.tooltip || []).filter(x => x !== undefined);\n            d.crossValue = d\n                .ancestors()\n                .slice(0, -1)\n                .reverse()\n                .map(cross => cross.data.name)\n                .join(\"|\");\n            d.key = set[0];\n            d.label = toValue(settings.crossValues[d.depth - 1 < 0 ? 0 : d.depth - 1].type, d.data.name);\n        });\n\n        return {\n            split: set[0],\n            data: chartData,\n            extents: getExtents(settings, set)\n        };\n    });\n\n    return data;\n}\n\nexport const getDataValue = (d, aggregate, split) => (split.length ? d[`${split}|${aggregate.name}`] : d[aggregate.name]);\n\nfunction getExtents(settings, [split, data]) {\n    if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n        const min = Math.min(...settings.data.map(d => getDataValue(d, settings.mainValues[1], split)));\n        const max = Math.max(...data.map(d => d.color));\n        return [min, max];\n    }\n}\n\nfunction getSplitNames(d) {\n    const splits = [];\n    Object.keys(d).forEach(key => {\n        if (key !== \"__ROW_PATH__\") {\n            const splitValue = key\n                .split(\"|\")\n                .slice(0, -1)\n                .join(\"|\");\n            if (!splits.includes(splitValue)) {\n                splits.push(splitValue);\n            }\n        }\n    });\n    return splits;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {arc} from \"d3\";\n\nexport const drawArc = radius =>\n    arc()\n        .startAngle(d => d.x0)\n        .endAngle(d => d.x1)\n        .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))\n        .padRadius(radius)\n        .innerRadius(d => Math.max(1, (d.y0 - 1) * radius))\n        .outerRadius(d => Math.max((d.y0 - 1) * radius, (d.y1 - 1) * radius - 1));\n\nexport const arcVisible = d => d.y0 >= 1 && d.x1 > d.x0;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\n\nexport const labelVisible = d => d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.06;\n\nexport function labelTransform(d, radius) {\n    const x = (((d.x0 + d.x1) / 2) * 180) / Math.PI;\n    const y = ((d.y0 - 1 + (d.y1 - 1)) / 2) * radius;\n    return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;\n}\n\nexport function cropLabel(d, targetWidth) {\n    let actualWidth = this.getBBox().width;\n    if (actualWidth > targetWidth) {\n        let labelText = d.label;\n        const textSelection = select(this);\n        while (actualWidth > targetWidth) {\n            labelText = labelText.substring(0, labelText.length - 1);\n            textSelection.text(() => labelText);\n            actualWidth = this.getBBox().width;\n        }\n        textSelection.text(() => `${labelText.substring(0, labelText.length - 3).replace(/\\s+$/, \"\")}...`);\n    }\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {interpolate} from \"d3\";\nimport {drawArc, arcVisible} from \"./sunburstArc\";\nimport {labelVisible, labelTransform} from \"./sunburstLabel\";\n\nexport const clickHandler = (data, g, parent, parentTitle, path, label, radius, split, settings) => (p, skipTransition) => {\n    settings.sunburstLevel[split] = p.data.name;\n    if (p.parent) {\n        parent.datum(p.parent);\n        parent.style(\"cursor\", \"pointer\");\n        parentTitle.html(`&#8682; ${p.label}`);\n    } else {\n        parent.datum(data);\n        parent.style(\"cursor\", \"default\");\n        parentTitle.html(\"\");\n    }\n    data.each(\n        d =>\n            (d.target = {\n                x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n                x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n                y0: Math.max(0, d.y0 - p.depth),\n                y1: Math.max(0, d.y1 - p.depth)\n            })\n    );\n\n    const t = g.transition().duration(skipTransition ? 0 : 750);\n    path.transition(t)\n        .tween(\"data\", d => {\n            const i = interpolate(d.current, d.target);\n            return t => (d.current = i(t));\n        })\n        .filter(function(d) {\n            return +this.getAttribute(\"fill-opacity\") || arcVisible(d.target);\n        })\n        .attr(\"fill-opacity\", d => (arcVisible(d.target) ? 1 : 0))\n        .attr(\"user-select\", d => (arcVisible(d.target) ? \"initial\" : \"none\"))\n        .attr(\"pointer-events\", d => (arcVisible(d.target) ? \"initial\" : \"none\"))\n        .attrTween(\"d\", d => () => drawArc(radius)(d.current));\n\n    label\n        .filter(function(d) {\n            return +this.getAttribute(\"fill-opacity\") || labelVisible(d.target);\n        })\n        .transition(t)\n        .attr(\"fill-opacity\", d => +labelVisible(d.target))\n        .attrTween(\"transform\", d => () => labelTransform(d.current, radius));\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {drawArc, arcVisible} from \"./sunburstArc\";\nimport {labelVisible, labelTransform, cropLabel} from \"./sunburstLabel\";\nimport {clickHandler} from \"./sunburstClick\";\n\nexport function sunburstSeries() {\n    let settings = null;\n    let split = null;\n    let data = null;\n    let color = null;\n    let radius = null;\n\n    const _sunburstSeries = sunburstElement => {\n        const segment = sunburstElement.selectAll(\"g.segment\").data(data.descendants().slice(1));\n        const segmentEnter = segment\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"segment\");\n\n        segmentEnter.append(\"path\");\n        segmentEnter\n            .append(\"text\")\n            .attr(\"class\", \"segment\")\n            .attr(\"dy\", \"0.35em\");\n        const segmentMerge = segmentEnter.merge(segment);\n\n        const path = segmentMerge\n            .select(\"path\")\n            .attr(\"fill-opacity\", d => (arcVisible(d.current) ? 1 : 0))\n            .attr(\"user-select\", d => (arcVisible(d.current) ? \"initial\" : \"none\"))\n            .attr(\"pointer-events\", d => (arcVisible(d.current) ? \"initial\" : \"none\"))\n            .attr(\"d\", d => drawArc(radius)(d.current));\n        color && path.style(\"fill\", d => color(d.data.color));\n\n        const label = segmentMerge\n            .select(\"text\")\n            .attr(\"fill-opacity\", d => +labelVisible(d.current))\n            .attr(\"transform\", d => labelTransform(d.current, radius))\n            .text(d => d.label)\n            .each(function(d) {\n                cropLabel.call(this, d, radius);\n            });\n\n        const parentTitle = sunburstElement.select(\"text.parent\");\n        const parent = sunburstElement\n            .select(\"circle\")\n            .attr(\"r\", radius)\n            .datum(data);\n\n        const onClick = clickHandler(data, sunburstElement, parent, parentTitle, path, label, radius, split, settings);\n        if (settings.sunburstLevel) {\n            const currentLevel = data.descendants().find(d => d.data.name === settings.sunburstLevel[split]);\n            currentLevel && onClick(currentLevel, true);\n        } else {\n            settings.sunburstLevel = {};\n        }\n        parent.on(\"click\", d => onClick(d, false));\n        path.filter(d => d.children)\n            .style(\"cursor\", \"pointer\")\n            .on(\"click\", d => onClick(d, false));\n    };\n\n    _sunburstSeries.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.split = (...args) => {\n        if (!args.length) {\n            return split;\n        }\n        split = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.radius = (...args) => {\n        if (!args.length) {\n            return radius;\n        }\n        radius = args[0];\n        return _sunburstSeries;\n    };\n\n    return _sunburstSeries;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {getOrCreateElement} from \"../utils/utils\";\n\nexport function gridLayoutMultiChart() {\n    let elementsPrefix = \"element-prefix-unset\";\n\n    let chartContainer = null;\n    let chartEnter = null;\n    let chartDiv = null;\n    let chartTitle = null;\n    let color = null;\n    let containerSize = null;\n\n    const _gridLayoutMultiChart = container => {\n        const innerContainer = getOrCreateElement(container, \"div.inner-container\", () => container.append(\"div\").attr(\"class\", \"inner-container\"));\n\n        const innerRect = innerContainer.node().getBoundingClientRect();\n        const containerHeight = innerRect.height;\n        const containerWidth = innerRect.width - (color ? 70 : 0);\n\n        const minSize = 500;\n        const data = container.datum();\n        const cols = Math.min(data.length, Math.floor(containerWidth / minSize));\n        const rows = Math.ceil(data.length / cols);\n        containerSize = {\n            width: containerWidth / Math.max(cols, 1),\n            height: Math.min(containerHeight, Math.max(containerHeight / rows, containerWidth / Math.max(cols, 1)))\n        };\n        if (containerHeight / rows > containerSize.height * 0.75) {\n            containerSize.height = containerHeight / rows;\n        }\n\n        innerContainer.style(\"grid-template-columns\", `repeat(${cols}, ${containerSize.width}px)`);\n        innerContainer.style(\"grid-template-rows\", `repeat(${rows}, ${containerSize.height}px)`);\n\n        chartDiv = innerContainer.selectAll(`div.${elementsPrefix}-container`).data(data, d => d.split);\n        chartDiv.exit().remove();\n\n        chartEnter = chartDiv\n            .enter()\n            .append(\"div\")\n            .attr(\"class\", `${elementsPrefix}-container`);\n\n        chartTitle = chartEnter\n            .append(\"div\")\n            .attr(\"class\", \"title-container\")\n            .style(\"text-align\", \"center\")\n            .attr(\"display\", \"inline-block\")\n            .append(\"text\")\n            .attr(\"class\", \"title\")\n            .style(\"text-align\", \"left\");\n\n        chartContainer = chartEnter\n            .append(\"svg\")\n            .append(\"g\")\n            .attr(\"class\", elementsPrefix);\n    };\n\n    _gridLayoutMultiChart.elementsPrefix = (...args) => {\n        if (!args.length) {\n            return elementsPrefix;\n        }\n        elementsPrefix = args[0];\n        return _gridLayoutMultiChart;\n    };\n\n    _gridLayoutMultiChart.chartContainer = () => chartContainer;\n\n    _gridLayoutMultiChart.chartEnter = () => chartEnter;\n\n    _gridLayoutMultiChart.chartDiv = () => chartDiv;\n\n    _gridLayoutMultiChart.chartTitle = () => chartTitle;\n\n    _gridLayoutMultiChart.containerSize = () => containerSize;\n\n    return _gridLayoutMultiChart;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {treeColor} from \"../series/sunburst/sunburstColor\";\nimport {treeData} from \"../data/treeData\";\nimport {sunburstSeries} from \"../series/sunburst/sunburstSeries\";\nimport {tooltip} from \"../tooltip/tooltip\";\nimport {gridLayoutMultiChart} from \"../layout/gridLayoutMultiChart\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport {colorLegend} from \"../legend/legend\";\n\nfunction sunburst(container, settings) {\n    if (settings.crossValues.length === 0) {\n        console.warn(\"Unable to render a chart in the absence of any groups.\");\n        return;\n    }\n\n    const data = treeData(settings);\n    const color = treeColor(settings, data);\n    const sunburstGrid = gridLayoutMultiChart().elementsPrefix(\"sunburst\");\n\n    container.datum(data).call(sunburstGrid);\n\n    if (color) {\n        const color_column = settings.realValues[1];\n        if (settings.mainValues.find(x => x.name === color_column)?.type === \"string\") {\n            const legend = colorLegend()\n                .settings(settings)\n                .scale(color);\n            container.call(legend);\n        } else {\n            const legend = colorRangeLegend().scale(color);\n            container.call(legend);\n        }\n    }\n\n    const sunburstContainer = sunburstGrid.chartContainer();\n    const sunburstEnter = sunburstGrid.chartEnter();\n    const sunburstDiv = sunburstGrid.chartDiv();\n    const sunburstTitle = sunburstGrid.chartTitle();\n    const containerSize = sunburstGrid.containerSize();\n\n    sunburstTitle.each((d, i, nodes) => select(nodes[i]).text(d.split));\n\n    sunburstContainer\n        .append(\"circle\")\n        .attr(\"fill\", \"none\")\n        .attr(\"pointer-events\", \"all\");\n\n    sunburstContainer.append(\"text\").attr(\"class\", \"parent\");\n    sunburstEnter\n        .merge(sunburstDiv)\n        .select(\"svg\")\n        .select(\"g.sunburst\")\n        .attr(\"transform\", `translate(${containerSize.width / 2}, ${containerSize.height / 2})`)\n        .each(function({split, data}) {\n            const sunburstElement = select(this);\n            const svgNode = this.parentNode;\n            const {width, height} = svgNode.getBoundingClientRect();\n\n            const radius = (Math.min(width, height) - 24) / (settings.crossValues.length * 2);\n            sunburstSeries()\n                .settings(settings)\n                .split(split)\n                .data(data)\n                .color(color)\n                .radius(radius)(sunburstElement);\n\n            tooltip().settings(settings)(sunburstElement.selectAll(\"g.segment\"));\n        });\n}\n\nsunburst.plugin = {\n    type: \"d3_sunburst\",\n    name: \"Sunburst\",\n    max_cells: 7500,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"]\n    }\n};\n\nexport default sunburst;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {seriesColorRange} from \"../seriesRange\";\nimport {seriesColorsFromDistinct} from \"../seriesColors\";\n\nexport function treeColor(settings, data) {\n    if (settings.realValues.length < 1 || settings.realValues[1] === null) return;\n    const color_column = settings.realValues[1];\n    const colors = data\n        .filter(x => x.height > 0)\n        .map(x => getColors(x))\n        .reduce((a, b) => a.concat(b));\n    if (settings.mainValues.find(x => x.name === color_column)?.type === \"string\") {\n        return seriesColorsFromDistinct(settings, colors);\n    } else {\n        let min = Math.min(...colors);\n        let max = Math.max(...colors);\n        return seriesColorRange(settings, null, null, [min, max]);\n    }\n}\n\n// only get the colors from the bottom level (e.g. nodes with no children)\nfunction getColors(nodes, colors = []) {\n    nodes.children && nodes.children.length > 0 ? nodes.children.forEach(child => colors.concat(getColors(child, colors))) : nodes.data.color && colors.push(nodes.data.color);\n    return colors;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {select} from \"d3\";\nimport {isElementOverlapping, isElementOverflowing} from \"../../utils/utils\";\n\nconst minTextSize = 7;\n\nexport const labelMapExists = d => (d.target && d.target.textAttributes ? true : false);\n\nexport const toggleLabels = (nodes, treemapLevel, crossValues) => {\n    nodes\n        .selectAll(\"text\")\n        .style(\"font-size\", null)\n        .attr(\"class\", d => textLevelHelper(d, treemapLevel, crossValues));\n\n    const visibleNodes = selectVisibleNodes(nodes);\n    centerLabels(visibleNodes);\n    preventTextCollisions(visibleNodes);\n};\n\nexport const restoreLabels = nodes => {\n    nodes.each((d, i, nodes) => {\n        const label = select(nodes[i]).selectAll(\"text\");\n        label\n            .attr(\"dx\", d.target.textAttributes.dx)\n            .attr(\"dy\", d.target.textAttributes.dy)\n            .attr(\"class\", d.target.textAttributes.class)\n            .style(\"font-size\", d.target.textAttributes[\"font-size\"]);\n    });\n};\n\nexport const preventTextCollisions = nodes => {\n    const textCollisionFuzzFactorPx = -2;\n    const textAdjustPx = 14; // This should remain the same as the css value for .top => font-size in the chart.less\n    const rect = element => element.getBoundingClientRect();\n\n    const topNodes = [];\n    nodes\n        .selectAll(\"text\")\n        .filter((_, i, nodes) => select(nodes[i]).attr(\"class\") === textVisability.high)\n        .each((_, i, nodes) => topNodes.push(nodes[i]));\n\n    nodes\n        .selectAll(\"text\")\n        .filter((_, i, nodes) => select(nodes[i]).attr(\"class\") === textVisability.low)\n        .each((_, i, nodes) => {\n            const lowerNode = nodes[i];\n            topNodes\n                .filter(topNode => isElementOverlapping(\"x\", rect(topNode), rect(lowerNode)) && isElementOverlapping(\"y\", rect(topNode), rect(lowerNode), textCollisionFuzzFactorPx))\n                .forEach(() => select(lowerNode).attr(\"dy\", Number(select(lowerNode).attr(\"dy\")) + textAdjustPx));\n        });\n};\n\nexport const lockTextOpacity = d => select(d).style(\"opacity\", textOpacity[select(d).attr(\"class\")]);\n\nexport const unlockTextOpacity = d => select(d).style(\"opacity\", null);\n\nexport const textOpacity = {top: 1, mid: 0.7, lower: 0};\n\nexport const selectVisibleNodes = nodes =>\n    nodes.filter(\n        (_, i, nodes) =>\n            select(nodes[i])\n                .selectAll(\"text\")\n                .attr(\"class\") !== textVisability.zero\n    );\n\nexport const adjustLabelsThatOverflow = nodes => nodes.selectAll(\"text\").each((_, i, nodes) => shrinkOrHideText(nodes[i]));\n\nconst centerLabels = nodes => nodes.selectAll(\"text\").each((_, i, nodes) => centerText(nodes[i]));\n\nconst centerText = d => {\n    const nodeSelect = select(d);\n    const rect = d.getBoundingClientRect();\n    nodeSelect.attr(\"dx\", 0 - rect.width / 2).attr(\"dy\", 0 + rect.height / 4);\n};\n\nconst shrinkOrHideText = d => {\n    const parent = d.parentNode;\n    const rect = parent.childNodes[0];\n\n    const textRect = d.getBoundingClientRect();\n    const rectRect = rect.getBoundingClientRect();\n\n    if (!needsToShrinkOrHide(d, rectRect, textRect, \"left\") && !needsToShrinkOrHide(d, rectRect, textRect, \"bottom\")) {\n        select(d).attr(\"class\", select(d).attr(\"class\"));\n    }\n};\n\nconst needsToShrinkOrHide = (d, rectRect, textRect, direction) => {\n    if (isElementOverflowing(rectRect, textRect, direction)) {\n        const fontSize = parseInt(select(d).style(\"font-size\"));\n        if (fontSize > minTextSize) {\n            select(d).style(\"font-size\", `${fontSize - 1}px`);\n            centerText(d);\n            shrinkOrHideText(d);\n        } else {\n            select(d).style(\"font-size\", null);\n            select(d).attr(\"class\", textVisability.zero);\n        }\n        return true;\n    }\n    return false;\n};\n\nconst textLevelHelper = (d, treemapLevel, crossValues) => {\n    if (!crossValues.filter(x => x !== \"\").every(x => d.crossValue.split(\"|\").includes(x))) return textVisability.zero;\n    switch (d.depth) {\n        case treemapLevel + 1:\n            return textVisability.high;\n        case treemapLevel + 2:\n            return textVisability.low;\n        default:\n            return textVisability.zero;\n    }\n};\n\nconst textVisability = {high: \"top\", low: \"mid\", zero: \"lower\"};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\n\nexport default (width, height) => {\n    const treemapLayout = d3\n        .treemap()\n        .size([width, height])\n        .paddingInner(d => 1 + 2 * (d.height - 1));\n\n    treemapLayout.tile(d3.treemapBinary);\n\n    return treemapLayout;\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {calcWidth, calcHeight} from \"./treemapSeries\";\nimport {hierarchy, select} from \"d3\";\nimport treemapLayout from \"./treemapLayout\";\nimport {textOpacity} from \"./treemapLabel\";\n\nconst includesAllCrossValues = (d, crossValues) => crossValues.every(val => d.crossValue.split(\"|\").includes(val));\n\nexport function calculateSubTreeMap(d, crossValues, nodesMerge, treemapLevel, rootNode, treemapDiv) {\n    // We can approximate coordinates for most of the tree which will be shunted\n    // beyond the viewable area. This approach alone results in excessive\n    // margins as one goes deeper into the treemap.\n    approximateAttributesForAllNodes(d, crossValues, nodesMerge, treemapLevel, rootNode);\n    d.mapLevel[treemapLevel].levelRoot = true;\n    // Use the pre-existing d3 mechanism to calculate the subtree for the\n    // viewable area.\n    recalculateVisibleSubTreeCoordinates(d, treemapDiv.node().getBoundingClientRect().width, treemapDiv.node().getBoundingClientRect().height, treemapLevel);\n\n    calculateTextOpacities(nodesMerge, treemapLevel);\n}\n\nexport function calculateRootLevelMap(nodesMerge, rootNode) {\n    nodesMerge.each(d => {\n        d.mapLevel = [];\n        d.mapLevel[0] = {\n            x0: d.x0,\n            x1: calcWidth(d) + d.x0,\n            y0: d.y0,\n            y1: calcHeight(d) + d.y0,\n            visible: true,\n            opacity: 1\n        };\n    });\n    rootNode.mapLevel[0].levelRoot = true;\n    calculateTextOpacities(nodesMerge, 0);\n}\n\nexport const saveLabelMap = (nodes, treemapLevel) => {\n    nodes.each((d, i, nodes) => {\n        const label = select(nodes[i]).selectAll(\"text\");\n        d.mapLevel[treemapLevel].textAttributes = {\n            dx: label.attr(\"dx\"),\n            dy: label.attr(\"dy\"),\n            class: label.attr(\"class\"),\n            \"font-size\": label.style(\"font-size\")\n        };\n    });\n};\n\nfunction approximateAttributesForAllNodes(d, crossValues, nodesMerge, treemapLevel, rootNode) {\n    const oldDimensions = {x: d.x0, y: d.y0, width: d.x1 - d.x0, height: d.y1 - d.y0};\n    const newDimensions = {width: rootNode.x1 - rootNode.x0, height: rootNode.y1 - rootNode.y0};\n    const dimensionMultiplier = {width: newDimensions.width / oldDimensions.width, height: newDimensions.height / oldDimensions.height};\n\n    nodesMerge.each(d => {\n        const x0 = (d.x0 - oldDimensions.x) * dimensionMultiplier.width;\n        const y0 = (d.y0 - oldDimensions.y) * dimensionMultiplier.height;\n        const width = calcWidth(d) * dimensionMultiplier.width;\n        const height = calcHeight(d) * dimensionMultiplier.height;\n        const visible = includesAllCrossValues(d, crossValues) && d.data.name != crossValues[treemapLevel - 1];\n\n        d.mapLevel[treemapLevel] = {\n            x0,\n            x1: width + x0,\n            y0,\n            y1: height + y0,\n            visible,\n            opacity: visible ? 1 : 0\n        };\n    });\n    d.mapLevel[treemapLevel].levelRoot = true;\n}\n\nfunction recalculateVisibleSubTreeCoordinates(subTreeRoot, treeRootWidth, treeRootHeight, treemapLevel) {\n    const treemapBlueprinter = treemapLayout(treeRootWidth, treeRootHeight);\n    const treemapBlueprint = treemapBlueprinter(hierarchy(subTreeRoot.data).sum(d => d.size));\n\n    const dummiedDescendants = treemapBlueprint.descendants();\n    const descendants = subTreeRoot.descendants();\n\n    dummiedDescendants.forEach((_, i) => {\n        descendants[i].mapLevel[treemapLevel].x0 = dummiedDescendants[i].x0;\n        descendants[i].mapLevel[treemapLevel].x1 = dummiedDescendants[i].x1;\n        descendants[i].mapLevel[treemapLevel].y0 = dummiedDescendants[i].y0;\n        descendants[i].mapLevel[treemapLevel].y1 = dummiedDescendants[i].y1;\n    });\n}\n\nfunction calculateTextOpacities(nodesMerge, treemapLevel) {\n    nodesMerge.selectAll(\"text\").each((_, i, nodes) => {\n        const text = select(nodes[i]);\n        const d = select(nodes[i]).datum();\n        const textVis = text.attr(\"class\");\n        d.mapLevel[treemapLevel].textLockedAt = {opacity: textOpacity[textVis]};\n    });\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {calcWidth, calcHeight} from \"./treemapSeries\";\nimport {labelMapExists, toggleLabels, preventTextCollisions, lockTextOpacity, unlockTextOpacity, textOpacity, selectVisibleNodes, adjustLabelsThatOverflow, restoreLabels} from \"./treemapLabel\";\nimport {calculateSubTreeMap, saveLabelMap} from \"./treemapLevelCalculation\";\n\nexport function returnToLevel(rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls) {\n    if (settings.treemapLevel > 0) {\n        const crossValues = rootNode.crossValue.split(\"|\");\n        executeTransition(rootNode, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, 0, crossValues, parentCtrls, 1, false);\n\n        settings.treemapRoute.slice(1, settings.treemapRoute.length).forEach(cv => {\n            const d = nodesMerge.filter(d => d.crossValue === cv).datum();\n            const crossValues = d.crossValue.split(\"|\");\n            calculateSubTreeMap(d, crossValues, nodesMerge, d.depth, rootNode, treemapDiv);\n            executeTransition(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, d.depth, crossValues, parentCtrls, 1, false);\n        });\n    }\n}\n\nexport function changeLevel(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls) {\n    if (!d.children) return;\n\n    if (settings.treemapLevel < d.depth) {\n        settings.treemapRoute.push(d.crossValue);\n    } else {\n        settings.treemapRoute.pop();\n    }\n\n    settings.treemapLevel = d.depth;\n\n    const crossValues = d.crossValue.split(\"|\");\n    if (!d.mapLevel[settings.treemapLevel] || !d.mapLevel[settings.treemapLevel].levelRoot) {\n        calculateSubTreeMap(d, crossValues, nodesMerge, settings.treemapLevel, rootNode, treemapDiv);\n    }\n\n    executeTransition(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, settings.treemapLevel, crossValues, parentCtrls);\n}\n\nfunction executeTransition(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, treemapLevel, crossValues, parentCtrls, duration = 500, recordLabelMap = true) {\n    const parent = d.parent;\n\n    const t = treemapSvg\n        .transition(\"main transition\")\n        .duration(duration)\n        .ease(d3.easeCubicOut);\n\n    nodesMerge.each(d => (d.target = d.mapLevel[treemapLevel]));\n\n    if (!labelMapExists(d)) preventUserInteraction(nodesMerge, parentCtrls);\n\n    // hide hidden svgs\n    nodesMerge\n        .transition(t)\n        .tween(\"data\", d => {\n            const i = d3.interpolate(d.current, d.target);\n            return t => (d.current = i(t));\n        })\n        .styleTween(\"opacity\", d => () => d.current.opacity)\n        .attrTween(\"pointer-events\", d => () => (d.target.visible ? \"all\" : \"none\"));\n\n    rects\n        .transition(t)\n        .filter(d => d.target.visible)\n        .styleTween(\"x\", d => () => `${d.current.x0}px`)\n        .styleTween(\"y\", d => () => `${d.current.y0}px`)\n        .styleTween(\"width\", d => () => `${d.current.x1 - d.current.x0}px`)\n        .styleTween(\"height\", d => () => `${d.current.y1 - d.current.y0}px`);\n\n    labels\n        .transition(t)\n        .filter(d => d.target.visible)\n        .attrTween(\"x\", d => () => d.current.x0 + calcWidth(d.current) / 2)\n        .attrTween(\"y\", d => () => d.current.y0 + calcHeight(d.current) / 2)\n        .end()\n        .catch(() => enableUserInteraction(nodesMerge))\n        .then(() => {\n            if (!labelMapExists(d)) {\n                preventTextCollisions(visibleLabelNodes);\n                adjustLabelsThatOverflow(visibleLabelNodes);\n                fadeTextTransition(labels, treemapSvg, duration);\n                if (recordLabelMap) saveLabelMap(nodesMerge, treemapLevel);\n                enableUserInteraction(nodesMerge, parentCtrls, parent);\n            }\n        })\n        .catch(ex => {\n            console.error(\"Exception completing promises after main transition\", ex);\n            enableUserInteraction(nodesMerge, parentCtrls, parent);\n        });\n\n    if (!labelMapExists(d)) {\n        labels.each((_, i, labels) => lockTextOpacity(labels[i]));\n        toggleLabels(nodesMerge, treemapLevel, crossValues);\n    } else {\n        restoreLabels(nodesMerge);\n    }\n\n    const visibleLabelNodes = selectVisibleNodes(nodesMerge);\n\n    if (parent) {\n        parentCtrls\n            .hide(false)\n            .text(d.label)\n            .onClick(() => changeLevel(parent, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls, duration))();\n    } else {\n        parentCtrls.hide(true)();\n    }\n}\n\nasync function fadeTextTransition(labels, treemapSvg, duration = 400) {\n    const t = treemapSvg\n        .transition(\"text fade transition\")\n        .duration(duration)\n        .ease(d3.easeCubicOut);\n\n    await labels\n        .transition(t)\n        .filter(d => d.target.visible)\n        .tween(\"data\", (d, i, labels) => {\n            const label = labels[i];\n            const interpolation = d3.interpolate(lockedOpacity(d), targetOpacity(label));\n            return t => (d.current.opacity = interpolation(t));\n        })\n        .styleTween(\"opacity\", d => () => d.current.opacity)\n        .end()\n        .catch(ex => console.error(\"Exception in text fade transition\", ex))\n        .then(() => labels.each((_, i, labels) => unlockTextOpacity(labels[i])));\n}\n\nconst lockedOpacity = d => d.target.textLockedAt.opacity;\nconst targetOpacity = d => textOpacity[d3.select(d).attr(\"class\")];\n\nconst preventUserInteraction = (nodes, parentCtrls) => {\n    parentCtrls.deactivate(true);\n\n    nodes.each((_, i, nodes) => {\n        const rect = d3.select(nodes[i]).selectAll(\"rect\");\n        rect.attr(\"pointer-events\", \"none\");\n    });\n};\n\nconst enableUserInteraction = (nodes, parentCtrls) => {\n    if (parentCtrls) parentCtrls.deactivate(false);\n\n    nodes.each((_, i, nodes) => {\n        const rect = d3.select(nodes[i]).selectAll(\"rect\");\n        rect.attr(\"pointer-events\", null);\n    });\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {toggleLabels, adjustLabelsThatOverflow, selectVisibleNodes} from \"./treemapLabel\";\nimport treemapLayout from \"./treemapLayout\";\nimport {changeLevel, returnToLevel} from \"./treemapTransitions\";\nimport {parentControls} from \"./treemapControls\";\nimport {calculateRootLevelMap, saveLabelMap} from \"./treemapLevelCalculation\";\n\nexport const nodeLevel = {\n    leaf: \"leafnode\",\n    branch: \"branchnode\",\n    root: \"rootnode\"\n};\nexport const calcWidth = d => d.x1 - d.x0;\nexport const calcHeight = d => d.y1 - d.y0;\nconst isLeafNode = (maxDepth, d) => d.depth === maxDepth;\nconst nodeLevelHelper = (maxDepth, d) => (d.depth === 0 ? nodeLevel.root : isLeafNode(maxDepth, d) ? nodeLevel.leaf : nodeLevel.branch);\n\nexport function treemapSeries() {\n    let settings = null;\n    let data = null;\n    let color = null;\n    let treemapDiv = null;\n    let parentCtrls = null;\n\n    const _treemapSeries = treemapSvg => {\n        parentCtrls = parentControls(treemapDiv);\n        parentCtrls();\n\n        const maxDepth = data.height;\n        if (!settings.treemapLevel) settings.treemapLevel = 0;\n        if (!settings.treemapRoute) settings.treemapRoute = [];\n        const treemap = treemapLayout(treemapDiv.node().getBoundingClientRect().width, treemapDiv.node().getBoundingClientRect().height);\n        treemap(data);\n\n        const nodes = treemapSvg.selectAll(\"g\").data(data.descendants());\n        const nodesEnter = nodes.enter().append(\"g\");\n\n        nodesEnter.append(\"rect\");\n        nodesEnter.append(\"text\");\n\n        // Draw child nodes first\n        const nodesMerge = nodesEnter.merge(nodes).sort((a, b) => b.depth - a.depth);\n\n        const rects = nodesMerge\n            .select(\"rect\")\n            .attr(\"class\", d => `treerect ${nodeLevelHelper(maxDepth, d)}`)\n            .style(\"x\", d => d.x0)\n            .style(\"y\", d => d.y0)\n            .style(\"width\", d => calcWidth(d))\n            .style(\"height\", d => calcHeight(d));\n\n        color &&\n            rects.style(\"fill\", d => {\n                if (d.data.color) {\n                    return color(d.data.color);\n                }\n            });\n\n        const labels = nodesMerge\n            .filter(d => d.value !== 0)\n            .select(\"text\")\n            .attr(\"x\", d => d.x0 + calcWidth(d) / 2)\n            .attr(\"y\", d => d.y0 + calcHeight(d) / 2)\n            .text(d => d.label);\n\n        const rootNode = rects.filter(d => d.crossValue === \"\").datum();\n        calculateRootLevelMap(nodesMerge, rootNode);\n\n        toggleLabels(nodesMerge, 0, []);\n        adjustLabelsThatOverflow(selectVisibleNodes(nodesMerge));\n        saveLabelMap(nodesMerge, 0);\n\n        if (settings.treemapRoute.length === 0) settings.treemapRoute.push(rootNode.crossValue);\n        rects.filter(d => d.children).on(\"click\", d => changeLevel(d, rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls));\n\n        returnToLevel(rects, nodesMerge, labels, settings, treemapDiv, treemapSvg, rootNode, parentCtrls);\n    };\n\n    _treemapSeries.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.container = (...args) => {\n        if (!args.length) {\n            return treemapDiv;\n        }\n        treemapDiv = args[0];\n        return _treemapSeries;\n    };\n\n    return _treemapSeries;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {getOrCreateElement} from \"../../utils/utils\";\nimport template from \"../../../html/parent-controls.html\";\n\nexport function parentControls(container) {\n    let onClick = null;\n    let text = null;\n    let hide = true;\n    let deactivated = false;\n\n    const parent = getOrCreateElement(container, \".parent-controls\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"parent-controls\")\n            .style(\"display\", hide ? \"none\" : \"\")\n            .html(template)\n    );\n\n    const controls = () => {\n        parent\n            .style(\"display\", hide ? \"none\" : \"\")\n            .select(\"#goto-parent\")\n            .style(\"pointer-events\", deactivated ? \"none\" : null)\n            .html(`⇪ ${text}`)\n            .on(\"click\", () => onClick());\n    };\n\n    controls.deactivate = (...args) => {\n        if (!args.length) {\n            return deactivated;\n        }\n        deactivated = args[0];\n\n        const button = parent.select(\"#goto-parent\");\n        if (deactivated) {\n            button.style(\"pointer-events\", \"none\");\n        } else {\n            button.style(\"pointer-events\", null);\n        }\n\n        return controls;\n    };\n\n    controls.hide = (...args) => {\n        if (!args.length) {\n            return hide;\n        }\n        hide = args[0];\n        return controls;\n    };\n\n    controls.text = (...args) => {\n        if (!args.length) {\n            return text;\n        }\n        text = args[0];\n        return controls;\n    };\n\n    controls.onClick = (...args) => {\n        if (!args.length) {\n            return onClick;\n        }\n        onClick = args[0];\n        return controls;\n    };\n\n    return controls;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport {treeColor} from \"../series/treemap/treemapColor\";\nimport {treeData} from \"../data/treeData\";\nimport {treemapSeries} from \"../series/treemap/treemapSeries\";\nimport {tooltip} from \"../tooltip/tooltip\";\nimport {gridLayoutMultiChart} from \"../layout/gridLayoutMultiChart\";\nimport {colorRangeLegend} from \"../legend/colorRangeLegend\";\nimport {colorLegend} from \"../legend/legend\";\n\nfunction treemap(container, settings) {\n    if (settings.crossValues.length === 0) {\n        console.warn(\"Unable to render a chart in the absence of any groups.\");\n        return;\n    }\n    if (!settings.treemaps) settings.treemaps = {};\n\n    const data = treeData(settings);\n    const color = treeColor(\n        settings,\n        data.map(d => d.data)\n    );\n\n    if (color) {\n        this._container.classList.add(\"has-legend\");\n    }\n\n    const treemapGrid = gridLayoutMultiChart().elementsPrefix(\"treemap\");\n    container.datum(data).call(treemapGrid);\n    if (color) {\n        const color_column = settings.realValues[1];\n        if (settings.mainValues.find(x => x.name === color_column)?.type === \"string\") {\n            const legend = colorLegend()\n                .settings(settings)\n                .scale(color);\n            container.call(legend);\n        } else {\n            const legend = colorRangeLegend().scale(color);\n            container.call(legend);\n        }\n    }\n\n    const treemapEnter = treemapGrid.chartEnter();\n    const treemapDiv = treemapGrid.chartDiv();\n    const treemapTitle = treemapGrid.chartTitle();\n\n    treemapTitle.each((d, i, nodes) => d3.select(nodes[i]).text(d.split));\n    treemapEnter\n        .merge(treemapDiv)\n        .select(\"svg\")\n        .select(\"g.treemap\")\n        .each(function({split, data}) {\n            const treemapSvg = d3.select(this);\n\n            if (!settings.treemaps[split]) settings.treemaps[split] = {};\n\n            treemapSeries()\n                .settings(settings.treemaps[split])\n                .data(data)\n                .container(d3.select(d3.select(this.parentNode).node().parentNode))\n                .color(color)(treemapSvg);\n\n            tooltip()\n                .settings(settings)\n                .centered(true)(treemapSvg.selectAll(\"g\"));\n        });\n}\n\ntreemap.plugin = {\n    type: \"d3_treemap\",\n    name: \"Treemap\",\n    max_cells: 5000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"]\n    }\n};\nexport default treemap;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport barChart from \"./bar\";\nimport columnChart from \"./column\";\nimport lineChart from \"./line\";\nimport xyLine from \"./xy-line\";\nimport areaChart from \"./area\";\nimport yScatter from \"./y-scatter\";\nimport xyScatter from \"./xy-scatter\";\nimport heatmap from \"./heatmap\";\nimport ohlc from \"./ohlc\";\nimport candlestick from \"./candlestick\";\nimport sunburst from \"./sunburst\";\nimport treemap from \"./treemap\";\n\nconst chartClasses = [barChart, columnChart, lineChart, xyLine, areaChart, yScatter, xyScatter, ohlc, candlestick, treemap, sunburst, heatmap];\n\nexport default chartClasses;\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport * as d3 from \"d3\";\nimport * as gparser from \"gradient-parser\";\n\nexport const initialiseStyles = (container, settings) => {\n    if (!settings.colorStyles) {\n        const data = [\"series\"];\n        for (let n = 1; n <= 10; n++) {\n            data.push(`series-${n}`);\n        }\n\n        const styles = {\n            scheme: [],\n            gradient: {},\n            interpolator: {},\n            grid: {}\n        };\n\n        const computed = computedStyle(container);\n        data.forEach((d, i) => {\n            styles[d] = computed(`--d3fc-${d}`);\n\n            if (i > 0) {\n                styles.scheme.push(styles[d]);\n            }\n        });\n\n        styles.opacity = getOpacityFromColor(styles.series);\n        styles.grid.gridLineColor = computed`--d3fc-gridline--color`;\n\n        const gradients = [\"full\", \"positive\", \"negative\"];\n        gradients.forEach(g => {\n            const gradient = computed(`--d3fc-${g}--gradient`);\n            styles.gradient[g] = parseGradient(gradient, styles.opacity);\n        });\n\n        settings.colorStyles = styles;\n    }\n};\n\nconst getOpacityFromColor = color => {\n    return d3.color(color).opacity;\n};\n\nconst stepAsColor = (value, opacity) => {\n    const color = d3.color(`#${value}`);\n    color.opacity = opacity;\n    return color + \"\";\n};\n\nconst computedStyle = container => {\n    if (window.ShadyCSS) {\n        return d => window.ShadyCSS.getComputedStyleValue(container, d);\n    } else {\n        const containerStyles = getComputedStyle(container);\n        return d => containerStyles.getPropertyValue(d);\n    }\n};\n\nconst parseGradient = (gradient, opacity) => {\n    const parsed = gparser.parse(gradient)[0].colorStops;\n    return parsed.map((g, i) => [g.length ? g.length.value / 100 : i / (parsed.length - 1), stepAsColor(g.value, opacity)]).sort((a, b) => a[0] - b[0]);\n};\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nimport * as d3 from \"d3\";\n\nimport style from \"../../less/chart.less\";\nimport template from \"../../html/d3fc-chart.html\";\nimport {areArraysEqualSimple} from \"../utils/utils\";\nimport {initialiseStyles} from \"../series/colorStyles\";\n\nimport {bindTemplate} from \"@finos/perspective-viewer/src/js/utils\";\n\nconst styleWithD3FC = `${style}${getD3FCStyles()}`;\nconst EXCLUDED_SETTINGS = [\"crossValues\", \"mainValues\", \"splitValues\", \"filter\", \"data\", \"size\", \"colorStyles\"];\n\n@bindTemplate(template, styleWithD3FC) // eslint-disable-next-line no-unused-vars\nclass D3FCChartElement extends HTMLElement {\n    constructor() {\n        super();\n        this._chart = null;\n        this._settings = null;\n    }\n\n    connectedCallback() {\n        this._container = this.shadowRoot.querySelector(\".chart\");\n    }\n\n    render(chart, settings) {\n        this._chart = chart;\n\n        const handler = {\n            set: (obj, prop, value) => {\n                if (!EXCLUDED_SETTINGS.includes(prop)) {\n                    this._container && this._container.dispatchEvent(new Event(\"perspective-plugin-update\", {bubbles: true, composed: true}));\n                }\n                obj[prop] = value;\n                return true;\n            }\n        };\n\n        this._settings = new Proxy(this._configureSettings(this._settings, settings), handler);\n        initialiseStyles(this._container, this._settings);\n\n        if ((this._settings.data && this._settings.data.length > 0) || chart.plugin.type !== this._chart.plugin.type) {\n            this.remove();\n        }\n        this.draw();\n\n        if (window.navigator.userAgent.indexOf(\"Edge\") > -1) {\n            // Workaround for MS Edge issue that doesn't draw content in the\n            // plot-area until the chart D3 object is redrawn\n            setTimeout(() => this.draw());\n        }\n    }\n\n    draw() {\n        if (this._settings.data) {\n            const containerDiv = d3.select(this._container);\n            const chartClass = `chart ${this._chart.plugin.type}`;\n            this._settings.size = this._container.getBoundingClientRect();\n\n            if (this._settings.data.length > 0) {\n                this._chart(containerDiv.attr(\"class\", chartClass), this._settings);\n            } else {\n                containerDiv.attr(\"class\", `${chartClass} disabled`);\n            }\n        }\n    }\n\n    resize() {\n        this.draw();\n    }\n\n    remove() {\n        this._container.innerHTML = \"\";\n    }\n\n    delete() {\n        this.remove();\n    }\n\n    getContainer() {\n        return this._container;\n    }\n\n    getSettings() {\n        const settings = {...this._settings};\n        EXCLUDED_SETTINGS.forEach(s => {\n            delete settings[s];\n        });\n        return settings;\n    }\n\n    setSettings(settings) {\n        this._settings = {...this._settings, ...settings};\n        this.draw();\n    }\n\n    _configureSettings(oldSettings, newSettings) {\n        if (oldSettings) {\n            if (!oldSettings.data) {\n                // Combine with the restored settings\n                return {...oldSettings, ...newSettings};\n            }\n\n            const oldValues = [oldSettings.crossValues, oldSettings.mainValues, oldSettings.splitValues, oldSettings.realValues];\n            const newValues = [newSettings.crossValues, newSettings.mainValues, newSettings.splitValues, newSettings.realValues];\n            if (areArraysEqualSimple(oldValues, newValues)) return {...oldSettings, data: newSettings.data, agg_paths: newSettings.agg_paths, colorStyles: null};\n        }\n        this.remove();\n        return newSettings;\n    }\n}\n\nfunction getD3FCStyles() {\n    const headerStyles = document.querySelector(\"head\").querySelectorAll(\"style\");\n    const d3fcStyles = [];\n    headerStyles.forEach(s => {\n        if (s.innerText.indexOf(\"d3fc-\") !== -1) {\n            d3fcStyles.push(s.innerText);\n        }\n    });\n    return d3fcStyles.join(\"\");\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {registerPlugin} from \"@finos/perspective-viewer/src/js/utils.js\";\nimport charts from \"../charts/charts\";\nimport \"./polyfills/index\";\nimport \"./template\";\n\nexport const PRIVATE = Symbol(\"D3FC chart\");\n\nconst DEFAULT_PLUGIN_SETTINGS = {\n    initial: {\n        type: \"number\",\n        count: 1\n    },\n    selectMode: \"select\"\n};\n\nexport function register(...plugins) {\n    plugins = new Set(plugins.length > 0 ? plugins : charts.map(chart => chart.plugin.type));\n    charts.forEach(chart => {\n        if (plugins.has(chart.plugin.type)) {\n            registerPlugin(chart.plugin.type, {\n                ...DEFAULT_PLUGIN_SETTINGS,\n                ...chart.plugin,\n                create: drawChart(chart),\n                resize: resizeChart,\n                delete: deleteChart,\n                save,\n                restore\n            });\n        }\n    });\n}\n\nfunction drawChart(chart) {\n    return async function(el, view, task, end_col, end_row) {\n        let jsonp, metadata;\n        const realValues = JSON.parse(this.getAttribute(\"columns\"));\n        const leaves_only = chart.plugin.type !== \"d3_sunburst\";\n        if (end_col && end_row) {\n            jsonp = view.to_json({end_row, end_col, leaves_only});\n        } else if (end_col) {\n            jsonp = view.to_json({end_col, leaves_only});\n        } else if (end_row) {\n            jsonp = view.to_json({end_row, leaves_only});\n        } else {\n            jsonp = view.to_json({leaves_only});\n        }\n        metadata = await Promise.all([this._table.schema(false), view.expression_schema(false), view.schema(false), jsonp, view.get_config()]);\n\n        if (task.cancelled) {\n            return;\n        }\n\n        let [table_schema, expression_schema, view_schema, json, config] = metadata;\n\n        /**\n         * Retrieve a tree axis column from the table and expression schemas,\n         * returning a String type or `undefined`.\n         * @param {String} column a column name\n         */\n        const get_pivot_column_type = function(column) {\n            let type = table_schema[column];\n            if (!type) {\n                type = expression_schema[column];\n            }\n            return type;\n        };\n\n        const {columns, row_pivots, column_pivots, filter} = config;\n        const filtered =\n            row_pivots.length > 0\n                ? json.reduce(\n                      (acc, col) => {\n                          if (col.__ROW_PATH__ && col.__ROW_PATH__.length == row_pivots.length) {\n                              acc.agg_paths.push(acc.aggs.slice());\n                              acc.rows.push(col);\n                          } else {\n                              const len = col.__ROW_PATH__.filter(x => x !== undefined).length;\n                              acc.aggs[len] = col;\n                              acc.aggs = acc.aggs.slice(0, len + 1);\n                          }\n                          return acc;\n                      },\n                      {rows: [], aggs: [], agg_paths: []}\n                  )\n                : {rows: json};\n        const dataMap = (col, i) => (!row_pivots.length ? {...col, __ROW_PATH__: [i]} : col);\n        const mapped = filtered.rows.map(dataMap);\n\n        let settings = {\n            realValues,\n            crossValues: row_pivots.map(r => ({name: r, type: get_pivot_column_type(r)})),\n            mainValues: columns.map(a => ({name: a, type: view_schema[a]})),\n            splitValues: column_pivots.map(r => ({name: r, type: get_pivot_column_type(r)})),\n            filter,\n            data: mapped,\n            agg_paths: filtered.agg_paths\n        };\n\n        createOrUpdateChart.call(this, el, chart, settings);\n        await new Promise(setTimeout);\n    };\n}\n\nfunction getOrCreatePluginElement() {\n    let perspective_d3fc_element;\n    this[PRIVATE] = this[PRIVATE] || {};\n    if (!this[PRIVATE].chart) {\n        perspective_d3fc_element = this[PRIVATE].chart = document.createElement(\"perspective-d3fc-chart\");\n    } else {\n        perspective_d3fc_element = this[PRIVATE].chart;\n    }\n    return perspective_d3fc_element;\n}\n\nfunction createOrUpdateChart(div, chart, settings) {\n    const perspective_d3fc_element = getOrCreatePluginElement.call(this);\n\n    if (!div.contains(perspective_d3fc_element)) {\n        div.innerHTML = \"\";\n        div.appendChild(perspective_d3fc_element);\n    }\n\n    perspective_d3fc_element.render(chart, settings);\n}\n\nfunction resizeChart() {\n    if (this[PRIVATE] && this[PRIVATE].chart) {\n        const perspective_d3fc_element = this[PRIVATE].chart;\n        perspective_d3fc_element.resize();\n    }\n}\n\nfunction deleteChart() {\n    if (this[PRIVATE] && this[PRIVATE].chart) {\n        const perspective_d3fc_element = this[PRIVATE].chart;\n        perspective_d3fc_element.delete();\n    }\n}\n\nfunction save() {\n    if (this[PRIVATE] && this[PRIVATE].chart) {\n        const perspective_d3fc_element = this[PRIVATE].chart;\n        return perspective_d3fc_element.getSettings();\n    }\n}\n\nfunction restore(config) {\n    const perspective_d3fc_element = getOrCreatePluginElement.call(this);\n    perspective_d3fc_element.setSettings(config);\n}\n\nif (!Element.prototype.matches) {\n    Element.prototype.matches = Element.prototype.msMatchesSelector;\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\n\nimport {register} from \"./plugin/plugin.js\";\nregister();\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nif (!Element.prototype.matches) {\n    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n}\n\nif (!Element.prototype.closest) {\n    Element.prototype.closest = function(s) {\n        var el = this;\n\n        do {\n            if (el.matches(s)) return el;\n            el = el.parentElement || el.parentNode;\n        } while (el !== null && el.nodeType === 1);\n        return null;\n    };\n}\n","/******************************************************************************\n *\n * Copyright (c) 2017, the Perspective Authors.\n *\n * This file is part of the Perspective library, distributed under the terms of\n * the Apache License 2.0.  The full license can be found in the LICENSE file.\n *\n */\nif (!Element.prototype.matches) {\n    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__944__;","module.exports = __WEBPACK_EXTERNAL_MODULE__100__;","module.exports = __WEBPACK_EXTERNAL_MODULE__974__;","module.exports = __WEBPACK_EXTERNAL_MODULE__988__;","module.exports = __WEBPACK_EXTERNAL_MODULE__575__;","module.exports = __WEBPACK_EXTERNAL_MODULE__536__;","module.exports = __WEBPACK_EXTERNAL_MODULE__680__;","module.exports = __WEBPACK_EXTERNAL_MODULE__237__;","module.exports = __WEBPACK_EXTERNAL_MODULE__215__;","module.exports = __WEBPACK_EXTERNAL_MODULE__902__;","module.exports = __WEBPACK_EXTERNAL_MODULE__924__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(451);\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"sourceRoot":""}