!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("core-js/modules/es.array.reduce.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("@finos/perspective-viewer/src/js/utils.js"),require("d3fc"),require("d3"),require("d3-array"),require("@finos/perspective/dist/esm/config"),require("d3-svg-legend"),require("core-js/modules/es.string.replace.js"),require("gradient-parser"),require("@finos/perspective-viewer/src/js/utils")):"function"==typeof define&&define.amd?define(["core-js/modules/es.array.reduce.js","core-js/modules/web.dom-collections.iterator.js","@finos/perspective-viewer/src/js/utils.js","d3fc","d3","d3-array","@finos/perspective/dist/esm/config","d3-svg-legend","core-js/modules/es.string.replace.js","gradient-parser","@finos/perspective-viewer/src/js/utils"],t):"object"==typeof exports?exports["perspective-view-d3fc"]=t(require("core-js/modules/es.array.reduce.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("@finos/perspective-viewer/src/js/utils.js"),require("d3fc"),require("d3"),require("d3-array"),require("@finos/perspective/dist/esm/config"),require("d3-svg-legend"),require("core-js/modules/es.string.replace.js"),require("gradient-parser"),require("@finos/perspective-viewer/src/js/utils")):e["perspective-view-d3fc"]=t(e["core-js/modules/es.array.reduce.js"],e["core-js/modules/web.dom-collections.iterator.js"],e["@finos/perspective-viewer/src/js/utils.js"],e.d3fc,e.d3,e["d3-array"],e["@finos/perspective/dist/esm/config"],e["d3-svg-legend"],e["core-js/modules/es.string.replace.js"],e["gradient-parser"],e["@finos/perspective-viewer/src/js/utils"])}(self,(function(e,t,n,a,l,r,s,i,o,c,u){return(()=>{var d={903:(e,t,n)=>{(e.exports=n(965)(!1)).push([e.id,':host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:15px;overflow:hidden}:host .chart.d3_heatmap d3fc-group.cartesian-chart,\n:host .chart.d3_treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content) auto 1fr auto minmax(0em,max-content)}:host .chart .chart-label{display:none}:host .chart.d3_heatmap{padding-right:120px}:host .chart.d3_sunburst{padding:0;font-size:14px}:host .chart.d3_sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.d3_sunburst .inner-container div{overflow:hidden}:host .chart.d3_sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px)}:host .chart.d3_sunburst .inner-container svg{width:100%;height:100%}:host .chart.d3_sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart.d3_sunburst .inner-container text.segment,\n:host .chart.d3_sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,#333333)}:host .chart.d3_sunburst .inner-container div.title-container{margin-top:5px}:host .chart.has-legend{padding-right:120px}:host .chart.d3_treemap .treemap-container{position:relative}:host .chart.d3_treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto}:host .chart.d3_treemap .inner-container div{overflow:hidden}:host .chart.d3_treemap .inner-container svg{width:100%;height:100%}:host .chart.d3_treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart.d3_treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1}:host .chart.d3_treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0}:host .chart.d3_treemap .inner-container .branchnode{opacity:0}:host .chart.d3_treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black)}:host .chart.d3_treemap .inner-container .leafnode{fill-opacity:0.8}:host .chart.d3_treemap .inner-container .leafnode:hover{fill-opacity:0.5}:host .chart.d3_treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0}:host .chart.d3_treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none}:host .chart.d3_treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4}:host .chart.d3_treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4}:host .chart.d3_treemap .inner-container text{fill:var(--d3fc-treedata--labels,#333333)}:host .chart.d3_treemap .inner-container text.title{dominant-baseline:hanging}:host .chart.d3_treemap .inner-container .parent-controls{position:absolute;top:15px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s}:host .chart.d3_treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px #000;transition:box-shadow 0.2s}:host .chart .x-label{height:1.2em!important;line-height:1em!important}:host .chart .x-label,\n:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px}:host .chart d3fc-canvas.plot-area{display:none}:host .chart.d3_xy_scatter d3fc-canvas.plot-area,\n:host .chart.d3_xy_line d3fc-canvas.plot-area,\n:host .chart.d3_ohlc d3fc-canvas.plot-area,\n:host .chart.d3_candlestick d3fc-canvas.plot-area{display:block}:host .chart .y-axis text,\n:host .chart .x-axis text{fill:var(--d3fc-axis--ticks,#505050);font-size:11px}:host .chart .y-axis path,\n:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,#b4d2e1)}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,#b4d2e1)}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis--ticks,#505050)}:host .chart .splitter-label.disabled{cursor:default}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3)}:host .chart .y-label-container .splitter-label::after{font-family:var(--d3fc-y1-label--font-family,inherit);content:var(--d3fc-y1-label--content,"\\1F847")}:host .chart .y2-label-container .splitter-label::after{font-family:var(--d3fc-y2-label--font-family,inherit);content:var(--d3fc-y2-label--content,"\\1F845")}:host .chart.d3_y_bar .y-axis path,\n:host .chart.d3_y_line .y-axis path,\n:host .chart.d3_xy_line .y-axis path,\n:host .chart.d3_xy_line .x-axis path,\n:host .chart.d3_y_area .y-axis path,\n:host .chart.d3_y_scatter .y-axis path,\n:host .chart.d3_xy_scatter .y-axis path,\n:host .chart.d3_xy_scatter .x-axis path,\n:host .chart.d3_x_bar .x-axis path{visibility:hidden}:host .chart .y-label{white-space:nowrap}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart .series{fill:var(--d3fc-series,rgba(31,119,180,0.5))}:host .chart .series-1{fill:var(--d3fc-series-1,#0366d6)}:host .chart .series-2{fill:var(--d3fc-series-2,#ff7f0e)}:host .chart .series-3{fill:var(--d3fc-series-3,#2ca02c)}:host .chart .series-4{fill:var(--d3fc-series-4,#d62728)}:host .chart .series-5{fill:var(--d3fc-series-5,#9467bd)}:host .chart .series-6{fill:var(--d3fc-series-6,#8c564b)}:host .chart .series-7{fill:var(--d3fc-series-7,#e377c2)}:host .chart .series-8{fill:var(--d3fc-series-8,#7f7f7f)}:host .chart .series-9{fill:var(--d3fc-series-9,#bcbd22)}:host .chart .series-10{fill:var(--d3fc-series-10,#17becf)}:host .disabled{filter:grayscale(100%)}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none}:host #dragHandles rect{pointer-events:all}:host .label rect{fill:none}:host .legend-container{position:absolute;top:15px;right:15px;left:auto;width:150px;height:280px}:host .legend-container.legend-color{width:90px;height:150px}:host .legend-container[borderbox-on-hover="true"]{transition:box-shadow 1s}:host .legend-container[borderbox-on-hover="true"]:hover{background-color:var(--d3fc-legend--background,#ffffff);box-shadow:0 2px 4px 0 rgba(0,0,0,0.1);transition:box-shadow 0.2s,background-color 0.2s}:host .legend-container .legend{font-size:8pt;width:100%}:host .legend-container .legend .cell{cursor:pointer}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,#1f77b4)}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:#cccccc}:host .legend-container .legend .cell.hidden circle{fill:#cccccc!important}:host .legend-container text{fill:var(--d3fc-legend--text,#333333)}:host .legend-container .label:hover{fill:#22a0ce}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,#333333)}:host .legend-container .legend-controls{margin-left:12px}:host .legend-container .legend-controls #up-arrow,\n:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:#1f77b4}:host .legend-container .legend-controls #up-arrow.disabled,\n:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:#333333}:host .d3_heatmap .legend-container.legend-color{height:200px}:host .d3_treemap .legend-container.legend-color{height:200px}:host .d3_treemap .legend-container:not(.legend-color){width:100px}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center}:host .zoom-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #cccccc;padding:10px;opacity:0.5;cursor:pointer}:host .zoom-controls button:hover{background:#e6e6e6}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right}:host .parent-controls button{-webkit-appearance:none;background:#f7f7f7;border:1px solid #cccccc;padding:10px;opacity:0.5;cursor:pointer}:host .parent-controls button:hover{background:#e6e6e6}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none}:host div.tooltip ul{margin:0;padding:0;list-style-type:none}',""])},965:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var l=(s=a,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=a.sources.map((function(e){return"/*# sourceURL="+a.sourceRoot+e+" */"}));return[n].concat(r).concat([l]).join("\n")}var s;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},l=0;l<this.length;l++){var r=this[l][0];"number"==typeof r&&(a[r]=!0)}for(l=0;l<e.length;l++){var s=e[l];"number"==typeof s[0]&&a[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},282:e=>{e.exports='<template id="perspective-d3fc-chart">\r\n    <div id="container" class="chart">\r\n    </div>\r\n</template>'},995:e=>{e.exports='<span id="up-arrow">&#9650;</span>\n<span id="page-text"></span>\n<span id="down-arrow">&#9660;</span>'},50:e=>{e.exports='<button id="goto-parent">Goto parent</button>'},688:e=>{e.exports='<ul id="tooltip-values"></ul>'},962:e=>{e.exports='<button id="zoom-reset">Reset zoom</button>\n<button id="one-year">1 Year</button>\n<button id="six-months">6 Months</button>\n<button id="one-month">1 Month</button>'},451:(e,t,n)=>{"use strict";n.r(t);var a={};n.r(a),n.d(a,{domain:()=>x,labelFunction:()=>v,scale:()=>y});var l={};n.r(l),n.d(l,{domain:()=>k,labelFunction:()=>z,scale:()=>S,tickFormatFunction:()=>A});var r={};n.r(r),n.d(r,{domain:()=>C,labelFunction:()=>M,scale:()=>N});var s={};n.r(s),n.d(s,{component:()=>F,domain:()=>B,labelFunction:()=>D,scale:()=>P});n(988),n(536);var i=n(100),o=n(902);const c="none",u="ordinal",d="time",h="linear",p=e=>{let t="crossValues",n=null,a=null;const l=()=>{const l=a=>{const l=n?e[t].filter((e=>n==e.name)):e[t];return!("crossValues"==t&&l.length>1)&&l.some((e=>a.includes(e.type)))};return 0===e[t].length?c:a!=d&&l(["datetime","date"])?d:a!=h&&l(["integer","float"])||a==u?h:u};return l.settingName=(...e)=>e.length?(t=e[0],l):t,l.settingValue=(...e)=>e.length?(n=e[0],l):n,l.excludeType=(...e)=>e.length?(a=e[0],l):a,l};var g=n(680);const m=e=>Array.isArray(e)?[].concat(...e.map(m)):[e],f=e=>{const t=t=>e(t);return(0,o.rebindAll)(t,e),t.bandwidth=(...n)=>n.length?(e.bandwidth(...n),t):Math.max(e.bandwidth(),1),t},y=()=>(e=>{const t=t=>e(t);return(0,o.rebindAll)(t,e),t.ticks=function(){return[]},t})(f(g.scaleBand())),x=()=>{let e=["crossValue"],t="horizontal";const n=t=>{const n=m(t);return a([...new Set(n.map((t=>t[e[0]])))])},a=e=>"vertical"==t?e.reverse():e;return n.valueName=(...t)=>t.length?(e=[t[0]],n):e[0],n.valueNames=(...t)=>t.length?(e=t[0],n):e,n.orient=(...e)=>e.length?(t=e[0],n):t,n},v=e=>t=>t[e].join("|");var b=n(237);const _=()=>{let e=[0,0],t="percent";const n=n=>{switch(t){case"domain":n[0]-=e[0],n[1]+=e[1];break;case"percent":{let t=n[1]-n[0];n[0]-=e[0]*t,n[1]+=e[1]*t;break}default:throw new Error("Unknown padUnit: "+t)}return n};return n.pad=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],n):e},n.padUnit=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],n):t},n};let V=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n];return t}return Array.from(e)};const w=e=>Math.abs(e)>=1e7?g.format(".3s")(e):Number.isInteger(e)?g.format(",.0f")(e):g.format(",.2f")(e),S=()=>g.scaleLinear(),k=()=>{const e=function(){let e=[function(e){return e}],t=null,n=[],a=_();const l=function(l){let r,s=new Array(l.length),i=!0,o=!1,c=e[Symbol.iterator]();try{for(let e;!(i=(e=c.next()).done);i=!0){let t=e.value;for(let e=0;e<l.length;e++){let n=t(l[e],e);Array.isArray(n)?s.push.apply(s,V(n)):s.push(n)}}}catch(e){o=!0,r=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw r}}let u=[b.min(s),b.max(s)];if(u[0]=null==u[0]?b.min(n):b.min([u[0]].concat(V(n))),u[1]=null==u[1]?b.max(n):b.max([u[1]].concat(V(n))),null!=t){let e=Math.max(Math.abs(u[1]-t),Math.abs(u[0]-t));u[0]=t-e,u[1]=t+e}return a(u)};return l.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],l):e},l.pad=function(){return arguments.length?(a.pad(arguments.length<=0?void 0:arguments[0]),l):a.pad},l.padUnit=function(){return arguments.length?(a.padUnit(arguments.length<=0?void 0:arguments[0]),l):a.padUnit},l.include=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],l):n},l.symmetricalAbout=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],l):t},l.paddingStrategy=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],l):a},l}().pad([0,.1]).padUnit("percent");let t=["crossValue"];const n=n=>(e.accessors(t.map((e=>t=>parseFloat(t[e])))),a(m(n)));o.rebindAll(n,e);const a=n=>{if("domain"==e.padUnit()){const a=(e=>{const n=t.map((t=>e.map((e=>e[t])).sort(((e,t)=>e-t)).filter(((e,t,n)=>0===t||e!==n[t-1])).reduce(((e,t,n,a)=>0===n||e<=t-a[n-1]?e:Math.abs(t-a[n-1])))));return Math.min(...n)})(n);return e.pad([a/2,a/2])(n)}return e(n)};return n.valueName=(...e)=>e.length?(t=[e[0]],n):t[0],n.valueNames=(...e)=>e.length?(t=e[0],n):t,n},z=e=>t=>t[e][0],A=w,N=()=>g.scaleTime(),C=()=>{const e=o.extentTime();let t=["crossValue"];const n=n=>(e.accessors(t.map((e=>t=>new Date(t[e])))),a(m(n)));o.rebindAll(n,e,o.exclude("include","paddingStrategy"));const a=n=>{const a=(e=>{const n=t.map((t=>e.map((e=>new Date(e[t]).getTime())).sort(((e,t)=>e-t)).filter(((e,t,n)=>0===t||e!==n[t-1])).reduce(((e,t,n,a)=>0===n||e<=t-a[n-1]?e:Math.abs(t-a[n-1])))));return Math.min(...n)})(n);return e.padUnit("domain").pad([a/2,a/2])(n)};return n.valueName=(...e)=>e.length?(t=[e[0]],n):t[0],n.valueNames=(...e)=>e.length?(t=e[0],n):t,n},M=e=>t=>new Date(t[e][0]),O=(e,t,n)=>{let a=6,l=6,r=((...e)=>{const t={},n=e=>{for(const n of Object.keys(t))e[n](t[n]);return e};for(const a of e)n[a]=(...e)=>e.length?(t[a]=e[0],n):t[a];return n})("tickFormat","ticks","tickArguments","tickValues","tickPadding"),s=()=>{},i=null;const c=(0,o.dataJoin)("g","group"),u=(0,o.dataJoin)("path","domain"),d=(e,t)=>h()?`translate(${t}, ${e})`:`translate(${e}, ${t})`,h=()=>"left"===e||"right"===e,p=o=>{i?(o.selection&&(c.transition(o),u.transition(o)),o.each(((o,p,f)=>{const y=f[p],x=(0,g.select)(y),v="bottom"===e||"right"===e?1:-1,b=n.range(),_=(V=[[b[0],v*a],[b[0],0],[b[1],0],[b[1],v*a]],h()?V.map((e=>[e[1],e[0]])):V);var V;u(x,[o]).attr("d",(0,g.line)()(_)).attr("stroke","#000").attr("fill","none");const w=c(x,i),S=e=>Array.isArray(l)?l[e]:l,k=e=>{let t=0;for(let n=0;n<e;n++)t+=S(n);return t};w.attr("transform",((e,t)=>d(0,v*k(t)))).each(((e,a,l)=>{const i=(0,g.select)(l[a]),o=m(n,e);r(t(o)).decorate(((e,t)=>s(e,t,a))).tickSizeInner(S(a)).tickOffset((e=>o.step(e)/2))(i),i.select("path.domain").attr("visibility","hidden")})),w.exit().attr("transform",((e,t)=>d(0,v*k(t))))}))):r(t(n).decorate(s))(o)},m=(e,t)=>{function n(t){const n=t.domain;return n.reduce(((t,n)=>t+e(n)),0)/n.length}return n.ticks=()=>t,n.tickFormat=()=>e=>e.text,n.copy=()=>m(e,t),n.step=t=>t.domain.length*e.step(),(0,o.rebindAll)(n,e,(0,o.exclude)("ticks","step","copy")),n};return p.tickSize=(...e)=>e.length?(l=a=Number(e[0]),p):l,p.tickSizeInner=(...e)=>e.length?(l=Array.isArray(e[0])?e[0]:Number(e[0]),p):l,p.tickSizeOuter=(...e)=>e.length?(a=Number(e[0]),p):a,p.decorate=(...e)=>e.length?(s=e[0],p):s,p.groups=(...e)=>e.length?(i=e[0],p):i,(0,o.rebindAll)(p,r),p},j=e=>O("top",o.axisOrdinalTop,e),T=e=>O("bottom",o.axisOrdinalBottom,e),R=e=>O("left",o.axisOrdinalLeft,e),$=e=>O("right",o.axisOrdinalRight,e);function E(e){return e.getRootNode().host}function L(e){return e.closest("#container.chart")}const P=()=>f(g.scaleBand()).padding(.5),B=()=>{let e=["crossValue"],t="horizontal";const n=t=>{const n=m(t);return a([...new Set(n.map((t=>t[e[0]])))])},a=e=>"vertical"==t?e.reverse():e;return n.valueName=(...t)=>t.length?(e=[t[0]],n):e[0],n.valueNames=(...t)=>t.length?(e=t[0],n):e,n.orient=(...e)=>e.length?(t=e[0],n):t,n},D=e=>t=>t[e].join("|"),F=e=>{let t="horizontal",n="crossValues",a=null;const l=()=>{const l=e[n].length>1,o=s(a),u=o.map(i),h=l?u.map((e=>e.size)):u[0].size,p=u.reduce(((e,t)=>e+t.size),0),g=e=>n=>{const a=e(n);return l&&a.groups(o).tickSizeInner(h).tickSizeOuter(p),"horizontal"!==t&&a.tickPadding(10),a},m=r(l);return{bottom:g(m.bottom),left:g(m.left),right:g(m.right),top:g(m.top),size:`${p+10}px`,decorate:(e,n,a)=>{const l=u[a].rotation;"horizontal"===t&&d(e,l),c(e,l)}}},r=e=>e?{bottom:T,left:R,top:j,right:$}:{bottom:o.axisOrdinalBottom,left:o.axisOrdinalLeft,top:o.axisOrdinalTop,right:o.axisOrdinalRight},s=e=>{const t=[];return e.forEach((e=>{(e&&e.split?e.split("|"):[e]).forEach(((n,a)=>{for(;t.length<=a;)t.push([]);const l=t[a];l.length>0&&l[l.length-1].text===n?l[l.length-1].domain.push(e):l.push({text:n,domain:[e]})}))})),t.reverse()},i=n=>{const a=e.size.width,l=Math.max(...n.map((e=>e.text?e.text.length:0)));return"horizontal"===t?n&&16*n.length>a-100?{size:5*l+10,rotation:90}:n&&n.length*(6*l+10)>a-100?{size:3*l+20,rotation:45}:{size:25,rotation:0}:{size:5*l+10,rotation:0}},c=(e,n)=>{const a=n?(e,t)=>e.x+e.width+14>t.x+t.width:(e,t)=>e.x<=t.x+t.width&&t.x<=e.x+e.width&&e.y<=t.y+t.height&&t.y<=e.y+e.height,l="horizontal"==t?u(e):null,r=[];e.each(((e,t,n)=>{const s=g.select(n[t]),i=(e=>{const t=-1!==e.indexOf(",")?",":" ",n=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(t).map((e=>parseInt(e)));for(;n.length<2;)n.push(0);return n})(s.attr("transform")),o=s.node().getBBox(),c={x:o.x+i[0],y:o.y+i[1],width:o.width,height:o.height},u=r.some((e=>a(e,c)))||l&&!((d=c).x>=(h=l).x&&d.x+d.width<=h.x+h.width&&d.y>=h.y&&d.y+d.height<=h.y+h.height);var d,h;s.attr("visibility",u?"hidden":""),u||r.push(c)}))},u=e=>{const t=L(e.node());if(null===t)return;const n=t.querySelector(".cartesian-chart"),a=n.querySelector(".x-axis"),l=n.getBoundingClientRect(),r=a.getBoundingClientRect();return{x:l.left-r.left,width:l.width,y:l.top-r.top,height:l.height}},d=(e,t)=>{const n=(e=>e?e<60?`rotate(-${e} 5 5)`:`rotate(-${e} 3 7)`:"translate(0, 8)")(t),a=t?"end":"";e.each(((e,t,l)=>{g.select(l[t]).select("text").attr("transform",n).style("text-anchor",a)}))};return l.orient=(...e)=>e.length?(t=e[0],l):t,l.settingName=(...e)=>e.length?(n=e[0],l):n,l.domain=(...e)=>e.length?(a=e[0],l):a,l},H={none:a,ordinal:s,time:r,linear:l},I=e=>{let t=null,n="horizontal",a="crossValues",l=null,r=["crossValue"];const s=["include","paddingStrategy","pad"],i={},c=o=>{const c=p(e).excludeType(t).settingName(a).settingValue(l)(),h=H[c],g=h.domain().valueNames(r);s.forEach((e=>{i[e]&&g[e]&&g[e](i[e])})),g.orient&&g.orient(n);const m=g(o),f=h.component?u(h,m,o):d();return{scale:h.scale(),domain:m,domainFunction:g,labelFunction:h.labelFunction,component:{bottom:f.bottom,left:f.left,top:f.top,right:f.right},size:f.size,decorate:f.decorate,label:e[a].map((e=>e.name)).join(", "),tickFormatFunction:h.tickFormatFunction}},u=(t,l,r)=>t.component(e).orient(n).settingName(a).domain(l)(r),d=()=>({bottom:o.axisBottom,left:o.axisLeft,top:o.axisTop,right:o.axisRight,decorate:()=>{}});return c.excludeType=(...e)=>e.length?(t=e[0],c):t,c.orient=(...e)=>e.length?(n=e[0],c):n,c.settingName=(...e)=>e.length?(a=e[0],c):a,c.settingValue=(...e)=>e.length?(l=e[0],c):l,c.valueName=(...e)=>e.length?(r=[e[0]],c):r[0],c.valueNames=(...e)=>e.length?(r=e[0],c):r,s.forEach((e=>{c[e]=(...t)=>t.length?(i[e]=t[0],c):i[e]})),c},W=(e,t)=>U(e,t,o.chartSvgCartesian,!1),q=(e,t)=>U(e,t,o.chartCanvasCartesian,!0),U=(e,t,n,a)=>{let l=null,r=null;const s=n({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&s.xDecorate(e.decorate),t.decorate&&s.yDecorate(t.decorate),s.xPaddingInner&&s.xPaddingInner(1),s.xPaddingOuter&&s.xPaddingOuter(.5),s.yPaddingInner&&s.yPaddingInner(1),s.yPaddingOuter&&s.yPaddingOuter(.5),s.axisSplitter=(...e)=>e.length?(l=e[0],s):l,s.altAxis=(...e)=>e.length?(r=e[0],s):r;const i=s.decorate();return s.decorate(((n,c)=>{const u=n.select("d3fc-svg.plot-area");if(u.select("svg").node().setAttribute("viewBox",`0 0 ${u.node().clientWidth} ${u.node().clientHeight}`),i(n,c),l){if(l.haveSplit()){const i=l.altData(),u=o.dataJoin("d3fc-svg","y2-axis").key((e=>e)),d=o.dataJoin("g","y-series").key((e=>e));n.enter().append("div").attr("class","y2-label-container").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",r.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("div").attr("class","y-label").style("transform","rotate(-90deg)");const h=r.scale.domain(r.domain),p=r.component.right(h);if(p.tickFormat(r.tickFormatFunction),r.decorate&&p.decorate(r.decorate),u(n,["right"]).attr("class",(e=>`y-axis ${e}-axis`)).on("measure",((e,t,n)=>{const{width:a,height:l}=g.event.detail;"left"===e&&g.select(n[t]).select("svg").attr("viewBox",`${-a} 0 ${a} ${l}`),h.range([l,0])})).on("draw",((e,t,n)=>{g.select(n[t]).select("svg").call(p)})),a){const a=n=>{const a=s.plotArea();a.context(n.node().getContext("2d")).xScale(e.scale);const l=[t.scale,h];[c,i].forEach(((e,t)=>{a.yScale(l[t]),a(e)}))};n.select("d3fc-canvas.plot-area").on("draw",((e,t,n)=>{a(g.select(n[t]).select("canvas"))}))}else{const a=n=>{const a=s.plotArea();a.xScale(e.scale);const l=[t.scale,h];d(n,[c,i]).each(((e,t,n)=>{a.yScale(l[t]),g.select(n[t]).datum(e).call(a)}))};n.select("d3fc-svg.plot-area").on("draw",((e,t,n)=>{a(g.select(n[t]).select("svg"))}))}}l(n)}})),s};function K(e,t,n){let a=e.select(t);return a.size()>0?a:n()}function Y(e,t,n="right"){if("right"===n||"bottom"===n)return e[n]<t[n];if("left"===n||"top"===n)return e[n]>t[n];throw`Direction being checked for overflow is invalid: ${n}`}function J(e,t,n,a=0){const l="x"===e?"width":"height",r=t[e],s=t[e]+t[l],i=n[e],o=n[e]+n[l];return i+a>r&&i-a<s||o+a>r&&o-a<s||i+a<r&&o-a>s}var X=n(688),G=n.n(X),Q=n(974);function Z(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString("en-us",(0,Q.get_type_config)(e).format);case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function ee(e,t){if(0===t.crossValues.length)return[];return((e.crossValue.split?e.crossValue.split("|"):[e.crossValue])||[e.key]).map(((e,n)=>({name:t.crossValues[n].name,value:Z(t.crossValues[n].type,e)})))}function te(e,t){if(0===t.splitValues.length)return[];const n=e.key?e.key.split("|"):e.mainValue.split?e.mainValue.split("|"):[e.mainValue];return t.splitValues.map(((e,t)=>({name:e.name,value:Z(e.type,n[t])})))}function ne(e,t){return t.mainValues.length>1?e.mainValue?[{name:e.key,value:e.mainValue-(e.baseValue||0)}]:t.mainValues.map(((t,n)=>({name:t.name,value:Z(t.type,e.mainValues[n])}))):[{name:t.mainValues[0].name,value:Z(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function ae(e,t,n){!function(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each((function(e){(0,g.select)(this).text(`${e.name}: `).append("b").text(le(e.value))}))}(e,ee(t,n).concat(te(t,n)).concat(ne(t,n)))}const le=e=>e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:(0,Q.get_type_config)("float").precision,maximumFractionDigits:(0,Q.get_type_config)("float").precision}),re=e=>[e.name,"==",e.value],se=(e,t,n)=>{const a=ne(t,n).map((e=>e.name)),l=ee(t,n).map(re),r=te(t,n).map(re),s=n.filter.concat(l).concat(r);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:a,config:{filters:s},row:t.row}}))},ie=()=>{let e=!1,t=null,n=null,a=!1;const l=l=>{const r=l.node();if(!r||!r.isConnected)return void oe(t);const s=(0,g.select)(L(r));t=function(e){return K(e,"div.tooltip",(()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(G())))}(s);const i=(e,l,r)=>{ae(t,e,n),function(e,t,n,a){const l=e.getBoundingClientRect(),r=t.getBoundingClientRect();let s=r.left+r.width/2-l.left,i=r.top-l.top+e.scrollTop;a&&(i=r.top+r.height/2-l.top+e.scrollTop);n.style("left",`${s}px`).style("top",`${i}px`).style("opacity",.9),a&&([s,i]=function(e,t){const n=e.node().getBoundingClientRect(),a=n.width/2,l=n.left-a-t.left;e.style("left",`${l}px`);const r=n.height/2,s=n.top-r-t.top;return e.style("top",`${s}px`),[l,s]}(n,l));!function(e,t,n,a,l=!1){const r=e.node().getBoundingClientRect();if(Y(t,r)){const a=r.right-t.right;e.style("left",n-a+"px")}if(Y(t,r,"bottom")){const n=r.bottom-t.bottom;e.style("top",a-n+"px")}if(!l)return;if(Y(t,r,"left")){const a=r.left-t.left;e.style("left",n-a+"px")}if(Y(t,r,"top")){const n=r.top-t.top;e.style("top",a-n+"px")}}(n,l,s,i,a)}(s.node(),r[l],t,a),(0,g.select)(r[l]).style("opacity","0.7")},o=(e,n,a)=>{oe(t),a&&(0,g.select)(a[n]).style("opacity","1")};e?l.each(i):(l.on("mouseover",i).on("mouseout",o),(()=>{let e=null;const t=t=>{const n=t.node();t.on("click",(t=>se(n,t,e)))};return t.settings=(...n)=>n.length?(e=n[0],t):e,t})().settings(n)(l))};return l.alwaysShow=(...t)=>t.length?(e=t[0],l):e,l.centered=(...e)=>e.length?(a=e[0],l):a,l.settings=(...e)=>e.length?(n=e[0],l):n,l};function oe(e){e&&e.style("opacity",0)}function ce(e,t){let n=e.mainValues.length>1?o.seriesSvgGrouped(o.seriesSvgBar()):o.seriesSvgBar();return n=n.decorate((n=>{ie().settings(e)(n),n.style("fill",(e=>t(e.key)))})),o.autoBandwidth(ue(n)).crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue)).baseValue((e=>e.baseValue))}const ue=e=>{const t=t=>e(t);return o.rebindAll(t,e),t.bandwidth=(...n)=>n.length?(e.bandwidth(Math.max(n[0],1)),t):e.bandwidth(),t};function de(e){return e.split("|").slice(0,-1).join("|")}function he(e){const t=e.data&&e.data.length>0?e.data[0]:{},n=Object.keys(t).filter((e=>"__ROW_PATH__"!==e));return me().settings(e).domain(n)()}function pe(e,t){let n=Array.from(new Set(t));return me().settings(e).domain(n)()}function ge(e){const t=e.data&&e.data.length>0?e.data[0]:{},n=[];return Object.keys(t).forEach((e=>{if("__ROW_PATH__"!==e){const t=de(e);n.includes(t)||n.push(t)}})),me().settings(e).domain(n)()}function me(){let e=null,t=null,n={},a=e=>ye(e,n.colorStyles&&n.colorStyles.opacity);const l=()=>{const l=n.colorStyles,r=t||[l.series];if(r||e.length>1){const t=e.length>1?l.scheme:r;return g.scaleOrdinal(t.map(a)).domain(e)}return null};return l.domain=(...t)=>t.length?(e=t[0],l):e,l.defaultColors=(...e)=>e.length?(t=e[0],l):t,l.mapFunction=(...e)=>e.length?(a=e[0],l):a,l.settings=(...e)=>e.length?(n=e[0],l):n,l}function fe(e){return xe(1)(e)}function ye(e,t=.5){return xe(t)(e)}function xe(e){return t=>{const n=g.color(t);return n.opacity=e,n+""}}const ve={none:v,ordinal:D,time:M,linear:z},be=e=>{const t=p(e);let n="__ROW_PATH__";const a=(e,a)=>ve[t()](n)(e,a);return(0,o.rebindAll)(a,t),a.valueName=(...e)=>e.length?(n=e[0],a):n,a};function _e(e,t,{stack:n=!1,excludeEmpty:a=!1}={}){const l=t||e.data;return e.splitValues.length>0?function(e,t,{stack:n=!1,excludeEmpty:a=!1}){const l={};return t.forEach((e=>{const t={},r={};Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).filter((t=>!a||null!=e[t]&&null!=e[t])).forEach((a=>{const l=a.split("|"),s=l[l.length-1],i=e[a]||0,o=`${s}${i>=0?"+ve":"-ve"}`,c=l.slice(0,l.length-1).join("|"),u=r[c]=r[c]||{__ROW_PATH__:e.__ROW_PATH__},d=t[o]||0;u.__KEY__=c,n?(u[s]=d+i,u[`__BASE_VALUE__${s}`]=d,t[o]=u[s]):u[s]=i,u.row=e})),Object.keys(r).forEach((e=>{(l[e]=l[e]||[]).push(r[e])}))})),Object.keys(l).map((e=>{const t=l[e];return t.key=e,t}))}(0,l,{stack:n,excludeEmpty:a}):[l]}function Ve(e,t){const n={stack:!0};return _e(e,t,n).map((t=>we(e,t,n)))}function we(e,t,{stack:n=!1}){const a=function(e,t,{stack:n=!1}){const a=be(e);return e=>{const l=t=>n&&t[`__BASE_VALUE__${e.name}`]||0,r=t.map(((t,n)=>({crossValue:a(t,n),mainValue:t[e.name]?t[e.name]:null,baseValue:l(t),key:t.__KEY__?`${t.__KEY__}|${e.name}`:e.name,row:t.row||t})));return r.key=r[0].key,r}}(e,t,{stack:n});return e.mainValues.length>1?e.mainValues.map(a):a(e.mainValues[0])}var Se=n(215),ke=n(995),ze=n.n(ke);const Ae=10;function Ne(e,t,n){const a=g.select(E(e).getContainer()).node().getBoundingClientRect(),l=e.getBoundingClientRect(),r={top:l.top+n-Ae,right:l.right+t+Ae,bottom:l.bottom+n+Ae,left:l.left+t-Ae},s={x:t,y:n};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach((e=>{if(Y(a,r,e.edge)){const t=r[e.edge]-a[e.edge];s[e.dimension]=s[e.dimension]-t}})),s}const Ce="resize.for-dragging";function Me(){let e=!0,t=null;const n=n=>{const a=n.node();a.style.cursor="move",t.legend&&(a.style.left=t.legend.left,a.style.top=t.legend.top);const l=g.drag().on("drag",(function(){const n=Ne(this,g.event.dx,g.event.dy);this.style.left=`${this.offsetLeft+n.x}px`,this.style.top=`${this.offsetTop+n.y}px`;const l={left:this.style.left,top:this.style.top};t.legend={...t.legend,...l},e=function(e){const t=e.getBoundingClientRect(),n=g.select(L(e)).node().getBoundingClientRect(),a=5;return t.right+Ae+a>=n.right&&t.top-Ae-a<=n.top}(a)?function(e){return g.select(window).on(Ce,null),e.style.left="auto",!0}(a):function(e,t){!1!==t&&g.select(window).on(Ce,(function(){const t=Ne(e,0,0);e.style.left=`${e.offsetLeft+t.x}px`,e.style.top=`${e.offsetTop+t.y}px`}));return!1}(a,e)}));n.call(l)};return n.settings=(...e)=>e.length?(t=e[0],n):t,n}const Oe="horizontal-drag-handle",je="vertical-drag-handle",Te="dragHandles",Re="resize";const $e=(e,t,n,a)=>{e.selectAll(`.${a}`).each(((e,a,l)=>{const r=l[a];g.select(r).attr(n,r.getBoundingClientRect()[n]-t)}))},Ee=e=>e.select("#dragHandles").size()>0,Le=(e,t,n)=>e.attr(t,Number(e.attr(t))-n),Pe=(e,t,n)=>e.attr(t,e.node().getBoundingClientRect()[t]-n),Be=(e,t)=>{const n=e||Se.legendColor();let a,l,r=[],s=1,i=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,c=()=>{},u=Me().settings(t);const d=e=>{r=n.scale().domain(),l=function(){let e=9,t=3,n=null;const a={height:100,width:100},l={height:null,width:null},r=[],s=(e,t)=>r.filter((t=>t.event===e)).forEach((e=>e.execute(t))),i=a=>{if(Ee(a))return;const r={left:()=>s(Re,{horizontal:A(g.event),vertical:!1}),top:()=>s(Re,{horizontal:!1,vertical:C(g.event)}),right:()=>s(Re,{horizontal:N(g.event),vertical:!1}),bottom:()=>s(Re,{horizontal:!1,vertical:M(g.event)}),topleft:()=>s(Re,{horizontal:A(g.event),vertical:C(g.event)}),topright:()=>s(Re,{horizontal:N(g.event),vertical:C(g.event)}),bottomright:()=>s(Re,{horizontal:N(g.event),vertical:M(g.event)}),bottomleft:()=>s(Re,{horizontal:A(g.event),vertical:M(g.event)})},i=a.node();n.legend&&(i.style.height=n.legend.height,i.style.width=n.legend.width);const u=i.getBoundingClientRect(),d=a.append("svg").attr("id",Te).attr("width",u.width).attr("height",u.height),h=d.append("g"),p=e=>"left"===e||"right"===e,m={left:0,top:e,right:u.width-e,bottom:e},f={left:e,top:0,right:e,bottom:u.height-e},[y,x,v,b]=["left","top","right","bottom"].map((n=>h.append("rect").attr("id",`drag${n}`).attr("class",p(n)?je:Oe).attr("y",f[n]).attr("x",m[n]).attr("height",p(n)?u.height-2*e:e).attr("width",p(n)?e:u.width-2*e).attr("fill",p(n)?"lightgreen":"lightblue").attr("fill-opacity",0).style("z-index",t).attr("cursor",p(n)?"ew-resize":"ns-resize").call(g.drag().on("drag",r[n])))),_=e=>`${e[0]}${e[1]}`,V={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},[w,S,k,z]=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]].map((n=>h.append("rect").attr("id",`drag${_(n)}`).attr("class",`corner-drag-handle ${n[0]} ${n[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",0).style("z-index",t).attr("cursor",`${V[_(n)]}-resize`).call(g.drag().on("drag",r[_(n)]))));function A(e){const t=c(Ne(y.node(),e.x,0).x,d,"width",((e,t)=>e-t));return i.style.left=`${i.offsetLeft+t}px`,i.style.width=i.offsetWidth-t+"px",O(),j(v,t,"width","x")}function N(e){const t=-c(Ne(v.node(),e.dx,0).x,d,"width",((e,t)=>e+t));return!o(t,"x",v,e)&&(i.style.width=i.offsetWidth-t+"px",O(),j(v,t,"width","x"))}function C(e){const t=c(Ne(x.node(),0,e.y).y,d,"height",((e,t)=>e-t));return i.style.top=`${i.offsetTop+t}px`,i.style.height=i.offsetHeight-t+"px",O(),j(b,t,"height","y")}function M(e){const t=-c(Ne(b.node(),0,e.dy).y,d,"height",((e,t)=>e+t));return!o(t,"y",b,e)&&(i.style.height=i.offsetHeight-t+"px",O(),j(b,t,"height","y"))}function O(){const e={top:i.style.top,left:i.style.left,height:i.style.height,width:i.style.width};n.legend={...n.legend,...e}}function j(e,t,n,a){return Pe(d,n,t),Le(e,a,t),$e(d,t,n,"height"===n?je:Oe),T(d),0!=t}function T(t){w.attr("y",0,"x",0),S.attr("y",0).attr("x",t.attr("width")-e),k.attr("y",t.attr("height")-e).attr("x",t.attr("width")-e),z.attr("y",t.attr("height")-e).attr("x",0)}function R(e,t,n){l[e]&&l[e]<u[e]&&(i.style[e]=`${l[e]}px`,j(n,u[e]-l[e],e,t))}R("height","y",b),R("width","x",v),T(d)};function o(e,t,n,a){return((e,t,n,a)=>e<0&&a[t]<Number(n.attr(t)))(e,t,n,a)||((e,t,n,a)=>e>0&&a[t]>Number(n.attr(t)))(e,t,n,a)}function c(e,t,n,r){const s=r(Number(t.attr(n)),e);return s<a[n]?r(e,a[n]-s):l[n]&&s>l[n]?r(e,l[n]-s):e}return i.on=(e,t)=>(r.push({event:e,execute:t}),i),i.zIndex=e=>(t=e,i),i.settings=(...e)=>e.length?(n=e[0],i):n,i.minWidth=e=>(a.width=e,l.width&&(l.width=Math.max(a.width,l.width)),i),i.minHeight=e=>(a.height=e,l.height&&(l.height=Math.max(a.height,l.height)),i),i.handleWidth=t=>(e=t,i),i.maxWidth=e=>(l.width=e,a.width=Math.min(a.width,l.width),i),i.maxHeight=e=>(l.height=e,a.height=Math.min(a.height,l.height),i),i}().settings(t).maxHeight(16*r.length+20).on("resize",(()=>h(e))),l(e),u(e),h(e)},h=e=>{x(e),p(e),m(e),function(e){const t=e.select("g.legendCells"),n=e.node().getBoundingClientRect();if(!Y(n,t.node().getBoundingClientRect()))return;const a=e.select(".legend");t.selectAll(".label").text(((e,t,l)=>{const r=l[t];if(Y(n,r.getBoundingClientRect())){const t=function(e,t,n){const a=e.getBoundingClientRect(),l=t.node().createSVGPoint(),r=3;return l.x=n.right-a.left-r,l.y=0,e.getCharNumAtPosition(l)}(r,a,n);return`${e.substring(0,t-3)}...`}return e}))}(e)},p=e=>{const t=b(e);t.style("display",s<=1?"none":"block"),t.select("#page-text").text(`${i+1}/${s}`),t.select("#up-arrow").attr("class",0===i?"disabled":"").on("click",(()=>{i>0&&(f(i-1),h(e))})),t.select("#down-arrow").attr("class",i>=s-1?"disabled":"").on("click",(()=>{i<s-1&&(f(i+1),h(e))}))},m=e=>{s>1&&n.cellFilter(y()),e.select("g.legendCells").remove();const t=_(e);t.call(n);const a=e.select("g.legendCells").node().getBBox();t.attr("height",a.height+20),c(e)},f=e=>{i=e,t.legend={...t.legend,pageIndex:i}},y=()=>(e,t)=>t>=a*i&&t<a*i+a,x=e=>{const t=e.node().getBoundingClientRect();let n=Math.floor(t.height/16)-1;a=n<r.length?n-1:n,s=v(n),i=Math.min(i,s-1)},v=e=>Math.ceil(r.length/e),b=e=>K(e,".legend-controls",(()=>e.append("g").attr("class","legend-controls").html(ze()))),_=e=>K(e,".legend",(()=>e.append("svg").attr("class","legend")));return d.decorate=(...e)=>e.length?(c=e[0],d):c,(0,o.rebindAll)(d,n),d},De=e=>Be(Se.legendColor().shape("circle").shapeRadius(6),e),Fe=e=>Be(Se.legendSymbol().shapePadding(1).labelOffset(3),e),He=()=>qe(De),Ie=()=>qe(Fe,We);function We(e){if(!e)return null;const t=e.domain(),n=e.range().map((e=>g.symbol().type(e)()));return g.scaleOrdinal().domain(t).range(n)}function qe(e,t){let n={},a=null,l=null;function r(t){if(a&&a.range().length>1){const r=e(n);r.scale(a).orient("vertical").on("cellclick",(function(e){n.hideKeys=n.hideKeys||[],n.hideKeys.includes(e)?n.hideKeys=n.hideKeys.filter((t=>t!==e)):n.hideKeys.push(e),E(this).draw()})),r.labels((e=>{const t=e.domain[e.i].split("|");return n.mainValues.length<=1&&t.length>1?t.slice(0,t.length-1).join("|"):e.domain[e.i]}));const s=K(t,"div.legend-container",(()=>t.append("div")));r.decorate((e=>{const t=e=>n.hideKeys&&n.hideKeys.includes(e),a=e.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");a.classed("hidden",t),a.append("title").html((e=>e)),l&&a.select("circle, path").style("fill",(e=>t(e)?null:l(e))).style("stroke",(e=>t(e)?null:fe(l(e))))})),s.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(r)}}return r.settings=(...e)=>e.length?(n=e[0],r):n,r.scale=(...e)=>e.length?(a=t?t(e[0]):e[0],r):a,r.color=(...e)=>e.length?(l=e[0],r):l,r}function Ue(e,t){const n=t||e.data;return e.hideKeys&&e.hideKeys.length>0?n.map((t=>{const n={...t};return e.hideKeys.forEach((e=>{delete n[e]})),n})):n}function Ke(e,t){const n=t||e.data;return e.hideKeys&&e.hideKeys.length>0?n.map((t=>{const n={};return Object.keys(t).map((a=>{e.hideKeys.includes(de(a))||(n[a]=t[a])})),n})):n}const Ye=e=>e.style("display","none"),Je=(e,t)=>{let n="both",a=!1,l=null,r=null,s=null,i=o.seriesSvgMulti(),c=o.annotationSvgGridline(),u=(e=>t=>t.style("stroke-width","1.0").style("stroke",e?e.colorStyles.grid.gridLineColor:"#bbb"))(t),d=Ye;const h=function(...h){a&&(i=o.seriesCanvasMulti().context(s),c=o.annotationCanvasGridline(),u=(e=>t=>{t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb",t.lineWidth=1})(t),d=(e=>t=>{t.lineWidth=1,t.strokeStyle=e?e.colorStyles.grid.gridLineColor:"#bbb"})(t));const p=i.xScale(l).yScale(r),g="vertical"===n?d:u,m="horizontal"===n?d:u,f=c.xDecorate(g).yDecorate(m);return p.series([f,e])(...h)};return h.orient=(...e)=>e.length?(n=e[0],h):n,h.canvas=(...e)=>e.length?(a=e[0],h):a,h.xScale=(...e)=>e.length?(l=e[0],h):l,h.yScale=(...e)=>e.length?(r=e[0],h):r,h.context=(...e)=>e.length?(s=e[0],h):s,h},Xe=()=>{const e=_(),t=t=>{let n=e.pad(),a=e.padUnit(),l=1;switch(a){case"domain":break;case"percent":l=t[1]-t[0];break;default:throw new Error("Unknown padUnit: "+a)}let r=t[0]-n[0]*l,s=t[1]+n[1]*l;return t[0]=t[0]>=0&&r<0?0:r,t[1]=t[1]<=0&&s>0?0:s,t};return o.rebindAll(t,e),t};var Ge=n(962),Qe=n.n(Ge);const Ze=()=>{let e=null,t=null,n=null,a=null,l=null,r=null,s=!1,i=!1,o=()=>{};function c(o){const c=`d3fc-${i?"canvas":"svg"}.plot-area`;if(n||l){const i=a&&a.domain()[0]instanceof Date,h=g.zoom().on("zoom",(()=>{const{transform:s}=g.event;t.zoom={k:s.k,x:s.x,y:s.y},u(s),o.call(e);const p=1===s.k&&0===s.x&&0===s.y,m=d(o).style("display",p?"none":"");m.select("#zoom-reset").on("click",(()=>o.select(c).call(h.transform,g.zoomIdentity)));const f=m.select("#one-year").style("display",i?"":"none"),y=m.select("#six-months").style("display",i?"":"none"),x=m.select("#one-month").style("display",i?"":"none");if(i){const e=e=>()=>{const t=new Date(n.domain()[0]),s=new Date(t);e(t,s);const i=a.range(),u=(i[1]-i[0])/(a(s)-a(t)),d=-a(t)*u;let p=0;if(l){const e=l.domain().reduce(((e,t)=>e+t))/2;p=-r(e)*u+l(e)}o.select(c).call(h.transform,g.zoomIdentity.translate(d,p).scale(u))};f.on("click",e(((e,t)=>t.setYear(e.getFullYear()+1)))),y.on("click",e(((e,t)=>t.setMonth(e.getMonth()+6)))),x.on("click",e(((e,t)=>t.setMonth(e.getMonth()+1))))}})),p=e.decorate();e.decorate(((e,n)=>{if(p(e,n),!s){s=!0;const n=e.select(c);n.on("measure.zoom-range",(()=>{if(a&&a.range([0,g.event.detail.width]),r&&r.range([0,g.event.detail.height]),t.zoom){const e=g.zoomIdentity.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);n.call(h.transform,e)}})).call(h)}}))}o.call(e)}c.chart=(...t)=>t.length?(e=t[0],c):e,c.settings=(...e)=>e.length?(t=e[0],c):t,c.xScale=(...e)=>e.length?(n=h(e[0]),a=n?n.copy():null,c):n,c.yScale=(...e)=>{if(!e.length)return l;if(l=h(e[0]),r=l?l.copy():null,r){const e=r.domain();r.domain([e[1],e[0]])}return c},c.canvas=(...e)=>e.length?(i=e[0],c):i,c.onChange=(...e)=>e.length?(o=e[0],c):o;const u=e=>{const t={...e};if(n&&(n.domain(e.rescaleX(a).domain()),t.xDomain=n.domain()),l){const n=e.rescaleY(r).domain();l.domain([n[1],n[0]]),t.yDomain=l.domain()}o(t)},d=e=>K(e,".zoom-controls",(()=>e.append("div").attr("class","zoom-controls").style("display","none").html(Qe()))),h=e=>e&&e.nice?e:null;return c};function et(e,t){const n=Ve(t,Ue(t)),a=he(t),l=He().settings(t).scale(a),r=ce(t,a).orient("horizontal"),s=o.seriesSvgMulti().mapping(((e,t)=>e[t])).series(n.map((()=>r))),i=I(t).settingName("mainValues").valueName("mainValue").excludeType(u).include([0]).paddingStrategy(Xe())(n),c=I(t).excludeType(h).settingName("crossValues").valueName("crossValue").orient("vertical")(n),d=W(i,c).plotArea(Je(s,t).orient("horizontal"));d.yPaddingInner&&(d.yPaddingInner(.5),d.yPaddingOuter(.25),r.align("left")),d.xNice&&d.xNice();const p=Ze().chart(d).settings(t).yScale(c.scale);e.datum(n).call(p),e.call(l)}et.plugin={type:"d3_x_bar",name:"X Bar Chart",max_cells:1e3,max_columns:50,render_warning:!0};const tt=et,nt=e=>2===e.length&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],at=e=>(0-e[0])/(e[1]-e[0]),lt=(e,t)=>t*e[1]/(t-1),rt=(e,t,n=st)=>{let a,l,r;const s=e.splitMainValues||[],i=e=>{const t=e.split("|");return s.includes(t[t.length-1])},c=e.mainValues.some((e=>i(e.name)));l=c?n(t,(e=>!i(e))):t,r=c?n(t,i):null;const u=t=>{if(1===e.mainValues.length)return;const n=e.mainValues.map(((e,t)=>({index:t,name:e.name}))),l=n.filter((e=>!i(e.name))),r=n.filter((e=>i(e.name))),s=()=>(e=>{let t,n=[],a=!1;const l=l=>{l.text("");const s=o.dataJoin("span","splitter-label").key((e=>e)),i=!a&&1===n.length,c=t&&0===e.splitValues.length;s(l,n).classed("disabled",i).text((e=>e.name)).style("color",(e=>c?fe(t(e.name)):void 0)).on("click",(t=>{i||(e.splitMainValues=a?e.splitMainValues.filter((e=>e!=t.name)):[t.name].concat(e.splitMainValues||[]),r(l))}))},r=e=>{const t=E(e.node());t.remove(),t.draw()};return l.labels=(...e)=>e.length?(n=e[0],l):n,l.alt=(...e)=>e.length?(a=e[0],l):a,l.color=(...e)=>e.length?(t=e[0],l):t,l})(e).color(a);t.select(".y-label-container>.y-label").call(s().labels(l)),t.select(".y2-label-container>.y-label").call(s().labels(r).alt(!0))};return u.color=(...e)=>e.length?(a=e[0],u):a,u.haveSplit=()=>c,u.data=(...e)=>e.length?(l=e[0],u):l,u.altData=(...e)=>e.length?(r=e[0],u):r,u},st=(e,t)=>e.map((e=>e.filter((e=>t(e.key))))),it=(e,t)=>e.map((e=>t(e.key)?e:e.map((e=>Object.assign({},e,{mainValue:null}))))),ot=(e,t)=>e.map((e=>it(e,t)));function ct(e,t){const n=Ve(t,Ue(t)),a=he(t),l=He().settings(t).scale(a),r=ce(t,a).orient("vertical"),s=o.seriesSvgMulti().mapping(((e,t)=>e[t])).series(n.map((()=>r))),i=I(t).excludeType(h).settingName("crossValues").valueName("crossValue")(n),c=I(t).settingName("mainValues").valueName("mainValue").excludeType(u).orient("vertical").include([0]).paddingStrategy(Xe()),d=t.mainValues.length>1?ot:it,p=rt(t,n,d).color(a),g=c(p.data()),m=p.haveSplit()?s:Je(s,t).orient("vertical"),f=W(i,g).axisSplitter(p).plotArea(m);f.xPaddingInner&&(f.xPaddingInner(.5),f.xPaddingOuter(.25),r.align("left")),f.yNice&&f.yNice();const y=Ze().chart(f).settings(t).xScale(i.scale);if(p.haveSplit()){const e=c(p.altData());((e,t)=>{if(!nt(e)||!nt(t))return;const n=at(e),a=at(t);n>a?t[0]=lt(t,n):e[0]=lt(e,a)})(g.domain,e.domain),f.yDomain(g.domain).altAxis(e)}e.datum(p.data()).call(y),e.call(l)}ct.plugin={type:"d3_y_bar",name:"Y Bar Chart",max_cells:1e3,max_columns:50,render_warning:!0};const ut=ct;function dt(e,t){let n=o.seriesSvgLine();return n=n.decorate((e=>{e.style("stroke",(e=>fe(t(e[0]&&e[0].key))))})),n.crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue))}const ht=function(e){const t=[];for(const n of e)for(let e=0;e<n.length;e++)null!==n[e].mainValue&&(t[e]=t[e]||[],t[e].push(n[e]));return t},pt=(e,t,n=Math.min)=>{const a=e=>e.reduce(((e,a)=>{const r=l(a,t);return!r||e&&n(e.value,r.value)!==r.value?e:r}),null),l=e=>{if(Array.isArray(e))return a(e);const n=t(e);return null!==n?{item:e,value:n}:null},r=a(e);return r?r.item:null},gt=()=>{const e=ie().alwaysShow(!0);let t=null,n=null,a=null,l=null,r=!1,s=null,i="crossValue",c="mainValue",u=null;function d(a){const l=`d3fc-${r?"canvas":"svg"}.plot-area`;if(t||n){let t=null;const r=o.pointer().on("point",(e=>{const l=e.length?p(e[0]):null;t=l?[l.data]:[];const r=l?l.scale:n;h(a,t,r)}));a.select(l).on("measure.nearbyTip",(()=>h(a,[]))).on("click",(()=>{t.length&&se(a.node(),t[0],e.settings())})).call(r)}}const h=(r,s,o=n)=>{const u=r.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(s);u.exit().remove(),u.enter().append("circle").attr("class","nearbyTip").merge(u).attr("r",(e=>l?Math.sqrt(l(e.size)):10)).attr("transform",(e=>`translate(${t(e[i])},${o(e[c])})`)).style("stroke","none").style("fill",(e=>a&&ye(a(e.key)))),e(u)},p=e=>{const a=n=>a=>void 0===a[c]||null===a[c]||void 0===a[i]||null===a[i]?null:Math.sqrt(Math.pow(t(a[i])-e.x,2)+Math.pow(n(a[c])-e.y,2)),l=a(n),r=pt(s,l,Math.min);if(u){const e=a(u.yScale),t=pt(u.data,e,Math.min);return l(r)<=e(t)?{data:r,scale:n}:{data:t,scale:u.yScale}}return{data:r,scale:n}};return d.xScale=(...e)=>e.length?(t=e[0],d):t,d.yScale=(...e)=>e.length?(n=e[0],d):n,d.color=(...e)=>e.length?(a=e[0],d):a,d.size=(...e)=>e.length?(l=e[0]?e[0].copy().range([40,4e3]):null,d):l,d.canvas=(...e)=>e.length?(r=e[0],d):r,d.data=(...e)=>e.length?(s=e[0],d):s,d.xValueName=(...e)=>e.length?(i=e[0],d):i,d.yValueName=(...e)=>e.length?(c=e[0],d):c,d.altDataWithScale=(...e)=>e.length?(u=e[0],d):u,o.rebindAll(d,e),d};function mt(e,t){const n=function(e,t){const n=be(e);return t.map(((e,t)=>Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).map((a=>({key:a,crossValue:n(e,t),mainValue:e[a],row:e})))))}(t,Ue(t)),a=he(t),l=He().settings(t).scale(a),r=o.seriesSvgRepeat().series(dt(0,a)).orient("horizontal"),s=Xe().pad([.1,.1]).padUnit("percent"),i=I(t).excludeType(h).settingName("crossValues").valueName("crossValue")(n),c=I(t).settingName("mainValues").valueName("mainValue").orient("vertical").paddingStrategy(s),u=rt(t,ht(n)).color(a),d=c(u.data()),p=u.haveSplit()?r:Je(r,t).orient("vertical"),g=W(i,d).axisSplitter(u).plotArea(p);g.yNice&&g.yNice();const m=Ze().chart(g).settings(t).xScale(i.scale),f=gt().settings(t).xScale(i.scale).yScale(d.scale).color(a).data(n);if(u.haveSplit()){const e=c(u.altData());g.altAxis(e),f.data(u.data()).altDataWithScale({yScale:e.scale,data:u.altData()})}const y=u.data();e.datum(y).call(m),e.call(f),e.call(l)}mt.plugin={type:"d3_y_line",name:"Y Line Chart",max_cells:4e3,max_columns:50,render_warning:!0};const ft=mt,yt=[g.symbolCircle,g.symbolCross,g.symbolDiamond,g.symbolSquare,g.symbolStar,g.symbolTriangle,g.symbolWye];function xt(e){return e.length>1?g.scaleOrdinal().domain(e).range(yt):null}function vt(e){const t=e.data&&e.data.length>0?e.data[0]:{},n=[];return Object.keys(t).forEach((e=>{if("__ROW_PATH__"!==e){const t=de(e);n.includes(t)||n.push(t)}})),xt(n)}function bt(e,t){const n=ht(function(e,t){const n=e.mainValues.length;return t.map((e=>{const t=Object.keys(e).filter((e=>"__ROW_PATH__"!==e)),a=new Array(t.length/n);for(let l=0;l<t.length/n;l++)a[l]={key:de(t[l*n]),crossValue:e[t[l*n]],mainValue:e[t[l*n+1]],row:e};return a}))}(t,Ke(t))),a=ge(t),l=vt(t);let r=null;a.domain().length>2&&(r=qe(De,We).settings(t).scale(l).color(a));const s=o.seriesSvgRepeat().series(dt(0,a)).orient("horizontal"),i=Xe().pad([.1,.1]).padUnit("percent"),c=I(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").paddingStrategy(i),u=I(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").orient("vertical").paddingStrategy(i)(n),d=c(n),h=Je(s,t).orient("vertical"),p=W(d,u).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(h);p.xNice&&p.xNice(),p.yNice&&p.yNice();const g=Ze().chart(p).settings(t).xScale(d.scale).yScale(u.scale),m=gt().settings(t).xScale(d.scale).yScale(u.scale).color(a).data(n);e.datum(n).call(g),e.call(m),r&&e.call(r)}bt.plugin={type:"d3_xy_line",name:"X/Y Line Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis"]},selectMode:"toggle"};const _t=bt;function Vt(e,t){const n=function(e,t){const n=be(e);return t.map(((e,t)=>{const a={};return Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).map((l=>{const r=l.split("|"),s=r[r.length-1],i=a[s]||0,o=i+e[l];return a[s]=o,{key:l,crossValue:n(e,t),mainValue:o,baseValue:i,row:e}}))}))}(t,Ue(t)),a=he(t),l=He().settings(t).scale(a),r=o.seriesSvgRepeat().series(function(e,t){let n=o.seriesSvgArea();return n=n.decorate((e=>{e.style("fill",(e=>t(e[0].key)))})),n.crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue)).baseValue((e=>e.baseValue))}(0,a).orient("vertical")),s=I(t).excludeType(h).settingName("crossValues").valueName("crossValue")(n),i=I(t).settingName("mainValues").valueName("mainValue").excludeType(u).orient("vertical").include([0]).paddingStrategy(Xe()),c=rt(t,n).color(a),d=i(c.data()),p=c.haveSplit()?r:Je(r,t).orient("vertical"),g=W(s,d).axisSplitter(c).plotArea(p);g.yNice&&g.yNice();const m=Ze().chart(g).settings(t).xScale(s.scale),f=gt().settings(t).xScale(s.scale).yScale(d.scale).color(a).data(n);if(c.haveSplit()){const e=i(c.altData());g.altAxis(e),f.data(c.data()).altDataWithScale({yScale:e.scale,data:c.altData()})}e.datum(c.data()).call(m),e.call(f),e.call(l)}Vt.plugin={type:"d3_y_area",name:"Y Area Chart",max_cells:4e3,max_columns:50,render_warning:!0};const wt=Vt;function St(e,t){const n=function(e,t){const n={stack:!1},a=_e(e,t,n).map((t=>we(e,t,n)));if(e.mainValues.length>1)return a.reduce(((e,t)=>e.concat(t)));return a}(t,Ue(t)),a=function(e){const t=e.data&&e.data.length>0?e.data[0]:{};return xt(Object.keys(t).filter((e=>"__ROW_PATH__"!==e)))}(t),l=he(t),r=Ie().settings(t).scale(a).color(l),s=o.seriesSvgMulti().mapping(((e,t)=>e[t])).series(n.map((e=>function(e,t,n,a){let l=o.seriesSvgPoint().size(100);const r=e.colorStyles&&e.colorStyles.opacity;return a&&l.type(a(t)),l.decorate((e=>{e.style("stroke",(e=>fe(n(e.colorValue||t)))).style("fill",(e=>ye(n(e.colorValue||t),r)))})),l.crossValue((e=>e.crossValue)).mainValue((e=>e.mainValue))}(t,e.key,l,a)))),i=Xe().pad([.05,.05]).padUnit("percent"),c=I(t).excludeType(h).settingName("crossValues").valueName("crossValue")(n),u=I(t).settingName("mainValues").valueName("mainValue").orient("vertical").paddingStrategy(i),d=rt(t,n).color(l),p=u(d.data()),g=d.haveSplit()?s:Je(s,t).orient("vertical"),m=W(c,p).axisSplitter(d).plotArea(g);m.yNice&&m.yNice();const f=Ze().chart(m).settings(t).xScale(c.scale),y=gt().settings(t).xScale(c.scale).yScale(p.scale).color(l).data(n);if(d.haveSplit()){const e=u(d.altData());m.altAxis(e),y.data(d.data()).altDataWithScale({yScale:e.scale,data:d.altData()})}e.datum(d.data()).call(f),e.call(y),r&&e.call(r)}St.plugin={type:"d3_y_scatter",name:"Y Scatter Chart",max_cells:4e3,max_columns:50,render_warning:!0};const kt=St;function zt(e,t){return _e(e,t,{excludeEmpty:!0}).map((t=>function(e,t){const n=be(e),a=t.map(((a,l)=>({crossValue:n(a,l),mainValues:e.mainValues.map((e=>a[e.name])),x:a[e.mainValues[0].name],y:a[e.mainValues[1].name],colorValue:e.realValues[2]?a[e.realValues[2]]:void 0,size:e.realValues[3]?a[e.realValues[3]]:void 0,key:t.key,row:a})));return a.key=t.key,a}(e,t)))}function At(e,t,n,a){let l=Nt(t,n,a),r=e.colorStyles.gradient.full;if(l[0]>=0)r=e.colorStyles.gradient.positive;else if(l[1]<=0)r=e.colorStyles.gradient.negative;else{const e=Math.max(-l[0],l[1]);l=[-e,e]}const s=Ct(r);return g.scaleSequential(s).domain(l)}const Nt=(e,t,n)=>n||k().valueName(t).pad([0,0])(e),Ct=e=>{const t=e.slice(1).map(((t,n)=>g.interpolate(e[n][1],t[1])));return n=>{const a=e.findIndex(((t,a)=>a<e.length-1&&n<=e[a+1][0]&&n>t[0]));if(-1===a)return n<=e[0][0]?e[0][1]:e[e.length-1][1];const l=t[a],[r]=e[a],[s]=e[a+1];return l((n-r)/(s-r))}};function Mt(){let e=null;function t(t){const n=K(t,"div.legend-container",(()=>t.append("div").attr("class","legend-container legend-color").style("z-index","2"))),{width:a,height:l}=n.node().getBoundingClientRect(),r=g.scaleBand().domain([0,1]).range([0,a]),s=e.copy().nice().domain(),i=o.extentLinear().pad([.1,.1]).padUnit("percent")(s),[c,u]=i,d=g.range(c,u,(u-c)/l),h=g.scaleLinear().domain(i).range([l,0]),p=o.autoBandwidth(o.seriesSvgBar()).xScale(r).yScale(h).crossValue(0).baseValue(((e,t)=>d[Math.max(0,t-1)])).mainValue((e=>e)).decorate((t=>{t.selectAll("path").style("fill",(t=>e(t)))})),m=s[0]<0&&s[1]>0?0:Math.round((s[1]+s[0])/2),f=[...s,m],y=o.axisRight(h).tickValues(f).tickSizeOuter(0).tickFormat((e=>w(e))),x=K(n,"svg",(()=>n.append("svg"))).style("width",a).style("height",l),v=K(x,"g",(()=>x.append("g"))).datum(d).call(p),b=Math.abs(v.node().getBBox().x);K(x,"#legend-axis",(()=>x.append("g").attr("id","legend-axis"))).attr("transform",`translate(${b})`).datum(d).call(y).select(".domain").attr("visibility","hidden")}return t.scale=(...n)=>n.length?(e=n[0],t):e,t}function Ot(e,t){const n=zt(t,Ke(t)),a=vt(t),l=t.realValues.length<=2||null===t.realValues[2];let r=null,s=null;l?(r=ge(t),s=Ie().settings(t).scale(a).color(l?r:null)):(r=At(t,n,"colorValue"),s=Mt().scale(r));const i=t.realValues[3]?function(e,t,n,a){return g.scaleLinear().domain(Nt(t,n,a))}(0,n,"size").range([10,1e4]):null,c=o.seriesCanvasMulti().mapping(((e,t)=>e[t])).series(n.map((e=>function(e,t,n,a,l){let r=(0,o.seriesCanvasPoint)().crossValue((e=>e.x)).mainValue((e=>e.y));return n&&r.size((e=>n(e.size))),l&&r.type(l(t)),r.decorate(((n,l)=>{const r=a(void 0!==l.colorValue?l.colorValue:t),s=e.colorStyles&&e.colorStyles.opacity;n.strokeStyle=fe(r),n.fillStyle=ye(r,s)})),r}(t,e.key,i,r,a)))),u=()=>I(t).settingName("mainValues").paddingStrategy(Xe()).pad([.1,.1]),d=u().settingValue(t.mainValues[0].name).valueName("x")(n),h=u().orient("vertical").settingValue(t.mainValues[1].name).valueName("y")(n),p=q(d,h).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(Je(c,t).canvas(!0));p.xNice&&p.xNice(),p.yNice&&p.yNice();const m=Ze().chart(p).settings(t).xScale(d.scale).yScale(h.scale).canvas(!0),f=gt().settings(t).canvas(!0).xScale(d.scale).xValueName("x").yValueName("y").yScale(h.scale).color(l&&r).size(i).data(n);e.datum(n).call(m),e.call(f),s&&e.call(s)}Ot.plugin={type:"d3_xy_scatter",name:"X/Y Scatter Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Tooltip"]},selectMode:"toggle"};const jt=Ot;function Tt(e,t){const n=function(e,t){const n=be(e),a=p(e).excludeType(h).settingName("splitValues")(),l=[];return t.forEach(((e,t)=>{const r=n(e,t);Object.keys(e).filter((e=>"__ROW_PATH__"!==e)).forEach((t=>{const n=function(e){const t=e.split("|");return t.pop(),t.join("|")}(t);l.push({crossValue:r,mainValue:a===d?new Date(n):n,colorValue:e[t],row:e})}))})),l}(t,Ue(t)),a=At(t,n,"colorValue"),l=function(e,t){let n=o.seriesSvgHeatmap();return n.decorate((n=>{ie().settings(e)(n),n.select("path").attr("fill",(e=>t(e.colorValue)))})),o.autoBandwidth(n).xValue((e=>e.crossValue)).yValue((e=>e.mainValue)).colorValue((e=>e.colorValue)).colorInterpolate(t.interpolator()).widthFraction(1)}(t,a),r=Mt().scale(a),s=I(t).excludeType(h).settingName("crossValues").valueName("crossValue")(n),i=I(t).excludeType(h).settingName("splitValues").valueName("mainValue").orient("vertical")(n),c=W(s,i).plotArea(Je(l,t));c.xPaddingInner&&(c.xPaddingInner(0),c.xPaddingOuter(0),l.xAlign("right")),c.yPaddingInner&&(c.yPaddingInner(0),c.yPaddingOuter(0),l.yAlign("top"));const u=Ze().chart(c).settings(t).xScale(s.scale).yScale(i.scale);e.datum(n).call(u),e.call(r)}Tt.plugin={type:"d3_heatmap",name:"Heatmap",max_cells:1e3,max_columns:50,render_warning:!0};const Rt=Tt;function $t(e,t){return _e(e,t,{excludeEmpty:!0}).map((t=>function(e,t){const n=be(e),a=n=>t[n<t.length-1?n+1:n][e.mainValues[0].name],l=t.map(((l,r)=>{const s=e.mainValues.length>=1?l[e.mainValues[0].name]:void 0,i=e.mainValues.length>=2?l[e.mainValues[1].name]:a(r);return{crossValue:n(l,r),mainValues:e.mainValues.map((e=>l[e.name])),openValue:s,closeValue:i,highValue:e.mainValues.length>=3?l[e.mainValues[2].name]:Math.max(s,i),lowValue:e.mainValues.length>=4?l[e.mainValues[3].name]:Math.min(s,i),key:t.key,row:l}}));return l.key=t.key,l}(e,t)))}const Et=function(e){return function(t,n){const a=$t(n,Ke(n)),l=o.indicatorBollingerBands().value((e=>e.openValue)),r=a.map((e=>{const t=l(e);return e.map(((e,n)=>Object.assign({bollinger:t[n]},e)))})),s=a.map((e=>e.key)).concat(n.hideKeys?n.hideKeys:[]).sort(),i=me().domain(s).settings(n).mapFunction(xe(1))(),c=He().settings(n).scale(s.length>1?i:null),u=function(e,t,n){const a=n.domain(),l=me().domain(a).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(xe(.5))(),r=me().settings(e).domain(a)(),s=t().crossValue((e=>e.crossValue)).openValue((e=>e.openValue)).highValue((e=>e.highValue)).lowValue((e=>e.lowValue)).closeValue((e=>e.closeValue)).decorate(((e,t)=>{const a=(e=>e.closeValue>=e.openValue)(t)?n(t.key):l(t.key);e.fillStyle=a,e.strokeStyle=a})),i=o.seriesCanvasLine().mainValue((e=>e.bollinger.average)).crossValue((e=>e.crossValue)).decorate(((e,t)=>{e.strokeStyle=r(t[0].key)})),c=o.seriesCanvasArea().mainValue((e=>e.bollinger.upper)).baseValue((e=>e.bollinger.lower)).crossValue((e=>e.crossValue)).decorate(((e,t)=>{e.fillStyle=xe(.25)(r(t[0].key))}));return o.seriesCanvasMulti().series([c,s,i])}(n,e,i),d=o.seriesCanvasMulti().mapping(((e,t)=>e[t])).series(r.map((()=>u))),h=Xe().pad([.1,.1]).padUnit("percent"),p=I(n).settingName("crossValues").valueName("crossValue")(r),g=I(n).settingName("mainValues").valueNames(["lowValue","highValue"]).orient("vertical").paddingStrategy(h)(r),m=q(p,g).plotArea(Je(d,n).orient("vertical").canvas(!0));m.yNice&&m.yNice();const f=Ze().chart(m).settings(n).xScale(p.scale).onChange((e=>{const t=r.map((t=>t.filter((t=>t.crossValue>=e.xDomain[0]&&t.crossValue<=e.xDomain[1]))));m.yDomain(g.domainFunction(t))})).canvas(!0),y=gt().settings(n).xScale(p.scale).yScale(g.scale).yValueName("closeValue").color(i).data(r).canvas(!0);t.datum(r).call(f),t.call(y),t.call(c)}},Lt=Et(o.seriesCanvasOhlc);Lt.plugin={type:"d3_ohlc",name:"OHLC Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:4,names:["Open","Close","High","Low"]},selectMode:"toggle"};const Pt=Lt,Bt=Et(o.seriesCanvasCandlestick);Bt.plugin={type:"d3_candlestick",name:"Candlestick Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:4,names:["Open","Close","High","Low"]},selectMode:"toggle"};const Dt=Bt;function Ft(e,t){if(e.realValues.length>1&&null!==e.realValues[1]){var n;const a=e.realValues[1];if("string"===(null===(n=e.mainValues.find((e=>e.name===a)))||void 0===n?void 0:n.type)){return pe(e,t.map((e=>e.data)).filter((e=>e.height>0)).map((e=>Ht(e))).reduce(((e,t)=>e.concat(t))))}return At(e,null,null,(e=>{const t=e=>(t,n)=>void 0===t?n:void 0===n?t:e(t,n);return e.reduce(((e,n)=>[t(Math.min)(e[0],n[0]),t(Math.max)(e[1],n[1])]),[void 0,void 0])})(t.map((e=>e.extents))))}}function Ht(e,t=[]){return e.children&&e.children.length>0?e.children.forEach((e=>t.concat(Ht(e,t)))):e.data.color&&t.push(e.data.color),t}function It(e){const t={},n=e.realValues.map((t=>null===t?null:e.mainValues.find((e=>e.name===t))));e.data.forEach(((a,l)=>{const r=a.__ROW_PATH__;(function(e){const t=[];return Object.keys(e).forEach((e=>{if("__ROW_PATH__"!==e){const n=e.split("|").slice(0,-1).join("|");t.includes(n)||t.push(n)}})),t})(a).forEach((s=>{let i;t[s]||(t[s]=[]),i=t[s],r.forEach(((t,o)=>{let c=i.find((e=>e.name===t));if(c||(c={name:t,children:[]},i.push(c)),e.realValues.length>1&&null!==e.realValues[1]){const t=o===r.length-1,n=Wt(t?a:e.agg_paths[l][o+1]||a,e.mainValues[1],s);void 0!==n&&(c.color=n)}if(e.realValues.length>2&&null!==e.realValues[2]){c.tooltip=[];for(let t=2;t<e.realValues.length;++t)c.tooltip.push(Wt(a,n[t],s))}if(o===r.length-1&&(c.name=r.slice(-1)[0],r.length===e.crossValues.length)){const t=Wt(a,e.mainValues[0],s);c.size=t>0?t:0}i=c.children}))}))}));return Object.entries(t).map((t=>{const n={name:"root",children:t[1]},a=g.hierarchy(n).sum((e=>e.size)),l=g.partition().size([2*Math.PI,a.height+1])(a);return l.each((n=>{n.current=n,n.mainValues=1===e.realValues.length||null===e.realValues[1]&&null===e.realValues[2]?n.value:[n.value,n.data.color].concat(n.data.tooltip||[]).filter((e=>void 0!==e)),n.crossValue=n.ancestors().slice(0,-1).reverse().map((e=>e.data.name)).join("|"),n.key=t[0],n.label=Z(e.crossValues[n.depth-1<0?0:n.depth-1].type,n.data.name)})),{split:t[0],data:l,extents:qt(e,t)}}))}const Wt=(e,t,n)=>n.length?e[`${n}|${t.name}`]:e[t.name];function qt(e,[t,n]){if(e.realValues.length>1&&null!==e.realValues[1]){return[Math.min(...e.data.map((n=>Wt(n,e.mainValues[1],t)))),Math.max(...n.map((e=>e.color)))]}}const Ut=e=>(0,g.arc)().startAngle((e=>e.x0)).endAngle((e=>e.x1)).padAngle((e=>Math.min((e.x1-e.x0)/2,.005))).padRadius(e).innerRadius((t=>Math.max(1,(t.y0-1)*e))).outerRadius((t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1))),Kt=e=>e.y0>=1&&e.x1>e.x0;n(575);const Yt=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;function Jt(e,t){const n=(e.x0+e.x1)/2*180/Math.PI;return`rotate(${n-90}) translate(${(e.y0-1+(e.y1-1))/2*t},0) rotate(${n<180?0:180})`}function Xt(e,t){let n=this.getBBox().width;if(n>t){let a=e.label;const l=(0,g.select)(this);for(;n>t;)a=a.substring(0,a.length-1),l.text((()=>a)),n=this.getBBox().width;l.text((()=>`${a.substring(0,a.length-3).replace(/\s+$/,"")}...`))}}const Gt=(e,t,n,a,l,r,s,i,o)=>(c,u)=>{o.sunburstLevel[i]=c.data.name,c.parent?(n.datum(c.parent),n.style("cursor","pointer"),a.html(`&#8682; ${c.label}`)):(n.datum(e),n.style("cursor","default"),a.html("")),e.each((e=>e.target={x0:2*Math.max(0,Math.min(1,(e.x0-c.x0)/(c.x1-c.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(e.x1-c.x0)/(c.x1-c.x0)))*Math.PI,y0:Math.max(0,e.y0-c.depth),y1:Math.max(0,e.y1-c.depth)}));const d=t.transition().duration(u?0:750);l.transition(d).tween("data",(e=>{const t=(0,g.interpolate)(e.current,e.target);return n=>e.current=t(n)})).filter((function(e){return+this.getAttribute("fill-opacity")||Kt(e.target)})).attr("fill-opacity",(e=>Kt(e.target)?1:0)).attr("user-select",(e=>Kt(e.target)?"initial":"none")).attr("pointer-events",(e=>Kt(e.target)?"initial":"none")).attrTween("d",(e=>()=>Ut(s)(e.current))),r.filter((function(e){return+this.getAttribute("fill-opacity")||Yt(e.target)})).transition(d).attr("fill-opacity",(e=>+Yt(e.target))).attrTween("transform",(e=>()=>Jt(e.current,s)))};function Qt(){let e=null,t=null,n=null,a=null,l=null;const r=r=>{const s=r.selectAll("g.segment").data(n.descendants().slice(1)),i=s.enter().append("g").attr("class","segment");i.append("path"),i.append("text").attr("class","segment").attr("dy","0.35em");const o=i.merge(s),c=o.select("path").attr("fill-opacity",(e=>Kt(e.current)?1:0)).attr("user-select",(e=>Kt(e.current)?"initial":"none")).attr("pointer-events",(e=>Kt(e.current)?"initial":"none")).attr("d",(e=>Ut(l)(e.current)));a&&c.style("fill",(e=>a(e.data.color)));const u=o.select("text").attr("fill-opacity",(e=>+Yt(e.current))).attr("transform",(e=>Jt(e.current,l))).text((e=>e.label)).each((function(e){Xt.call(this,e,l)})),d=r.select("text.parent"),h=r.select("circle").attr("r",l).datum(n),p=Gt(n,r,h,d,c,u,l,t,e);if(e.sunburstLevel){const a=n.descendants().find((n=>n.data.name===e.sunburstLevel[t]));a&&p(a,!0)}else e.sunburstLevel={};h.on("click",(e=>p(e,!1))),c.filter((e=>e.children)).style("cursor","pointer").on("click",(e=>p(e,!1)))};return r.settings=(...t)=>t.length?(e=t[0],r):e,r.split=(...e)=>e.length?(t=e[0],r):t,r.data=(...e)=>e.length?(n=e[0],r):n,r.color=(...e)=>e.length?(a=e[0],r):a,r.radius=(...e)=>e.length?(l=e[0],r):l,r}function Zt(){let e="element-prefix-unset",t=null,n=null,a=null,l=null,r=null;const s=s=>{const i=K(s,"div.inner-container",(()=>s.append("div").attr("class","inner-container"))),o=i.node().getBoundingClientRect(),c=o.height,u=o.width-0,d=s.datum(),h=Math.min(d.length,Math.floor(u/500)),p=Math.ceil(d.length/h);r={width:u/Math.max(h,1),height:Math.min(c,Math.max(c/p,u/Math.max(h,1)))},c/p>.75*r.height&&(r.height=c/p),i.style("grid-template-columns",`repeat(${h}, ${r.width}px)`),i.style("grid-template-rows",`repeat(${p}, ${r.height}px)`),a=i.selectAll(`div.${e}-container`).data(d,(e=>e.split)),a.exit().remove(),n=a.enter().append("div").attr("class",`${e}-container`),l=n.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),t=n.append("svg").append("g").attr("class",e)};return s.elementsPrefix=(...t)=>t.length?(e=t[0],s):e,s.chartContainer=()=>t,s.chartEnter=()=>n,s.chartDiv=()=>a,s.chartTitle=()=>l,s.containerSize=()=>r,s}function en(e,t){if(0===t.crossValues.length)return void console.warn("Unable to render a chart in the absence of any groups.");const n=It(t),a=Ft(t,n),l=Zt().elementsPrefix("sunburst");if(e.datum(n).call(l),a){var r;const n=t.realValues[1];if("string"===(null===(r=t.mainValues.find((e=>e.name===n)))||void 0===r?void 0:r.type)){const n=He().settings(t).scale(a);e.call(n)}else{const t=Mt().scale(a);e.call(t)}}const s=l.chartContainer(),i=l.chartEnter(),o=l.chartDiv(),c=l.chartTitle(),u=l.containerSize();c.each(((e,t,n)=>(0,g.select)(n[t]).text(e.split))),s.append("circle").attr("fill","none").attr("pointer-events","all"),s.append("text").attr("class","parent"),i.merge(o).select("svg").select("g.sunburst").attr("transform",`translate(${u.width/2}, ${u.height/2})`).each((function({split:e,data:n}){const l=(0,g.select)(this),r=this.parentNode,{width:s,height:i}=r.getBoundingClientRect(),o=(Math.min(s,i)-24)/(2*t.crossValues.length);Qt().settings(t).split(e).data(n).color(a).radius(o)(l),ie().settings(t)(l.selectAll("g.segment"))}))}en.plugin={type:"d3_sunburst",name:"Sunburst",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};const tn=en;function nn(e,t){var n;if(e.realValues.length<1||null===e.realValues[1])return;const a=e.realValues[1],l=t.filter((e=>e.height>0)).map((e=>an(e))).reduce(((e,t)=>e.concat(t)));if("string"===(null===(n=e.mainValues.find((e=>e.name===a)))||void 0===n?void 0:n.type))return pe(e,l);return At(e,null,null,[Math.min(...l),Math.max(...l)])}function an(e,t=[]){return e.children&&e.children.length>0?e.children.forEach((e=>t.concat(an(e,t)))):e.data.color&&t.push(e.data.color),t}const ln=e=>!(!e.target||!e.target.textAttributes),rn=(e,t,n)=>{e.selectAll("text").style("font-size",null).attr("class",(e=>mn(e,t,n)));const a=cn(e);dn(a),sn(a)},sn=e=>{const t=e=>e.getBoundingClientRect(),n=[];e.selectAll("text").filter(((e,t,n)=>(0,g.select)(n[t]).attr("class")===fn.high)).each(((e,t,a)=>n.push(a[t]))),e.selectAll("text").filter(((e,t,n)=>(0,g.select)(n[t]).attr("class")===fn.low)).each(((e,a,l)=>{const r=l[a];n.filter((e=>J("x",t(e),t(r))&&J("y",t(e),t(r),-2))).forEach((()=>(0,g.select)(r).attr("dy",Number((0,g.select)(r).attr("dy"))+14)))}))},on={top:1,mid:.7,lower:0},cn=e=>e.filter(((e,t,n)=>(0,g.select)(n[t]).selectAll("text").attr("class")!==fn.zero)),un=e=>e.selectAll("text").each(((e,t,n)=>pn(n[t]))),dn=e=>e.selectAll("text").each(((e,t,n)=>hn(n[t]))),hn=e=>{const t=(0,g.select)(e),n=e.getBoundingClientRect();t.attr("dx",0-n.width/2).attr("dy",0+n.height/4)},pn=e=>{const t=e.parentNode.childNodes[0],n=e.getBoundingClientRect(),a=t.getBoundingClientRect();gn(e,a,n,"left")||gn(e,a,n,"bottom")||(0,g.select)(e).attr("class",(0,g.select)(e).attr("class"))},gn=(e,t,n,a)=>{if(Y(t,n,a)){const t=parseInt((0,g.select)(e).style("font-size"));return t>7?((0,g.select)(e).style("font-size",t-1+"px"),hn(e),pn(e)):((0,g.select)(e).style("font-size",null),(0,g.select)(e).attr("class",fn.zero)),!0}return!1},mn=(e,t,n)=>{if(!n.filter((e=>""!==e)).every((t=>e.crossValue.split("|").includes(t))))return fn.zero;switch(e.depth){case t+1:return fn.high;case t+2:return fn.low;default:return fn.zero}},fn={high:"top",low:"mid",zero:"lower"},yn=(e,t)=>{const n=g.treemap().size([e,t]).paddingInner((e=>1+2*(e.height-1)));return n.tile(g.treemapBinary),n};function xn(e,t,n,a,l,r){!function(e,t,n,a,l){const r={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},s={width:l.x1-l.x0,height:l.y1-l.y0},i={width:s.width/r.width,height:s.height/r.height};n.each((e=>{const n=(e.x0-r.x)*i.width,l=(e.y0-r.y)*i.height,s=jn(e)*i.width,o=Tn(e)*i.height,c=((e,t)=>t.every((t=>e.crossValue.split("|").includes(t))))(e,t)&&e.data.name!=t[a-1];e.mapLevel[a]={x0:n,x1:s+n,y0:l,y1:o+l,visible:c,opacity:c?1:0}})),e.mapLevel[a].levelRoot=!0}(e,t,n,a,l),e.mapLevel[a].levelRoot=!0,function(e,t,n,a){const l=yn(t,n),r=l((0,g.hierarchy)(e.data).sum((e=>e.size))).descendants(),s=e.descendants();r.forEach(((e,t)=>{s[t].mapLevel[a].x0=r[t].x0,s[t].mapLevel[a].x1=r[t].x1,s[t].mapLevel[a].y0=r[t].y0,s[t].mapLevel[a].y1=r[t].y1}))}(e,r.node().getBoundingClientRect().width,r.node().getBoundingClientRect().height,a),bn(n,a)}const vn=(e,t)=>{e.each(((e,n,a)=>{const l=(0,g.select)(a[n]).selectAll("text");e.mapLevel[t].textAttributes={dx:l.attr("dx"),dy:l.attr("dy"),class:l.attr("class"),"font-size":l.style("font-size")}}))};function bn(e,t){e.selectAll("text").each(((e,n,a)=>{const l=(0,g.select)(a[n]),r=(0,g.select)(a[n]).datum(),s=l.attr("class");r.mapLevel[t].textLockedAt={opacity:on[s]}}))}function _n(e,t,n,a,l,r,s,i,o){if(!e.children)return;l.treemapLevel<e.depth?l.treemapRoute.push(e.crossValue):l.treemapRoute.pop(),l.treemapLevel=e.depth;const c=e.crossValue.split("|");e.mapLevel[l.treemapLevel]&&e.mapLevel[l.treemapLevel].levelRoot||xn(e,c,n,l.treemapLevel,i,r),Vn(e,t,n,a,l,r,s,i,l.treemapLevel,c,o)}function Vn(e,t,n,a,l,r,s,i,o,c,u,d=500,h=!0){const p=e.parent,m=s.transition("main transition").duration(d).ease(g.easeCubicOut);n.each((e=>e.target=e.mapLevel[o])),ln(e)||kn(n,u),n.transition(m).tween("data",(e=>{const t=g.interpolate(e.current,e.target);return n=>e.current=t(n)})).styleTween("opacity",(e=>()=>e.current.opacity)).attrTween("pointer-events",(e=>()=>e.target.visible?"all":"none")),t.transition(m).filter((e=>e.target.visible)).styleTween("x",(e=>()=>`${e.current.x0}px`)).styleTween("y",(e=>()=>`${e.current.y0}px`)).styleTween("width",(e=>()=>e.current.x1-e.current.x0+"px")).styleTween("height",(e=>()=>e.current.y1-e.current.y0+"px")),a.transition(m).filter((e=>e.target.visible)).attrTween("x",(e=>()=>e.current.x0+jn(e.current)/2)).attrTween("y",(e=>()=>e.current.y0+Tn(e.current)/2)).end().catch((()=>zn(n))).then((()=>{ln(e)||(sn(f),un(f),async function(e,t,n=400){const a=t.transition("text fade transition").duration(n).ease(g.easeCubicOut);await e.transition(a).filter((e=>e.target.visible)).tween("data",((e,t,n)=>{const a=n[t],l=g.interpolate(wn(e),Sn(a));return t=>e.current.opacity=l(t)})).styleTween("opacity",(e=>()=>e.current.opacity)).end().catch((e=>console.error("Exception in text fade transition",e))).then((()=>e.each(((e,t,n)=>(e=>(0,g.select)(e).style("opacity",null))(n[t])))))}(a,s,d),h&&vn(n,o),zn(n,u,p))})).catch((e=>{console.error("Exception completing promises after main transition",e),zn(n,u,p)})),ln(e)?n.each(((e,t,n)=>{(0,g.select)(n[t]).selectAll("text").attr("dx",e.target.textAttributes.dx).attr("dy",e.target.textAttributes.dy).attr("class",e.target.textAttributes.class).style("font-size",e.target.textAttributes["font-size"])})):(a.each(((e,t,n)=>(e=>(0,g.select)(e).style("opacity",on[(0,g.select)(e).attr("class")]))(n[t]))),rn(n,o,c));const f=cn(n);p?u.hide(!1).text(e.label).onClick((()=>_n(p,t,n,a,l,r,s,i,u)))():u.hide(!0)()}const wn=e=>e.target.textLockedAt.opacity,Sn=e=>on[g.select(e).attr("class")],kn=(e,t)=>{t.deactivate(!0),e.each(((e,t,n)=>{g.select(n[t]).selectAll("rect").attr("pointer-events","none")}))},zn=(e,t)=>{t&&t.deactivate(!1),e.each(((e,t,n)=>{g.select(n[t]).selectAll("rect").attr("pointer-events",null)}))};var An=n(50),Nn=n.n(An);const Cn="leafnode",Mn="branchnode",On="rootnode",jn=e=>e.x1-e.x0,Tn=e=>e.y1-e.y0;function Rn(){let e=null,t=null,n=null,a=null,l=null;const r=r=>{l=function(e){let t=null,n=null,a=!0,l=!1;const r=K(e,".parent-controls",(()=>e.append("div").attr("class","parent-controls").style("display",a?"none":"").html(Nn()))),s=()=>{r.style("display",a?"none":"").select("#goto-parent").style("pointer-events",l?"none":null).html(`\u21ea ${n}`).on("click",(()=>t()))};return s.deactivate=(...e)=>{if(!e.length)return l;l=e[0];const t=r.select("#goto-parent");return l?t.style("pointer-events","none"):t.style("pointer-events",null),s},s.hide=(...e)=>e.length?(a=e[0],s):a,s.text=(...e)=>e.length?(n=e[0],s):n,s.onClick=(...e)=>e.length?(t=e[0],s):t,s}(a),l();const s=t.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]);yn(a.node().getBoundingClientRect().width,a.node().getBoundingClientRect().height)(t);const i=r.selectAll("g").data(t.descendants()),o=i.enter().append("g");o.append("rect"),o.append("text");const c=o.merge(i).sort(((e,t)=>t.depth-e.depth)),u=c.select("rect").attr("class",(e=>`treerect ${((e,t)=>0===t.depth?On:((e,t)=>t.depth===e)(e,t)?Cn:Mn)(s,e)}`)).style("x",(e=>e.x0)).style("y",(e=>e.y0)).style("width",(e=>jn(e))).style("height",(e=>Tn(e)));n&&u.style("fill",(e=>{if(e.data.color)return n(e.data.color)}));const d=c.filter((e=>0!==e.value)).select("text").attr("x",(e=>e.x0+jn(e)/2)).attr("y",(e=>e.y0+Tn(e)/2)).text((e=>e.label)),h=u.filter((e=>""===e.crossValue)).datum();!function(e,t){e.each((e=>{e.mapLevel=[],e.mapLevel[0]={x0:e.x0,x1:jn(e)+e.x0,y0:e.y0,y1:Tn(e)+e.y0,visible:!0,opacity:1}})),t.mapLevel[0].levelRoot=!0,bn(e,0)}(c,h),rn(c,0,[]),un(cn(c)),vn(c,0),0===e.treemapRoute.length&&e.treemapRoute.push(h.crossValue),u.filter((e=>e.children)).on("click",(t=>_n(t,u,c,d,e,a,r,h,l))),function(e,t,n,a,l,r,s,i){if(a.treemapLevel>0){const o=s.crossValue.split("|");Vn(s,e,t,n,a,l,r,s,0,o,i,1,!1),a.treemapRoute.slice(1,a.treemapRoute.length).forEach((o=>{const c=t.filter((e=>e.crossValue===o)).datum(),u=c.crossValue.split("|");xn(c,u,t,c.depth,s,l),Vn(c,e,t,n,a,l,r,s,c.depth,u,i,1,!1)}))}}(u,c,d,e,a,r,h,l)};return r.settings=(...t)=>t.length?(e=t[0],r):e,r.data=(...e)=>e.length?(t=e[0],r):t,r.color=(...e)=>e.length?(n=e[0],r):n,r.container=(...e)=>e.length?(a=e[0],r):a,r}function $n(e,t){if(0===t.crossValues.length)return void console.warn("Unable to render a chart in the absence of any groups.");t.treemaps||(t.treemaps={});const n=It(t),a=nn(t,n.map((e=>e.data)));a&&this._container.classList.add("has-legend");const l=Zt().elementsPrefix("treemap");if(e.datum(n).call(l),a){var r;const n=t.realValues[1];if("string"===(null===(r=t.mainValues.find((e=>e.name===n)))||void 0===r?void 0:r.type)){const n=He().settings(t).scale(a);e.call(n)}else{const t=Mt().scale(a);e.call(t)}}const s=l.chartEnter(),i=l.chartDiv();l.chartTitle().each(((e,t,n)=>g.select(n[t]).text(e.split))),s.merge(i).select("svg").select("g.treemap").each((function({split:e,data:n}){const l=g.select(this);t.treemaps[e]||(t.treemaps[e]={}),Rn().settings(t.treemaps[e]).data(n).container(g.select(g.select(this.parentNode).node().parentNode)).color(a)(l),ie().settings(t).centered(!0)(l.selectAll("g"))}))}$n.plugin={type:"d3_treemap",name:"Treemap",max_cells:5e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};const En=[tt,ut,ft,_t,wt,kt,jt,Pt,Dt,$n,tn,Rt];n(603),n(485);var Ln=n(903),Pn=n.n(Ln),Bn=n(282),Dn=n.n(Bn),Fn=n(924);const Hn=e=>g.color(e).opacity,In=(e,t)=>{const n=g.color(`#${e}`);return n.opacity=t,n+""},Wn=e=>{if(window.ShadyCSS)return t=>window.ShadyCSS.getComputedStyleValue(e,t);{const t=getComputedStyle(e);return e=>t.getPropertyValue(e)}},qn=(e,t)=>{const n=Fn.parse(e)[0].colorStops;return n.map(((e,a)=>[e.length?e.length.value/100:a/(n.length-1),In(e.value,t)])).sort(((e,t)=>e[0]-t[0]))};var Un,Kn=n(944);function Yn(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(Yn.prototype,HTMLElement.prototype),Object.setPrototypeOf(Yn,HTMLElement);const Jn=`${Pn()}${function(){const e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach((e=>{-1!==e.innerText.indexOf("d3fc-")&&t.push(e.innerText)})),t.join("")}()}`,Xn=["crossValues","mainValues","splitValues","filter","data","size","colorStyles"];(0,Kn.bindTemplate)(Dn(),Jn)(Un=class extends Yn{constructor(){super(),this._chart=null,this._settings=null}connectedCallback(){this._container=this.shadowRoot.querySelector(".chart")}render(e,t){this._chart=e;const n={set:(e,t,n)=>(Xn.includes(t)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),e[t]=n,!0)};this._settings=new Proxy(this._configureSettings(this._settings,t),n),((e,t)=>{if(!t.colorStyles){const n=["series"];for(let e=1;e<=10;e++)n.push(`series-${e}`);const a={scheme:[],gradient:{},interpolator:{},grid:{}},l=Wn(e);n.forEach(((e,t)=>{a[e]=l(`--d3fc-${e}`),t>0&&a.scheme.push(a[e])})),a.opacity=Hn(a.series),a.grid.gridLineColor=l`--d3fc-gridline--color`,["full","positive","negative"].forEach((e=>{const t=l(`--d3fc-${e}--gradient`);a.gradient[e]=qn(t,a.opacity)})),t.colorStyles=a}})(this._container,this._settings),(this._settings.data&&this._settings.data.length>0||e.plugin.type!==this._chart.plugin.type)&&this.remove(),this.draw(),window.navigator.userAgent.indexOf("Edge")>-1&&setTimeout((()=>this.draw()))}draw(){if(this._settings.data){const e=g.select(this._container),t=`chart ${this._chart.plugin.type}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(e.attr("class",t),this._settings):e.attr("class",`${t} disabled`)}}resize(){this.draw()}remove(){this._container.innerHTML=""}delete(){this.remove()}getContainer(){return this._container}getSettings(){const e={...this._settings};return Xn.forEach((t=>{delete e[t]})),e}setSettings(e){this._settings={...this._settings,...e},this.draw()}_configureSettings(e,t){if(e){if(!e.data)return{...e,...t};const l=[e.crossValues,e.mainValues,e.splitValues,e.realValues],r=[t.crossValues,t.mainValues,t.splitValues,t.realValues];if(n=l,a=r,JSON.stringify(n)===JSON.stringify(a))return{...e,data:t.data,agg_paths:t.agg_paths,colorStyles:null}}var n,a;return this.remove(),t}});const Gn=Symbol("D3FC chart"),Qn={initial:{type:"number",count:1},selectMode:"select"};function Zn(e){return async function(t,n,a,l,r){let s,i;const o=JSON.parse(this.getAttribute("columns")),c="d3_sunburst"!==e.plugin.type;if(s=l&&r?n.to_json({end_row:r,end_col:l,leaves_only:c}):l?n.to_json({end_col:l,leaves_only:c}):r?n.to_json({end_row:r,leaves_only:c}):n.to_json({leaves_only:c}),i=await Promise.all([this._table.schema(!1),n.expression_schema(!1),n.schema(!1),s,n.get_config()]),a.cancelled)return;let[u,d,h,p,g]=i;const m=function(e){let t=u[e];return t||(t=d[e]),t},{columns:f,row_pivots:y,column_pivots:x,filter:v}=g,b=y.length>0?p.reduce(((e,t)=>{if(t.__ROW_PATH__&&t.__ROW_PATH__.length==y.length)e.agg_paths.push(e.aggs.slice()),e.rows.push(t);else{const n=t.__ROW_PATH__.filter((e=>void 0!==e)).length;e.aggs[n]=t,e.aggs=e.aggs.slice(0,n+1)}return e}),{rows:[],aggs:[],agg_paths:[]}):{rows:p},_=b.rows.map(((e,t)=>y.length?e:{...e,__ROW_PATH__:[t]}));let V={realValues:o,crossValues:y.map((e=>({name:e,type:m(e)}))),mainValues:f.map((e=>({name:e,type:h[e]}))),splitValues:x.map((e=>({name:e,type:m(e)}))),filter:v,data:_,agg_paths:b.agg_paths};ta.call(this,t,e,V),await new Promise(setTimeout)}}function ea(){let e;return this[Gn]=this[Gn]||{},e=this[Gn].chart?this[Gn].chart:this[Gn].chart=document.createElement("perspective-d3fc-chart"),e}function ta(e,t,n){const a=ea.call(this);e.contains(a)||(e.innerHTML="",e.appendChild(a)),a.render(t,n)}function na(){if(this[Gn]&&this[Gn].chart){this[Gn].chart.resize()}}function aa(){if(this[Gn]&&this[Gn].chart){this[Gn].chart.delete()}}function la(){if(this[Gn]&&this[Gn].chart){return this[Gn].chart.getSettings()}}function ra(e){ea.call(this).setSettings(e)}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),function(...e){e=new Set(e.length>0?e:En.map((e=>e.plugin.type))),En.forEach((t=>{e.has(t.plugin.type)&&(0,i.registerPlugin)(t.plugin.type,{...Qn,...t.plugin,create:Zn(t),resize:na,delete:aa,save:la,restore:ra})}))}()},485:()=>{Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})},603:()=>{Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector)},944:e=>{"use strict";e.exports=u},100:e=>{"use strict";e.exports=n},974:e=>{"use strict";e.exports=s},988:t=>{"use strict";t.exports=e},575:e=>{"use strict";e.exports=o},536:e=>{"use strict";e.exports=t},680:e=>{"use strict";e.exports=l},237:e=>{"use strict";e.exports=r},215:e=>{"use strict";e.exports=i},902:e=>{"use strict";e.exports=a},924:e=>{"use strict";e.exports=c}},h={};function p(e){if(h[e])return h[e].exports;var t=h[e]={id:e,exports:{}};return d[e](t,t.exports,p),t.exports}return p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var n in t)p.o(t,n)&&!p.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p(451)})()}));
//# sourceMappingURL=perspective-viewer-d3fc.js.map